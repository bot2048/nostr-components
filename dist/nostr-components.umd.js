(function(j,z){typeof exports=="object"&&typeof module<"u"?z(exports):typeof define=="function"&&define.amd?define(["exports"],z):(j=typeof globalThis<"u"?globalThis:j||self,z(j.NostrComponents={}))})(this,function(exports){"use strict";var Pe=Object.defineProperty;var Ae=j=>{throw TypeError(j)};var Ue=(j,z,W)=>z in j?Pe(j,z,{enumerable:!0,configurable:!0,writable:!0,value:W}):j[z]=W;var p=(j,z,W)=>Ue(j,typeof z!="symbol"?z+"":z,W),Me=(j,z,W)=>z.has(j)||Ae("Cannot "+W);var $e=(j,z,W)=>z.has(j)?Ae("Cannot add the same private member more than once"):z instanceof WeakSet?z.add(j):z.set(j,W);var xe=(j,z,W)=>(Me(j,z,"access private method"),W);var j,z,W,ae,ue,ce,me,se,le,de,ne,he,pe,be,Ee,ie,Ne,Se,Le;const DEFAULT_RELAYS=["wss://relay.damus.io","wss://nostr.wine","wss://relay.nostr.net","wss://relay.nostr.band","wss://nos.lol","wss://nostr-pub.wellorder.net","wss://njump.me","wss://relay.getalby.com","wss://relay.primal.net","wss://nostr.malin.onl","wss://nostrsatva.net","wss://purplepag.es"],MILLISATS_PER_SAT=1e3;var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var lib$1={},types={};Object.defineProperty(types,"__esModule",{value:!0});var ee={},taskCollection$1={},taskCollection={},utils$1={};Object.defineProperty(utils$1,"__esModule",{value:!0}),utils$1._fast_remove_single=void 0;function _fast_remove_single(n,e){e!==-1&&(e===0?n.shift():e===n.length-1?n.length=n.length-1:n.splice(e,1))}utils$1._fast_remove_single=_fast_remove_single;var bakeCollection={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0,exports.BAKED_EMPTY_FUNC=function(){};var FORLOOP_FALLBACK=1500;function generateArgsDefCode(n){var e="";if(n===0)return e;for(var t=0;t<n-1;++t)e+="arg"+String(t)+", ";return e+="arg"+String(n-1),e}function generateBodyPartsCode(n,e){for(var t="",r="",s=0;s<e;++s)t+="var f".concat(s," = collection[").concat(s,`];
`),r+="f".concat(s,"(").concat(n,`)
`);return{funcDefCode:t,funcCallCode:r}}function generateBodyPartsVariadicCode(n){for(var e="",t="",r=0;r<n;++r)e+="var f".concat(r," = collection[").concat(r,`];
`),t+="f".concat(r,`.apply(undefined, arguments)
`);return{funcDefCode:e,funcCallCode:t}}function bakeCollection(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                `).concat(funcCallCode,`
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);collection.length%10===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 10) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                        collection[i+4](`).concat(argsDefCode,`);
                        collection[i+5](`).concat(argsDefCode,`);
                        collection[i+6](`).concat(argsDefCode,`);
                        collection[i+7](`).concat(argsDefCode,`);
                        collection[i+8](`).concat(argsDefCode,`);
                        collection[i+9](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%4===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 4) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%3===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 3) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                    }
                });
            })`):funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; ++i) {
                        collection[i](`).concat(argsDefCode,`);
                    }
                });
            })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollection=bakeCollection;function bakeCollectionAwait(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                return Promise.all([ `).concat(funcCallCode,` ]);
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=`(function(collection) {
            return (function(`.concat(argsDefCode,`) {
                var promises = Array(collection.length);
                for (var i = 0; i < collection.length; ++i) {
                    promises[i] = collection[i](`).concat(argsDefCode,`);
                }
                return Promise.all(promises);
            });
        })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionAwait=bakeCollectionAwait;function bakeCollectionVariadic(collection){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function() {
                `).concat(funcCallCode,`
            });
        })`)}else funcFactoryCode=`(function(collection) {
            return (function() {
                for (var i = 0; i < collection.length; ++i) {
                    collection[i].apply(undefined, arguments);
                }
            });
        })`;{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionVariadic=bakeCollectionVariadic})(bakeCollection);var __spreadArray$1=commonjsGlobal&&commonjsGlobal.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,o;r<s;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(taskCollection,"__esModule",{value:!0}),taskCollection.TaskCollection=void 0;var utils_1$1=utils$1,bake_collection_1=bakeCollection;function push_norebuild(n,e){var t=this.length;if(t>1)if(e){var r;(r=this._tasks).push.apply(r,arguments),this.length+=arguments.length}else this._tasks.push(n),this.length++;else if(e){if(t===1){var s=Array(1+arguments.length);s.push(s),s.push.apply(s,arguments),this._tasks=s}else{var s=Array(arguments.length);s.push.apply(s,arguments),this._tasks=s}this.length+=arguments.length}else t===1?this._tasks=[this._tasks,n]:this._tasks=n,this.length++}function push_rebuild(n,e){var t=this.length;if(t>1)if(e){var r;(r=this._tasks).push.apply(r,arguments),this.length+=arguments.length}else this._tasks.push(n),this.length++;else if(e){if(t===1){var s=Array(1+arguments.length);s.push(s),s.push.apply(s,arguments),this._tasks=s}else{var s=Array(arguments.length);s.push.apply(s,arguments),this._tasks=s}this.length+=arguments.length}else t===1?this._tasks=[this._tasks,n]:this._tasks=n,this.length++;this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild()}function removeLast_norebuild(n){this.length!==0&&(this.length===1?this._tasks===n&&(this.length=0):((0,utils_1$1._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(n)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function removeLast_rebuild(n){if(this.length!==0){if(this.length===1)if(this._tasks===n&&(this.length=0),this.firstEmitBuildStrategy){this.call=bake_collection_1.BAKED_EMPTY_FUNC;return}else{this.rebuild();return}else(0,utils_1$1._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(n)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length;this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild()}}function insert_norebuild(n){for(var e,t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.length===0?(this._tasks=t,this.length=1):this.length===1?(t.unshift(this._tasks),this._tasks=t,this.length=this._tasks.length):((e=this._tasks).splice.apply(e,__spreadArray$1([n,0],t,!1)),this.length=this._tasks.length)}function insert_rebuild(n){for(var e,t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.length===0?(this._tasks=t,this.length=1):this.length===1?(t.unshift(this._tasks),this._tasks=t,this.length=this._tasks.length):((e=this._tasks).splice.apply(e,__spreadArray$1([n,0],t,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild()}function rebuild_noawait(){this.length===0?this.call=bake_collection_1.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,bake_collection_1.bakeCollection)(this._tasks,this.argsNum)}function rebuild_await(){this.length===0?this.call=bake_collection_1.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,bake_collection_1.bakeCollectionAwait)(this._tasks,this.argsNum)}function rebuild_on_first_call(){this.rebuild(),this.call.apply(void 0,arguments)}var TaskCollection=function(){function n(e,t,r,s){t===void 0&&(t=!0),r===void 0&&(r=null),s===void 0&&(s=!1),this.awaitTasks=s,this.call=bake_collection_1.BAKED_EMPTY_FUNC,this.argsNum=e,this.firstEmitBuildStrategy=!0,s?this.rebuild=rebuild_await.bind(this):this.rebuild=rebuild_noawait.bind(this),this.setAutoRebuild(t),r?typeof r=="function"?(this._tasks=r,this.length=1):(this._tasks=r,this.length=r.length):(this._tasks=null,this.length=0),t&&this.rebuild()}return n}();taskCollection.TaskCollection=TaskCollection;function fastClear(){this._tasks=null,this.length=0,this.call=bake_collection_1.BAKED_EMPTY_FUNC}function clear(){this._tasks=null,this.length=0,this.call=bake_collection_1.BAKED_EMPTY_FUNC}function growArgsNum(n){this.argsNum<n&&(this.argsNum=n,this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild())}function setAutoRebuild(n){n?(this.push=push_rebuild.bind(this),this.insert=insert_rebuild.bind(this),this.removeLast=removeLast_rebuild.bind(this)):(this.push=push_norebuild.bind(this),this.insert=insert_norebuild.bind(this),this.removeLast=removeLast_norebuild.bind(this))}function tasksAsArray(){return this.length===0?[]:this.length===1?[this._tasks]:this._tasks}function setTasks(n){n.length===0?(this.length=0,this.call=bake_collection_1.BAKED_EMPTY_FUNC):n.length===1?(this.length=1,this.call=n[0],this._tasks=n[0]):(this.length=n.length,this._tasks=n,this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild())}TaskCollection.prototype.fastClear=fastClear,TaskCollection.prototype.clear=clear,TaskCollection.prototype.growArgsNum=growArgsNum,TaskCollection.prototype.setAutoRebuild=setAutoRebuild,TaskCollection.prototype.tasksAsArray=tasksAsArray,TaskCollection.prototype.setTasks=setTasks,function(n){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o);var u=Object.getOwnPropertyDescriptor(s,o);(!u||("get"in u?!s.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(r,a,u)}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),t=commonjsGlobal&&commonjsGlobal.__exportStar||function(r,s){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,r,o)};Object.defineProperty(n,"__esModule",{value:!0}),t(taskCollection,n)}(taskCollection$1);var utils={};Object.defineProperty(utils,"__esModule",{value:!0}),utils.nullObj=void 0;function nullObj(){var n={};return n.__proto__=null,n}utils.nullObj=nullObj;var __spreadArray=commonjsGlobal&&commonjsGlobal.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,o;r<s;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(ee,"__esModule",{value:!0}),ee.EventEmitter=void 0;var task_collection_1=taskCollection$1,utils_1=utils$1,utils_2=utils;function emit(n,e,t,r,s,o){var a=this.events[n];if(a){if(a.length===0)return!1;if(a.argsNum<6)a.call(e,t,r,s,o);else{for(var u=new Array(a.argsNum),c=0,l=u.length;c<l;++c)u[c]=arguments[c+1];a.call.apply(void 0,u)}return!0}return!1}function emitHasOnce(n,e,t,r,s,o){var a=this.events[n],u;if(a!==void 0){if(a.length===0)return!1;if(a.argsNum<6)a.call(e,t,r,s,o);else{u=new Array(a.argsNum);for(var c=0,l=u.length;c<l;++c)u[c]=arguments[c+1];a.call.apply(void 0,u)}}var f=this.onceEvents[n];if(f){if(typeof f=="function")if(this.onceEvents[n]=void 0,arguments.length<6)f(e,t,r,s,o);else{if(u===void 0){u=new Array(arguments.length-1);for(var c=0,l=u.length;c<l;++c)u[c]=arguments[c+1]}f.apply(void 0,u)}else{var h=f;if(this.onceEvents[n]=void 0,arguments.length<6)for(var c=0;c<h.length;++c)h[c](e,t,r,s,o);else{if(u===void 0){u=new Array(arguments.length-1);for(var c=0,l=u.length;c<l;++c)u[c]=arguments[c+1]}for(var c=0;c<h.length;++c)h[c].apply(void 0,u)}}return!0}return a!==void 0}var EventEmitter=function(){function n(){this.events=(0,utils_2.nullObj)(),this.onceEvents=(0,utils_2.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(n.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),n}();ee.EventEmitter=EventEmitter;function once(n,e){switch(this.emit===emit&&(this.emit=emitHasOnce),typeof this.onceEvents[n]){case"undefined":this.onceEvents[n]=e,typeof n=="symbol"&&this._symbolKeys.add(n);break;case"function":this.onceEvents[n]=[this.onceEvents[n],e];break;case"object":this.onceEvents[n].push(e)}return this}function addListener(n,e,t){if(t===void 0&&(t=e.length),typeof e!="function")throw new TypeError("The listener must be a function");var r=this.events[n];return r?(r.push(e),r.growArgsNum(t),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(n),'" event!'))):(this.events[n]=new task_collection_1.TaskCollection(t,!0,e,!1),typeof n=="symbol"&&this._symbolKeys.add(n)),this}function removeListener(n,e){var t=this.events[n];t&&t.removeLast(e);var r=this.onceEvents[n];return r&&(typeof r=="function"?this.onceEvents[n]=void 0:typeof r=="object"&&(r.length===1&&r[0]===e?this.onceEvents[n]=void 0:(0,utils_1._fast_remove_single)(r,r.lastIndexOf(e)))),this}function addListenerBound(n,e,t,r){t===void 0&&(t=this),r===void 0&&(r=e.length),this.boundFuncs||(this.boundFuncs=new Map);var s=e.bind(t);return this.boundFuncs.set(e,s),this.addListener(n,s,r)}function removeListenerBound(n,e){var t,r,s=(t=this.boundFuncs)===null||t===void 0?void 0:t.get(e);return(r=this.boundFuncs)===null||r===void 0||r.delete(e),this.removeListener(n,s)}function hasListeners(n){return this.events[n]&&!!this.events[n].length}function prependListener(n,e,t){if(t===void 0&&(t=e.length),typeof e!="function")throw new TypeError("The listener must be a function");var r=this.events[n];return!r||!(r instanceof task_collection_1.TaskCollection)?(r=this.events[n]=new task_collection_1.TaskCollection(t,!0,e,!1),typeof n=="symbol"&&this._symbolKeys.add(n)):(r.insert(0,e),r.growArgsNum(t),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(n),'" event!'))),this}function prependOnceListener(n,e){this.emit===emit&&(this.emit=emitHasOnce);var t=this.onceEvents[n];return t?typeof t!="object"?(this.onceEvents[n]=[e,t],typeof n=="symbol"&&this._symbolKeys.add(n)):(t.unshift(e),this.maxListeners!==1/0&&this.maxListeners<=t.length&&console.warn('Maximum event listeners for "'.concat(String(n),'" once event!'))):(this.onceEvents[n]=[e],typeof n=="symbol"&&this._symbolKeys.add(n)),this}function removeAllListeners(n){return n===void 0?(this.events=(0,utils_2.nullObj)(),this.onceEvents=(0,utils_2.nullObj)(),this._symbolKeys=new Set):(this.events[n]=void 0,this.onceEvents[n]=void 0,typeof n=="symbol"&&this._symbolKeys.delete(n)),this}function setMaxListeners(n){return this.maxListeners=n,this}function getMaxListeners(){return this.maxListeners}function listeners(n){return this.emit===emit?this.events[n]?this.events[n].tasksAsArray().slice():[]:this.events[n]&&this.onceEvents[n]?__spreadArray(__spreadArray([],this.events[n].tasksAsArray(),!0),typeof this.onceEvents[n]=="function"?[this.onceEvents[n]]:this.onceEvents[n],!0):this.events[n]?this.events[n].tasksAsArray():this.onceEvents[n]?typeof this.onceEvents[n]=="function"?[this.onceEvents[n]]:this.onceEvents[n]:[]}function eventNames(){var n=this;if(this.emit===emit){var e=Object.keys(this.events);return __spreadArray(__spreadArray([],e,!0),Array.from(this._symbolKeys),!0).filter(function(r){return r in n.events&&n.events[r]&&n.events[r].length})}else{var e=Object.keys(this.events).filter(function(s){return n.events[s]&&n.events[s].length}),t=Object.keys(this.onceEvents).filter(function(s){return n.onceEvents[s]&&n.onceEvents[s].length});return __spreadArray(__spreadArray(__spreadArray([],e,!0),t,!0),Array.from(this._symbolKeys).filter(function(s){return s in n.events&&n.events[s]&&n.events[s].length||s in n.onceEvents&&n.onceEvents[s]&&n.onceEvents[s].length}),!0)}}function listenerCount(n){return this.emit===emit?this.events[n]&&this.events[n].length||0:(this.events[n]&&this.events[n].length||0)+(this.onceEvents[n]&&this.onceEvents[n].length||0)}EventEmitter.prototype.emit=emit,EventEmitter.prototype.on=addListener,EventEmitter.prototype.once=once,EventEmitter.prototype.addListener=addListener,EventEmitter.prototype.removeListener=removeListener,EventEmitter.prototype.addListenerBound=addListenerBound,EventEmitter.prototype.removeListenerBound=removeListenerBound,EventEmitter.prototype.hasListeners=hasListeners,EventEmitter.prototype.prependListener=prependListener,EventEmitter.prototype.prependOnceListener=prependOnceListener,EventEmitter.prototype.off=removeListener,EventEmitter.prototype.removeAllListeners=removeAllListeners,EventEmitter.prototype.setMaxListeners=setMaxListeners,EventEmitter.prototype.getMaxListeners=getMaxListeners,EventEmitter.prototype.listeners=listeners,EventEmitter.prototype.eventNames=eventNames,EventEmitter.prototype.listenerCount=listenerCount,function(n){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o);var u=Object.getOwnPropertyDescriptor(s,o);(!u||("get"in u?!s.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(r,a,u)}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),t=commonjsGlobal&&commonjsGlobal.__exportStar||function(r,s){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,r,o)};Object.defineProperty(n,"__esModule",{value:!0}),t(types,n),t(ee,n)}(lib$1);var browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var n=1e3,e=n*60,t=e*60,r=t*24,s=r*7,o=r*365.25;ms=function(f,h){h=h||{};var g=typeof f;if(g==="string"&&f.length>0)return a(f);if(g==="number"&&isFinite(f))return h.long?c(f):u(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function a(f){if(f=String(f),!(f.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(h){var g=parseFloat(h[1]),m=(h[2]||"ms").toLowerCase();switch(m){case"years":case"year":case"yrs":case"yr":case"y":return g*o;case"weeks":case"week":case"w":return g*s;case"days":case"day":case"d":return g*r;case"hours":case"hour":case"hrs":case"hr":case"h":return g*t;case"minutes":case"minute":case"mins":case"min":case"m":return g*e;case"seconds":case"second":case"secs":case"sec":case"s":return g*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return g;default:return}}}}function u(f){var h=Math.abs(f);return h>=r?Math.round(f/r)+"d":h>=t?Math.round(f/t)+"h":h>=e?Math.round(f/e)+"m":h>=n?Math.round(f/n)+"s":f+"ms"}function c(f){var h=Math.abs(f);return h>=r?l(f,h,r,"day"):h>=t?l(f,h,t,"hour"):h>=e?l(f,h,e,"minute"):h>=n?l(f,h,n,"second"):f+" ms"}function l(f,h,g,m){var v=h>=g*1.5;return Math.round(f/g)+" "+m+(v?"s":"")}return ms}function setup(n){t.debug=t,t.default=t,t.coerce=c,t.disable=a,t.enable=s,t.enabled=u,t.humanize=requireMs(),t.destroy=l,Object.keys(n).forEach(f=>{t[f]=n[f]}),t.names=[],t.skips=[],t.formatters={};function e(f){let h=0;for(let g=0;g<f.length;g++)h=(h<<5)-h+f.charCodeAt(g),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(f){let h,g=null,m,v;function b(...y){if(!b.enabled)return;const w=b,S=Number(new Date),B=S-(h||S);w.diff=B,w.prev=h,w.curr=S,h=S,y[0]=t.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let N=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(R,C)=>{if(R==="%%")return"%";N++;const I=t.formatters[C];if(typeof I=="function"){const D=y[N];R=I.call(w,D),y.splice(N,1),N--}return R}),t.formatArgs.call(w,y),(w.log||t.log).apply(w,y)}return b.namespace=f,b.useColors=t.useColors(),b.color=t.selectColor(f),b.extend=r,b.destroy=t.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>g!==null?g:(m!==t.namespaces&&(m=t.namespaces,v=t.enabled(f)),v),set:y=>{g=y}}),typeof t.init=="function"&&t.init(b),b}function r(f,h){const g=t(this.namespace+(typeof h>"u"?":":h)+f);return g.log=this.log,g}function s(f){t.save(f),t.namespaces=f,t.names=[],t.skips=[];const h=(typeof f=="string"?f:"").trim().replace(" ",",").split(",").filter(Boolean);for(const g of h)g[0]==="-"?t.skips.push(g.slice(1)):t.names.push(g)}function o(f,h){let g=0,m=0,v=-1,b=0;for(;g<f.length;)if(m<h.length&&(h[m]===f[g]||h[m]==="*"))h[m]==="*"?(v=m,b=g,m++):(g++,m++);else if(v!==-1)m=v+1,b++,g=b;else return!1;for(;m<h.length&&h[m]==="*";)m++;return m===h.length}function a(){const f=[...t.names,...t.skips.map(h=>"-"+h)].join(",");return t.enable(""),f}function u(f){for(const h of t.skips)if(o(f,h))return!1;for(const h of t.names)if(o(f,h))return!0;return!1}function c(f){return f instanceof Error?f.stack||f.message:f}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var common=setup;(function(n,e){e.formatArgs=r,e.save=s,e.load=o,e.useColors=t,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;c.splice(1,0,l,"color: inherit");let f=0,h=0;c[0].replace(/%[a-zA-Z%]/g,g=>{g!=="%%"&&(f++,g==="%c"&&(h=f))}),c.splice(h,0,l)}e.log=console.debug||console.log||(()=>{});function s(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function o(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=process.env.DEBUG),c}function a(){try{return localStorage}catch{}}n.exports=common(e);const{formatters:u}=n.exports;u.j=function(c){try{return JSON.stringify(c)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(browser,browser.exports);var browserExports=browser.exports;const createDebug5=getDefaultExportFromCjs(browserExports);function number$2(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`Wrong positive integer: ${n}`)}function bytes$2(n,...e){if(!(n instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(n.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${n.length}`)}function hash$1(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$2(n.outputLen),number$2(n.blockLen)}function exists$1(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function output$1(n,e){bytes$2(n);const t=e.outputLen;if(n.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const crypto$2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a$2=n=>n instanceof Uint8Array,createView$2=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),rotr$2=(n,e)=>n<<32-e|n>>>e,isLE$2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$2)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$4(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function toBytes$2(n){if(typeof n=="string"&&(n=utf8ToBytes$4(n)),!u8a$2(n))throw new Error(`expected Uint8Array, got ${typeof n}`);return n}function concatBytes$4(...n){const e=new Uint8Array(n.reduce((r,s)=>r+s.length,0));let t=0;return n.forEach(r=>{if(!u8a$2(r))throw new Error("Uint8Array expected");e.set(r,t),t+=r.length}),e}let Hash$2=class{clone(){return this._cloneInto()}};function wrapConstructor$2(n){const e=r=>n().update(toBytes$2(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function randomBytes$2(n=32){if(crypto$2&&typeof crypto$2.getRandomValues=="function")return crypto$2.getRandomValues(new Uint8Array(n));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$2(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const s=BigInt(32),o=BigInt(4294967295),a=Number(t>>s&o),u=Number(t&o),c=r?4:0,l=r?0:4;n.setUint32(e+c,a,r),n.setUint32(e+l,u,r)}let SHA2$1=class extends Hash$2{constructor(e,t,r,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$2(this.buffer)}update(e){exists$1(this);const{view:t,buffer:r,blockLen:s}=this;e=toBytes$2(e);const o=e.length;for(let a=0;a<o;){const u=Math.min(s-this.pos,o-a);if(u===s){const c=createView$2(e);for(;s<=o-a;a+=s)this.process(c,a);continue}r.set(e.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){exists$1(this),output$1(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:o}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(r,0),a=0);for(let h=a;h<s;h++)t[h]=0;setBigUint64$2(r,s-8,BigInt(this.length*8),o),this.process(r,0);const u=createView$2(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)u.setUint32(4*h,f[h],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:o,destroyed:a,pos:u}=this;return e.length=s,e.pos=u,e.finished=o,e.destroyed=a,s%t&&e.buffer.set(r),e}};const Chi$2=(n,e,t)=>n&e^~n&t,Maj$2=(n,e,t)=>n&e^n&t^e&t,SHA256_K$2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV$1=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$2=new Uint32Array(64);let SHA256$2=class extends SHA2$1{constructor(){super(64,32,8,!1),this.A=IV$1[0]|0,this.B=IV$1[1]|0,this.C=IV$1[2]|0,this.D=IV$1[3]|0,this.E=IV$1[4]|0,this.F=IV$1[5]|0,this.G=IV$1[6]|0,this.H=IV$1[7]|0}get(){const{A:e,B:t,C:r,D:s,E:o,F:a,G:u,H:c}=this;return[e,t,r,s,o,a,u,c]}set(e,t,r,s,o,a,u,c){this.A=e|0,this.B=t|0,this.C=r|0,this.D=s|0,this.E=o|0,this.F=a|0,this.G=u|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)SHA256_W$2[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const g=SHA256_W$2[h-15],m=SHA256_W$2[h-2],v=rotr$2(g,7)^rotr$2(g,18)^g>>>3,b=rotr$2(m,17)^rotr$2(m,19)^m>>>10;SHA256_W$2[h]=b+SHA256_W$2[h-7]+v+SHA256_W$2[h-16]|0}let{A:r,B:s,C:o,D:a,E:u,F:c,G:l,H:f}=this;for(let h=0;h<64;h++){const g=rotr$2(u,6)^rotr$2(u,11)^rotr$2(u,25),m=f+g+Chi$2(u,c,l)+SHA256_K$2[h]+SHA256_W$2[h]|0,b=(rotr$2(r,2)^rotr$2(r,13)^rotr$2(r,22))+Maj$2(r,s,o)|0;f=l,l=c,c=u,u=a+m|0,a=o,o=s,s=r,r=m+b|0}r=r+this.A|0,s=s+this.B|0,o=o+this.C|0,a=a+this.D|0,u=u+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,s,o,a,u,c,l,f)}roundClean(){SHA256_W$2.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const sha256$2=wrapConstructor$2(()=>new SHA256$2);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$9=BigInt(0),_1n$9=BigInt(1),_2n$5=BigInt(2),u8a$1=n=>n instanceof Uint8Array,hexes$3=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$3(n){if(!u8a$1(n))throw new Error("Uint8Array expected");let e="";for(let t=0;t<n.length;t++)e+=hexes$3[n[t]];return e}function numberToHexUnpadded$1(n){const e=n.toString(16);return e.length&1?`0${e}`:e}function hexToNumber$1(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return BigInt(n===""?"0":`0x${n}`)}function hexToBytes$3(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const t=new Uint8Array(e/2);for(let r=0;r<t.length;r++){const s=r*2,o=n.slice(s,s+2),a=Number.parseInt(o,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");t[r]=a}return t}function bytesToNumberBE$1(n){return hexToNumber$1(bytesToHex$3(n))}function bytesToNumberLE$1(n){if(!u8a$1(n))throw new Error("Uint8Array expected");return hexToNumber$1(bytesToHex$3(Uint8Array.from(n).reverse()))}function numberToBytesBE$1(n,e){return hexToBytes$3(n.toString(16).padStart(e*2,"0"))}function numberToBytesLE$1(n,e){return numberToBytesBE$1(n,e).reverse()}function numberToVarBytesBE$1(n){return hexToBytes$3(numberToHexUnpadded$1(n))}function ensureBytes$1(n,e,t){let r;if(typeof e=="string")try{r=hexToBytes$3(e)}catch(o){throw new Error(`${n} must be valid hex string, got "${e}". Cause: ${o}`)}else if(u8a$1(e))r=Uint8Array.from(e);else throw new Error(`${n} must be hex string or Uint8Array`);const s=r.length;if(typeof t=="number"&&s!==t)throw new Error(`${n} expected ${t} bytes, got ${s}`);return r}function concatBytes$3(...n){const e=new Uint8Array(n.reduce((r,s)=>r+s.length,0));let t=0;return n.forEach(r=>{if(!u8a$1(r))throw new Error("Uint8Array expected");e.set(r,t),t+=r.length}),e}function equalBytes$2(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function utf8ToBytes$3(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function bitLen$1(n){let e;for(e=0;n>_0n$9;n>>=_1n$9,e+=1);return e}function bitGet$1(n,e){return n>>BigInt(e)&_1n$9}const bitSet$1=(n,e,t)=>n|(t?_1n$9:_0n$9)<<BigInt(e),bitMask$1=n=>(_2n$5<<BigInt(n-1))-_1n$9,u8n$1=n=>new Uint8Array(n),u8fr$1=n=>Uint8Array.from(n);function createHmacDrbg$1(n,e,t){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let r=u8n$1(n),s=u8n$1(n),o=0;const a=()=>{r.fill(1),s.fill(0),o=0},u=(...h)=>t(s,r,...h),c=(h=u8n$1())=>{s=u(u8fr$1([0]),h),r=u(),h.length!==0&&(s=u(u8fr$1([1]),h),r=u())},l=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const g=[];for(;h<e;){r=u();const m=r.slice();g.push(m),h+=r.length}return concatBytes$3(...g)};return(h,g)=>{a(),c(h);let m;for(;!(m=g(l()));)c();return a(),m}}const validatorFns$1={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||n instanceof Uint8Array,isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,e)=>e.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function validateObject$1(n,e,t={}){const r=(s,o,a)=>{const u=validatorFns$1[o];if(typeof u!="function")throw new Error(`Invalid validator "${o}", expected function`);const c=n[s];if(!(a&&c===void 0)&&!u(c,n))throw new Error(`Invalid param ${String(s)}=${c} (${typeof c}), expected ${o}`)};for(const[s,o]of Object.entries(e))r(s,o,!1);for(const[s,o]of Object.entries(t))r(s,o,!0);return n}const ut$1=Object.freeze(Object.defineProperty({__proto__:null,bitGet:bitGet$1,bitLen:bitLen$1,bitMask:bitMask$1,bitSet:bitSet$1,bytesToHex:bytesToHex$3,bytesToNumberBE:bytesToNumberBE$1,bytesToNumberLE:bytesToNumberLE$1,concatBytes:concatBytes$3,createHmacDrbg:createHmacDrbg$1,ensureBytes:ensureBytes$1,equalBytes:equalBytes$2,hexToBytes:hexToBytes$3,hexToNumber:hexToNumber$1,numberToBytesBE:numberToBytesBE$1,numberToBytesLE:numberToBytesLE$1,numberToHexUnpadded:numberToHexUnpadded$1,numberToVarBytesBE:numberToVarBytesBE$1,utf8ToBytes:utf8ToBytes$3,validateObject:validateObject$1},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$8=BigInt(0),_1n$8=BigInt(1),_2n$4=BigInt(2),_3n$3=BigInt(3),_4n$1=BigInt(4),_5n$1=BigInt(5),_8n$1=BigInt(8);BigInt(9),BigInt(16);function mod$1(n,e){const t=n%e;return t>=_0n$8?t:e+t}function pow$1(n,e,t){if(t<=_0n$8||e<_0n$8)throw new Error("Expected power/modulo > 0");if(t===_1n$8)return _0n$8;let r=_1n$8;for(;e>_0n$8;)e&_1n$8&&(r=r*n%t),n=n*n%t,e>>=_1n$8;return r}function pow2$1(n,e,t){let r=n;for(;e-- >_0n$8;)r*=r,r%=t;return r}function invert$1(n,e){if(n===_0n$8||e<=_0n$8)throw new Error(`invert: expected positive integers, got n=${n} mod=${e}`);let t=mod$1(n,e),r=e,s=_0n$8,o=_1n$8;for(;t!==_0n$8;){const u=r/t,c=r%t,l=s-o*u;r=t,t=c,s=o,o=l}if(r!==_1n$8)throw new Error("invert: does not exist");return mod$1(s,e)}function tonelliShanks$1(n){const e=(n-_1n$8)/_2n$4;let t,r,s;for(t=n-_1n$8,r=0;t%_2n$4===_0n$8;t/=_2n$4,r++);for(s=_2n$4;s<n&&pow$1(s,e,n)!==n-_1n$8;s++);if(r===1){const a=(n+_1n$8)/_4n$1;return function(c,l){const f=c.pow(l,a);if(!c.eql(c.sqr(f),l))throw new Error("Cannot find square root");return f}}const o=(t+_1n$8)/_2n$4;return function(u,c){if(u.pow(c,e)===u.neg(u.ONE))throw new Error("Cannot find square root");let l=r,f=u.pow(u.mul(u.ONE,s),t),h=u.pow(c,o),g=u.pow(c,t);for(;!u.eql(g,u.ONE);){if(u.eql(g,u.ZERO))return u.ZERO;let m=1;for(let b=u.sqr(g);m<l&&!u.eql(b,u.ONE);m++)b=u.sqr(b);const v=u.pow(f,_1n$8<<BigInt(l-m-1));f=u.sqr(v),h=u.mul(h,v),g=u.mul(g,f),l=m}return h}}function FpSqrt$1(n){if(n%_4n$1===_3n$3){const e=(n+_1n$8)/_4n$1;return function(r,s){const o=r.pow(s,e);if(!r.eql(r.sqr(o),s))throw new Error("Cannot find square root");return o}}if(n%_8n$1===_5n$1){const e=(n-_5n$1)/_8n$1;return function(r,s){const o=r.mul(s,_2n$4),a=r.pow(o,e),u=r.mul(s,a),c=r.mul(r.mul(u,_2n$4),a),l=r.mul(u,r.sub(c,r.ONE));if(!r.eql(r.sqr(l),s))throw new Error("Cannot find square root");return l}}return tonelliShanks$1(n)}const FIELD_FIELDS$1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$1(n){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=FIELD_FIELDS$1.reduce((r,s)=>(r[s]="function",r),e);return validateObject$1(n,t)}function FpPow$1(n,e,t){if(t<_0n$8)throw new Error("Expected power > 0");if(t===_0n$8)return n.ONE;if(t===_1n$8)return e;let r=n.ONE,s=e;for(;t>_0n$8;)t&_1n$8&&(r=n.mul(r,s)),s=n.sqr(s),t>>=_1n$8;return r}function FpInvertBatch$1(n,e){const t=new Array(e.length),r=e.reduce((o,a,u)=>n.is0(a)?o:(t[u]=o,n.mul(o,a)),n.ONE),s=n.inv(r);return e.reduceRight((o,a,u)=>n.is0(a)?o:(t[u]=n.mul(o,t[u]),n.mul(o,a)),s),t}function nLength$1(n,e){const t=e!==void 0?e:n.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function Field$1(n,e,t=!1,r={}){if(n<=_0n$8)throw new Error(`Expected Field ORDER > 0, got ${n}`);const{nBitLength:s,nByteLength:o}=nLength$1(n,e);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const a=FpSqrt$1(n),u=Object.freeze({ORDER:n,BITS:s,BYTES:o,MASK:bitMask$1(s),ZERO:_0n$8,ONE:_1n$8,create:c=>mod$1(c,n),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return _0n$8<=c&&c<n},is0:c=>c===_0n$8,isOdd:c=>(c&_1n$8)===_1n$8,neg:c=>mod$1(-c,n),eql:(c,l)=>c===l,sqr:c=>mod$1(c*c,n),add:(c,l)=>mod$1(c+l,n),sub:(c,l)=>mod$1(c-l,n),mul:(c,l)=>mod$1(c*l,n),pow:(c,l)=>FpPow$1(u,c,l),div:(c,l)=>mod$1(c*invert$1(l,n),n),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>invert$1(c,n),sqrt:r.sqrt||(c=>a(u,c)),invertBatch:c=>FpInvertBatch$1(u,c),cmov:(c,l,f)=>f?l:c,toBytes:c=>t?numberToBytesLE$1(c,o):numberToBytesBE$1(c,o),fromBytes:c=>{if(c.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${c.length}`);return t?bytesToNumberLE$1(c):bytesToNumberBE$1(c)}});return Object.freeze(u)}function getFieldBytesLength$1(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function getMinHashLength$1(n){const e=getFieldBytesLength$1(n);return e+Math.ceil(e/2)}function mapHashToField$1(n,e,t=!1){const r=n.length,s=getFieldBytesLength$1(e),o=getMinHashLength$1(e);if(r<16||r<o||r>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${r}`);const a=t?bytesToNumberBE$1(n):bytesToNumberLE$1(n),u=mod$1(a,e-_1n$8)+_1n$8;return t?numberToBytesLE$1(u,s):numberToBytesBE$1(u,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$7=BigInt(0),_1n$7=BigInt(1);function wNAF$1(n,e){const t=(s,o)=>{const a=o.negate();return s?a:o},r=s=>{const o=Math.ceil(e/s)+1,a=2**(s-1);return{windows:o,windowSize:a}};return{constTimeNegate:t,unsafeLadder(s,o){let a=n.ZERO,u=s;for(;o>_0n$7;)o&_1n$7&&(a=a.add(u)),u=u.double(),o>>=_1n$7;return a},precomputeWindow(s,o){const{windows:a,windowSize:u}=r(o),c=[];let l=s,f=l;for(let h=0;h<a;h++){f=l,c.push(f);for(let g=1;g<u;g++)f=f.add(l),c.push(f);l=f.double()}return c},wNAF(s,o,a){const{windows:u,windowSize:c}=r(s);let l=n.ZERO,f=n.BASE;const h=BigInt(2**s-1),g=2**s,m=BigInt(s);for(let v=0;v<u;v++){const b=v*c;let y=Number(a&h);a>>=m,y>c&&(y-=g,a+=_1n$7);const w=b,S=b+Math.abs(y)-1,B=v%2!==0,N=y<0;y===0?f=f.add(t(B,o[w])):l=l.add(t(N,o[S]))}return{p:l,f}},wNAFCached(s,o,a,u){const c=s._WINDOW_SIZE||1;let l=o.get(s);return l||(l=this.precomputeWindow(s,c),c!==1&&o.set(s,u(l))),this.wNAF(c,l,a)}}}function validateBasic$1(n){return validateField$1(n.Fp),validateObject$1(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength$1(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts$1(n){const e=validateBasic$1(n);validateObject$1(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:r,a:s}=e;if(t){if(!r.eql(s,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n$1,hexToBytes:h2b$1}=ut$1,DER$1={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(n){const{Err:e}=DER$1;if(n.length<2||n[0]!==2)throw new e("Invalid signature integer tag");const t=n[1],r=n.subarray(2,t+2);if(!t||r.length!==t)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:b2n$1(r),l:n.subarray(t+2)}},toSig(n){const{Err:e}=DER$1,t=typeof n=="string"?h2b$1(n):n;if(!(t instanceof Uint8Array))throw new Error("ui8a expected");let r=t.length;if(r<2||t[0]!=48)throw new e("Invalid signature tag");if(t[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:s,l:o}=DER$1._parseInt(t.subarray(2)),{d:a,l:u}=DER$1._parseInt(o);if(u.length)throw new e("Invalid signature: left bytes after parsing");return{r:s,s:a}},hexFromSig(n){const e=l=>Number.parseInt(l[0],16)&8?"00"+l:l,t=l=>{const f=l.toString(16);return f.length&1?`0${f}`:f},r=e(t(n.s)),s=e(t(n.r)),o=r.length/2,a=s.length/2,u=t(o),c=t(a);return`30${t(a+o+4)}02${c}${s}02${u}${r}`}},_0n$6=BigInt(0),_1n$6=BigInt(1);BigInt(2);const _3n$2=BigInt(3);BigInt(4);function weierstrassPoints$1(n){const e=validatePointOpts$1(n),{Fp:t}=e,r=e.toBytes||((v,b,y)=>{const w=b.toAffine();return concatBytes$3(Uint8Array.from([4]),t.toBytes(w.x),t.toBytes(w.y))}),s=e.fromBytes||(v=>{const b=v.subarray(1),y=t.fromBytes(b.subarray(0,t.BYTES)),w=t.fromBytes(b.subarray(t.BYTES,2*t.BYTES));return{x:y,y:w}});function o(v){const{a:b,b:y}=e,w=t.sqr(v),S=t.mul(w,v);return t.add(t.add(S,t.mul(v,b)),y)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(v){return typeof v=="bigint"&&_0n$6<v&&v<e.n}function u(v){if(!a(v))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(v){const{allowedPrivateKeyLengths:b,nByteLength:y,wrapPrivateKey:w,n:S}=e;if(b&&typeof v!="bigint"){if(v instanceof Uint8Array&&(v=bytesToHex$3(v)),typeof v!="string"||!b.includes(v.length))throw new Error("Invalid key");v=v.padStart(y*2,"0")}let B;try{B=typeof v=="bigint"?v:bytesToNumberBE$1(ensureBytes$1("private key",v,y))}catch{throw new Error(`private key must be ${y} bytes, hex or bigint, not ${typeof v}`)}return w&&(B=mod$1(B,S)),u(B),B}const l=new Map;function f(v){if(!(v instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(b,y,w){if(this.px=b,this.py=y,this.pz=w,b==null||!t.isValid(b))throw new Error("x required");if(y==null||!t.isValid(y))throw new Error("y required");if(w==null||!t.isValid(w))throw new Error("z required")}static fromAffine(b){const{x:y,y:w}=b||{};if(!b||!t.isValid(y)||!t.isValid(w))throw new Error("invalid affine point");if(b instanceof h)throw new Error("projective point not allowed");const S=B=>t.eql(B,t.ZERO);return S(y)&&S(w)?h.ZERO:new h(y,w,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(b){const y=t.invertBatch(b.map(w=>w.pz));return b.map((w,S)=>w.toAffine(y[S])).map(h.fromAffine)}static fromHex(b){const y=h.fromAffine(s(ensureBytes$1("pointHex",b)));return y.assertValidity(),y}static fromPrivateKey(b){return h.BASE.multiply(c(b))}_setWindowSize(b){this._WINDOW_SIZE=b,l.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!t.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:b,y}=this.toAffine();if(!t.isValid(b)||!t.isValid(y))throw new Error("bad point: x or y not FE");const w=t.sqr(y),S=o(b);if(!t.eql(w,S))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:b}=this.toAffine();if(t.isOdd)return!t.isOdd(b);throw new Error("Field doesn't support isOdd")}equals(b){f(b);const{px:y,py:w,pz:S}=this,{px:B,py:N,pz:U}=b,R=t.eql(t.mul(y,U),t.mul(B,S)),C=t.eql(t.mul(w,U),t.mul(N,S));return R&&C}negate(){return new h(this.px,t.neg(this.py),this.pz)}double(){const{a:b,b:y}=e,w=t.mul(y,_3n$2),{px:S,py:B,pz:N}=this;let U=t.ZERO,R=t.ZERO,C=t.ZERO,I=t.mul(S,S),D=t.mul(B,B),F=t.mul(N,N),k=t.mul(S,B);return k=t.add(k,k),C=t.mul(S,N),C=t.add(C,C),U=t.mul(b,C),R=t.mul(w,F),R=t.add(U,R),U=t.sub(D,R),R=t.add(D,R),R=t.mul(U,R),U=t.mul(k,U),C=t.mul(w,C),F=t.mul(b,F),k=t.sub(I,F),k=t.mul(b,k),k=t.add(k,C),C=t.add(I,I),I=t.add(C,I),I=t.add(I,F),I=t.mul(I,k),R=t.add(R,I),F=t.mul(B,N),F=t.add(F,F),I=t.mul(F,k),U=t.sub(U,I),C=t.mul(F,D),C=t.add(C,C),C=t.add(C,C),new h(U,R,C)}add(b){f(b);const{px:y,py:w,pz:S}=this,{px:B,py:N,pz:U}=b;let R=t.ZERO,C=t.ZERO,I=t.ZERO;const D=e.a,F=t.mul(e.b,_3n$2);let k=t.mul(y,B),_=t.mul(w,N),A=t.mul(S,U),T=t.add(y,w),x=t.add(B,N);T=t.mul(T,x),x=t.add(k,_),T=t.sub(T,x),x=t.add(y,S);let E=t.add(B,U);return x=t.mul(x,E),E=t.add(k,A),x=t.sub(x,E),E=t.add(w,S),R=t.add(N,U),E=t.mul(E,R),R=t.add(_,A),E=t.sub(E,R),I=t.mul(D,x),R=t.mul(F,A),I=t.add(R,I),R=t.sub(_,I),I=t.add(_,I),C=t.mul(R,I),_=t.add(k,k),_=t.add(_,k),A=t.mul(D,A),x=t.mul(F,x),_=t.add(_,A),A=t.sub(k,A),A=t.mul(D,A),x=t.add(x,A),k=t.mul(_,x),C=t.add(C,k),k=t.mul(E,x),R=t.mul(T,R),R=t.sub(R,k),k=t.mul(T,_),I=t.mul(E,I),I=t.add(I,k),new h(R,C,I)}subtract(b){return this.add(b.negate())}is0(){return this.equals(h.ZERO)}wNAF(b){return m.wNAFCached(this,l,b,y=>{const w=t.invertBatch(y.map(S=>S.pz));return y.map((S,B)=>S.toAffine(w[B])).map(h.fromAffine)})}multiplyUnsafe(b){const y=h.ZERO;if(b===_0n$6)return y;if(u(b),b===_1n$6)return this;const{endo:w}=e;if(!w)return m.unsafeLadder(this,b);let{k1neg:S,k1:B,k2neg:N,k2:U}=w.splitScalar(b),R=y,C=y,I=this;for(;B>_0n$6||U>_0n$6;)B&_1n$6&&(R=R.add(I)),U&_1n$6&&(C=C.add(I)),I=I.double(),B>>=_1n$6,U>>=_1n$6;return S&&(R=R.negate()),N&&(C=C.negate()),C=new h(t.mul(C.px,w.beta),C.py,C.pz),R.add(C)}multiply(b){u(b);let y=b,w,S;const{endo:B}=e;if(B){const{k1neg:N,k1:U,k2neg:R,k2:C}=B.splitScalar(y);let{p:I,f:D}=this.wNAF(U),{p:F,f:k}=this.wNAF(C);I=m.constTimeNegate(N,I),F=m.constTimeNegate(R,F),F=new h(t.mul(F.px,B.beta),F.py,F.pz),w=I.add(F),S=D.add(k)}else{const{p:N,f:U}=this.wNAF(y);w=N,S=U}return h.normalizeZ([w,S])[0]}multiplyAndAddUnsafe(b,y,w){const S=h.BASE,B=(U,R)=>R===_0n$6||R===_1n$6||!U.equals(S)?U.multiplyUnsafe(R):U.multiply(R),N=B(this,y).add(B(b,w));return N.is0()?void 0:N}toAffine(b){const{px:y,py:w,pz:S}=this,B=this.is0();b==null&&(b=B?t.ONE:t.inv(S));const N=t.mul(y,b),U=t.mul(w,b),R=t.mul(S,b);if(B)return{x:t.ZERO,y:t.ZERO};if(!t.eql(R,t.ONE))throw new Error("invZ was invalid");return{x:N,y:U}}isTorsionFree(){const{h:b,isTorsionFree:y}=e;if(b===_1n$6)return!0;if(y)return y(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:b,clearCofactor:y}=e;return b===_1n$6?this:y?y(h,this):this.multiplyUnsafe(e.h)}toRawBytes(b=!0){return this.assertValidity(),r(h,this,b)}toHex(b=!0){return bytesToHex$3(this.toRawBytes(b))}}h.BASE=new h(e.Gx,e.Gy,t.ONE),h.ZERO=new h(t.ZERO,t.ONE,t.ZERO);const g=e.nBitLength,m=wNAF$1(h,e.endo?Math.ceil(g/2):g);return{CURVE:e,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function validateOpts$1(n){const e=validateBasic$1(n);return validateObject$1(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass$1(n){const e=validateOpts$1(n),{Fp:t,n:r}=e,s=t.BYTES+1,o=2*t.BYTES+1;function a(x){return _0n$6<x&&x<t.ORDER}function u(x){return mod$1(x,r)}function c(x){return invert$1(x,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:h,isWithinCurveOrder:g}=weierstrassPoints$1({...e,toBytes(x,E,$){const L=E.toAffine(),P=t.toBytes(L.x),O=concatBytes$3;return $?O(Uint8Array.from([E.hasEvenY()?2:3]),P):O(Uint8Array.from([4]),P,t.toBytes(L.y))},fromBytes(x){const E=x.length,$=x[0],L=x.subarray(1);if(E===s&&($===2||$===3)){const P=bytesToNumberBE$1(L);if(!a(P))throw new Error("Point is not on curve");const O=h(P);let M=t.sqrt(O);const H=(M&_1n$6)===_1n$6;return($&1)===1!==H&&(M=t.neg(M)),{x:P,y:M}}else if(E===o&&$===4){const P=t.fromBytes(L.subarray(0,t.BYTES)),O=t.fromBytes(L.subarray(t.BYTES,2*t.BYTES));return{x:P,y:O}}else throw new Error(`Point of length ${E} was invalid. Expected ${s} compressed bytes or ${o} uncompressed bytes`)}}),m=x=>bytesToHex$3(numberToBytesBE$1(x,e.nByteLength));function v(x){const E=r>>_1n$6;return x>E}function b(x){return v(x)?u(-x):x}const y=(x,E,$)=>bytesToNumberBE$1(x.slice(E,$));class w{constructor(E,$,L){this.r=E,this.s=$,this.recovery=L,this.assertValidity()}static fromCompact(E){const $=e.nByteLength;return E=ensureBytes$1("compactSignature",E,$*2),new w(y(E,0,$),y(E,$,2*$))}static fromDER(E){const{r:$,s:L}=DER$1.toSig(ensureBytes$1("DER",E));return new w($,L)}assertValidity(){if(!g(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!g(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(E){return new w(this.r,this.s,E)}recoverPublicKey(E){const{r:$,s:L,recovery:P}=this,O=C(ensureBytes$1("msgHash",E));if(P==null||![0,1,2,3].includes(P))throw new Error("recovery id invalid");const M=P===2||P===3?$+e.n:$;if(M>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const H=P&1?"03":"02",q=l.fromHex(H+m(M)),V=c(M),Y=u(-O*V),G=u(L*V),J=l.BASE.multiplyAndAddUnsafe(q,Y,G);if(!J)throw new Error("point at infinify");return J.assertValidity(),J}hasHighS(){return v(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,u(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$3(this.toDERHex())}toDERHex(){return DER$1.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$3(this.toCompactHex())}toCompactHex(){return m(this.r)+m(this.s)}}const S={isValidPrivateKey(x){try{return f(x),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const x=getMinHashLength$1(e.n);return mapHashToField$1(e.randomBytes(x),e.n)},precompute(x=8,E=l.BASE){return E._setWindowSize(x),E.multiply(BigInt(3)),E}};function B(x,E=!0){return l.fromPrivateKey(x).toRawBytes(E)}function N(x){const E=x instanceof Uint8Array,$=typeof x=="string",L=(E||$)&&x.length;return E?L===s||L===o:$?L===2*s||L===2*o:x instanceof l}function U(x,E,$=!0){if(N(x))throw new Error("first arg must be private key");if(!N(E))throw new Error("second arg must be public key");return l.fromHex(E).multiply(f(x)).toRawBytes($)}const R=e.bits2int||function(x){const E=bytesToNumberBE$1(x),$=x.length*8-e.nBitLength;return $>0?E>>BigInt($):E},C=e.bits2int_modN||function(x){return u(R(x))},I=bitMask$1(e.nBitLength);function D(x){if(typeof x!="bigint")throw new Error("bigint expected");if(!(_0n$6<=x&&x<I))throw new Error(`bigint expected < 2^${e.nBitLength}`);return numberToBytesBE$1(x,e.nByteLength)}function F(x,E,$=k){if(["recovered","canonical"].some(Q=>Q in $))throw new Error("sign() legacy options not supported");const{hash:L,randomBytes:P}=e;let{lowS:O,prehash:M,extraEntropy:H}=$;O==null&&(O=!0),x=ensureBytes$1("msgHash",x),M&&(x=ensureBytes$1("prehashed msgHash",L(x)));const q=C(x),V=f(E),Y=[D(V),D(q)];if(H!=null){const Q=H===!0?P(t.BYTES):H;Y.push(ensureBytes$1("extraEntropy",Q))}const G=concatBytes$3(...Y),J=q;function X(Q){const re=R(Q);if(!g(re))return;const ye=c(re),K=l.BASE.multiply(re).toAffine(),Z=u(K.x);if(Z===_0n$6)return;const te=u(ye*u(J+Z*V));if(te===_0n$6)return;let oe=(K.x===Z?0:2)|Number(K.y&_1n$6),Te=te;return O&&v(te)&&(Te=b(te),oe^=1),new w(Z,Te,oe)}return{seed:G,k2sig:X}}const k={lowS:e.lowS,prehash:!1},_={lowS:e.lowS,prehash:!1};function A(x,E,$=k){const{seed:L,k2sig:P}=F(x,E,$),O=e;return createHmacDrbg$1(O.hash.outputLen,O.nByteLength,O.hmac)(L,P)}l.BASE._setWindowSize(8);function T(x,E,$,L=_){var K;const P=x;if(E=ensureBytes$1("msgHash",E),$=ensureBytes$1("publicKey",$),"strict"in L)throw new Error("options.strict was renamed to lowS");const{lowS:O,prehash:M}=L;let H,q;try{if(typeof P=="string"||P instanceof Uint8Array)try{H=w.fromDER(P)}catch(Z){if(!(Z instanceof DER$1.Err))throw Z;H=w.fromCompact(P)}else if(typeof P=="object"&&typeof P.r=="bigint"&&typeof P.s=="bigint"){const{r:Z,s:te}=P;H=new w(Z,te)}else throw new Error("PARSE");q=l.fromHex($)}catch(Z){if(Z.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(O&&H.hasHighS())return!1;M&&(E=e.hash(E));const{r:V,s:Y}=H,G=C(E),J=c(Y),X=u(G*J),Q=u(V*J),re=(K=l.BASE.multiplyAndAddUnsafe(q,X,Q))==null?void 0:K.toAffine();return re?u(re.x)===V:!1}return{CURVE:e,getPublicKey:B,getSharedSecret:U,sign:A,verify:T,ProjectivePoint:l,Signature:w,utils:S}}let HMAC$2=class extends Hash$2{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,hash$1(e);const r=toBytes$2(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(r.length>s?e.create().update(r).digest():r);for(let a=0;a<o.length;a++)o[a]^=54;this.iHash.update(o),this.oHash=e.create();for(let a=0;a<o.length;a++)o[a]^=106;this.oHash.update(o),o.fill(0)}update(e){return exists$1(this),this.iHash.update(e),this}digestInto(e){exists$1(this),bytes$2(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:s,destroyed:o,blockLen:a,outputLen:u}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=a,e.outputLen=u,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$2=(n,e,t)=>new HMAC$2(n,e).update(t).digest();hmac$2.create=(n,e)=>new HMAC$2(n,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash$1(n){return{hash:n,hmac:(e,...t)=>hmac$2(n,e,concatBytes$4(...t)),randomBytes:randomBytes$2}}function createCurve$1(n,e){const t=r=>weierstrass$1({...n,...getHash$1(r)});return Object.freeze({...t(e),create:t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P$1=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N$1=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n$5=BigInt(1),_2n$3=BigInt(2),divNearest$1=(n,e)=>(n+e/_2n$3)/e;function sqrtMod$1(n){const e=secp256k1P$1,t=BigInt(3),r=BigInt(6),s=BigInt(11),o=BigInt(22),a=BigInt(23),u=BigInt(44),c=BigInt(88),l=n*n*n%e,f=l*l*n%e,h=pow2$1(f,t,e)*f%e,g=pow2$1(h,t,e)*f%e,m=pow2$1(g,_2n$3,e)*l%e,v=pow2$1(m,s,e)*m%e,b=pow2$1(v,o,e)*v%e,y=pow2$1(b,u,e)*b%e,w=pow2$1(y,c,e)*y%e,S=pow2$1(w,u,e)*b%e,B=pow2$1(S,t,e)*f%e,N=pow2$1(B,a,e)*v%e,U=pow2$1(N,r,e)*l%e,R=pow2$1(U,_2n$3,e);if(!Fp.eql(Fp.sqr(R),n))throw new Error("Cannot find square root");return R}const Fp=Field$1(secp256k1P$1,void 0,void 0,{sqrt:sqrtMod$1}),secp256k1$1=createCurve$1({a:BigInt(0),b:BigInt(7),Fp,n:secp256k1N$1,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const e=secp256k1N$1,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-_1n$5*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=t,a=BigInt("0x100000000000000000000000000000000"),u=divNearest$1(o*n,e),c=divNearest$1(-r*n,e);let l=mod$1(n-u*t-c*s,e),f=mod$1(-u*r-c*o,e);const h=l>a,g=f>a;if(h&&(l=e-l),g&&(f=e-f),l>a||f>a)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:h,k1:l,k2neg:g,k2:f}}}},sha256$2),_0n$5=BigInt(0),fe=n=>typeof n=="bigint"&&_0n$5<n&&n<secp256k1P$1,ge=n=>typeof n=="bigint"&&_0n$5<n&&n<secp256k1N$1,TAGGED_HASH_PREFIXES$1={};function taggedHash$1(n,...e){let t=TAGGED_HASH_PREFIXES$1[n];if(t===void 0){const r=sha256$2(Uint8Array.from(n,s=>s.charCodeAt(0)));t=concatBytes$3(r,r),TAGGED_HASH_PREFIXES$1[n]=t}return sha256$2(concatBytes$3(t,...e))}const pointToBytes$1=n=>n.toRawBytes(!0).slice(1),numTo32b$1=n=>numberToBytesBE$1(n,32),modP$1=n=>mod$1(n,secp256k1P$1),modN$1=n=>mod$1(n,secp256k1N$1),Point$1=secp256k1$1.ProjectivePoint,GmulAdd$1=(n,e,t)=>Point$1.BASE.multiplyAndAddUnsafe(n,e,t);function schnorrGetExtPubKey$1(n){let e=secp256k1$1.utils.normPrivateKeyToScalar(n),t=Point$1.fromPrivateKey(e);return{scalar:t.hasEvenY()?e:modN$1(-e),bytes:pointToBytes$1(t)}}function lift_x$1(n){if(!fe(n))throw new Error("bad x: need 0 < x < p");const e=modP$1(n*n),t=modP$1(e*n+BigInt(7));let r=sqrtMod$1(t);r%_2n$3!==_0n$5&&(r=modP$1(-r));const s=new Point$1(n,r,_1n$5);return s.assertValidity(),s}function challenge$1(...n){return modN$1(bytesToNumberBE$1(taggedHash$1("BIP0340/challenge",...n)))}function schnorrGetPublicKey$1(n){return schnorrGetExtPubKey$1(n).bytes}function schnorrSign$1(n,e,t=randomBytes$2(32)){const r=ensureBytes$1("message",n),{bytes:s,scalar:o}=schnorrGetExtPubKey$1(e),a=ensureBytes$1("auxRand",t,32),u=numTo32b$1(o^bytesToNumberBE$1(taggedHash$1("BIP0340/aux",a))),c=taggedHash$1("BIP0340/nonce",u,s,r),l=modN$1(bytesToNumberBE$1(c));if(l===_0n$5)throw new Error("sign failed: k is zero");const{bytes:f,scalar:h}=schnorrGetExtPubKey$1(l),g=challenge$1(f,s,r),m=new Uint8Array(64);if(m.set(f,0),m.set(numTo32b$1(modN$1(h+g*o)),32),!schnorrVerify$1(m,r,s))throw new Error("sign: Invalid signature produced");return m}function schnorrVerify$1(n,e,t){const r=ensureBytes$1("signature",n,64),s=ensureBytes$1("message",e),o=ensureBytes$1("publicKey",t,32);try{const a=lift_x$1(bytesToNumberBE$1(o)),u=bytesToNumberBE$1(r.subarray(0,32));if(!fe(u))return!1;const c=bytesToNumberBE$1(r.subarray(32,64));if(!ge(c))return!1;const l=challenge$1(numTo32b$1(u),pointToBytes$1(a),s),f=GmulAdd$1(a,c,modN$1(-l));return!(!f||!f.hasEvenY()||f.toAffine().x!==u)}catch{return!1}}const schnorr$1={getPublicKey:schnorrGetPublicKey$1,sign:schnorrSign$1,verify:schnorrVerify$1,utils:{randomPrivateKey:secp256k1$1.utils.randomPrivateKey,lift_x:lift_x$1,pointToBytes:pointToBytes$1,numberToBytesBE:numberToBytesBE$1,bytesToNumberBE:bytesToNumberBE$1,taggedHash:taggedHash$1,mod:mod$1}},crypto$1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a=n=>n instanceof Uint8Array,createView$1=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),rotr$1=(n,e)=>n<<32-e|n>>>e,isLE$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$1)throw new Error("Non little-endian hardware is not supported");const hexes$2=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$2(n){if(!u8a(n))throw new Error("Uint8Array expected");let e="";for(let t=0;t<n.length;t++)e+=hexes$2[n[t]];return e}function hexToBytes$2(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const t=new Uint8Array(e/2);for(let r=0;r<t.length;r++){const s=r*2,o=n.slice(s,s+2),a=Number.parseInt(o,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");t[r]=a}return t}function utf8ToBytes$2(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function toBytes$1(n){if(typeof n=="string"&&(n=utf8ToBytes$2(n)),!u8a(n))throw new Error(`expected Uint8Array, got ${typeof n}`);return n}function concatBytes$2(...n){const e=new Uint8Array(n.reduce((r,s)=>r+s.length,0));let t=0;return n.forEach(r=>{if(!u8a(r))throw new Error("Uint8Array expected");e.set(r,t),t+=r.length}),e}let Hash$1=class{clone(){return this._cloneInto()}};function wrapConstructor$1(n){const e=r=>n().update(toBytes$1(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function randomBytes$1(n=32){if(crypto$1&&typeof crypto$1.getRandomValues=="function")return crypto$1.getRandomValues(new Uint8Array(n));throw new Error("crypto.getRandomValues must be defined")}function number$1(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`Wrong positive integer: ${n}`)}function bool$1(n){if(typeof n!="boolean")throw new Error(`Expected boolean, not ${n}`)}function bytes$1(n,...e){if(!(n instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(n.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${n.length}`)}function hash(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$1(n.outputLen),number$1(n.blockLen)}function exists(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function output(n,e){bytes$1(n);const t=e.outputLen;if(n.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const assert={number:number$1,bool:bool$1,bytes:bytes$1,hash,exists,output};function setBigUint64$1(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const s=BigInt(32),o=BigInt(4294967295),a=Number(t>>s&o),u=Number(t&o),c=r?4:0,l=r?0:4;n.setUint32(e+c,a,r),n.setUint32(e+l,u,r)}class SHA2 extends Hash$1{constructor(e,t,r,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$1(this.buffer)}update(e){assert.exists(this);const{view:t,buffer:r,blockLen:s}=this;e=toBytes$1(e);const o=e.length;for(let a=0;a<o;){const u=Math.min(s-this.pos,o-a);if(u===s){const c=createView$1(e);for(;s<=o-a;a+=s)this.process(c,a);continue}r.set(e.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){assert.exists(this),assert.output(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:o}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(r,0),a=0);for(let h=a;h<s;h++)t[h]=0;setBigUint64$1(r,s-8,BigInt(this.length*8),o),this.process(r,0);const u=createView$1(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)u.setUint32(4*h,f[h],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:o,destroyed:a,pos:u}=this;return e.length=s,e.pos=u,e.finished=o,e.destroyed=a,s%t&&e.buffer.set(r),e}}const Chi$1=(n,e,t)=>n&e^~n&t,Maj$1=(n,e,t)=>n&e^n&t^e&t,SHA256_K$1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$1=new Uint32Array(64);let SHA256$1=class extends SHA2{constructor(){super(64,32,8,!1),this.A=IV[0]|0,this.B=IV[1]|0,this.C=IV[2]|0,this.D=IV[3]|0,this.E=IV[4]|0,this.F=IV[5]|0,this.G=IV[6]|0,this.H=IV[7]|0}get(){const{A:e,B:t,C:r,D:s,E:o,F:a,G:u,H:c}=this;return[e,t,r,s,o,a,u,c]}set(e,t,r,s,o,a,u,c){this.A=e|0,this.B=t|0,this.C=r|0,this.D=s|0,this.E=o|0,this.F=a|0,this.G=u|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)SHA256_W$1[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const g=SHA256_W$1[h-15],m=SHA256_W$1[h-2],v=rotr$1(g,7)^rotr$1(g,18)^g>>>3,b=rotr$1(m,17)^rotr$1(m,19)^m>>>10;SHA256_W$1[h]=b+SHA256_W$1[h-7]+v+SHA256_W$1[h-16]|0}let{A:r,B:s,C:o,D:a,E:u,F:c,G:l,H:f}=this;for(let h=0;h<64;h++){const g=rotr$1(u,6)^rotr$1(u,11)^rotr$1(u,25),m=f+g+Chi$1(u,c,l)+SHA256_K$1[h]+SHA256_W$1[h]|0,b=(rotr$1(r,2)^rotr$1(r,13)^rotr$1(r,22))+Maj$1(r,s,o)|0;f=l,l=c,c=u,u=a+m|0,a=o,o=s,s=r,r=m+b|0}r=r+this.A|0,s=s+this.B|0,o=o+this.C|0,a=a+this.D|0,u=u+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,s,o,a,u,c,l,f)}roundClean(){SHA256_W$1.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};class SHA224 extends SHA256$1{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const sha256$1=wrapConstructor$1(()=>new SHA256$1);wrapConstructor$1(()=>new SHA224);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function assertNumber(n){if(!Number.isSafeInteger(n))throw new Error(`Wrong integer: ${n}`)}function chain(...n){const e=(s,o)=>a=>s(o(a)),t=Array.from(n).reverse().reduce((s,o)=>s?e(s,o.encode):o.encode,void 0),r=n.reduce((s,o)=>s?e(s,o.decode):o.decode,void 0);return{encode:t,decode:r}}function alphabet(n){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(t=>{if(assertNumber(t),t<0||t>=n.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${n.length})`);return n[t]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(t=>{if(typeof t!="string")throw new Error(`alphabet.decode: not string element=${t}`);const r=n.indexOf(t);if(r===-1)throw new Error(`Unknown letter: "${t}". Allowed: ${n}`);return r})}}}function join(n=""){if(typeof n!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let t of e)if(typeof t!="string")throw new Error(`join.encode: non-string input=${t}`);return e.join(n)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(n)}}}function padding(n,e="="){if(assertNumber(n),typeof e!="string")throw new Error("padding chr should be string");return{encode(t){if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of t)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;t.length*n%8;)t.push(e);return t},decode(t){if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of t)if(typeof s!="string")throw new Error(`padding.decode: non-string input=${s}`);let r=t.length;if(r*n%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&t[r-1]===e;r--)if(!((r-1)*n%8))throw new Error("Invalid padding: string has too much padding");return t.slice(0,r)}}}function normalize$1(n){if(typeof n!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>n(e)}}function convertRadix(n,e,t){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(t<2)throw new Error(`convertRadix: wrong to=${t}, base cannot be less than 2`);if(!Array.isArray(n))throw new Error("convertRadix: data should be array");if(!n.length)return[];let r=0;const s=[],o=Array.from(n);for(o.forEach(a=>{if(assertNumber(a),a<0||a>=e)throw new Error(`Wrong integer: ${a}`)});;){let a=0,u=!0;for(let c=r;c<o.length;c++){const l=o[c],f=e*a+l;if(!Number.isSafeInteger(f)||e*a/e!==a||f-l!==e*a)throw new Error("convertRadix: carry overflow");if(a=f%t,o[c]=Math.floor(f/t),!Number.isSafeInteger(o[c])||o[c]*t+a!==f)throw new Error("convertRadix: carry overflow");if(u)o[c]?u=!1:r=c;else continue}if(s.push(a),u)break}for(let a=0;a<n.length-1&&n[a]===0;a++)s.push(0);return s.reverse()}const gcd=(n,e)=>e?gcd(e,n%e):n,radix2carry=(n,e)=>n+(e-gcd(n,e));function convertRadix2(n,e,t,r){if(!Array.isArray(n))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(t<=0||t>32)throw new Error(`convertRadix2: wrong to=${t}`);if(radix2carry(e,t)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${t} carryBits=${radix2carry(e,t)}`);let s=0,o=0;const a=2**t-1,u=[];for(const c of n){if(assertNumber(c),c>=2**e)throw new Error(`convertRadix2: invalid data word=${c} from=${e}`);if(s=s<<e|c,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=t;o-=t)u.push((s>>o-t&a)>>>0);s&=2**o-1}if(s=s<<t-o&a,!r&&o>=e)throw new Error("Excess padding");if(!r&&s)throw new Error(`Non-zero padding: ${s}`);return r&&o>0&&u.push(s>>>0),u}function radix(n){return assertNumber(n),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return convertRadix(Array.from(e),2**8,n)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(convertRadix(e,n,2**8))}}}function radix2(n,e=!1){if(assertNumber(n),n<=0||n>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry(8,n)>32||radix2carry(n,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2(Array.from(t),8,n,!e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(convertRadix2(t,n,8,e))}}}function unsafeWrapper(n){if(typeof n!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return n.apply(null,e)}catch{}}}const base16=chain(radix2(4),alphabet("0123456789ABCDEF"),join("")),base32=chain(radix2(5),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),padding(5),join(""));chain(radix2(5),alphabet("0123456789ABCDEFGHIJKLMNOPQRSTUV"),padding(5),join("")),chain(radix2(5),alphabet("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),join(""),normalize$1(n=>n.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const base64=chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),padding(6),join("")),base64url=chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),padding(6),join("")),genBase58=n=>chain(radix(58),alphabet(n),join("")),base58=genBase58("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");genBase58("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),genBase58("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const XMR_BLOCK_LEN=[0,2,3,5,6,7,9,10,11],base58xmr={encode(n){let e="";for(let t=0;t<n.length;t+=8){const r=n.subarray(t,t+8);e+=base58.encode(r).padStart(XMR_BLOCK_LEN[r.length],"1")}return e},decode(n){let e=[];for(let t=0;t<n.length;t+=11){const r=n.slice(t,t+11),s=XMR_BLOCK_LEN.indexOf(r.length),o=base58.decode(r);for(let a=0;a<o.length-s;a++)if(o[a]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(o.slice(o.length-s)))}return Uint8Array.from(e)}},BECH_ALPHABET=chain(alphabet("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join("")),POLYMOD_GENERATORS=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod(n){const e=n>>25;let t=(n&33554431)<<5;for(let r=0;r<POLYMOD_GENERATORS.length;r++)(e>>r&1)===1&&(t^=POLYMOD_GENERATORS[r]);return t}function bechChecksum(n,e,t=1){const r=n.length;let s=1;for(let o=0;o<r;o++){const a=n.charCodeAt(o);if(a<33||a>126)throw new Error(`Invalid prefix (${n})`);s=bech32Polymod(s)^a>>5}s=bech32Polymod(s);for(let o=0;o<r;o++)s=bech32Polymod(s)^n.charCodeAt(o)&31;for(let o of e)s=bech32Polymod(s)^o;for(let o=0;o<6;o++)s=bech32Polymod(s);return s^=t,BECH_ALPHABET.encode(convertRadix2([s%2**30],30,5,!1))}function genBech32(n){const e=n==="bech32"?1:734539939,t=radix2(5),r=t.decode,s=t.encode,o=unsafeWrapper(r);function a(f,h,g=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(h)||h.length&&typeof h[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof h}`);const m=f.length+7+h.length;if(g!==!1&&m>g)throw new TypeError(`Length ${m} exceeds limit ${g}`);return f=f.toLowerCase(),`${f}1${BECH_ALPHABET.encode(h)}${bechChecksum(f,h,e)}`}function u(f,h=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||h!==!1&&f.length>h)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${h})`);const g=f.toLowerCase();if(f!==g&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=g;const m=f.lastIndexOf("1");if(m===0||m===-1)throw new Error('Letter "1" must be present between prefix and data only');const v=f.slice(0,m),b=f.slice(m+1);if(b.length<6)throw new Error("Data must be at least 6 characters long");const y=BECH_ALPHABET.decode(b).slice(0,-6),w=bechChecksum(v,y,e);if(!b.endsWith(w))throw new Error(`Invalid checksum in ${f}: expected "${w}"`);return{prefix:v,words:y}}const c=unsafeWrapper(u);function l(f){const{prefix:h,words:g}=u(f,!1);return{prefix:h,words:g,bytes:r(g)}}return{encode:a,decode:u,decodeToBytes:l,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:o,toWords:s}}const bech32$1=genBech32("bech32");genBech32("bech32m");const utf8$1={encode:n=>new TextDecoder().decode(n),decode:n=>new TextEncoder().encode(n)},hex$1=chain(radix2(4),alphabet("0123456789abcdef"),join(""),normalize$1(n=>{if(typeof n!="string"||n.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof n} with length ${n.length}`);return n.toLowerCase()})),CODERS={utf8:utf8$1,hex:hex$1,base16,base32,base64,base64url,base58,base58xmr};`${Object.keys(CODERS).join(", ")}`;function number(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`positive integer expected, not ${n}`)}function bool(n){if(typeof n!="boolean")throw new Error(`boolean expected, not ${n}`)}function isBytes$2(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function bytes(n,...e){if(!isBytes$2(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${n.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32=n=>new Uint32Array(n.buffer,n.byteOffset,Math.floor(n.byteLength/4)),isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE)throw new Error("Non little-endian hardware is not supported");function checkOpts(n,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(n,e)}function equalBytes$1(n,e){if(n.length!==e.length)return!1;let t=0;for(let r=0;r<n.length;r++)t|=n[r]^e[r];return t===0}const wrapCipher=(n,e)=>(Object.assign(e,n),e),BLOCK_SIZE=16,POLY=283;function mul2(n){return n<<1^POLY&-(n>>7)}function mul(n,e){let t=0;for(;e>0;e>>=1)t^=n&-(e&1),n=mul2(n);return t}const sbox=(()=>{let n=new Uint8Array(256);for(let t=0,r=1;t<256;t++,r^=mul2(r))n[t]=r;const e=new Uint8Array(256);e[0]=99;for(let t=0;t<255;t++){let r=n[255-t];r|=r<<8,e[n[t]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),invSbox=sbox.map((n,e)=>sbox.indexOf(e)),rotr32_8=n=>n<<24|n>>>8,rotl32_8=n=>n<<8|n>>>24;function genTtable(n,e){if(n.length!==256)throw new Error("Wrong sbox length");const t=new Uint32Array(256).map((l,f)=>e(n[f])),r=t.map(rotl32_8),s=r.map(rotl32_8),o=s.map(rotl32_8),a=new Uint32Array(256*256),u=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let l=0;l<256;l++)for(let f=0;f<256;f++){const h=l*256+f;a[h]=t[l]^r[f],u[h]=s[l]^o[f],c[h]=n[l]<<8|n[f]}return{sbox:n,sbox2:c,T0:t,T1:r,T2:s,T3:o,T01:a,T23:u}}const tableEncoding=genTtable(sbox,n=>mul(n,3)<<24|n<<16|n<<8|mul(n,2)),tableDecoding=genTtable(invSbox,n=>mul(n,11)<<24|mul(n,13)<<16|mul(n,9)<<8|mul(n,14)),xPowers=(()=>{const n=new Uint8Array(16);for(let e=0,t=1;e<16;e++,t=mul2(t))n[e]=t;return n})();function expandKeyLE(n){bytes(n);const e=n.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:t}=tableEncoding,r=u32(n),s=r.length,o=u=>applySbox(t,u,u,u,u),a=new Uint32Array(e+28);a.set(r);for(let u=s;u<a.length;u++){let c=a[u-1];u%s===0?c=o(rotr32_8(c))^xPowers[u/s-1]:s>6&&u%s===4&&(c=o(c)),a[u]=a[u-s]^c}return a}function expandKeyDecLE(n){const e=expandKeyLE(n),t=e.slice(),r=e.length,{sbox2:s}=tableEncoding,{T0:o,T1:a,T2:u,T3:c}=tableDecoding;for(let l=0;l<r;l+=4)for(let f=0;f<4;f++)t[l+f]=e[r-l-4+f];e.fill(0);for(let l=4;l<r-4;l++){const f=t[l],h=applySbox(s,f,f,f,f);t[l]=o[h&255]^a[h>>>8&255]^u[h>>>16&255]^c[h>>>24]}return t}function apply0123(n,e,t,r,s,o){return n[t<<8&65280|r>>>8&255]^e[s>>>8&65280|o>>>24&255]}function applySbox(n,e,t,r,s){return n[e&255|t&65280]|n[r>>>16&255|s>>>16&65280]<<16}function encrypt$2(n,e,t,r,s){const{sbox2:o,T01:a,T23:u}=tableEncoding;let c=0;e^=n[c++],t^=n[c++],r^=n[c++],s^=n[c++];const l=n.length/4-2;for(let v=0;v<l;v++){const b=n[c++]^apply0123(a,u,e,t,r,s),y=n[c++]^apply0123(a,u,t,r,s,e),w=n[c++]^apply0123(a,u,r,s,e,t),S=n[c++]^apply0123(a,u,s,e,t,r);e=b,t=y,r=w,s=S}const f=n[c++]^applySbox(o,e,t,r,s),h=n[c++]^applySbox(o,t,r,s,e),g=n[c++]^applySbox(o,r,s,e,t),m=n[c++]^applySbox(o,s,e,t,r);return{s0:f,s1:h,s2:g,s3:m}}function decrypt$2(n,e,t,r,s){const{sbox2:o,T01:a,T23:u}=tableDecoding;let c=0;e^=n[c++],t^=n[c++],r^=n[c++],s^=n[c++];const l=n.length/4-2;for(let v=0;v<l;v++){const b=n[c++]^apply0123(a,u,e,s,r,t),y=n[c++]^apply0123(a,u,t,e,s,r),w=n[c++]^apply0123(a,u,r,t,e,s),S=n[c++]^apply0123(a,u,s,r,t,e);e=b,t=y,r=w,s=S}const f=n[c++]^applySbox(o,e,s,r,t),h=n[c++]^applySbox(o,t,e,s,r),g=n[c++]^applySbox(o,r,t,e,s),m=n[c++]^applySbox(o,s,r,t,e);return{s0:f,s1:h,s2:g,s3:m}}function getDst(n,e){if(!e)return new Uint8Array(n);if(bytes(e),e.length<n)throw new Error(`aes: wrong destination length, expected at least ${n}, got: ${e.length}`);return e}function validateBlockDecrypt(n){if(bytes(n),n.length%BLOCK_SIZE!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${BLOCK_SIZE}`)}function validateBlockEncrypt(n,e,t){let r=n.length;const s=r%BLOCK_SIZE;if(!e&&s!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const o=u32(n);if(e){let c=BLOCK_SIZE-s;c||(c=BLOCK_SIZE),r=r+c}const a=getDst(r,t),u=u32(a);return{b:o,o:u,out:a}}function validatePCKS(n,e){if(!e)return n;const t=n.length;if(!t)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=n[t-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const s=n.subarray(0,-r);for(let o=0;o<r;o++)if(n[t-o-1]!==r)throw new Error("aes/pcks5: wrong padding");return s}function padPCKS(n){const e=new Uint8Array(16),t=u32(e);e.set(n);const r=BLOCK_SIZE-n.length;for(let s=BLOCK_SIZE-r;s<BLOCK_SIZE;s++)e[s]=r;return t}const cbc=wrapCipher({blockSize:16,nonceLength:16},function n(e,t,r={}){bytes(e),bytes(t,16);const s=!r.disablePadding;return{encrypt:(o,a)=>{const u=expandKeyLE(e),{b:c,o:l,out:f}=validateBlockEncrypt(o,s,a),h=u32(t);let g=h[0],m=h[1],v=h[2],b=h[3],y=0;for(;y+4<=c.length;)g^=c[y+0],m^=c[y+1],v^=c[y+2],b^=c[y+3],{s0:g,s1:m,s2:v,s3:b}=encrypt$2(u,g,m,v,b),l[y++]=g,l[y++]=m,l[y++]=v,l[y++]=b;if(s){const w=padPCKS(o.subarray(y*4));g^=w[0],m^=w[1],v^=w[2],b^=w[3],{s0:g,s1:m,s2:v,s3:b}=encrypt$2(u,g,m,v,b),l[y++]=g,l[y++]=m,l[y++]=v,l[y++]=b}return u.fill(0),f},decrypt:(o,a)=>{validateBlockDecrypt(o);const u=expandKeyDecLE(e),c=u32(t),l=getDst(o.length,a),f=u32(o),h=u32(l);let g=c[0],m=c[1],v=c[2],b=c[3];for(let y=0;y+4<=f.length;){const w=g,S=m,B=v,N=b;g=f[y+0],m=f[y+1],v=f[y+2],b=f[y+3];const{s0:U,s1:R,s2:C,s3:I}=decrypt$2(u,g,m,v,b);h[y++]=U^w,h[y++]=R^S,h[y++]=C^B,h[y++]=I^N}return u.fill(0),validatePCKS(l,s)}}}),_utf8ToBytes=n=>Uint8Array.from(n.split("").map(e=>e.charCodeAt(0))),sigma16=_utf8ToBytes("expand 16-byte k"),sigma32=_utf8ToBytes("expand 32-byte k"),sigma16_32=u32(sigma16),sigma32_32=u32(sigma32);sigma32_32.slice();function rotl(n,e){return n<<e|n>>>32-e}function isAligned32(n){return n.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher(n,e,t,r,s,o,a,u){const c=s.length,l=new Uint8Array(BLOCK_LEN),f=u32(l),h=isAligned32(s)&&isAligned32(o),g=h?u32(s):U32_EMPTY,m=h?u32(o):U32_EMPTY;for(let v=0;v<c;a++){if(n(e,t,r,f,a,u),a>=MAX_COUNTER)throw new Error("arx: counter overflow");const b=Math.min(BLOCK_LEN,c-v);if(h&&b===BLOCK_LEN){const y=v/4;if(v%4!==0)throw new Error("arx: invalid block position");for(let w=0,S;w<BLOCK_LEN32;w++)S=y+w,m[S]=g[S]^f[w];v+=BLOCK_LEN;continue}for(let y=0,w;y<b;y++)w=v+y,o[w]=s[w]^l[y];v+=b}}function createCipher(n,e){const{allowShortKeys:t,extendNonceFn:r,counterLength:s,counterRight:o,rounds:a}=checkOpts({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof n!="function")throw new Error("core must be a function");return number(s),number(a),bool(o),bool(t),(u,c,l,f,h=0)=>{bytes(u),bytes(c),bytes(l);const g=l.length;if(f||(f=new Uint8Array(g)),bytes(f),number(h),h<0||h>=MAX_COUNTER)throw new Error("arx: counter overflow");if(f.length<g)throw new Error(`arx: output (${f.length}) is shorter than data (${g})`);const m=[];let v=u.length,b,y;if(v===32)b=u.slice(),m.push(b),y=sigma32_32;else if(v===16&&t)b=new Uint8Array(32),b.set(u),b.set(u,16),y=sigma16_32,m.push(b);else throw new Error(`arx: invalid 32-byte key, got length=${v}`);isAligned32(c)||(c=c.slice(),m.push(c));const w=u32(b);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(y,w,u32(c.subarray(0,16)),w),c=c.subarray(16)}const S=16-s;if(S!==c.length)throw new Error(`arx: nonce must be ${S} or 16 bytes`);if(S!==12){const N=new Uint8Array(12);N.set(c,o?0:12-c.length),c=N,m.push(c)}const B=u32(c);for(runCipher(n,y,w,B,l,f,h,a);m.length>0;)m.pop().fill(0);return f}}function chachaCore(n,e,t,r,s,o=20){let a=n[0],u=n[1],c=n[2],l=n[3],f=e[0],h=e[1],g=e[2],m=e[3],v=e[4],b=e[5],y=e[6],w=e[7],S=s,B=t[0],N=t[1],U=t[2],R=a,C=u,I=c,D=l,F=f,k=h,_=g,A=m,T=v,x=b,E=y,$=w,L=S,P=B,O=N,M=U;for(let q=0;q<o;q+=2)R=R+F|0,L=rotl(L^R,16),T=T+L|0,F=rotl(F^T,12),R=R+F|0,L=rotl(L^R,8),T=T+L|0,F=rotl(F^T,7),C=C+k|0,P=rotl(P^C,16),x=x+P|0,k=rotl(k^x,12),C=C+k|0,P=rotl(P^C,8),x=x+P|0,k=rotl(k^x,7),I=I+_|0,O=rotl(O^I,16),E=E+O|0,_=rotl(_^E,12),I=I+_|0,O=rotl(O^I,8),E=E+O|0,_=rotl(_^E,7),D=D+A|0,M=rotl(M^D,16),$=$+M|0,A=rotl(A^$,12),D=D+A|0,M=rotl(M^D,8),$=$+M|0,A=rotl(A^$,7),R=R+k|0,M=rotl(M^R,16),E=E+M|0,k=rotl(k^E,12),R=R+k|0,M=rotl(M^R,8),E=E+M|0,k=rotl(k^E,7),C=C+_|0,L=rotl(L^C,16),$=$+L|0,_=rotl(_^$,12),C=C+_|0,L=rotl(L^C,8),$=$+L|0,_=rotl(_^$,7),I=I+A|0,P=rotl(P^I,16),T=T+P|0,A=rotl(A^T,12),I=I+A|0,P=rotl(P^I,8),T=T+P|0,A=rotl(A^T,7),D=D+F|0,O=rotl(O^D,16),x=x+O|0,F=rotl(F^x,12),D=D+F|0,O=rotl(O^D,8),x=x+O|0,F=rotl(F^x,7);let H=0;r[H++]=a+R|0,r[H++]=u+C|0,r[H++]=c+I|0,r[H++]=l+D|0,r[H++]=f+F|0,r[H++]=h+k|0,r[H++]=g+_|0,r[H++]=m+A|0,r[H++]=v+T|0,r[H++]=b+x|0,r[H++]=y+E|0,r[H++]=w+$|0,r[H++]=S+L|0,r[H++]=B+P|0,r[H++]=N+O|0,r[H++]=U+M|0}const chacha20=createCipher(chachaCore,{counterRight:!1,counterLength:4,allowShortKeys:!1});let HMAC$1=class extends Hash$1{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,assert.hash(e);const r=toBytes$1(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(r.length>s?e.create().update(r).digest():r);for(let a=0;a<o.length;a++)o[a]^=54;this.iHash.update(o),this.oHash=e.create();for(let a=0;a<o.length;a++)o[a]^=106;this.oHash.update(o),o.fill(0)}update(e){return assert.exists(this),this.iHash.update(e),this}digestInto(e){assert.exists(this),assert.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:s,destroyed:o,blockLen:a,outputLen:u}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=a,e.outputLen=u,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$1=(n,e,t)=>new HMAC$1(n,e).update(t).digest();hmac$1.create=(n,e)=>new HMAC$1(n,e);function extract(n,e,t){return assert.hash(n),hmac$1(n,toBytes$1(t),toBytes$1(e))}const HKDF_COUNTER=new Uint8Array([0]),EMPTY_BUFFER=new Uint8Array;function expand(n,e,t,r=32){if(assert.hash(n),assert.number(r),r>255*n.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/n.outputLen);t===void 0&&(t=EMPTY_BUFFER);const o=new Uint8Array(s*n.outputLen),a=hmac$1.create(n,e),u=a._cloneInto(),c=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)HKDF_COUNTER[0]=l+1,u.update(l===0?EMPTY_BUFFER:c).update(t).update(HKDF_COUNTER).digestInto(c),o.set(c,n.outputLen*l),a._cloneInto(u);return a.destroy(),u.destroy(),c.fill(0),HKDF_COUNTER.fill(0),o.slice(0,r)}var __defProp=Object.defineProperty,__export=(n,e)=>{for(var t in e)__defProp(n,t,{get:e[t],enumerable:!0})},verifiedSymbol=Symbol("verified"),isRecord=n=>n instanceof Object;function validateEvent(n){if(!isRecord(n)||typeof n.kind!="number"||typeof n.content!="string"||typeof n.created_at!="number"||typeof n.pubkey!="string"||!n.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(n.tags))return!1;for(let e=0;e<n.tags.length;e++){let t=n.tags[e];if(!Array.isArray(t))return!1;for(let r=0;r<t.length;r++)if(typeof t[r]=="object")return!1}return!0}var utils_exports={};__export(utils_exports,{Queue:()=>Queue$1,QueueNode:()=>QueueNode,binarySearch:()=>binarySearch,insertEventIntoAscendingList:()=>insertEventIntoAscendingList,insertEventIntoDescendingList:()=>insertEventIntoDescendingList,normalizeURL:()=>normalizeURL,utf8Decoder:()=>utf8Decoder,utf8Encoder:()=>utf8Encoder});var utf8Decoder=new TextDecoder("utf-8"),utf8Encoder=new TextEncoder;function normalizeURL(n){n.indexOf("://")===-1&&(n="wss://"+n);let e=new URL(n);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function insertEventIntoDescendingList(n,e){const[t,r]=binarySearch(n,s=>e.id===s.id?0:e.created_at===s.created_at?-1:s.created_at-e.created_at);return r||n.splice(t,0,e),n}function insertEventIntoAscendingList(n,e){const[t,r]=binarySearch(n,s=>e.id===s.id?0:e.created_at===s.created_at?-1:e.created_at-s.created_at);return r||n.splice(t,0,e),n}function binarySearch(n,e){let t=0,r=n.length-1;for(;t<=r;){const s=Math.floor((t+r)/2),o=e(n[s]);if(o===0)return[s,!0];o<0?r=s-1:t=s+1}return[t,!1]}var QueueNode=class{constructor(n){p(this,"value");p(this,"next",null);p(this,"prev",null);this.value=n}},Queue$1=class{constructor(){p(this,"first");p(this,"last");this.first=null,this.last=null}enqueue(e){const t=new QueueNode(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,e.value}},JS=class{generateSecretKey(){return schnorr$1.utils.randomPrivateKey()}getPublicKey(n){return bytesToHex$2(schnorr$1.getPublicKey(n))}finalizeEvent(n,e){const t=n;return t.pubkey=bytesToHex$2(schnorr$1.getPublicKey(e)),t.id=getEventHash$1(t),t.sig=bytesToHex$2(schnorr$1.sign(getEventHash$1(t),e)),t[verifiedSymbol]=!0,t}verifyEvent(n){if(typeof n[verifiedSymbol]=="boolean")return n[verifiedSymbol];const e=getEventHash$1(n);if(e!==n.id)return n[verifiedSymbol]=!1,!1;try{const t=schnorr$1.verify(n.sig,e,n.pubkey);return n[verifiedSymbol]=t,t}catch{return n[verifiedSymbol]=!1,!1}}};function serializeEvent(n){if(!validateEvent(n))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,n.pubkey,n.created_at,n.kind,n.tags,n.content])}function getEventHash$1(n){let e=sha256$1(utf8Encoder.encode(serializeEvent(n)));return bytesToHex$2(e)}var i=new JS,generateSecretKey=i.generateSecretKey,getPublicKey=i.getPublicKey,finalizeEvent=i.finalizeEvent,verifyEvent=i.verifyEvent,kinds_exports={};__export(kinds_exports,{Application:()=>Application,BadgeAward:()=>BadgeAward,BadgeDefinition:()=>BadgeDefinition,BlockedRelaysList:()=>BlockedRelaysList,BookmarkList:()=>BookmarkList,Bookmarksets:()=>Bookmarksets,Calendar:()=>Calendar,CalendarEventRSVP:()=>CalendarEventRSVP,ChannelCreation:()=>ChannelCreation,ChannelHideMessage:()=>ChannelHideMessage,ChannelMessage:()=>ChannelMessage,ChannelMetadata:()=>ChannelMetadata,ChannelMuteUser:()=>ChannelMuteUser,ClassifiedListing:()=>ClassifiedListing,ClientAuth:()=>ClientAuth,CommunitiesList:()=>CommunitiesList,CommunityDefinition:()=>CommunityDefinition,CommunityPostApproval:()=>CommunityPostApproval,Contacts:()=>Contacts,CreateOrUpdateProduct:()=>CreateOrUpdateProduct,CreateOrUpdateStall:()=>CreateOrUpdateStall,Curationsets:()=>Curationsets,Date:()=>Date2,DirectMessageRelaysList:()=>DirectMessageRelaysList,DraftClassifiedListing:()=>DraftClassifiedListing,DraftLong:()=>DraftLong,Emojisets:()=>Emojisets,EncryptedDirectMessage:()=>EncryptedDirectMessage,EventDeletion:()=>EventDeletion,FileMetadata:()=>FileMetadata,FileServerPreference:()=>FileServerPreference,Followsets:()=>Followsets,GenericRepost:()=>GenericRepost,Genericlists:()=>Genericlists,GiftWrap:()=>GiftWrap,HTTPAuth:()=>HTTPAuth,Handlerinformation:()=>Handlerinformation,Handlerrecommendation:()=>Handlerrecommendation,Highlights:()=>Highlights,InterestsList:()=>InterestsList,Interestsets:()=>Interestsets,JobFeedback:()=>JobFeedback,JobRequest:()=>JobRequest,JobResult:()=>JobResult,Label:()=>Label,LightningPubRPC:()=>LightningPubRPC,LiveChatMessage:()=>LiveChatMessage,LiveEvent:()=>LiveEvent,LongFormArticle:()=>LongFormArticle,Metadata:()=>Metadata,Mutelist:()=>Mutelist,NWCWalletInfo:()=>NWCWalletInfo,NWCWalletRequest:()=>NWCWalletRequest,NWCWalletResponse:()=>NWCWalletResponse,NostrConnect:()=>NostrConnect,OpenTimestamps:()=>OpenTimestamps,Pinlist:()=>Pinlist,PrivateDirectMessage:()=>PrivateDirectMessage,ProblemTracker:()=>ProblemTracker,ProfileBadges:()=>ProfileBadges,PublicChatsList:()=>PublicChatsList,Reaction:()=>Reaction,RecommendRelay:()=>RecommendRelay,RelayList:()=>RelayList,Relaysets:()=>Relaysets,Report:()=>Report,Reporting:()=>Reporting,Repost:()=>Repost,Seal:()=>Seal,SearchRelaysList:()=>SearchRelaysList,ShortTextNote:()=>ShortTextNote,Time:()=>Time,UserEmojiList:()=>UserEmojiList,UserStatuses:()=>UserStatuses,Zap:()=>Zap,ZapGoal:()=>ZapGoal,ZapRequest:()=>ZapRequest,classifyKind:()=>classifyKind,isAddressableKind:()=>isAddressableKind,isEphemeralKind:()=>isEphemeralKind,isKind:()=>isKind,isParameterizedReplaceableKind:()=>isParameterizedReplaceableKind,isRegularKind:()=>isRegularKind,isReplaceableKind:()=>isReplaceableKind});function isRegularKind(n){return 1e3<=n&&n<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(n)}function isReplaceableKind(n){return[0,3].includes(n)||1e4<=n&&n<2e4}function isEphemeralKind(n){return 2e4<=n&&n<3e4}function isAddressableKind(n){return 3e4<=n&&n<4e4}var isParameterizedReplaceableKind=isAddressableKind;function classifyKind(n){return isRegularKind(n)?"regular":isReplaceableKind(n)?"replaceable":isEphemeralKind(n)?"ephemeral":isAddressableKind(n)?"parameterized":"unknown"}function isKind(n,e){const t=e instanceof Array?e:[e];return validateEvent(n)&&t.includes(n.kind)||!1}var Metadata=0,ShortTextNote=1,RecommendRelay=2,Contacts=3,EncryptedDirectMessage=4,EventDeletion=5,Repost=6,Reaction=7,BadgeAward=8,Seal=13,PrivateDirectMessage=14,GenericRepost=16,ChannelCreation=40,ChannelMetadata=41,ChannelMessage=42,ChannelHideMessage=43,ChannelMuteUser=44,OpenTimestamps=1040,GiftWrap=1059,FileMetadata=1063,LiveChatMessage=1311,ProblemTracker=1971,Report=1984,Reporting=1984,Label=1985,CommunityPostApproval=4550,JobRequest=5999,JobResult=6999,JobFeedback=7e3,ZapGoal=9041,ZapRequest=9734,Zap=9735,Highlights=9802,Mutelist=1e4,Pinlist=10001,RelayList=10002,BookmarkList=10003,CommunitiesList=10004,PublicChatsList=10005,BlockedRelaysList=10006,SearchRelaysList=10007,InterestsList=10015,UserEmojiList=10030,DirectMessageRelaysList=10050,FileServerPreference=10096,NWCWalletInfo=13194,LightningPubRPC=21e3,ClientAuth=22242,NWCWalletRequest=23194,NWCWalletResponse=23195,NostrConnect=24133,HTTPAuth=27235,Followsets=3e4,Genericlists=30001,Relaysets=30002,Bookmarksets=30003,Curationsets=30004,ProfileBadges=30008,BadgeDefinition=30009,Interestsets=30015,CreateOrUpdateStall=30017,CreateOrUpdateProduct=30018,LongFormArticle=30023,DraftLong=30024,Emojisets=30030,Application=30078,LiveEvent=30311,UserStatuses=30315,ClassifiedListing=30402,DraftClassifiedListing=30403,Date2=31922,Time=31923,Calendar=31924,CalendarEventRSVP=31925,Handlerrecommendation=31989,Handlerinformation=31990,CommunityDefinition=34550;function matchFilter(n,e){if(n.ids&&n.ids.indexOf(e.id)===-1||n.kinds&&n.kinds.indexOf(e.kind)===-1||n.authors&&n.authors.indexOf(e.pubkey)===-1)return!1;for(let t in n)if(t[0]==="#"){let r=t.slice(1),s=n[`#${r}`];if(s&&!e.tags.find(([o,a])=>o===t.slice(1)&&s.indexOf(a)!==-1))return!1}return!(n.since&&e.created_at<n.since||n.until&&e.created_at>n.until)}function matchFilters(n,e){for(let t=0;t<n.length;t++)if(matchFilter(n[t],e))return!0;return!1}var fakejson_exports={};__export(fakejson_exports,{getHex64:()=>getHex64,getInt:()=>getInt,getSubscriptionId:()=>getSubscriptionId,matchEventId:()=>matchEventId,matchEventKind:()=>matchEventKind,matchEventPubkey:()=>matchEventPubkey});function getHex64(n,e){let t=e.length+3,r=n.indexOf(`"${e}":`)+t,s=n.slice(r).indexOf('"')+r+1;return n.slice(s,s+64)}function getInt(n,e){let t=e.length,r=n.indexOf(`"${e}":`)+t+3,s=n.slice(r),o=Math.min(s.indexOf(","),s.indexOf("}"));return parseInt(s.slice(0,o),10)}function getSubscriptionId(n){let e=n.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let t=n.slice(e+7+1).indexOf('"');if(t===-1)return null;let r=e+7+1+t,s=n.slice(r+1,80).indexOf('"');if(s===-1)return null;let o=r+1+s;return n.slice(r+1,o)}function matchEventId(n,e){return e===getHex64(n,"id")}function matchEventPubkey(n,e){return e===getHex64(n,"pubkey")}function matchEventKind(n,e){return e===getInt(n,"kind")}var nip42_exports={};__export(nip42_exports,{makeAuthEvent:()=>makeAuthEvent});function makeAuthEvent(n,e){return{kind:ClientAuth,created_at:Math.floor(Date.now()/1e3),tags:[["relay",n],["challenge",e]],content:""}}var _WebSocket;try{_WebSocket=WebSocket}catch{}var _WebSocket2;try{_WebSocket2=WebSocket}catch{}var nip19_exports={};__export(nip19_exports,{BECH32_REGEX:()=>BECH32_REGEX$1,Bech32MaxSize:()=>Bech32MaxSize,NostrTypeGuard:()=>NostrTypeGuard,decode:()=>decode,decodeNostrURI:()=>decodeNostrURI,encodeBytes:()=>encodeBytes,naddrEncode:()=>naddrEncode,neventEncode:()=>neventEncode,noteEncode:()=>noteEncode,nprofileEncode:()=>nprofileEncode,npubEncode:()=>npubEncode,nsecEncode:()=>nsecEncode});var NostrTypeGuard={isNProfile:n=>/^nprofile1[a-z\d]+$/.test(n||""),isNEvent:n=>/^nevent1[a-z\d]+$/.test(n||""),isNAddr:n=>/^naddr1[a-z\d]+$/.test(n||""),isNSec:n=>/^nsec1[a-z\d]{58}$/.test(n||""),isNPub:n=>/^npub1[a-z\d]{58}$/.test(n||""),isNote:n=>/^note1[a-z\d]+$/.test(n||""),isNcryptsec:n=>/^ncryptsec1[a-z\d]+$/.test(n||"")},Bech32MaxSize=5e3,BECH32_REGEX$1=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array(n){const e=new Uint8Array(4);return e[0]=n>>24&255,e[1]=n>>16&255,e[2]=n>>8&255,e[3]=n&255,e}function decodeNostrURI(n){try{return n.startsWith("nostr:")&&(n=n.substring(6)),decode(n)}catch{return{type:"invalid",data:null}}}function decode(n){var s,o,a,u,c,l,f;let{prefix:e,words:t}=bech32$1.decode(n,Bech32MaxSize),r=new Uint8Array(bech32$1.fromWords(t));switch(e){case"nprofile":{let h=parseTLV(r);if(!((s=h[0])!=null&&s[0]))throw new Error("missing TLV 0 for nprofile");if(h[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex$2(h[0][0]),relays:h[1]?h[1].map(g=>utf8Decoder.decode(g)):[]}}}case"nevent":{let h=parseTLV(r);if(!((o=h[0])!=null&&o[0]))throw new Error("missing TLV 0 for nevent");if(h[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(h[2]&&h[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(h[3]&&h[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex$2(h[0][0]),relays:h[1]?h[1].map(g=>utf8Decoder.decode(g)):[],author:(a=h[2])!=null&&a[0]?bytesToHex$2(h[2][0]):void 0,kind:(u=h[3])!=null&&u[0]?parseInt(bytesToHex$2(h[3][0]),16):void 0}}}case"naddr":{let h=parseTLV(r);if(!((c=h[0])!=null&&c[0]))throw new Error("missing TLV 0 for naddr");if(!((l=h[2])!=null&&l[0]))throw new Error("missing TLV 2 for naddr");if(h[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((f=h[3])!=null&&f[0]))throw new Error("missing TLV 3 for naddr");if(h[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder.decode(h[0][0]),pubkey:bytesToHex$2(h[2][0]),kind:parseInt(bytesToHex$2(h[3][0]),16),relays:h[1]?h[1].map(g=>utf8Decoder.decode(g)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:bytesToHex$2(r)};default:throw new Error(`unknown prefix ${e}`)}}function parseTLV(n){let e={},t=n;for(;t.length>0;){let r=t[0],s=t[1],o=t.slice(2,2+s);if(t=t.slice(2+s),o.length<s)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(o)}return e}function nsecEncode(n){return encodeBytes("nsec",n)}function npubEncode(n){return encodeBytes("npub",hexToBytes$2(n))}function noteEncode(n){return encodeBytes("note",hexToBytes$2(n))}function encodeBech32(n,e){let t=bech32$1.toWords(e);return bech32$1.encode(n,t,Bech32MaxSize)}function encodeBytes(n,e){return encodeBech32(n,e)}function nprofileEncode(n){let e=encodeTLV({0:[hexToBytes$2(n.pubkey)],1:(n.relays||[]).map(t=>utf8Encoder.encode(t))});return encodeBech32("nprofile",e)}function neventEncode(n){let e;n.kind!==void 0&&(e=integerToUint8Array(n.kind));let t=encodeTLV({0:[hexToBytes$2(n.id)],1:(n.relays||[]).map(r=>utf8Encoder.encode(r)),2:n.author?[hexToBytes$2(n.author)]:[],3:e?[new Uint8Array(e)]:[]});return encodeBech32("nevent",t)}function naddrEncode(n){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,n.kind,!1);let t=encodeTLV({0:[utf8Encoder.encode(n.identifier)],1:(n.relays||[]).map(r=>utf8Encoder.encode(r)),2:[hexToBytes$2(n.pubkey)],3:[new Uint8Array(e)]});return encodeBech32("naddr",t)}function encodeTLV(n){let e=[];return Object.entries(n).reverse().forEach(([t,r])=>{r.forEach(s=>{let o=new Uint8Array(s.length+2);o.set([parseInt(t)],0),o.set([s.length],1),o.set(s,2),e.push(o)})}),concatBytes$2(...e)}var nip04_exports={};__export(nip04_exports,{decrypt:()=>decrypt$1,encrypt:()=>encrypt$1});function encrypt$1(n,e,t){const r=n instanceof Uint8Array?bytesToHex$2(n):n,s=secp256k1$1.getSharedSecret(r,"02"+e),o=getNormalizedX(s);let a=Uint8Array.from(randomBytes$1(16)),u=utf8Encoder.encode(t),c=cbc(o,a).encrypt(u),l=base64.encode(new Uint8Array(c)),f=base64.encode(new Uint8Array(a.buffer));return`${l}?iv=${f}`}function decrypt$1(n,e,t){const r=n instanceof Uint8Array?bytesToHex$2(n):n;let[s,o]=t.split("?iv="),a=secp256k1$1.getSharedSecret(r,"02"+e),u=getNormalizedX(a),c=base64.decode(o),l=base64.decode(s),f=cbc(u,c).decrypt(l);return utf8Decoder.decode(f)}function getNormalizedX(n){return n.slice(1,33)}var nip05_exports={};__export(nip05_exports,{NIP05_REGEX:()=>NIP05_REGEX$1,isNip05:()=>isNip05,isValid:()=>isValid,queryProfile:()=>queryProfile,searchDomain:()=>searchDomain,useFetchImplementation:()=>useFetchImplementation});var NIP05_REGEX$1=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,isNip05=n=>NIP05_REGEX$1.test(n||""),_fetch;try{_fetch=fetch}catch(n){}function useFetchImplementation(n){_fetch=n}async function searchDomain(n,e=""){try{const t=`https://${n}/.well-known/nostr.json?name=${e}`,r=await _fetch(t,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function queryProfile(n){var s;const e=n.match(NIP05_REGEX$1);if(!e)return null;const[,t="_",r]=e;try{const o=`https://${r}/.well-known/nostr.json?name=${t}`,a=await _fetch(o,{redirect:"manual"});if(a.status!==200)throw Error("Wrong response code");const u=await a.json(),c=u.names[t];return c?{pubkey:c,relays:(s=u.relays)==null?void 0:s[c]}:null}catch{return null}}async function isValid(n,e){const t=await queryProfile(e);return t?t.pubkey===n:!1}var nip10_exports={};__export(nip10_exports,{parse:()=>parse});function parse(n){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let t,r;for(let s=n.tags.length-1;s>=0;s--){const o=n.tags[s];if(o[0]==="e"&&o[1]){const[a,u,c,l,f]=o,h={id:u,relays:c?[c]:[],author:f};if(l==="root"){e.root=h;continue}if(l==="reply"){e.reply=h;continue}if(l==="mention"){e.mentions.push(h);continue}t?r=h:t=h,e.mentions.push(h);continue}if(o[0]==="q"&&o[1]){const[a,u,c]=o;e.quotes.push({id:u,relays:c?[c]:[]})}if(o[0]==="p"&&o[1]){e.profiles.push({pubkey:o[1],relays:o[2]?[o[2]]:[]});continue}}return e.root||(e.root=r||t||e.reply),e.reply||(e.reply=t||e.root),[e.reply,e.root].forEach(s=>{if(!s)return;let o=e.mentions.indexOf(s);if(o!==-1&&e.mentions.splice(o,1),s.author){let a=e.profiles.find(u=>u.pubkey===s.author);a&&a.relays&&(s.relays||(s.relays=[]),a.relays.forEach(u=>{var c;((c=s.relays)==null?void 0:c.indexOf(u))===-1&&s.relays.push(u)}),a.relays=s.relays)}}),e.mentions.forEach(s=>{if(s.author){let o=e.profiles.find(a=>a.pubkey===s.author);o&&o.relays&&(s.relays||(s.relays=[]),o.relays.forEach(a=>{s.relays.indexOf(a)===-1&&s.relays.push(a)}),o.relays=s.relays)}}),e}var nip11_exports={};__export(nip11_exports,{fetchRelayInformation:()=>fetchRelayInformation,useFetchImplementation:()=>useFetchImplementation2});var _fetch2;try{_fetch2=fetch}catch{}function useFetchImplementation2(n){_fetch2=n}async function fetchRelayInformation(n){return await(await fetch(n.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var nip13_exports={};__export(nip13_exports,{fastEventHash:()=>fastEventHash,getPow:()=>getPow,minePow:()=>minePow});function getPow(n){let e=0;for(let t=0;t<64;t+=8){const r=parseInt(n.substring(t,t+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function minePow(n,e){let t=0;const r=n,s=["nonce",t.toString(),e.toString()];for(r.tags.push(s);;){const o=Math.floor(new Date().getTime()/1e3);if(o!==r.created_at&&(t=0,r.created_at=o),s[1]=(++t).toString(),r.id=fastEventHash(r),getPow(r.id)>=e)break}return r}function fastEventHash(n){return bytesToHex$2(sha256$1(utf8Encoder.encode(JSON.stringify([0,n.pubkey,n.created_at,n.kind,n.tags,n.content]))))}var nip17_exports={};__export(nip17_exports,{unwrapEvent:()=>unwrapEvent2,unwrapManyEvents:()=>unwrapManyEvents2,wrapEvent:()=>wrapEvent2,wrapManyEvents:()=>wrapManyEvents2});var nip59_exports={};__export(nip59_exports,{createRumor:()=>createRumor,createSeal:()=>createSeal,createWrap:()=>createWrap,unwrapEvent:()=>unwrapEvent,unwrapManyEvents:()=>unwrapManyEvents,wrapEvent:()=>wrapEvent$1,wrapManyEvents:()=>wrapManyEvents});var nip44_exports={};__export(nip44_exports,{decrypt:()=>decrypt2,encrypt:()=>encrypt2,getConversationKey:()=>getConversationKey,v2:()=>v2});var minPlaintextSize=1,maxPlaintextSize=65535;function getConversationKey(n,e){const t=secp256k1$1.getSharedSecret(n,"02"+e).subarray(1,33);return extract(sha256$1,t,"nip44-v2")}function getMessageKeys(n,e){const t=expand(sha256$1,n,e,76);return{chacha_key:t.subarray(0,32),chacha_nonce:t.subarray(32,44),hmac_key:t.subarray(44,76)}}function calcPaddedLen(n){if(!Number.isSafeInteger(n)||n<1)throw new Error("expected positive integer");if(n<=32)return 32;const e=1<<Math.floor(Math.log2(n-1))+1,t=e<=256?32:e/8;return t*(Math.floor((n-1)/t)+1)}function writeU16BE(n){if(!Number.isSafeInteger(n)||n<minPlaintextSize||n>maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,n,!1),e}function pad(n){const e=utf8Encoder.encode(n),t=e.length,r=writeU16BE(t),s=new Uint8Array(calcPaddedLen(t)-t);return concatBytes$2(r,e,s)}function unpad(n){const e=new DataView(n.buffer).getUint16(0),t=n.subarray(2,2+e);if(e<minPlaintextSize||e>maxPlaintextSize||t.length!==e||n.length!==2+calcPaddedLen(e))throw new Error("invalid padding");return utf8Decoder.decode(t)}function hmacAad(n,e,t){if(t.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=concatBytes$2(t,e);return hmac$1(sha256$1,n,r)}function decodePayload(n){if(typeof n!="string")throw new Error("payload must be a valid string");const e=n.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(n[0]==="#")throw new Error("unknown encryption version");let t;try{t=base64.decode(n)}catch(o){throw new Error("invalid base64: "+o.message)}const r=t.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const s=t[0];if(s!==2)throw new Error("unknown encryption version "+s);return{nonce:t.subarray(1,33),ciphertext:t.subarray(33,-32),mac:t.subarray(-32)}}function encrypt2(n,e,t=randomBytes$1(32)){const{chacha_key:r,chacha_nonce:s,hmac_key:o}=getMessageKeys(e,t),a=pad(n),u=chacha20(r,s,a),c=hmacAad(o,u,t);return base64.encode(concatBytes$2(new Uint8Array([2]),t,u,c))}function decrypt2(n,e){const{nonce:t,ciphertext:r,mac:s}=decodePayload(n),{chacha_key:o,chacha_nonce:a,hmac_key:u}=getMessageKeys(e,t),c=hmacAad(u,r,t);if(!equalBytes$1(c,s))throw new Error("invalid MAC");const l=chacha20(o,a,r);return unpad(l)}var v2={utils:{getConversationKey,calcPaddedLen},encrypt:encrypt2,decrypt:decrypt2},TWO_DAYS=2*24*60*60,now=()=>Math.round(Date.now()/1e3),randomNow=()=>Math.round(now()-Math.random()*TWO_DAYS),nip44ConversationKey=(n,e)=>getConversationKey(n,e),nip44Encrypt=(n,e,t)=>encrypt2(JSON.stringify(n),nip44ConversationKey(e,t)),nip44Decrypt=(n,e)=>JSON.parse(decrypt2(n.content,nip44ConversationKey(e,n.pubkey)));function createRumor(n,e){const t={created_at:now(),content:"",tags:[],...n,pubkey:getPublicKey(e)};return t.id=getEventHash$1(t),t}function createSeal(n,e,t){return finalizeEvent({kind:Seal,content:nip44Encrypt(n,e,t),created_at:randomNow(),tags:[]},e)}function createWrap(n,e){const t=generateSecretKey();return finalizeEvent({kind:GiftWrap,content:nip44Encrypt(n,t,e),created_at:randomNow(),tags:[["p",e]]},t)}function wrapEvent$1(n,e,t){const r=createRumor(n,e),s=createSeal(r,e,t);return createWrap(s,t)}function wrapManyEvents(n,e,t){if(!t||t.length===0)throw new Error("At least one recipient is required.");const r=getPublicKey(e),s=[wrapEvent$1(n,e,r)];return t.forEach(o=>{s.push(wrapEvent$1(n,e,o))}),s}function unwrapEvent(n,e){const t=nip44Decrypt(n,e);return nip44Decrypt(t,e)}function unwrapManyEvents(n,e){let t=[];return n.forEach(r=>{t.push(unwrapEvent(r,e))}),t.sort((r,s)=>r.created_at-s.created_at),t}function createEvent(n,e,t,r){const s={created_at:Math.ceil(Date.now()/1e3),kind:PrivateDirectMessage,tags:[],content:e};return(Array.isArray(n)?n:[n]).forEach(({publicKey:a,relayUrl:u})=>{s.tags.push(u?["p",a,u]:["p",a])}),r&&s.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),t&&s.tags.push(["subject",t]),s}function wrapEvent2(n,e,t,r,s){const o=createEvent(e,t,r,s);return wrapEvent$1(o,n,e.publicKey)}function wrapManyEvents2(n,e,t,r,s){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:getPublicKey(n)},...e].map(a=>wrapEvent2(n,a,t,r,s))}var unwrapEvent2=unwrapEvent,unwrapManyEvents2=unwrapManyEvents,nip18_exports={};__export(nip18_exports,{finishRepostEvent:()=>finishRepostEvent,getRepostedEvent:()=>getRepostedEvent,getRepostedEventPointer:()=>getRepostedEventPointer});function finishRepostEvent(n,e,t,r){var a;let s;const o=[...n.tags??[],["e",e.id,t],["p",e.pubkey]];return e.kind===ShortTextNote?s=Repost:(s=GenericRepost,o.push(["k",String(e.kind)])),finalizeEvent({kind:s,tags:o,content:n.content===""||(a=e.tags)!=null&&a.find(u=>u[0]==="-")?"":JSON.stringify(e),created_at:n.created_at},r)}function getRepostedEventPointer(n){if(![Repost,GenericRepost].includes(n.kind))return;let e,t;for(let r=n.tags.length-1;r>=0&&(e===void 0||t===void 0);r--){const s=n.tags[r];s.length>=2&&(s[0]==="e"&&e===void 0?e=s:s[0]==="p"&&t===void 0&&(t=s))}if(e!==void 0)return{id:e[1],relays:[e[2],t==null?void 0:t[2]].filter(r=>typeof r=="string"),author:t==null?void 0:t[1]}}function getRepostedEvent(n,{skipVerification:e}={}){const t=getRepostedEventPointer(n);if(t===void 0||n.content==="")return;let r;try{r=JSON.parse(n.content)}catch{return}if(r.id===t.id&&!(!e&&!verifyEvent(r)))return r}var nip21_exports={};__export(nip21_exports,{NOSTR_URI_REGEX:()=>NOSTR_URI_REGEX,parse:()=>parse2,test:()=>test});var NOSTR_URI_REGEX=new RegExp(`nostr:(${BECH32_REGEX$1.source})`);function test(n){return typeof n=="string"&&new RegExp(`^${NOSTR_URI_REGEX.source}$`).test(n)}function parse2(n){const e=n.match(new RegExp(`^${NOSTR_URI_REGEX.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${n}`);return{uri:e[0],value:e[1],decoded:decode(e[1])}}var nip25_exports={};__export(nip25_exports,{finishReactionEvent:()=>finishReactionEvent,getReactedEventPointer:()=>getReactedEventPointer});function finishReactionEvent(n,e,t){const r=e.tags.filter(s=>s.length>=2&&(s[0]==="e"||s[0]==="p"));return finalizeEvent({...n,kind:Reaction,tags:[...n.tags??[],...r,["e",e.id],["p",e.pubkey]],content:n.content??"+"},t)}function getReactedEventPointer(n){if(n.kind!==Reaction)return;let e,t;for(let r=n.tags.length-1;r>=0&&(e===void 0||t===void 0);r--){const s=n.tags[r];s.length>=2&&(s[0]==="e"&&e===void 0?e=s:s[0]==="p"&&t===void 0&&(t=s))}if(!(e===void 0||t===void 0))return{id:e[1],relays:[e[2],t[2]].filter(r=>r!==void 0),author:t[1]}}var nip27_exports={};__export(nip27_exports,{parse:()=>parse3});var noCharacter=/\W/m,noURLCharacter=/\W |\W$|$|,| /m;function*parse3(n){const e=n.length;let t=0,r=0;for(;r<e;){let s=n.indexOf(":",r);if(s===-1)break;if(n.substring(s-5,s)==="nostr"){const o=n.substring(s+60).match(noCharacter),a=o?s+60+o.index:e;try{let u,{data:c,type:l}=decode(n.substring(s+1,a));switch(l){case"npub":u={pubkey:c};break;case"nsec":case"note":r=a+1;continue;default:u=c}t!==s-5&&(yield{type:"text",text:n.substring(t,s-5)}),yield{type:"reference",pointer:u},r=a,t=r;continue}catch{r=s+1;continue}}else if(n.substring(s-5,s)==="https"||n.substring(s-4,s)==="http"){const o=n.substring(s+4).match(noURLCharacter),a=o?s+4+o.index:e,u=n[s-1]==="s"?5:4;try{let c=new URL(n.substring(s-u,a));if(c.hostname.indexOf(".")===-1)throw new Error("invalid url");if(t!==s-u&&(yield{type:"text",text:n.substring(t,s-u)}),c.pathname.endsWith(".png")||c.pathname.endsWith(".jpg")||c.pathname.endsWith(".jpeg")||c.pathname.endsWith(".gif")||c.pathname.endsWith(".webp")){yield{type:"image",url:c.toString()},r=a,t=r;continue}if(c.pathname.endsWith(".mp4")||c.pathname.endsWith(".avi")||c.pathname.endsWith(".webm")||c.pathname.endsWith(".mkv")){yield{type:"video",url:c.toString()},r=a,t=r;continue}if(c.pathname.endsWith(".mp3")||c.pathname.endsWith(".aac")||c.pathname.endsWith(".ogg")||c.pathname.endsWith(".opus")){yield{type:"audio",url:c.toString()},r=a,t=r;continue}yield{type:"url",url:c.toString()},r=a,t=r;continue}catch{r=a+1;continue}}else if(n.substring(s-3,s)==="wss"||n.substring(s-2,s)==="ws"){const o=n.substring(s+4).match(noURLCharacter),a=o?s+4+o.index:e,u=n[s-1]==="s"?3:2;try{let c=new URL(n.substring(s-u,a));if(c.hostname.indexOf(".")===-1)throw new Error("invalid ws url");t!==s-u&&(yield{type:"text",text:n.substring(t,s-u)}),yield{type:"relay",url:c.toString()},r=a,t=r;continue}catch{r=a+1;continue}}else{r=s+1;continue}}t!==e&&(yield{type:"text",text:n.substring(t)})}var nip28_exports={};__export(nip28_exports,{channelCreateEvent:()=>channelCreateEvent,channelHideMessageEvent:()=>channelHideMessageEvent,channelMessageEvent:()=>channelMessageEvent,channelMetadataEvent:()=>channelMetadataEvent,channelMuteUserEvent:()=>channelMuteUserEvent});var channelCreateEvent=(n,e)=>{let t;if(typeof n.content=="object")t=JSON.stringify(n.content);else if(typeof n.content=="string")t=n.content;else return;return finalizeEvent({kind:ChannelCreation,tags:[...n.tags??[]],content:t,created_at:n.created_at},e)},channelMetadataEvent=(n,e)=>{let t;if(typeof n.content=="object")t=JSON.stringify(n.content);else if(typeof n.content=="string")t=n.content;else return;return finalizeEvent({kind:ChannelMetadata,tags:[["e",n.channel_create_event_id],...n.tags??[]],content:t,created_at:n.created_at},e)},channelMessageEvent=(n,e)=>{const t=[["e",n.channel_create_event_id,n.relay_url,"root"]];return n.reply_to_channel_message_event_id&&t.push(["e",n.reply_to_channel_message_event_id,n.relay_url,"reply"]),finalizeEvent({kind:ChannelMessage,tags:[...t,...n.tags??[]],content:n.content,created_at:n.created_at},e)},channelHideMessageEvent=(n,e)=>{let t;if(typeof n.content=="object")t=JSON.stringify(n.content);else if(typeof n.content=="string")t=n.content;else return;return finalizeEvent({kind:ChannelHideMessage,tags:[["e",n.channel_message_event_id],...n.tags??[]],content:t,created_at:n.created_at},e)},channelMuteUserEvent=(n,e)=>{let t;if(typeof n.content=="object")t=JSON.stringify(n.content);else if(typeof n.content=="string")t=n.content;else return;return finalizeEvent({kind:ChannelMuteUser,tags:[["p",n.pubkey_to_mute],...n.tags??[]],content:t,created_at:n.created_at},e)},nip30_exports={};__export(nip30_exports,{EMOJI_SHORTCODE_REGEX:()=>EMOJI_SHORTCODE_REGEX,matchAll:()=>matchAll,regex:()=>regex,replaceAll:()=>replaceAll});var EMOJI_SHORTCODE_REGEX=/:(\w+):/,regex=()=>new RegExp(`\\B${EMOJI_SHORTCODE_REGEX.source}\\B`,"g");function*matchAll(n){const e=n.matchAll(regex());for(const t of e)try{const[r,s]=t;yield{shortcode:r,name:s,start:t.index,end:t.index+r.length}}catch{}}function replaceAll(n,e){return n.replaceAll(regex(),(t,r)=>e({shortcode:t,name:r}))}var nip39_exports={};__export(nip39_exports,{useFetchImplementation:()=>useFetchImplementation3,validateGithub:()=>validateGithub});var _fetch3;try{_fetch3=fetch}catch{}function useFetchImplementation3(n){_fetch3=n}async function validateGithub(n,e,t){try{return await(await _fetch3(`https://gist.github.com/${e}/${t}/raw`)).text()===`Verifying that I control the following Nostr public key: ${n}`}catch{return!1}}var nip47_exports={};__export(nip47_exports,{makeNwcRequestEvent:()=>makeNwcRequestEvent,parseConnectionString:()=>parseConnectionString});function parseConnectionString(n){const{pathname:e,searchParams:t}=new URL(n),r=e,s=t.get("relay"),o=t.get("secret");if(!r||!s||!o)throw new Error("invalid connection string");return{pubkey:r,relay:s,secret:o}}async function makeNwcRequestEvent(n,e,t){const s=await encrypt$1(e,n,JSON.stringify({method:"pay_invoice",params:{invoice:t}})),o={kind:NWCWalletRequest,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",n]]};return finalizeEvent(o,e)}var nip54_exports={};__export(nip54_exports,{normalizeIdentifier:()=>normalizeIdentifier});function normalizeIdentifier(n){return n=n.trim().toLowerCase(),n=n.normalize("NFKC"),Array.from(n).map(e=>new RegExp("\\p{Letter}","u").test(e)||new RegExp("\\p{Number}","u").test(e)?e:"-").join("")}var nip57_exports={};__export(nip57_exports,{getZapEndpoint:()=>getZapEndpoint,makeZapReceipt:()=>makeZapReceipt,makeZapRequest:()=>makeZapRequest,useFetchImplementation:()=>useFetchImplementation4,validateZapRequest:()=>validateZapRequest});var _fetch4;try{_fetch4=fetch}catch{}function useFetchImplementation4(n){_fetch4=n}async function getZapEndpoint(n){try{let e="",{lud06:t,lud16:r}=JSON.parse(n.content);if(t){let{words:a}=bech32$1.decode(t,1e3),u=bech32$1.fromWords(a);e=utf8Decoder.decode(u)}else if(r){let[a,u]=r.split("@");e=new URL(`/.well-known/lnurlp/${a}`,`https://${u}`).toString()}else return null;let o=await(await _fetch4(e)).json();if(o.allowsNostr&&o.nostrPubkey)return o.callback}catch{}return null}function makeZapRequest({profile:n,event:e,amount:t,relays:r,comment:s=""}){if(!t)throw new Error("amount not given");if(!n)throw new Error("profile not given");let o={kind:9734,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",n],["amount",t.toString()],["relays",...r]]};if(e&&typeof e=="string"&&o.tags.push(["e",e]),e&&typeof e=="object"){if(isReplaceableKind(e.kind)){const a=["a",`${e.kind}:${e.pubkey}:`];o.tags.push(a)}else if(isAddressableKind(e.kind)){let a=e.tags.find(([c,l])=>c==="d"&&l);if(!a)throw new Error("d tag not found or is empty");const u=["a",`${e.kind}:${e.pubkey}:${a[1]}`];o.tags.push(u)}}return o}function validateZapRequest(n){let e;try{e=JSON.parse(n)}catch{return"Invalid zap request JSON."}if(!validateEvent(e))return"Zap request is not a valid Nostr event.";if(!verifyEvent(e))return"Invalid signature on zap request.";let t=e.tags.find(([o,a])=>o==="p"&&a);if(!t)return"Zap request doesn't have a 'p' tag.";if(!t[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([o,a])=>o==="e"&&a);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([o,a])=>o==="relays"&&a)?null:"Zap request doesn't have a 'relays' tag."}function makeZapReceipt({zapRequest:n,preimage:e,bolt11:t,paidAt:r}){let s=JSON.parse(n),o=s.tags.filter(([u])=>u==="e"||u==="p"||u==="a"),a={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...o,["P",s.pubkey],["bolt11",t],["description",n]]};return e&&a.tags.push(["preimage",e]),a}var nip98_exports={};__export(nip98_exports,{getToken:()=>getToken,hashPayload:()=>hashPayload,unpackEventFromToken:()=>unpackEventFromToken,validateEvent:()=>validateEvent2,validateEventKind:()=>validateEventKind,validateEventMethodTag:()=>validateEventMethodTag,validateEventPayloadTag:()=>validateEventPayloadTag,validateEventTimestamp:()=>validateEventTimestamp,validateEventUrlTag:()=>validateEventUrlTag,validateToken:()=>validateToken});var _authorizationScheme="Nostr ";async function getToken(n,e,t,r=!1,s){const o={kind:HTTPAuth,tags:[["u",n],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};s&&o.tags.push(["payload",hashPayload(s)]);const a=await t(o);return(r?_authorizationScheme:"")+base64.encode(utf8Encoder.encode(JSON.stringify(a)))}async function validateToken(n,e,t){const r=await unpackEventFromToken(n).catch(o=>{throw o});return await validateEvent2(r,e,t).catch(o=>{throw o})}async function unpackEventFromToken(n){if(!n)throw new Error("Missing token");n=n.replace(_authorizationScheme,"");const e=utf8Decoder.decode(base64.decode(n));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function validateEventTimestamp(n){return n.created_at?Math.round(new Date().getTime()/1e3)-n.created_at<60:!1}function validateEventKind(n){return n.kind===HTTPAuth}function validateEventUrlTag(n,e){const t=n.tags.find(r=>r[0]==="u");return t?t.length>0&&t[1]===e:!1}function validateEventMethodTag(n,e){const t=n.tags.find(r=>r[0]==="method");return t?t.length>0&&t[1].toLowerCase()===e.toLowerCase():!1}function hashPayload(n){const e=sha256$1(utf8Encoder.encode(JSON.stringify(n)));return bytesToHex$2(e)}function validateEventPayloadTag(n,e){const t=n.tags.find(s=>s[0]==="payload");if(!t)return!1;const r=hashPayload(e);return t.length>0&&t[1]===r}async function validateEvent2(n,e,t,r){if(!verifyEvent(n))throw new Error("Invalid nostr event, signature invalid");if(!validateEventKind(n))throw new Error("Invalid nostr event, kind invalid");if(!validateEventTimestamp(n))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!validateEventUrlTag(n,e))throw new Error("Invalid nostr event, url tag invalid");if(!validateEventMethodTag(n,t))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!validateEventPayloadTag(n,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function anumber(n){if(!Number.isSafeInteger(n)||n<0)throw new Error("positive integer expected, got "+n)}function isBytes$1(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function abytes$1(n,...e){if(!isBytes$1(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function ahash(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");anumber(n.outputLen),anumber(n.blockLen)}function aexists(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function aoutput(n,e){abytes$1(n);const t=e.outputLen;if(n.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function createView(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function rotr(n,e){return n<<32-e|n>>>e}const hexes$1=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$1(n){abytes$1(n);let e="";for(let t=0;t<n.length;t++)e+=hexes$1[n[t]];return e}const asciis$1={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16$1(n){if(n>=asciis$1._0&&n<=asciis$1._9)return n-asciis$1._0;if(n>=asciis$1.A&&n<=asciis$1.F)return n-(asciis$1.A-10);if(n>=asciis$1.a&&n<=asciis$1.f)return n-(asciis$1.a-10)}function hexToBytes$1(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let s=0,o=0;s<t;s++,o+=2){const a=asciiToBase16$1(n.charCodeAt(o)),u=asciiToBase16$1(n.charCodeAt(o+1));if(a===void 0||u===void 0){const c=n[o]+n[o+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+o)}r[s]=a*16+u}return r}function utf8ToBytes$1(n){if(typeof n!="string")throw new Error("utf8ToBytes expected string, got "+typeof n);return new Uint8Array(new TextEncoder().encode(n))}function toBytes(n){return typeof n=="string"&&(n=utf8ToBytes$1(n)),abytes$1(n),n}function concatBytes$1(...n){let e=0;for(let r=0;r<n.length;r++){const s=n[r];abytes$1(s),e+=s.length}const t=new Uint8Array(e);for(let r=0,s=0;r<n.length;r++){const o=n[r];t.set(o,s),s+=o.length}return t}class Hash{clone(){return this._cloneInto()}}function wrapConstructor(n){const e=r=>n().update(toBytes(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function randomBytes(n=32){if(crypto&&typeof crypto.getRandomValues=="function")return crypto.getRandomValues(new Uint8Array(n));if(crypto&&typeof crypto.randomBytes=="function")return crypto.randomBytes(n);throw new Error("crypto.getRandomValues must be defined")}function setBigUint64(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const s=BigInt(32),o=BigInt(4294967295),a=Number(t>>s&o),u=Number(t&o),c=r?4:0,l=r?0:4;n.setUint32(e+c,a,r),n.setUint32(e+l,u,r)}function Chi(n,e,t){return n&e^~n&t}function Maj(n,e,t){return n&e^n&t^e&t}class HashMD extends Hash{constructor(e,t,r,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView(this.buffer)}update(e){aexists(this);const{view:t,buffer:r,blockLen:s}=this;e=toBytes(e);const o=e.length;for(let a=0;a<o;){const u=Math.min(s-this.pos,o-a);if(u===s){const c=createView(e);for(;s<=o-a;a+=s)this.process(c,a);continue}r.set(e.subarray(a,a+u),this.pos),this.pos+=u,a+=u,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){aexists(this),aoutput(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:o}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(r,0),a=0);for(let h=a;h<s;h++)t[h]=0;setBigUint64(r,s-8,BigInt(this.length*8),o),this.process(r,0);const u=createView(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)u.setUint32(4*h,f[h],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:o,destroyed:a,pos:u}=this;return e.length=s,e.pos=u,e.finished=o,e.destroyed=a,s%t&&e.buffer.set(r),e}}const SHA256_K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W=new Uint32Array(64);class SHA256 extends HashMD{constructor(){super(64,32,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:e,B:t,C:r,D:s,E:o,F:a,G:u,H:c}=this;return[e,t,r,s,o,a,u,c]}set(e,t,r,s,o,a,u,c){this.A=e|0,this.B=t|0,this.C=r|0,this.D=s|0,this.E=o|0,this.F=a|0,this.G=u|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)SHA256_W[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const g=SHA256_W[h-15],m=SHA256_W[h-2],v=rotr(g,7)^rotr(g,18)^g>>>3,b=rotr(m,17)^rotr(m,19)^m>>>10;SHA256_W[h]=b+SHA256_W[h-7]+v+SHA256_W[h-16]|0}let{A:r,B:s,C:o,D:a,E:u,F:c,G:l,H:f}=this;for(let h=0;h<64;h++){const g=rotr(u,6)^rotr(u,11)^rotr(u,25),m=f+g+Chi(u,c,l)+SHA256_K[h]+SHA256_W[h]|0,b=(rotr(r,2)^rotr(r,13)^rotr(r,22))+Maj(r,s,o)|0;f=l,l=c,c=u,u=a+m|0,a=o,o=s,s=r,r=m+b|0}r=r+this.A|0,s=s+this.B|0,o=o+this.C|0,a=a+this.D|0,u=u+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,s,o,a,u,c,l,f)}roundClean(){SHA256_W.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const sha256=wrapConstructor(()=>new SHA256);class HMAC extends Hash{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,ahash(e);const r=toBytes(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(r.length>s?e.create().update(r).digest():r);for(let a=0;a<o.length;a++)o[a]^=54;this.iHash.update(o),this.oHash=e.create();for(let a=0;a<o.length;a++)o[a]^=106;this.oHash.update(o),o.fill(0)}update(e){return aexists(this),this.iHash.update(e),this}digestInto(e){aexists(this),abytes$1(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:s,destroyed:o,blockLen:a,outputLen:u}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=a,e.outputLen=u,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac=(n,e,t)=>new HMAC(n,e).update(t).digest();hmac.create=(n,e)=>new HMAC(n,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$4=BigInt(0),_1n$4=BigInt(1),_2n$2=BigInt(2);function isBytes(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function abytes(n){if(!isBytes(n))throw new Error("Uint8Array expected")}function abool(n,e){if(typeof e!="boolean")throw new Error(n+" boolean expected, got "+e)}const hexes=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function bytesToHex(n){abytes(n);let e="";for(let t=0;t<n.length;t++)e+=hexes[n[t]];return e}function numberToHexUnpadded(n){const e=n.toString(16);return e.length&1?"0"+e:e}function hexToNumber(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return n===""?_0n$4:BigInt("0x"+n)}const asciis={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16(n){if(n>=asciis._0&&n<=asciis._9)return n-asciis._0;if(n>=asciis.A&&n<=asciis.F)return n-(asciis.A-10);if(n>=asciis.a&&n<=asciis.f)return n-(asciis.a-10)}function hexToBytes(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let s=0,o=0;s<t;s++,o+=2){const a=asciiToBase16(n.charCodeAt(o)),u=asciiToBase16(n.charCodeAt(o+1));if(a===void 0||u===void 0){const c=n[o]+n[o+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+o)}r[s]=a*16+u}return r}function bytesToNumberBE(n){return hexToNumber(bytesToHex(n))}function bytesToNumberLE(n){return abytes(n),hexToNumber(bytesToHex(Uint8Array.from(n).reverse()))}function numberToBytesBE(n,e){return hexToBytes(n.toString(16).padStart(e*2,"0"))}function numberToBytesLE(n,e){return numberToBytesBE(n,e).reverse()}function numberToVarBytesBE(n){return hexToBytes(numberToHexUnpadded(n))}function ensureBytes(n,e,t){let r;if(typeof e=="string")try{r=hexToBytes(e)}catch(o){throw new Error(n+" must be hex string or Uint8Array, cause: "+o)}else if(isBytes(e))r=Uint8Array.from(e);else throw new Error(n+" must be hex string or Uint8Array");const s=r.length;if(typeof t=="number"&&s!==t)throw new Error(n+" of length "+t+" expected, got "+s);return r}function concatBytes(...n){let e=0;for(let r=0;r<n.length;r++){const s=n[r];abytes(s),e+=s.length}const t=new Uint8Array(e);for(let r=0,s=0;r<n.length;r++){const o=n[r];t.set(o,s),s+=o.length}return t}function equalBytes(n,e){if(n.length!==e.length)return!1;let t=0;for(let r=0;r<n.length;r++)t|=n[r]^e[r];return t===0}function utf8ToBytes(n){if(typeof n!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(n))}const isPosBig=n=>typeof n=="bigint"&&_0n$4<=n;function inRange(n,e,t){return isPosBig(n)&&isPosBig(e)&&isPosBig(t)&&e<=n&&n<t}function aInRange(n,e,t,r){if(!inRange(e,t,r))throw new Error("expected valid "+n+": "+t+" <= n < "+r+", got "+e)}function bitLen(n){let e;for(e=0;n>_0n$4;n>>=_1n$4,e+=1);return e}function bitGet(n,e){return n>>BigInt(e)&_1n$4}function bitSet(n,e,t){return n|(t?_1n$4:_0n$4)<<BigInt(e)}const bitMask=n=>(_2n$2<<BigInt(n-1))-_1n$4,u8n=n=>new Uint8Array(n),u8fr=n=>Uint8Array.from(n);function createHmacDrbg(n,e,t){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let r=u8n(n),s=u8n(n),o=0;const a=()=>{r.fill(1),s.fill(0),o=0},u=(...h)=>t(s,r,...h),c=(h=u8n())=>{s=u(u8fr([0]),h),r=u(),h.length!==0&&(s=u(u8fr([1]),h),r=u())},l=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const g=[];for(;h<e;){r=u();const m=r.slice();g.push(m),h+=r.length}return concatBytes(...g)};return(h,g)=>{a(),c(h);let m;for(;!(m=g(l()));)c();return a(),m}}const validatorFns={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||isBytes(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,e)=>e.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function validateObject(n,e,t={}){const r=(s,o,a)=>{const u=validatorFns[o];if(typeof u!="function")throw new Error("invalid validator function");const c=n[s];if(!(a&&c===void 0)&&!u(c,n))throw new Error("param "+String(s)+" is invalid. Expected "+o+", got "+c)};for(const[s,o]of Object.entries(e))r(s,o,!1);for(const[s,o]of Object.entries(t))r(s,o,!0);return n}const notImplemented=()=>{throw new Error("not implemented")};function memoized(n){const e=new WeakMap;return(t,...r)=>{const s=e.get(t);if(s!==void 0)return s;const o=n(t,...r);return e.set(t,o),o}}const ut=Object.freeze(Object.defineProperty({__proto__:null,aInRange,abool,abytes,bitGet,bitLen,bitMask,bitSet,bytesToHex,bytesToNumberBE,bytesToNumberLE,concatBytes,createHmacDrbg,ensureBytes,equalBytes,hexToBytes,hexToNumber,inRange,isBytes,memoized,notImplemented,numberToBytesBE,numberToBytesLE,numberToHexUnpadded,numberToVarBytesBE,utf8ToBytes,validateObject},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$3=BigInt(0),_1n$3=BigInt(1),_2n$1=BigInt(2),_3n$1=BigInt(3),_4n=BigInt(4),_5n=BigInt(5),_8n=BigInt(8);function mod(n,e){const t=n%e;return t>=_0n$3?t:e+t}function pow(n,e,t){if(e<_0n$3)throw new Error("invalid exponent, negatives unsupported");if(t<=_0n$3)throw new Error("invalid modulus");if(t===_1n$3)return _0n$3;let r=_1n$3;for(;e>_0n$3;)e&_1n$3&&(r=r*n%t),n=n*n%t,e>>=_1n$3;return r}function pow2(n,e,t){let r=n;for(;e-- >_0n$3;)r*=r,r%=t;return r}function invert(n,e){if(n===_0n$3)throw new Error("invert: expected non-zero number");if(e<=_0n$3)throw new Error("invert: expected positive modulus, got "+e);let t=mod(n,e),r=e,s=_0n$3,o=_1n$3;for(;t!==_0n$3;){const u=r/t,c=r%t,l=s-o*u;r=t,t=c,s=o,o=l}if(r!==_1n$3)throw new Error("invert: does not exist");return mod(s,e)}function tonelliShanks(n){const e=(n-_1n$3)/_2n$1;let t,r,s;for(t=n-_1n$3,r=0;t%_2n$1===_0n$3;t/=_2n$1,r++);for(s=_2n$1;s<n&&pow(s,e,n)!==n-_1n$3;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const a=(n+_1n$3)/_4n;return function(c,l){const f=c.pow(l,a);if(!c.eql(c.sqr(f),l))throw new Error("Cannot find square root");return f}}const o=(t+_1n$3)/_2n$1;return function(u,c){if(u.pow(c,e)===u.neg(u.ONE))throw new Error("Cannot find square root");let l=r,f=u.pow(u.mul(u.ONE,s),t),h=u.pow(c,o),g=u.pow(c,t);for(;!u.eql(g,u.ONE);){if(u.eql(g,u.ZERO))return u.ZERO;let m=1;for(let b=u.sqr(g);m<l&&!u.eql(b,u.ONE);m++)b=u.sqr(b);const v=u.pow(f,_1n$3<<BigInt(l-m-1));f=u.sqr(v),h=u.mul(h,v),g=u.mul(g,f),l=m}return h}}function FpSqrt(n){if(n%_4n===_3n$1){const e=(n+_1n$3)/_4n;return function(r,s){const o=r.pow(s,e);if(!r.eql(r.sqr(o),s))throw new Error("Cannot find square root");return o}}if(n%_8n===_5n){const e=(n-_5n)/_8n;return function(r,s){const o=r.mul(s,_2n$1),a=r.pow(o,e),u=r.mul(s,a),c=r.mul(r.mul(u,_2n$1),a),l=r.mul(u,r.sub(c,r.ONE));if(!r.eql(r.sqr(l),s))throw new Error("Cannot find square root");return l}}return tonelliShanks(n)}const FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(n){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=FIELD_FIELDS.reduce((r,s)=>(r[s]="function",r),e);return validateObject(n,t)}function FpPow(n,e,t){if(t<_0n$3)throw new Error("invalid exponent, negatives unsupported");if(t===_0n$3)return n.ONE;if(t===_1n$3)return e;let r=n.ONE,s=e;for(;t>_0n$3;)t&_1n$3&&(r=n.mul(r,s)),s=n.sqr(s),t>>=_1n$3;return r}function FpInvertBatch(n,e){const t=new Array(e.length),r=e.reduce((o,a,u)=>n.is0(a)?o:(t[u]=o,n.mul(o,a)),n.ONE),s=n.inv(r);return e.reduceRight((o,a,u)=>n.is0(a)?o:(t[u]=n.mul(o,t[u]),n.mul(o,a)),s),t}function nLength(n,e){const t=e!==void 0?e:n.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function Field(n,e,t=!1,r={}){if(n<=_0n$3)throw new Error("invalid field: expected ORDER > 0, got "+n);const{nBitLength:s,nByteLength:o}=nLength(n,e);if(o>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let a;const u=Object.freeze({ORDER:n,isLE:t,BITS:s,BYTES:o,MASK:bitMask(s),ZERO:_0n$3,ONE:_1n$3,create:c=>mod(c,n),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return _0n$3<=c&&c<n},is0:c=>c===_0n$3,isOdd:c=>(c&_1n$3)===_1n$3,neg:c=>mod(-c,n),eql:(c,l)=>c===l,sqr:c=>mod(c*c,n),add:(c,l)=>mod(c+l,n),sub:(c,l)=>mod(c-l,n),mul:(c,l)=>mod(c*l,n),pow:(c,l)=>FpPow(u,c,l),div:(c,l)=>mod(c*invert(l,n),n),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>invert(c,n),sqrt:r.sqrt||(c=>(a||(a=FpSqrt(n)),a(u,c))),invertBatch:c=>FpInvertBatch(u,c),cmov:(c,l,f)=>f?l:c,toBytes:c=>t?numberToBytesLE(c,o):numberToBytesBE(c,o),fromBytes:c=>{if(c.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+c.length);return t?bytesToNumberLE(c):bytesToNumberBE(c)}});return Object.freeze(u)}function getFieldBytesLength(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function getMinHashLength(n){const e=getFieldBytesLength(n);return e+Math.ceil(e/2)}function mapHashToField(n,e,t=!1){const r=n.length,s=getFieldBytesLength(e),o=getMinHashLength(e);if(r<16||r<o||r>1024)throw new Error("expected "+o+"-1024 bytes of input, got "+r);const a=t?bytesToNumberLE(n):bytesToNumberBE(n),u=mod(a,e-_1n$3)+_1n$3;return t?numberToBytesLE(u,s):numberToBytesBE(u,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$2=BigInt(0),_1n$2=BigInt(1);function constTimeNegate(n,e){const t=e.negate();return n?t:e}function validateW(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function calcWOpts(n,e){validateW(n,e);const t=Math.ceil(e/n)+1,r=2**(n-1);return{windows:t,windowSize:r}}function validateMSMPoints(n,e){if(!Array.isArray(n))throw new Error("array expected");n.forEach((t,r)=>{if(!(t instanceof e))throw new Error("invalid point at index "+r)})}function validateMSMScalars(n,e){if(!Array.isArray(n))throw new Error("array of scalars expected");n.forEach((t,r)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+r)})}const pointPrecomputes=new WeakMap,pointWindowSizes=new WeakMap;function getW(n){return pointWindowSizes.get(n)||1}function wNAF(n,e){return{constTimeNegate,hasPrecomputes(t){return getW(t)!==1},unsafeLadder(t,r,s=n.ZERO){let o=t;for(;r>_0n$2;)r&_1n$2&&(s=s.add(o)),o=o.double(),r>>=_1n$2;return s},precomputeWindow(t,r){const{windows:s,windowSize:o}=calcWOpts(r,e),a=[];let u=t,c=u;for(let l=0;l<s;l++){c=u,a.push(c);for(let f=1;f<o;f++)c=c.add(u),a.push(c);u=c.double()}return a},wNAF(t,r,s){const{windows:o,windowSize:a}=calcWOpts(t,e);let u=n.ZERO,c=n.BASE;const l=BigInt(2**t-1),f=2**t,h=BigInt(t);for(let g=0;g<o;g++){const m=g*a;let v=Number(s&l);s>>=h,v>a&&(v-=f,s+=_1n$2);const b=m,y=m+Math.abs(v)-1,w=g%2!==0,S=v<0;v===0?c=c.add(constTimeNegate(w,r[b])):u=u.add(constTimeNegate(S,r[y]))}return{p:u,f:c}},wNAFUnsafe(t,r,s,o=n.ZERO){const{windows:a,windowSize:u}=calcWOpts(t,e),c=BigInt(2**t-1),l=2**t,f=BigInt(t);for(let h=0;h<a;h++){const g=h*u;if(s===_0n$2)break;let m=Number(s&c);if(s>>=f,m>u&&(m-=l,s+=_1n$2),m===0)continue;let v=r[g+Math.abs(m)-1];m<0&&(v=v.negate()),o=o.add(v)}return o},getPrecomputes(t,r,s){let o=pointPrecomputes.get(r);return o||(o=this.precomputeWindow(r,t),t!==1&&pointPrecomputes.set(r,s(o))),o},wNAFCached(t,r,s){const o=getW(t);return this.wNAF(o,this.getPrecomputes(o,t,s),r)},wNAFCachedUnsafe(t,r,s,o){const a=getW(t);return a===1?this.unsafeLadder(t,r,o):this.wNAFUnsafe(a,this.getPrecomputes(a,t,s),r,o)},setWindowSize(t,r){validateW(r,e),pointWindowSizes.set(t,r),pointPrecomputes.delete(t)}}}function pippenger(n,e,t,r){if(validateMSMPoints(t,n),validateMSMScalars(r,e),t.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const s=n.ZERO,o=bitLen(BigInt(t.length)),a=o>12?o-3:o>4?o-2:o?2:1,u=(1<<a)-1,c=new Array(u+1).fill(s),l=Math.floor((e.BITS-1)/a)*a;let f=s;for(let h=l;h>=0;h-=a){c.fill(s);for(let m=0;m<r.length;m++){const v=r[m],b=Number(v>>BigInt(h)&BigInt(u));c[b]=c[b].add(t[m])}let g=s;for(let m=c.length-1,v=s;m>0;m--)v=v.add(c[m]),g=g.add(v);if(f=f.add(g),h!==0)for(let m=0;m<a;m++)f=f.double()}return f}function validateBasic(n){return validateField(n.Fp),validateObject(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validateSigVerOpts(n){n.lowS!==void 0&&abool("lowS",n.lowS),n.prehash!==void 0&&abool("prehash",n.prehash)}function validatePointOpts(n){const e=validateBasic(n);validateObject(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:r,a:s}=e;if(t){if(!r.eql(s,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n,hexToBytes:h2b}=ut;class DERErr extends Error{constructor(e=""){super(e)}}const DER={Err:DERErr,_tlv:{encode:(n,e)=>{const{Err:t}=DER;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const r=e.length/2,s=numberToHexUnpadded(r);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const o=r>127?numberToHexUnpadded(s.length/2|128):"";return numberToHexUnpadded(n)+o+s+e},decode(n,e){const{Err:t}=DER;let r=0;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[r++]!==n)throw new t("tlv.decode: wrong tlv");const s=e[r++],o=!!(s&128);let a=0;if(!o)a=s;else{const c=s&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(r,r+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const f of l)a=a<<8|f;if(r+=c,a<128)throw new t("tlv.decode(long): not minimal encoding")}const u=e.subarray(r,r+a);if(u.length!==a)throw new t("tlv.decode: wrong value length");return{v:u,l:e.subarray(r+a)}}},_int:{encode(n){const{Err:e}=DER;if(n<_0n$1)throw new e("integer: negative integers are not allowed");let t=numberToHexUnpadded(n);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(n){const{Err:e}=DER;if(n[0]&128)throw new e("invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return b2n(n)}},toSig(n){const{Err:e,_int:t,_tlv:r}=DER,s=typeof n=="string"?h2b(n):n;abytes(s);const{v:o,l:a}=r.decode(48,s);if(a.length)throw new e("invalid signature: left bytes after parsing");const{v:u,l:c}=r.decode(2,o),{v:l,l:f}=r.decode(2,c);if(f.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(u),s:t.decode(l)}},hexFromSig(n){const{_tlv:e,_int:t}=DER,r=e.encode(2,t.encode(n.r)),s=e.encode(2,t.encode(n.s)),o=r+s;return e.encode(48,o)}},_0n$1=BigInt(0),_1n$1=BigInt(1);BigInt(2);const _3n=BigInt(3);BigInt(4);function weierstrassPoints(n){const e=validatePointOpts(n),{Fp:t}=e,r=Field(e.n,e.nBitLength),s=e.toBytes||((b,y,w)=>{const S=y.toAffine();return concatBytes(Uint8Array.from([4]),t.toBytes(S.x),t.toBytes(S.y))}),o=e.fromBytes||(b=>{const y=b.subarray(1),w=t.fromBytes(y.subarray(0,t.BYTES)),S=t.fromBytes(y.subarray(t.BYTES,2*t.BYTES));return{x:w,y:S}});function a(b){const{a:y,b:w}=e,S=t.sqr(b),B=t.mul(S,b);return t.add(t.add(B,t.mul(b,y)),w)}if(!t.eql(t.sqr(e.Gy),a(e.Gx)))throw new Error("bad generator point: equation left != right");function u(b){return inRange(b,_1n$1,e.n)}function c(b){const{allowedPrivateKeyLengths:y,nByteLength:w,wrapPrivateKey:S,n:B}=e;if(y&&typeof b!="bigint"){if(isBytes(b)&&(b=bytesToHex(b)),typeof b!="string"||!y.includes(b.length))throw new Error("invalid private key");b=b.padStart(w*2,"0")}let N;try{N=typeof b=="bigint"?b:bytesToNumberBE(ensureBytes("private key",b,w))}catch{throw new Error("invalid private key, expected hex or "+w+" bytes, got "+typeof b)}return S&&(N=mod(N,B)),aInRange("private key",N,_1n$1,B),N}function l(b){if(!(b instanceof g))throw new Error("ProjectivePoint expected")}const f=memoized((b,y)=>{const{px:w,py:S,pz:B}=b;if(t.eql(B,t.ONE))return{x:w,y:S};const N=b.is0();y==null&&(y=N?t.ONE:t.inv(B));const U=t.mul(w,y),R=t.mul(S,y),C=t.mul(B,y);if(N)return{x:t.ZERO,y:t.ZERO};if(!t.eql(C,t.ONE))throw new Error("invZ was invalid");return{x:U,y:R}}),h=memoized(b=>{if(b.is0()){if(e.allowInfinityPoint&&!t.is0(b.py))return;throw new Error("bad point: ZERO")}const{x:y,y:w}=b.toAffine();if(!t.isValid(y)||!t.isValid(w))throw new Error("bad point: x or y not FE");const S=t.sqr(w),B=a(y);if(!t.eql(S,B))throw new Error("bad point: equation left != right");if(!b.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(y,w,S){if(this.px=y,this.py=w,this.pz=S,y==null||!t.isValid(y))throw new Error("x required");if(w==null||!t.isValid(w))throw new Error("y required");if(S==null||!t.isValid(S))throw new Error("z required");Object.freeze(this)}static fromAffine(y){const{x:w,y:S}=y||{};if(!y||!t.isValid(w)||!t.isValid(S))throw new Error("invalid affine point");if(y instanceof g)throw new Error("projective point not allowed");const B=N=>t.eql(N,t.ZERO);return B(w)&&B(S)?g.ZERO:new g(w,S,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(y){const w=t.invertBatch(y.map(S=>S.pz));return y.map((S,B)=>S.toAffine(w[B])).map(g.fromAffine)}static fromHex(y){const w=g.fromAffine(o(ensureBytes("pointHex",y)));return w.assertValidity(),w}static fromPrivateKey(y){return g.BASE.multiply(c(y))}static msm(y,w){return pippenger(g,r,y,w)}_setWindowSize(y){v.setWindowSize(this,y)}assertValidity(){h(this)}hasEvenY(){const{y}=this.toAffine();if(t.isOdd)return!t.isOdd(y);throw new Error("Field doesn't support isOdd")}equals(y){l(y);const{px:w,py:S,pz:B}=this,{px:N,py:U,pz:R}=y,C=t.eql(t.mul(w,R),t.mul(N,B)),I=t.eql(t.mul(S,R),t.mul(U,B));return C&&I}negate(){return new g(this.px,t.neg(this.py),this.pz)}double(){const{a:y,b:w}=e,S=t.mul(w,_3n),{px:B,py:N,pz:U}=this;let R=t.ZERO,C=t.ZERO,I=t.ZERO,D=t.mul(B,B),F=t.mul(N,N),k=t.mul(U,U),_=t.mul(B,N);return _=t.add(_,_),I=t.mul(B,U),I=t.add(I,I),R=t.mul(y,I),C=t.mul(S,k),C=t.add(R,C),R=t.sub(F,C),C=t.add(F,C),C=t.mul(R,C),R=t.mul(_,R),I=t.mul(S,I),k=t.mul(y,k),_=t.sub(D,k),_=t.mul(y,_),_=t.add(_,I),I=t.add(D,D),D=t.add(I,D),D=t.add(D,k),D=t.mul(D,_),C=t.add(C,D),k=t.mul(N,U),k=t.add(k,k),D=t.mul(k,_),R=t.sub(R,D),I=t.mul(k,F),I=t.add(I,I),I=t.add(I,I),new g(R,C,I)}add(y){l(y);const{px:w,py:S,pz:B}=this,{px:N,py:U,pz:R}=y;let C=t.ZERO,I=t.ZERO,D=t.ZERO;const F=e.a,k=t.mul(e.b,_3n);let _=t.mul(w,N),A=t.mul(S,U),T=t.mul(B,R),x=t.add(w,S),E=t.add(N,U);x=t.mul(x,E),E=t.add(_,A),x=t.sub(x,E),E=t.add(w,B);let $=t.add(N,R);return E=t.mul(E,$),$=t.add(_,T),E=t.sub(E,$),$=t.add(S,B),C=t.add(U,R),$=t.mul($,C),C=t.add(A,T),$=t.sub($,C),D=t.mul(F,E),C=t.mul(k,T),D=t.add(C,D),C=t.sub(A,D),D=t.add(A,D),I=t.mul(C,D),A=t.add(_,_),A=t.add(A,_),T=t.mul(F,T),E=t.mul(k,E),A=t.add(A,T),T=t.sub(_,T),T=t.mul(F,T),E=t.add(E,T),_=t.mul(A,E),I=t.add(I,_),_=t.mul($,E),C=t.mul(x,C),C=t.sub(C,_),_=t.mul(x,A),D=t.mul($,D),D=t.add(D,_),new g(C,I,D)}subtract(y){return this.add(y.negate())}is0(){return this.equals(g.ZERO)}wNAF(y){return v.wNAFCached(this,y,g.normalizeZ)}multiplyUnsafe(y){const{endo:w,n:S}=e;aInRange("scalar",y,_0n$1,S);const B=g.ZERO;if(y===_0n$1)return B;if(this.is0()||y===_1n$1)return this;if(!w||v.hasPrecomputes(this))return v.wNAFCachedUnsafe(this,y,g.normalizeZ);let{k1neg:N,k1:U,k2neg:R,k2:C}=w.splitScalar(y),I=B,D=B,F=this;for(;U>_0n$1||C>_0n$1;)U&_1n$1&&(I=I.add(F)),C&_1n$1&&(D=D.add(F)),F=F.double(),U>>=_1n$1,C>>=_1n$1;return N&&(I=I.negate()),R&&(D=D.negate()),D=new g(t.mul(D.px,w.beta),D.py,D.pz),I.add(D)}multiply(y){const{endo:w,n:S}=e;aInRange("scalar",y,_1n$1,S);let B,N;if(w){const{k1neg:U,k1:R,k2neg:C,k2:I}=w.splitScalar(y);let{p:D,f:F}=this.wNAF(R),{p:k,f:_}=this.wNAF(I);D=v.constTimeNegate(U,D),k=v.constTimeNegate(C,k),k=new g(t.mul(k.px,w.beta),k.py,k.pz),B=D.add(k),N=F.add(_)}else{const{p:U,f:R}=this.wNAF(y);B=U,N=R}return g.normalizeZ([B,N])[0]}multiplyAndAddUnsafe(y,w,S){const B=g.BASE,N=(R,C)=>C===_0n$1||C===_1n$1||!R.equals(B)?R.multiplyUnsafe(C):R.multiply(C),U=N(this,w).add(N(y,S));return U.is0()?void 0:U}toAffine(y){return f(this,y)}isTorsionFree(){const{h:y,isTorsionFree:w}=e;if(y===_1n$1)return!0;if(w)return w(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:y,clearCofactor:w}=e;return y===_1n$1?this:w?w(g,this):this.multiplyUnsafe(e.h)}toRawBytes(y=!0){return abool("isCompressed",y),this.assertValidity(),s(g,this,y)}toHex(y=!0){return abool("isCompressed",y),bytesToHex(this.toRawBytes(y))}}g.BASE=new g(e.Gx,e.Gy,t.ONE),g.ZERO=new g(t.ZERO,t.ONE,t.ZERO);const m=e.nBitLength,v=wNAF(g,e.endo?Math.ceil(m/2):m);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:c,weierstrassEquation:a,isWithinCurveOrder:u}}function validateOpts(n){const e=validateBasic(n);return validateObject(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass(n){const e=validateOpts(n),{Fp:t,n:r}=e,s=t.BYTES+1,o=2*t.BYTES+1;function a(T){return mod(T,r)}function u(T){return invert(T,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:f,isWithinCurveOrder:h}=weierstrassPoints({...e,toBytes(T,x,E){const $=x.toAffine(),L=t.toBytes($.x),P=concatBytes;return abool("isCompressed",E),E?P(Uint8Array.from([x.hasEvenY()?2:3]),L):P(Uint8Array.from([4]),L,t.toBytes($.y))},fromBytes(T){const x=T.length,E=T[0],$=T.subarray(1);if(x===s&&(E===2||E===3)){const L=bytesToNumberBE($);if(!inRange(L,_1n$1,t.ORDER))throw new Error("Point is not on curve");const P=f(L);let O;try{O=t.sqrt(P)}catch(q){const V=q instanceof Error?": "+q.message:"";throw new Error("Point is not on curve"+V)}const M=(O&_1n$1)===_1n$1;return(E&1)===1!==M&&(O=t.neg(O)),{x:L,y:O}}else if(x===o&&E===4){const L=t.fromBytes($.subarray(0,t.BYTES)),P=t.fromBytes($.subarray(t.BYTES,2*t.BYTES));return{x:L,y:P}}else{const L=s,P=o;throw new Error("invalid Point, expected length of "+L+", or uncompressed "+P+", got "+x)}}}),g=T=>bytesToHex(numberToBytesBE(T,e.nByteLength));function m(T){const x=r>>_1n$1;return T>x}function v(T){return m(T)?a(-T):T}const b=(T,x,E)=>bytesToNumberBE(T.slice(x,E));class y{constructor(x,E,$){this.r=x,this.s=E,this.recovery=$,this.assertValidity()}static fromCompact(x){const E=e.nByteLength;return x=ensureBytes("compactSignature",x,E*2),new y(b(x,0,E),b(x,E,2*E))}static fromDER(x){const{r:E,s:$}=DER.toSig(ensureBytes("DER",x));return new y(E,$)}assertValidity(){aInRange("r",this.r,_1n$1,r),aInRange("s",this.s,_1n$1,r)}addRecoveryBit(x){return new y(this.r,this.s,x)}recoverPublicKey(x){const{r:E,s:$,recovery:L}=this,P=R(ensureBytes("msgHash",x));if(L==null||![0,1,2,3].includes(L))throw new Error("recovery id invalid");const O=L===2||L===3?E+e.n:E;if(O>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const M=L&1?"03":"02",H=c.fromHex(M+g(O)),q=u(O),V=a(-P*q),Y=a($*q),G=c.BASE.multiplyAndAddUnsafe(H,V,Y);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return m(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes(this.toDERHex())}toDERHex(){return DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes(this.toCompactHex())}toCompactHex(){return g(this.r)+g(this.s)}}const w={isValidPrivateKey(T){try{return l(T),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const T=getMinHashLength(e.n);return mapHashToField(e.randomBytes(T),e.n)},precompute(T=8,x=c.BASE){return x._setWindowSize(T),x.multiply(BigInt(3)),x}};function S(T,x=!0){return c.fromPrivateKey(T).toRawBytes(x)}function B(T){const x=isBytes(T),E=typeof T=="string",$=(x||E)&&T.length;return x?$===s||$===o:E?$===2*s||$===2*o:T instanceof c}function N(T,x,E=!0){if(B(T))throw new Error("first arg must be private key");if(!B(x))throw new Error("second arg must be public key");return c.fromHex(x).multiply(l(T)).toRawBytes(E)}const U=e.bits2int||function(T){if(T.length>8192)throw new Error("input is too large");const x=bytesToNumberBE(T),E=T.length*8-e.nBitLength;return E>0?x>>BigInt(E):x},R=e.bits2int_modN||function(T){return a(U(T))},C=bitMask(e.nBitLength);function I(T){return aInRange("num < 2^"+e.nBitLength,T,_0n$1,C),numberToBytesBE(T,e.nByteLength)}function D(T,x,E=F){if(["recovered","canonical"].some(X=>X in E))throw new Error("sign() legacy options not supported");const{hash:$,randomBytes:L}=e;let{lowS:P,prehash:O,extraEntropy:M}=E;P==null&&(P=!0),T=ensureBytes("msgHash",T),validateSigVerOpts(E),O&&(T=ensureBytes("prehashed msgHash",$(T)));const H=R(T),q=l(x),V=[I(q),I(H)];if(M!=null&&M!==!1){const X=M===!0?L(t.BYTES):M;V.push(ensureBytes("extraEntropy",X))}const Y=concatBytes(...V),G=H;function J(X){const Q=U(X);if(!h(Q))return;const re=u(Q),ye=c.BASE.multiply(Q).toAffine(),K=a(ye.x);if(K===_0n$1)return;const Z=a(re*a(G+K*q));if(Z===_0n$1)return;let te=(ye.x===K?0:2)|Number(ye.y&_1n$1),oe=Z;return P&&m(Z)&&(oe=v(Z),te^=1),new y(K,oe,te)}return{seed:Y,k2sig:J}}const F={lowS:e.lowS,prehash:!1},k={lowS:e.lowS,prehash:!1};function _(T,x,E=F){const{seed:$,k2sig:L}=D(T,x,E),P=e;return createHmacDrbg(P.hash.outputLen,P.nByteLength,P.hmac)($,L)}c.BASE._setWindowSize(8);function A(T,x,E,$=k){var te;const L=T;x=ensureBytes("msgHash",x),E=ensureBytes("publicKey",E);const{lowS:P,prehash:O,format:M}=$;if(validateSigVerOpts($),"strict"in $)throw new Error("options.strict was renamed to lowS");if(M!==void 0&&M!=="compact"&&M!=="der")throw new Error("format must be compact or der");const H=typeof L=="string"||isBytes(L),q=!H&&!M&&typeof L=="object"&&L!==null&&typeof L.r=="bigint"&&typeof L.s=="bigint";if(!H&&!q)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let V,Y;try{if(q&&(V=new y(L.r,L.s)),H){try{M!=="compact"&&(V=y.fromDER(L))}catch(oe){if(!(oe instanceof DER.Err))throw oe}!V&&M!=="der"&&(V=y.fromCompact(L))}Y=c.fromHex(E)}catch{return!1}if(!V||P&&V.hasHighS())return!1;O&&(x=e.hash(x));const{r:G,s:J}=V,X=R(x),Q=u(J),re=a(X*Q),ye=a(G*Q),K=(te=c.BASE.multiplyAndAddUnsafe(Y,re,ye))==null?void 0:te.toAffine();return K?a(K.x)===G:!1}return{CURVE:e,getPublicKey:S,getSharedSecret:N,sign:_,verify:A,ProjectivePoint:c,Signature:y,utils:w}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash(n){return{hash:n,hmac:(e,...t)=>hmac(n,e,concatBytes$1(...t)),randomBytes}}function createCurve(n,e){const t=r=>weierstrass({...n,...getHash(r)});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n=BigInt(1),_2n=BigInt(2),divNearest=(n,e)=>(n+e/_2n)/e;function sqrtMod(n){const e=secp256k1P,t=BigInt(3),r=BigInt(6),s=BigInt(11),o=BigInt(22),a=BigInt(23),u=BigInt(44),c=BigInt(88),l=n*n*n%e,f=l*l*n%e,h=pow2(f,t,e)*f%e,g=pow2(h,t,e)*f%e,m=pow2(g,_2n,e)*l%e,v=pow2(m,s,e)*m%e,b=pow2(v,o,e)*v%e,y=pow2(b,u,e)*b%e,w=pow2(y,c,e)*y%e,S=pow2(w,u,e)*b%e,B=pow2(S,t,e)*f%e,N=pow2(B,a,e)*v%e,U=pow2(N,r,e)*l%e,R=pow2(U,_2n,e);if(!Fpk1.eql(Fpk1.sqr(R),n))throw new Error("Cannot find square root");return R}const Fpk1=Field(secp256k1P,void 0,void 0,{sqrt:sqrtMod}),secp256k1=createCurve({a:BigInt(0),b:BigInt(7),Fp:Fpk1,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const e=secp256k1N,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-_1n*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=t,a=BigInt("0x100000000000000000000000000000000"),u=divNearest(o*n,e),c=divNearest(-r*n,e);let l=mod(n-u*t-c*s,e),f=mod(-u*r-c*o,e);const h=l>a,g=f>a;if(h&&(l=e-l),g&&(f=e-f),l>a||f>a)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:h,k1:l,k2neg:g,k2:f}}}},sha256),_0n=BigInt(0),TAGGED_HASH_PREFIXES={};function taggedHash(n,...e){let t=TAGGED_HASH_PREFIXES[n];if(t===void 0){const r=sha256(Uint8Array.from(n,s=>s.charCodeAt(0)));t=concatBytes(r,r),TAGGED_HASH_PREFIXES[n]=t}return sha256(concatBytes(t,...e))}const pointToBytes=n=>n.toRawBytes(!0).slice(1),numTo32b=n=>numberToBytesBE(n,32),modP=n=>mod(n,secp256k1P),modN=n=>mod(n,secp256k1N),Point=secp256k1.ProjectivePoint,GmulAdd=(n,e,t)=>Point.BASE.multiplyAndAddUnsafe(n,e,t);function schnorrGetExtPubKey(n){let e=secp256k1.utils.normPrivateKeyToScalar(n),t=Point.fromPrivateKey(e);return{scalar:t.hasEvenY()?e:modN(-e),bytes:pointToBytes(t)}}function lift_x(n){aInRange("x",n,_1n,secp256k1P);const e=modP(n*n),t=modP(e*n+BigInt(7));let r=sqrtMod(t);r%_2n!==_0n&&(r=modP(-r));const s=new Point(n,r,_1n);return s.assertValidity(),s}const num=bytesToNumberBE;function challenge(...n){return modN(num(taggedHash("BIP0340/challenge",...n)))}function schnorrGetPublicKey(n){return schnorrGetExtPubKey(n).bytes}function schnorrSign(n,e,t=randomBytes(32)){const r=ensureBytes("message",n),{bytes:s,scalar:o}=schnorrGetExtPubKey(e),a=ensureBytes("auxRand",t,32),u=numTo32b(o^num(taggedHash("BIP0340/aux",a))),c=taggedHash("BIP0340/nonce",u,s,r),l=modN(num(c));if(l===_0n)throw new Error("sign failed: k is zero");const{bytes:f,scalar:h}=schnorrGetExtPubKey(l),g=challenge(f,s,r),m=new Uint8Array(64);if(m.set(f,0),m.set(numTo32b(modN(h+g*o)),32),!schnorrVerify(m,r,s))throw new Error("sign: Invalid signature produced");return m}function schnorrVerify(n,e,t){const r=ensureBytes("signature",n,64),s=ensureBytes("message",e),o=ensureBytes("publicKey",t,32);try{const a=lift_x(num(o)),u=num(r.subarray(0,32));if(!inRange(u,_1n,secp256k1P))return!1;const c=num(r.subarray(32,64));if(!inRange(c,_1n,secp256k1N))return!1;const l=challenge(numTo32b(u),pointToBytes(a),s),f=GmulAdd(a,c,modN(-l));return!(!f||!f.hasEvenY()||f.toAffine().x!==u)}catch{return!1}}const schnorr={getPublicKey:schnorrGetPublicKey,sign:schnorrSign,verify:schnorrVerify,utils:{randomPrivateKey:secp256k1.utils.randomPrivateKey,lift_x,pointToBytes,numberToBytesBE,bytesToNumberBE,taggedHash,mod}};var dist={},LRUCache$1={},LRUCacheNode$1={};Object.defineProperty(LRUCacheNode$1,"__esModule",{value:!0}),LRUCacheNode$1.LRUCacheNode=void 0;class LRUCacheNode{constructor(e,t,r){const{entryExpirationTimeInMS:s=null,next:o=null,prev:a=null,onEntryEvicted:u,onEntryMarkedAsMostRecentlyUsed:c,clone:l,cloneFn:f}=r??{};if(typeof s=="number"&&(s<=0||Number.isNaN(s)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=l??!1,this.cloneFn=f??this.defaultClone,this.key=e,this.internalValue=this.clone?this.cloneFn(t):t,this.created=Date.now(),this.entryExpirationTimeInMS=s,this.next=o,this.prev=a,this.onEntryEvicted=u,this.onEntryMarkedAsMostRecentlyUsed=c}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return typeof this.entryExpirationTimeInMS=="number"&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:e,value:t,isExpired:r}=this;this.onEntryEvicted({key:e,value:t,isExpired:r})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:e,value:t}=this;this.onEntryMarkedAsMostRecentlyUsed({key:e,value:t})}}defaultClone(e){return typeof e=="boolean"||typeof e=="string"||typeof e=="number"?e:JSON.parse(JSON.stringify(e))}}LRUCacheNode$1.LRUCacheNode=LRUCacheNode,Object.defineProperty(LRUCache$1,"__esModule",{value:!0}),LRUCache$1.LRUCache=void 0;const LRUCacheNode_1=LRUCacheNode$1;class LRUCache{constructor(e){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:t=25,entryExpirationTimeInMS:r=null,onEntryEvicted:s,onEntryMarkedAsMostRecentlyUsed:o,cloneFn:a,clone:u}=e??{};if(Number.isNaN(t)||t<=0)throw new Error("maxSize must be greater than 0.");if(typeof r=="number"&&(r<=0||Number.isNaN(r)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=t,this.entryExpirationTimeInMS=r,this.onEntryEvicted=s,this.onEntryMarkedAsMostRecentlyUsed=o,this.clone=u,this.cloneFn=a}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(e){if(Number.isNaN(e)||e<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=e,this.enforceSizeLimit()}set(e,t,r){const s=this.lookupTable.get(e);s&&this.removeNodeFromListAndLookupTable(s);const o=new LRUCacheNode_1.LRUCacheNode(e,t,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...r});return this.setNodeAsHead(o),this.lookupTable.set(e,o),this.enforceSizeLimit(),this}get(e){const t=this.lookupTable.get(e);return t?t.isExpired?(this.removeNodeFromListAndLookupTable(t),null):(this.setNodeAsHead(t),t.value):null}peek(e){const t=this.lookupTable.get(e);return t?t.isExpired?(this.removeNodeFromListAndLookupTable(t),null):t.value:null}delete(e){const t=this.lookupTable.get(e);return t?this.removeNodeFromListAndLookupTable(t):!1}has(e){const t=this.lookupTable.get(e);return t?t.isExpired?(this.removeNodeFromListAndLookupTable(t),!1):!0:!1}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(e){let t=this.head;for(;t;){if(t.isExpired){const s=t.next;this.removeNodeFromListAndLookupTable(t),t=s;continue}const r=this.mapNodeToEntry(t);if(e(r))return this.setNodeAsHead(t),r;t=t.next}return null}forEach(e){let t=this.head,r=0;for(;t;){if(t.isExpired){const s=t.next;this.removeNodeFromListAndLookupTable(t),t=s;continue}e(t.value,t.key,r),t=t.next,r++}}*values(){let e=this.head;for(;e;){if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t;continue}yield e.value,e=e.next}}*keys(){let e=this.head;for(;e;){if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t;continue}yield e.key,e=e.next}}*entries(){let e=this.head;for(;e;){if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t;continue}yield this.mapNodeToEntry(e),e=e.next}}*[Symbol.iterator](){let e=this.head;for(;e;){if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t;continue}yield this.mapNodeToEntry(e),e=e.next}}enforceSizeLimit(){let e=this.tail;for(;e!==null&&this.size>this.maxSizeInternal;){const t=e.prev;this.removeNodeFromListAndLookupTable(e),e=t}}mapNodeToEntry({key:e,value:t}){return{key:e,value:t}}setNodeAsHead(e){this.removeNodeFromList(e),this.head?(e.next=this.head,this.head.prev=e,this.head=e):(this.head=e,this.tail=e),e.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(e){e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.head===e&&(this.head=e.next),this.tail===e&&(this.tail=e.prev),e.next=null,e.prev=null}removeNodeFromListAndLookupTable(e){return e.invokeOnEvicted(),this.removeNodeFromList(e),this.lookupTable.delete(e.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const e=[];for(const t of this.lookupTable.values())t.isExpired&&e.push(t);e.forEach(t=>this.removeNodeFromListAndLookupTable(t))}}LRUCache$1.LRUCache=LRUCache,function(n){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o);var u=Object.getOwnPropertyDescriptor(s,o);(!u||("get"in u?!s.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(r,a,u)}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),t=commonjsGlobal&&commonjsGlobal.__exportStar||function(r,s){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,r,o)};Object.defineProperty(n,"__esModule",{value:!0}),t(LRUCache$1,n)}(dist);var lib={};(function(n){/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(n,"__esModule",{value:!0}),n.bytes=n.stringToBytes=n.str=n.bytesToString=n.hex=n.utf8=n.bech32m=n.bech32=n.base58check=n.base58xmr=n.base58xrp=n.base58flickr=n.base58=n.base64url=n.base64=n.base32crockford=n.base32hex=n.base32=n.base16=n.utils=n.assertNumber=void 0;function e(k){if(!Number.isSafeInteger(k))throw new Error(`Wrong integer: ${k}`)}n.assertNumber=e;function t(...k){const _=(x,E)=>$=>x(E($)),A=Array.from(k).reverse().reduce((x,E)=>x?_(x,E.encode):E.encode,void 0),T=k.reduce((x,E)=>x?_(x,E.decode):E.decode,void 0);return{encode:A,decode:T}}function r(k){return{encode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return _.map(A=>{if(e(A),A<0||A>=k.length)throw new Error(`Digit index outside alphabet: ${A} (alphabet: ${k.length})`);return k[A]})},decode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="string")throw new Error("alphabet.decode input should be array of strings");return _.map(A=>{if(typeof A!="string")throw new Error(`alphabet.decode: not string element=${A}`);const T=k.indexOf(A);if(T===-1)throw new Error(`Unknown letter: "${A}". Allowed: ${k}`);return T})}}}function s(k=""){if(typeof k!="string")throw new Error("join separator should be string");return{encode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="string")throw new Error("join.encode input should be array of strings");for(let A of _)if(typeof A!="string")throw new Error(`join.encode: non-string input=${A}`);return _.join(k)},decode:_=>{if(typeof _!="string")throw new Error("join.decode input should be string");return _.split(k)}}}function o(k,_="="){if(e(k),typeof _!="string")throw new Error("padding chr should be string");return{encode(A){if(!Array.isArray(A)||A.length&&typeof A[0]!="string")throw new Error("padding.encode input should be array of strings");for(let T of A)if(typeof T!="string")throw new Error(`padding.encode: non-string input=${T}`);for(;A.length*k%8;)A.push(_);return A},decode(A){if(!Array.isArray(A)||A.length&&typeof A[0]!="string")throw new Error("padding.encode input should be array of strings");for(let x of A)if(typeof x!="string")throw new Error(`padding.decode: non-string input=${x}`);let T=A.length;if(T*k%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;T>0&&A[T-1]===_;T--)if(!((T-1)*k%8))throw new Error("Invalid padding: string has too much padding");return A.slice(0,T)}}}function a(k){if(typeof k!="function")throw new Error("normalize fn should be function");return{encode:_=>_,decode:_=>k(_)}}function u(k,_,A){if(_<2)throw new Error(`convertRadix: wrong from=${_}, base cannot be less than 2`);if(A<2)throw new Error(`convertRadix: wrong to=${A}, base cannot be less than 2`);if(!Array.isArray(k))throw new Error("convertRadix: data should be array");if(!k.length)return[];let T=0;const x=[],E=Array.from(k);for(E.forEach($=>{if(e($),$<0||$>=_)throw new Error(`Wrong integer: ${$}`)});;){let $=0,L=!0;for(let P=T;P<E.length;P++){const O=E[P],M=_*$+O;if(!Number.isSafeInteger(M)||_*$/_!==$||M-O!==_*$)throw new Error("convertRadix: carry overflow");if($=M%A,E[P]=Math.floor(M/A),!Number.isSafeInteger(E[P])||E[P]*A+$!==M)throw new Error("convertRadix: carry overflow");if(L)E[P]?L=!1:T=P;else continue}if(x.push($),L)break}for(let $=0;$<k.length-1&&k[$]===0;$++)x.push(0);return x.reverse()}const c=(k,_)=>_?c(_,k%_):k,l=(k,_)=>k+(_-c(k,_));function f(k,_,A,T){if(!Array.isArray(k))throw new Error("convertRadix2: data should be array");if(_<=0||_>32)throw new Error(`convertRadix2: wrong from=${_}`);if(A<=0||A>32)throw new Error(`convertRadix2: wrong to=${A}`);if(l(_,A)>32)throw new Error(`convertRadix2: carry overflow from=${_} to=${A} carryBits=${l(_,A)}`);let x=0,E=0;const $=2**A-1,L=[];for(const P of k){if(e(P),P>=2**_)throw new Error(`convertRadix2: invalid data word=${P} from=${_}`);if(x=x<<_|P,E+_>32)throw new Error(`convertRadix2: carry overflow pos=${E} from=${_}`);for(E+=_;E>=A;E-=A)L.push((x>>E-A&$)>>>0);x&=2**E-1}if(x=x<<A-E&$,!T&&E>=_)throw new Error("Excess padding");if(!T&&x)throw new Error(`Non-zero padding: ${x}`);return T&&E>0&&L.push(x>>>0),L}function h(k){return e(k),{encode:_=>{if(!(_ instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return u(Array.from(_),2**8,k)},decode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(u(_,k,2**8))}}}function g(k,_=!1){if(e(k),k<=0||k>32)throw new Error("radix2: bits should be in (0..32]");if(l(8,k)>32||l(k,8)>32)throw new Error("radix2: carry overflow");return{encode:A=>{if(!(A instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return f(Array.from(A),8,k,!_)},decode:A=>{if(!Array.isArray(A)||A.length&&typeof A[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(f(A,k,8,_))}}}function m(k){if(typeof k!="function")throw new Error("unsafeWrapper fn should be function");return function(..._){try{return k.apply(null,_)}catch{}}}function v(k,_){if(e(k),typeof _!="function")throw new Error("checksum fn should be function");return{encode(A){if(!(A instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const T=_(A).slice(0,k),x=new Uint8Array(A.length+k);return x.set(A),x.set(T,A.length),x},decode(A){if(!(A instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const T=A.slice(0,-k),x=_(T).slice(0,k),E=A.slice(-k);for(let $=0;$<k;$++)if(x[$]!==E[$])throw new Error("Invalid checksum");return T}}}n.utils={alphabet:r,chain:t,checksum:v,radix:h,radix2:g,join:s,padding:o},n.base16=t(g(4),r("0123456789ABCDEF"),s("")),n.base32=t(g(5),r("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),s("")),n.base32hex=t(g(5),r("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),s("")),n.base32crockford=t(g(5),r("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),a(k=>k.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),n.base64=t(g(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),s("")),n.base64url=t(g(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),s(""));const b=k=>t(h(58),r(k),s(""));n.base58=b("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),n.base58flickr=b("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),n.base58xrp=b("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const y=[0,2,3,5,6,7,9,10,11];n.base58xmr={encode(k){let _="";for(let A=0;A<k.length;A+=8){const T=k.subarray(A,A+8);_+=n.base58.encode(T).padStart(y[T.length],"1")}return _},decode(k){let _=[];for(let A=0;A<k.length;A+=11){const T=k.slice(A,A+11),x=y.indexOf(T.length),E=n.base58.decode(T);for(let $=0;$<E.length-x;$++)if(E[$]!==0)throw new Error("base58xmr: wrong padding");_=_.concat(Array.from(E.slice(E.length-x)))}return Uint8Array.from(_)}};const w=k=>t(v(4,_=>k(k(_))),n.base58);n.base58check=w;const S=t(r("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),B=[996825010,642813549,513874426,1027748829,705979059];function N(k){const _=k>>25;let A=(k&33554431)<<5;for(let T=0;T<B.length;T++)(_>>T&1)===1&&(A^=B[T]);return A}function U(k,_,A=1){const T=k.length;let x=1;for(let E=0;E<T;E++){const $=k.charCodeAt(E);if($<33||$>126)throw new Error(`Invalid prefix (${k})`);x=N(x)^$>>5}x=N(x);for(let E=0;E<T;E++)x=N(x)^k.charCodeAt(E)&31;for(let E of _)x=N(x)^E;for(let E=0;E<6;E++)x=N(x);return x^=A,S.encode(f([x%2**30],30,5,!1))}function R(k){const _=k==="bech32"?1:734539939,A=g(5),T=A.decode,x=A.encode,E=m(T);function $(M,H,q=90){if(typeof M!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof M}`);if(!Array.isArray(H)||H.length&&typeof H[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof H}`);const V=M.length+7+H.length;if(q!==!1&&V>q)throw new TypeError(`Length ${V} exceeds limit ${q}`);return M=M.toLowerCase(),`${M}1${S.encode(H)}${U(M,H,_)}`}function L(M,H=90){if(typeof M!="string")throw new Error(`bech32.decode input should be string, not ${typeof M}`);if(M.length<8||H!==!1&&M.length>H)throw new TypeError(`Wrong string length: ${M.length} (${M}). Expected (8..${H})`);const q=M.toLowerCase();if(M!==q&&M!==M.toUpperCase())throw new Error("String must be lowercase or uppercase");M=q;const V=M.lastIndexOf("1");if(V===0||V===-1)throw new Error('Letter "1" must be present between prefix and data only');const Y=M.slice(0,V),G=M.slice(V+1);if(G.length<6)throw new Error("Data must be at least 6 characters long");const J=S.decode(G).slice(0,-6),X=U(Y,J,_);if(!G.endsWith(X))throw new Error(`Invalid checksum in ${M}: expected "${X}"`);return{prefix:Y,words:J}}const P=m(L);function O(M){const{prefix:H,words:q}=L(M,!1);return{prefix:H,words:q,bytes:T(q)}}return{encode:$,decode:L,decodeToBytes:O,decodeUnsafe:P,fromWords:T,fromWordsUnsafe:E,toWords:x}}n.bech32=R("bech32"),n.bech32m=R("bech32m"),n.utf8={encode:k=>new TextDecoder().decode(k),decode:k=>new TextEncoder().encode(k)},n.hex=t(g(4),r("0123456789abcdef"),s(""),a(k=>{if(typeof k!="string"||k.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof k} with length ${k.length}`);return k.toLowerCase()}));const C={utf8:n.utf8,hex:n.hex,base16:n.base16,base32:n.base32,base64:n.base64,base64url:n.base64url,base58:n.base58,base58xmr:n.base58xmr},I=`Invalid encoding type. Available types: ${Object.keys(C).join(", ")}`,D=(k,_)=>{if(typeof k!="string"||!C.hasOwnProperty(k))throw new TypeError(I);if(!(_ instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return C[k].encode(_)};n.bytesToString=D,n.str=n.bytesToString;const F=(k,_)=>{if(!C.hasOwnProperty(k))throw new TypeError(I);if(typeof _!="string")throw new TypeError("stringToBytes() expects string");return C[k].decode(_)};n.stringToBytes=F,n.bytes=n.stringToBytes})(lib);const{bech32,hex,utf8}=lib;BigInt(1e3),BigInt(1e6),BigInt(1e9),BigInt(1e12),BigInt("2100000000000000000"),BigInt(1e11);const TAGCODES={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27};for(let n=0,e=Object.keys(TAGCODES);n<e.length;n++)e[n],TAGCODES[e[n]].toString();var NDKKind=(n=>(n[n.Metadata=0]="Metadata",n[n.Text=1]="Text",n[n.RecommendRelay=2]="RecommendRelay",n[n.Contacts=3]="Contacts",n[n.EncryptedDirectMessage=4]="EncryptedDirectMessage",n[n.EventDeletion=5]="EventDeletion",n[n.Repost=6]="Repost",n[n.Reaction=7]="Reaction",n[n.BadgeAward=8]="BadgeAward",n[n.GroupChat=9]="GroupChat",n[n.GroupNote=11]="GroupNote",n[n.GroupReply=12]="GroupReply",n[n.GiftWrapSeal=13]="GiftWrapSeal",n[n.PrivateDirectMessage=14]="PrivateDirectMessage",n[n.Image=20]="Image",n[n.Video=21]="Video",n[n.ShortVideo=22]="ShortVideo",n[n.Story=23]="Story",n[n.Vanish=62]="Vanish",n[n.CashuWalletBackup=375]="CashuWalletBackup",n[n.GiftWrap=1059]="GiftWrap",n[n.GenericRepost=16]="GenericRepost",n[n.ChannelCreation=40]="ChannelCreation",n[n.ChannelMetadata=41]="ChannelMetadata",n[n.ChannelMessage=42]="ChannelMessage",n[n.ChannelHideMessage=43]="ChannelHideMessage",n[n.ChannelMuteUser=44]="ChannelMuteUser",n[n.GenericReply=1111]="GenericReply",n[n.Media=1063]="Media",n[n.Report=1984]="Report",n[n.Label=1985]="Label",n[n.DVMReqTextExtraction=5e3]="DVMReqTextExtraction",n[n.DVMReqTextSummarization=5001]="DVMReqTextSummarization",n[n.DVMReqTextTranslation=5002]="DVMReqTextTranslation",n[n.DVMReqTextGeneration=5050]="DVMReqTextGeneration",n[n.DVMReqImageGeneration=5100]="DVMReqImageGeneration",n[n.DVMReqTextToSpeech=5250]="DVMReqTextToSpeech",n[n.DVMReqDiscoveryNostrContent=5300]="DVMReqDiscoveryNostrContent",n[n.DVMReqDiscoveryNostrPeople=5301]="DVMReqDiscoveryNostrPeople",n[n.DVMReqTimestamping=5900]="DVMReqTimestamping",n[n.DVMEventSchedule=5905]="DVMEventSchedule",n[n.DVMJobFeedback=7e3]="DVMJobFeedback",n[n.Subscribe=7001]="Subscribe",n[n.Unsubscribe=7002]="Unsubscribe",n[n.SubscriptionReceipt=7003]="SubscriptionReceipt",n[n.CashuReserve=7373]="CashuReserve",n[n.CashuQuote=7374]="CashuQuote",n[n.CashuToken=7375]="CashuToken",n[n.CashuWalletTx=7376]="CashuWalletTx",n[n.GroupAdminAddUser=9e3]="GroupAdminAddUser",n[n.GroupAdminRemoveUser=9001]="GroupAdminRemoveUser",n[n.GroupAdminEditMetadata=9002]="GroupAdminEditMetadata",n[n.GroupAdminEditStatus=9006]="GroupAdminEditStatus",n[n.GroupAdminCreateGroup=9007]="GroupAdminCreateGroup",n[n.GroupAdminRequestJoin=9021]="GroupAdminRequestJoin",n[n.MuteList=1e4]="MuteList",n[n.PinList=10001]="PinList",n[n.RelayList=10002]="RelayList",n[n.BookmarkList=10003]="BookmarkList",n[n.CommunityList=10004]="CommunityList",n[n.PublicChatList=10005]="PublicChatList",n[n.BlockRelayList=10006]="BlockRelayList",n[n.SearchRelayList=10007]="SearchRelayList",n[n.SimpleGroupList=10009]="SimpleGroupList",n[n.InterestList=10015]="InterestList",n[n.CashuMintList=10019]="CashuMintList",n[n.EmojiList=10030]="EmojiList",n[n.DirectMessageReceiveRelayList=10050]="DirectMessageReceiveRelayList",n[n.BlossomList=10063]="BlossomList",n[n.NostrWaletConnectInfo=13194]="NostrWaletConnectInfo",n[n.TierList=17e3]="TierList",n[n.CashuWallet=17375]="CashuWallet",n[n.FollowSet=3e4]="FollowSet",n[n.CategorizedPeopleList=3e4]="CategorizedPeopleList",n[n.CategorizedBookmarkList=30001]="CategorizedBookmarkList",n[n.RelaySet=30002]="RelaySet",n[n.CategorizedRelayList=30002]="CategorizedRelayList",n[n.BookmarkSet=30003]="BookmarkSet",n[n.CurationSet=30004]="CurationSet",n[n.ArticleCurationSet=30004]="ArticleCurationSet",n[n.VideoCurationSet=30005]="VideoCurationSet",n[n.ImageCurationSet=30006]="ImageCurationSet",n[n.InterestSet=30015]="InterestSet",n[n.InterestsList=30015]="InterestsList",n[n.EmojiSet=30030]="EmojiSet",n[n.ModularArticle=30040]="ModularArticle",n[n.ModularArticleItem=30041]="ModularArticleItem",n[n.Wiki=30818]="Wiki",n[n.Draft=31234]="Draft",n[n.SubscriptionTier=37001]="SubscriptionTier",n[n.EcashMintRecommendation=38e3]="EcashMintRecommendation",n[n.HighlightSet=39802]="HighlightSet",n[n.CategorizedHighlightList=39802]="CategorizedHighlightList",n[n.Nutzap=9321]="Nutzap",n[n.ZapRequest=9734]="ZapRequest",n[n.Zap=9735]="Zap",n[n.Highlight=9802]="Highlight",n[n.ClientAuth=22242]="ClientAuth",n[n.NostrWalletConnectReq=23194]="NostrWalletConnectReq",n[n.NostrWalletConnectRes=23195]="NostrWalletConnectRes",n[n.NostrConnect=24133]="NostrConnect",n[n.BlossomUpload=24242]="BlossomUpload",n[n.HttpAuth=27235]="HttpAuth",n[n.ProfileBadge=30008]="ProfileBadge",n[n.BadgeDefinition=30009]="BadgeDefinition",n[n.MarketStall=30017]="MarketStall",n[n.MarketProduct=30018]="MarketProduct",n[n.Article=30023]="Article",n[n.AppSpecificData=30078]="AppSpecificData",n[n.Classified=30402]="Classified",n[n.HorizontalVideo=34235]="HorizontalVideo",n[n.VerticalVideo=34236]="VerticalVideo",n[n.LegacyCashuWallet=37375]="LegacyCashuWallet",n[n.GroupMetadata=39e3]="GroupMetadata",n[n.GroupAdmins=39001]="GroupAdmins",n[n.GroupMembers=39002]="GroupMembers",n[n.AppRecommendation=31989]="AppRecommendation",n[n.AppHandler=31990]="AppHandler",n))(NDKKind||{});function getRelaysForSync(n,e,t="write"){if(!n.outboxTracker)return;const r=n.outboxTracker.data.get(e);if(r)return t==="write"?r.writeRelays:r.readRelays}async function getWriteRelaysFor(n,e,t="write"){if(n.outboxTracker)return n.outboxTracker.data.has(e)||await n.outboxTracker.trackUsers([e]),getRelaysForSync(n,e,t)}function getTopRelaysForAuthors(n,e){const t=new Map;return e.forEach(s=>{const o=getRelaysForSync(n,s);o&&o.forEach(a=>{const u=t.get(a)||0;t.set(a,u+1)})}),Array.from(t.entries()).sort((s,o)=>o[1]-s[1]).map(s=>s[0])}function getAllRelaysForAllPubkeys(n,e,t="read"){const r=new Map,s=new Set;return e.forEach(o=>{const a=getRelaysForSync(n,o,t);a&&a.size>0?(a.forEach(u=>{(r.get(u)||new Set).add(o)}),r.set(o,a)):s.add(o)}),{pubkeysToRelays:r,authorsMissingRelays:s}}function chooseRelayCombinationForPubkeys(n,e,t,{count:r,preferredRelays:s}={}){r??(r=2),s??(s=new Set);const o=n.pool,a=o.connectedRelays();a.forEach(g=>{s==null||s.add(g.url)});const u=new Map,{pubkeysToRelays:c,authorsMissingRelays:l}=getAllRelaysForAllPubkeys(n,e,t),f=getTopRelaysForAuthors(n,e),h=(g,m)=>{const v=u.get(m)||[];v.push(g),u.set(m,v)};for(const[g,m]of c.entries()){let v=r;for(const b of a)m.has(b.url)&&(h(g,b.url),v--);for(const b of m)u.has(b)&&(h(g,b),v--);if(!(v<=0))for(const b of f){if(v<=0)break;m.has(b)&&(h(g,b),v--)}}for(const g of l)o.permanentAndConnectedRelays().forEach(m=>{const v=u.get(m.url)||[];v.push(g),u.set(m.url,v)});return u}function getRelaysForFilterWithAuthors(n,e,t=2){return chooseRelayCombinationForPubkeys(n,e,"write",{count:t})}function tryNormalizeRelayUrl(n){try{return normalizeRelayUrl(n)}catch{return}}function normalizeRelayUrl(n){let e=normalizeUrl(n,{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return e.endsWith("/")||(e+="/"),e}function normalize(n){const e=new Set;for(const t of n)try{e.add(normalizeRelayUrl(t))}catch{}return Array.from(e)}var DATA_URL_DEFAULT_MIME_TYPE="text/plain",DATA_URL_DEFAULT_CHARSET="us-ascii",testParameter=(n,e)=>e.some(t=>t instanceof RegExp?t.test(n):t===n),supportedProtocols=new Set(["https:","http:","file:"]),hasCustomProtocol=n=>{try{const{protocol:e}=new URL(n);return e.endsWith(":")&&!e.includes(".")&&!supportedProtocols.has(e)}catch{return!1}},normalizeDataURL=(n,{stripHash:e})=>{var h,g,m,v;const t=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(n);if(!t)throw new Error(`Invalid URL: ${n}`);const r=((h=t.groups)==null?void 0:h.type)??"",s=((g=t.groups)==null?void 0:g.data)??"";let o=((m=t.groups)==null?void 0:m.hash)??"";const a=r.split(";");o=e?"":o;let u=!1;a[a.length-1]==="base64"&&(a.pop(),u=!0);const c=((v=a.shift())==null?void 0:v.toLowerCase())??"",f=[...a.map(b=>{let[y,w=""]=b.split("=").map(S=>S.trim());return y==="charset"&&(w=w.toLowerCase(),w===DATA_URL_DEFAULT_CHARSET)?"":`${y}${w?`=${w}`:""}`}).filter(Boolean)];return u&&f.push("base64"),(f.length>0||c&&c!==DATA_URL_DEFAULT_MIME_TYPE)&&f.unshift(c),`data:${f.join(";")},${u?s.trim():s}${o?`#${o}`:""}`};function normalizeUrl(n,e={}){if(e={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...e},typeof e.defaultProtocol=="string"&&!e.defaultProtocol.endsWith(":")&&(e.defaultProtocol=`${e.defaultProtocol}:`),n=n.trim(),/^data:/i.test(n))return normalizeDataURL(n,e);if(hasCustomProtocol(n))return n;const t=n.startsWith("//");!t&&/^\.*\//.test(n)||(n=n.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));const s=new URL(n);if(s.hostname=s.hostname.toLowerCase(),e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&s.protocol==="https:"&&(s.protocol="http:"),e.forceHttps&&s.protocol==="http:"&&(s.protocol="https:"),e.stripAuthentication&&(s.username="",s.password=""),e.stripHash?s.hash="":e.stripTextFragment&&(s.hash=s.hash.replace(/#?:~:text.*?$/i,"")),s.pathname){const a=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let u=0,c="";for(;;){const f=a.exec(s.pathname);if(!f)break;const h=f[0],g=f.index,m=s.pathname.slice(u,g);c+=m.replace(/\/{2,}/g,"/"),c+=h,u=g+h.length}const l=s.pathname.slice(u,s.pathname.length);c+=l.replace(/\/{2,}/g,"/"),s.pathname=c}if(s.pathname)try{s.pathname=decodeURI(s.pathname)}catch{}if(e.removeDirectoryIndex===!0&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let a=s.pathname.split("/");const u=a[a.length-1];testParameter(u,e.removeDirectoryIndex)&&(a=a.slice(0,-1),s.pathname=`${a.slice(1).join("/")}/`)}if(s.hostname&&(s.hostname=s.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(s.hostname)&&(s.hostname=s.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(const a of[...s.searchParams.keys()])testParameter(a,e.removeQueryParameters)&&s.searchParams.delete(a);if(!Array.isArray(e.keepQueryParameters)&&e.removeQueryParameters===!0&&(s.search=""),Array.isArray(e.keepQueryParameters)&&e.keepQueryParameters.length>0)for(const a of[...s.searchParams.keys()])testParameter(a,e.keepQueryParameters)||s.searchParams.delete(a);if(e.sortQueryParameters){s.searchParams.sort();try{s.search=decodeURIComponent(s.search)}catch{}}e.removeTrailingSlash&&(s.pathname=s.pathname.replace(/\/$/,"")),e.removeExplicitPort&&s.port&&(s.port="");const o=n;return n=s.toString(),!e.removeSingleSlash&&s.pathname==="/"&&!o.endsWith("/")&&s.hash===""&&(n=n.replace(/\/$/,"")),(e.removeTrailingSlash||s.pathname==="/")&&s.hash===""&&e.removeSingleSlash&&(n=n.replace(/\/$/,"")),t&&!e.normalizeProtocol&&(n=n.replace(/^http:\/\//,"//")),e.stripProtocol&&(n=n.replace(/^(?:https?:)?\/\//,"")),n}var MAX_RECONNECT_ATTEMPTS=5,FLAPPING_THRESHOLD_MS=1e3,NDKRelayConnectivity=class{constructor(n,e){p(this,"ndkRelay");p(this,"ws");p(this,"_status");p(this,"timeoutMs");p(this,"connectedAt");p(this,"_connectionStats",{attempts:0,success:0,durations:[]});p(this,"debug");p(this,"netDebug");p(this,"connectTimeout");p(this,"reconnectTimeout");p(this,"ndk");p(this,"openSubs",new Map);p(this,"openCountRequests",new Map);p(this,"openEventPublishes",new Map);p(this,"serial",0);p(this,"baseEoseTimeout",4400);p(this,"updateConnectionStats",{connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}});this.ndkRelay=n,this._status=1;const t=Math.floor(Math.random()*1e3);this.debug=this.ndkRelay.debug.extend(`connectivity${t}`),this.ndk=e}async connect(n,e=!0){if(this._status!==2&&this._status!==1||this.reconnectTimeout){this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);return}this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),n??(n=this.timeoutMs),!this.timeoutMs&&n&&(this.timeoutMs=n),this.timeoutMs&&(this.connectTimeout=setTimeout(()=>this.onConnectionError(e),this.timeoutMs));try{this.updateConnectionStats.attempt(),this._status===1?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(t){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,t),this._status=1,e?this.handleReconnection():this.ndkRelay.emit("delayed-connect",2*24*60*60*1e3),t}}disconnect(){var n;this._status=0;try{(n=this.ws)==null||n.close()}catch(e){this.debug("Failed to disconnect",e),this._status=1}}onConnectionError(n){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),n&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){var n;(n=this.netDebug)==null||n.call(this,"connected",this.ndkRelay),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){var n;(n=this.netDebug)==null||n.call(this,"disconnected",this.ndkRelay),this.updateConnectionStats.disconnected(),this._status===5&&this.handleReconnection(),this._status=1,this.ndkRelay.emit("disconnect")}onMessage(n){var e;(e=this.netDebug)==null||e.call(this,n.data,this.ndkRelay,"recv");try{const t=JSON.parse(n.data),[r,s,...o]=t;switch(r){case"EVENT":{const a=this.openSubs.get(s),u=t[2];if(!a){this.debug(`Received event for unknown subscription ${s}`);return}a.onevent(u);return}case"COUNT":{const a=t[2],u=this.openCountRequests.get(s);u&&(u.resolve(a.count),this.openCountRequests.delete(s));return}case"EOSE":{const a=this.openSubs.get(s);if(!a)return;a.oneose(s);return}case"OK":{const a=t[2],u=t[3],c=this.openEventPublishes.get(s),l=c==null?void 0:c.pop();if(!c||!l){this.debug("Received OK for unknown event publish",s);return}a?l.resolve(u):l.reject(new Error(u)),c.length===0?this.openEventPublishes.delete(s):this.openEventPublishes.set(s,c);return}case"CLOSED":{const a=this.openSubs.get(s);if(!a)return;a.onclosed(t[2]);return}case"NOTICE":this.onNotice(t[1]);return;case"AUTH":{this.onAuthRequested(t[1]);return}}}catch(t){this.debug(`Error parsing message from ${this.ndkRelay.url}: ${t.message}`,t==null?void 0:t.stack);return}}async onAuthRequested(n){var t,r,s;const e=this.ndkRelay.authPolicy??((t=this.ndk)==null?void 0:t.relayAuthDefaultPolicy);if(this.debug("Relay requested authentication",{havePolicy:!!e}),this._status===7){this.debug("Already authenticating, ignoring");return}if(this._status=6,e){if(this._status>=5){this._status=7;let o;try{o=await e(this.ndkRelay,n)}catch(a){this.debug("Authentication policy threw an error",a),o=!1}if(this.debug("Authentication policy returned",!!o),o instanceof NDKEvent||o===!0){o instanceof NDKEvent&&await this.auth(o);const a=async()=>{if(this._status>=5&&this._status<8){const u=new NDKEvent(this.ndk);u.kind=22242,u.tags=[["relay",this.ndkRelay.url],["challenge",n]],await u.sign(),this.auth(u).then(()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful")}).catch(c=>{this._status=6,this.ndkRelay.emit("auth:failed",c),this.debug("Authentication failed",c)})}else this.debug("Authentication failed, it changed status, status is %d",this._status)};o===!0&&((r=this.ndk)!=null&&r.signer?a().catch(u=>{console.error("Error authenticating",u)}):(this.debug("No signer available for authentication localhost"),(s=this.ndk)==null||s.once("signer:ready",a))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",n)}onError(n){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,n)}get status(){return this._status}isAvailable(){return this._status===5}isFlapping(){const n=this._connectionStats.durations;if(n.length%3!==0)return!1;const t=n.reduce((a,u)=>a+u,0)/n.length,r=n.map(a=>(a-t)**2).reduce((a,u)=>a+u,0)/n.length;return Math.sqrt(r)<FLAPPING_THRESHOLD_MS}async onNotice(n){this.ndkRelay.emit("notice",n)}handleReconnection(n=0){if(this.reconnectTimeout)return;if(this.isFlapping()){this.ndkRelay.emit("flapping",this._connectionStats),this._status=3;return}const e=this.connectedAt?Math.max(0,6e4-(Date.now()-this.connectedAt)):5e3*(this._connectionStats.attempts+1);this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch(t=>{n<MAX_RECONNECT_ATTEMPTS?setTimeout(()=>{this.handleReconnection(n+1)},1e3*(n+1)^4):this.debug("Reconnect failed")})},e),this.ndkRelay.emit("delayed-connect",e),this.debug("Reconnecting in",e),this._connectionStats.nextReconnectAt=Date.now()+e}async send(n){var e,t,r;this._status>=5&&((e=this.ws)==null?void 0:e.readyState)===WebSocket.OPEN?((t=this.ws)==null||t.send(n),(r=this.netDebug)==null||r.call(this,n,this.ndkRelay,"send")):this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${n}`,this._status)}async auth(n){const e=new Promise((t,r)=>{const s=this.openEventPublishes.get(n.id)??[];s.push({resolve:t,reject:r}),this.openEventPublishes.set(n.id,s)});return this.send(`["AUTH",${JSON.stringify(n.rawEvent())}]`),e}async publish(n){const e=new Promise((t,r)=>{const s=this.openEventPublishes.get(n.id)??[];s.length>0&&console.warn(`Duplicate event publishing detected, you are publishing event ${n.id} twice`),s.push({resolve:t,reject:r}),this.openEventPublishes.set(n.id,s)});return this.send(`["EVENT",${JSON.stringify(n)}]`),e}async count(n,e){this.serial++;const t=(e==null?void 0:e.id)||`count:${this.serial}`,r=new Promise((s,o)=>{this.openCountRequests.set(t,{resolve:s,reject:o})});return this.send(`["COUNT","${t}",${JSON.stringify(n).substring(1)}`),r}close(n,e){this.send(`["CLOSE","${n}"]`);const t=this.openSubs.get(n);this.openSubs.delete(n),t&&t.onclose(e)}req(n){`${this.send(`["REQ","${n.subId}",${JSON.stringify(n.executeFilters).substring(1)}`)}`,this.openSubs.set(n.subId,n)}get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){var n;return this._status>=5&&((n=this.ws)==null?void 0:n.readyState)===WebSocket.OPEN}},NDKRelayPublisher=class{constructor(n){p(this,"ndkRelay");p(this,"debug");this.ndkRelay=n,this.debug=n.debug.extend("publisher")}async publish(n,e=2500){let t;const r=()=>new Promise((f,h)=>{try{this.publishEvent(n).then(g=>{this.ndkRelay.emit("published",n),n.emit("relay:published",this.ndkRelay),f(!0)}).catch(h)}catch(g){h(g)}}),s=new Promise((f,h)=>{t=setTimeout(()=>{t=void 0,h(new Error(`Timeout: ${e}ms`))},e)}),o=()=>{r().then(f=>a(f)).catch(f=>u(f))};let a,u;const c=f=>{throw this.ndkRelay.debug("Publish failed",f,n.id),this.ndkRelay.emit("publish:failed",n,f),n.emit("relay:publish:failed",this.ndkRelay,f),f},l=()=>{t&&clearTimeout(t),this.ndkRelay.removeListener("connect",o)};return this.ndkRelay.status>=5?Promise.race([r(),s]).catch(c).finally(l):(this.ndkRelay.status<=1?(console.warn("Relay is disconnected, trying to connect to publish an event",this.ndkRelay.url),this.ndkRelay.connect()):console.warn("Relay not connected, waiting for connection to publish an event",this.ndkRelay.url),Promise.race([new Promise((f,h)=>{a=f,u=h,this.ndkRelay.once("connect",o)}),s]).catch(c).finally(l))}async publishEvent(n){return this.ndkRelay.connectivity.publish(n.rawEvent())}};function filterFingerprint(n,e){const t=[];for(const s of n){const o=Object.entries(s||{}).map(([a,u])=>["since","until"].includes(a)?`${a}:${u}`:a).sort().join("-");t.push(o)}let r=e?"+":"";return r+=t.join("|"),r}function mergeFilters(n){const e=[],t={};return n.filter(r=>!!r.limit).forEach(r=>e.push(r)),n=n.filter(r=>!r.limit),n.length===0?e:(n.forEach(r=>{Object.entries(r).forEach(([s,o])=>{Array.isArray(o)?t[s]===void 0?t[s]=[...o]:t[s]=Array.from(new Set([...t[s],...o])):t[s]=o})}),[...e,t])}var NDKRelaySubscription=class{constructor(n,e,t){p(this,"fingerprint");p(this,"items",new Map);p(this,"topSubManager");p(this,"debug");p(this,"status",0);p(this,"onClose");p(this,"relay");p(this,"eosed",!1);p(this,"executionTimer");p(this,"fireTime");p(this,"delayType");p(this,"executeFilters");p(this,"id",Math.random().toString(36).substring(7));p(this,"_subId");p(this,"subIdParts",new Set);p(this,"executeOnRelayReady",()=>{if(this.status===2){if(this.items.size===0){this.debug("No items to execute; this relay was probably too slow to respond and the caller gave up",{status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size,id:this.id,subId:this.subId}),this.cleanup();return}this.debug("Executing on relay ready",{status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.status=1,this.execute()}});p(this,"reExecuteAfterAuth",(()=>{const n=this.subId;this.debug("Re-executing after auth",this.items.size),this.eosed?this.relay.close(this.subId):this.debug("We are abandoning an opened subscription, once it EOSE's, the handler will close it",{oldSubId:n}),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s 👉 %s",n,this.subId)}).bind(this));this.relay=n,this.topSubManager=t,this.debug=n.debug.extend(`sub[${this.id}]`),this.fingerprint=e||Math.random().toString(36).substring(7)}get subId(){return this._subId?this._subId:(this._subId=this.fingerprint.slice(0,15),this._subId)}addSubIdPart(n){this.subIdParts.add(n)}addItem(n,e){if(this.debug("Adding item",{filters:e,internalId:n.internalId,status:this.status,fingerprint:this.fingerprint,id:this.subId,items:this.items,itemsSize:this.items.size}),!this.items.has(n.internalId))switch(n.on("close",this.removeItem.bind(this,n)),this.items.set(n.internalId,{subscription:n,filters:e}),this.status!==3&&n.subId&&(!this._subId||this._subId.length<48)&&(this.status===0||this.status===1)&&this.addSubIdPart(n.subId),this.status){case 0:this.evaluateExecutionPlan(n);break;case 3:break;case 1:this.evaluateExecutionPlan(n);break;case 4:throw this.debug("Subscription is closed, cannot add new items %o (%o)",n,e),new Error("Cannot add new items to a closed subscription")}}removeItem(n){if(this.items.delete(n.internalId),this.items.size===0){if(!this.eosed)return;this.close(),this.cleanup()}}close(){if(this.status===4)return;const n=this.status;if(this.status=4,n===3)try{this.relay.close(this.subId)}catch(e){this.debug("Error closing subscription",e,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:n,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}evaluateExecutionPlan(n){if(!n.isGroupable()){this.status=1,this.execute();return}if(n.filters.find(r=>!!r.limit)&&(this.executeFilters=this.compileFilters(),this.executeFilters.length>=10)){this.status=1,this.execute();return}const e=n.groupableDelay,t=n.groupableDelayType;if(!e)throw new Error("Cannot group a subscription without a delay");if(this.status===0)this.schedule(e,t);else{const r=this.delayType,s=this.fireTime-Date.now();if(r==="at-least"&&t==="at-least")s<e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,t));else if(r==="at-least"&&t==="at-most")s>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,t));else if(r==="at-most"&&t==="at-most")s>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,t));else if(r==="at-most"&&t==="at-least")s>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,t));else throw new Error(`Unknown delay type combination ${r} ${t}`)}}schedule(n,e){this.status=1;const t=Date.now();this.fireTime=t+n,this.delayType=e;const r=setTimeout(this.execute.bind(this),n);e==="at-least"&&(this.executionTimer=r)}finalizeSubId(){this.subIdParts.size>0?this._subId=Array.from(this.subIdParts).join("-"):this._subId=this.fingerprint.slice(0,15),this._subId+=`-${Math.random().toString(36).substring(2,7)}`}execute(){if(this.status===1){if(!this.relay.connected){this.status=2,this.debug("Waiting for relay to be ready",{status:this.status,id:this.subId,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.relay.once("ready",this.executeOnRelayReady);return}this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth),this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(n){this.topSubManager.dispatchEvent(n,this.relay)}oneose(n){if(this.eosed=!0,n!==this.subId){this.debug("Received EOSE for an abandoned subscription",n,this.subId),this.relay.close(n);return}this.items.size===0&&this.close();for(const{subscription:e}of this.items.values())e.eoseReceived(this.relay),e.closeOnEose&&(this.debug("Removing item because of EOSE",{filters:e.filters,internalId:e.internalId,status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.removeItem(e))}onclose(n){this.status=4}onclosed(n){if(n)for(const{subscription:e}of this.items.values())e.closedReceived(this.relay,n)}compileFilters(){const n=[],e=Array.from(this.items.values()).map(r=>r.filters);if(!e[0])return this.debug("👀 No filters to merge",this.items),console.error("BUG: No filters to merge!",this.items),[];const t=e[0].length;for(let r=0;r<t;r++){const s=e.map(o=>o[r]);n.push(...mergeFilters(s))}return n}},NDKRelaySubscriptionManager=class{constructor(n,e){p(this,"relay");p(this,"subscriptions");p(this,"generalSubManager");this.relay=n,this.subscriptions=new Map,this.generalSubManager=e}addSubscription(n,e){let t;if(!n.isGroupable())t=this.createSubscription(n,e);else{const r=filterFingerprint(e,n.closeOnEose);r&&(t=(this.subscriptions.get(r)||[]).find(o=>o.status<3)),t??(t=this.createSubscription(n,e,r))}t.addItem(n,e)}createSubscription(n,e,t){const r=new NDKRelaySubscription(this.relay,t||null,this.generalSubManager);r.onClose=this.onRelaySubscriptionClose.bind(this);const s=this.subscriptions.get(r.fingerprint)??[];return this.subscriptions.set(r.fingerprint,[...s,r]),r}onRelaySubscriptionClose(n){let e=this.subscriptions.get(n.fingerprint)??[];e?e.length===1?this.subscriptions.delete(n.fingerprint):(e=e.filter(t=>t.id!==n.id),this.subscriptions.set(n.fingerprint,e)):console.warn("Unexpectedly did not find a subscription with fingerprint",n.fingerprint)}},NDKRelay=(j=class extends lib$1.EventEmitter{constructor(t,r,s){super();p(this,"url");p(this,"scores");p(this,"connectivity");p(this,"subs");p(this,"publisher");p(this,"authPolicy");p(this,"lowestValidationRatio");p(this,"targetValidationRatio");p(this,"validationRatioFn");p(this,"validatedEventCount",0);p(this,"nonValidatedEventCount",0);p(this,"trusted",!1);p(this,"complaining",!1);p(this,"debug");p(this,"req");p(this,"close");this.url=normalizeRelayUrl(t),this.scores=new Map,this.debug=createDebug5(`ndk:relay:${t}`),this.connectivity=new NDKRelayConnectivity(this,s),this.connectivity.netDebug=s==null?void 0:s.netDebug,this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new NDKRelaySubscriptionManager(this,s.subManager),this.publisher=new NDKRelayPublisher(this),this.authPolicy=r,this.targetValidationRatio=s==null?void 0:s.initialValidationRatio,this.lowestValidationRatio=s==null?void 0:s.lowestValidationRatio,this.validationRatioFn=((s==null?void 0:s.validationRatioFn)??j.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),s||console.trace("relay created without ndk")}updateValidationRatio(){setTimeout(()=>{this.updateValidationRatio()},3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(t,r=!0){return this.connectivity.connect(t,r)}disconnect(){this.status!==1&&this.connectivity.disconnect()}subscribe(t,r){this.subs.addSubscription(t,r)}async publish(t,r=2500){return this.publisher.publish(t,r)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return this.nonValidatedEventCount===0?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return this.trusted?!1:this.targetValidationRatio===void 0?!0:this.validationRatio<this.targetValidationRatio}get connected(){return this.connectivity.connected}},p(j,"defaultValidationRatioUpdateFn",(t,r,s)=>{if(t.lowestValidationRatio===void 0||t.targetValidationRatio===void 0)return 1;let o=t.validationRatio;if(t.validationRatio>t.targetValidationRatio){const a=r/100;o=Math.max(t.lowestValidationRatio,t.validationRatio-a)}return o<t.validationRatio?o:t.validationRatio}),j),NDKPublishError=class extends Error{constructor(e,t,r,s){super(e);p(this,"errors");p(this,"publishedToRelays");p(this,"intendedRelaySet");this.errors=t,this.publishedToRelays=r,this.intendedRelaySet=s}get relayErrors(){const e=[];for(const[t,r]of this.errors)e.push(`${t.url}: ${r}`);return e.join(`
`)}},NDKRelaySet=class Ce{constructor(e,t,r){p(this,"relays");p(this,"debug");p(this,"ndk");p(this,"pool");this.relays=e,this.ndk=t,this.pool=r??t.pool,this.debug=t.debug.extend("relayset")}addRelay(e){this.relays.add(e)}get relayUrls(){return Array.from(this.relays).map(e=>e.url)}static fromRelayUrls(e,t,r=!0,s){if(s=s??t.pool,!s)throw new Error("No pool provided");const o=new Set;for(const a of e){const u=s.relays.get(normalizeRelayUrl(a));if(u)u.status<5&&r&&u.connect(),o.add(u);else{const c=new NDKRelay(normalizeRelayUrl(a),t==null?void 0:t.relayAuthDefaultPolicy,t);s.useTemporaryRelay(c,void 0,`requested from fromRelayUrls ${e}`),o.add(c)}}return new Ce(new Set(o),t,s)}async publish(e,t,r=1){var c;const s=new Set,o=new Map,a=e.isEphemeral();e.publishStatus="pending";const u=l=>{s.add(l)};e.on("relay:published",u);try{const l=Array.from(this.relays).map(f=>new Promise(h=>{const g=t?setTimeout(()=>{s.has(f)||(o.set(f,new Error(`Publish timeout after ${t}ms`)),h(!1))},t):null;f.publish(e,t).then(m=>{g&&clearTimeout(g),m?(s.add(f),h(!0)):h(!1)}).catch(m=>{g&&clearTimeout(g),a||o.set(f,m),h(!1)})}));if(await Promise.all(l),s.size<r){if(!a){const f=new NDKPublishError("Not enough relays received the event",o,s,this);throw e.publishStatus="error",e.publishError=f,(c=this.ndk)==null||c.emit("event:publish-failed",e,f,this.relayUrls),f}}else e.publishStatus="success",e.emit("published",{relaySet:this,publishedToRelays:s});return s}finally{e.off("relay:published",u)}}get size(){return this.relays.size}},d=createDebug5("ndk:outbox:calculate");async function calculateRelaySetFromEvent(n,e){var a;const t=new Set,r=await getWriteRelaysFor(n,e.pubkey);r&&r.forEach(u=>{var l;const c=(l=n.pool)==null?void 0:l.getRelay(u);c&&t.add(c)});let s=e.tags.filter(u=>["a","e"].includes(u[0])).map(u=>u[2]).filter(u=>u==null?void 0:u.startsWith("wss://")).filter(u=>{try{return new URL(u),!0}catch{return!1}}).map(u=>normalizeRelayUrl(u));s=Array.from(new Set(s)).slice(0,5),s.forEach(u=>{var l;const c=(l=n.pool)==null?void 0:l.getRelay(u,!0,!0);c&&(d("Adding relay hint %s",u),t.add(c))});const o=e.getMatchingTags("p").map(u=>u[1]);return o.length<5?Array.from(chooseRelayCombinationForPubkeys(n,o,"read",{preferredRelays:new Set(r)}).keys()).forEach(c=>{var f;const l=(f=n.pool)==null?void 0:f.getRelay(c,!1,!0);l&&(d("Adding p-tagged relay %s",c),t.add(l))}):d("Too many p-tags to consider %d",o.length),(a=n.pool)==null||a.permanentAndConnectedRelays().forEach(u=>t.add(u)),new NDKRelaySet(t,n)}function calculateRelaySetsFromFilter(n,e,t){const r=new Map,s=new Set;if(e.forEach(o=>{o.authors&&o.authors.forEach(a=>s.add(a))}),s.size>0){const o=getRelaysForFilterWithAuthors(n,Array.from(s));for(const a of o.keys())r.set(a,[]);for(const a of e)if(a.authors)for(const[u,c]of o.entries()){const l=a.authors.filter(f=>c.includes(f));r.set(u,[...r.get(u),{...a,authors:l}])}else for(const u of o.keys())r.set(u,[...r.get(u),a])}else n.explicitRelayUrls&&n.explicitRelayUrls.forEach(o=>{r.set(o,e)});return r.size===0&&t.permanentAndConnectedRelays().slice(0,5).forEach(o=>{r.set(o.url,e)}),r}function calculateRelaySetsFromFilters(n,e,t){return calculateRelaySetsFromFilter(n,e,t)}function mergeTags(n,e){const t=new Map,r=a=>a.join(","),s=(a,u)=>a.every((c,l)=>c===u[l]),o=a=>{for(const[u,c]of t)if(s(c,a)||s(a,c)){a.length>=c.length&&t.set(u,a);return}t.set(r(a),a)};return n.concat(e).forEach(o),Array.from(t.values())}var hashtagRegex=new RegExp(`(?<=\\s|^)(#[^\\s!@#$%^&*()=+./,[{\\]};:'"?><]+)`,"g");function generateHashtags(n){const e=n.match(hashtagRegex),t=new Set,r=new Set;if(e)for(const s of e)t.has(s.slice(1))||(r.add(s.slice(1)),t.add(s.slice(1)));return Array.from(r)}async function generateContentTags(n,e=[]){const t=/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,r=[],s=a=>{e.find(u=>["q",a[0]].includes(u[0])&&u[1]===a[1])||e.push(a)};n=n.replace(t,a=>{try{const u=a.split(/(@|nostr:)/)[2],{type:c,data:l}=nip19_exports.decode(u);let f;switch(c){case"npub":f=["p",l];break;case"nprofile":f=["p",l.pubkey];break;case"note":r.push(new Promise(async h=>{s(["q",l,await maybeGetEventRelayUrl(u)]),h()}));break;case"nevent":r.push(new Promise(async h=>{const{id:g,author:m}=l;let{relays:v}=l;(!v||v.length===0)&&(v=[await maybeGetEventRelayUrl(u)]),s(["q",g,v[0]]),m&&s(["p",m]),h()}));break;case"naddr":r.push(new Promise(async h=>{const g=[l.kind,l.pubkey,l.identifier].join(":");let m=l.relays??[];m.length===0&&(m=[await maybeGetEventRelayUrl(u)]),s(["q",g,m[0]]),s(["p",l.pubkey]),h()}));break;default:return a}return f&&s(f),`nostr:${u}`}catch{return a}}),await Promise.all(r);const o=generateHashtags(n).map(a=>["t",a]);return e=mergeTags(e,o),{content:n,tags:e}}async function maybeGetEventRelayUrl(n){return""}async function encrypt(n,e,t="nip44"){let r;if(!this.ndk)throw new Error("No NDK instance found!");let s=e;if(s||(this.ndk.assertSigner(),s=this.ndk.signer),!s)throw new Error("no NDK signer");const o=n||(()=>{const a=this.getMatchingTags("p");if(a.length!==1)throw new Error("No recipient could be determined and no explicit recipient was provided");return this.ndk.getUser({pubkey:a[0][1]})})();if(t==="nip44"&&await isEncryptionEnabled(s,"nip44")&&(r=await s.encrypt(o,this.content,"nip44")),(!r||t==="nip04")&&await isEncryptionEnabled(s,"nip04")&&(r=await s.encrypt(o,this.content,"nip04")),!r)throw new Error("Failed to encrypt event.");this.content=r}async function decrypt(n,e,t){var u,c,l,f;if((c=(u=this.ndk)==null?void 0:u.cacheAdapter)!=null&&c.getDecryptedEvent){let h=null;if(typeof this.ndk.cacheAdapter.getDecryptedEvent=="function"&&(h=this.ndk.cacheAdapter.getDecryptedEvent(this.id)),h){this.content=h.content;return}}let r;if(!this.ndk)throw new Error("No NDK instance found!");let s=e;if(s||(this.ndk.assertSigner(),s=this.ndk.signer),!s)throw new Error("no NDK signer");const o=n||this.author;if(!o)throw new Error("No sender provided and no author available");const a=t||(this.content.match(/\\?iv=/)?"nip04":"nip44");if((a==="nip04"||this.kind===4)&&await isEncryptionEnabled(s,"nip04")&&this.content.search("\\?iv=")&&(r=await s.decrypt(o,this.content,"nip04")),!r&&a==="nip44"&&await isEncryptionEnabled(s,"nip44")&&(r=await s.decrypt(o,this.content,"nip44")),!r)throw new Error("Failed to decrypt event.");this.content=r,(f=(l=this.ndk)==null?void 0:l.cacheAdapter)!=null&&f.addDecryptedEvent&&this.ndk.cacheAdapter.addDecryptedEvent(this)}async function isEncryptionEnabled(n,e){return n.encryptionEnabled?e?!!await n.encryptionEnabled(e):!0:!1}function eventHasETagMarkers(n){for(const e of n.tags)if(e[0]==="e"&&(e[3]??"").length>0)return!0;return!1}function getRootTag(n,e){e??(e=n.tagType());const t=n.tags.find(isTagRootTag);if(!t){if(eventHasETagMarkers(n))return;const r=n.getMatchingTags(e);if(r.length<3)return r[0]}return t}var nip22RootTags=new Set(["A","E","I"]),nip22ReplyTags=new Set(["a","e","i"]);function getReplyTag(n,e){if(n.kind===1111){let s;for(const o of n.tags)if(nip22RootTags.has(o[0]))s=o;else if(nip22ReplyTags.has(o[0])){s=o;break}return s}e??(e=n.tagType());let t=!1,r;for(const s of n.tags)if(s[0]===e){if((s[3]??"").length>0&&(t=!0),t&&s[3]==="reply")return s;t&&s[3]==="root"&&(r=s),t||(r=s)}return r}function isTagRootTag(n){return n[0]==="E"||n[3]==="root"}async function fetchTaggedEvent(n,e){if(!this.ndk)throw new Error("NDK instance not found");const t=this.getMatchingTags(n,e);if(t.length===0)return;const[r,s,o]=t[0];let a=o!==""?this.ndk.pool.getRelay(o):void 0;return await this.ndk.fetchEvent(s,{},a)}async function fetchRootEvent(n){if(!this.ndk)throw new Error("NDK instance not found");const e=getRootTag(this);if(e)return this.ndk.fetchEventFromTag(e,this,n)}async function fetchReplyEvent(n){if(!this.ndk)throw new Error("NDK instance not found");const e=getReplyTag(this);if(e)return this.ndk.fetchEventFromTag(e,this,n)}function isReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function isEphemeral(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function isParamReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}var DEFAULT_RELAY_COUNT=2;function encode(n=DEFAULT_RELAY_COUNT){let e=[];return this.onRelays.length>0?e=this.onRelays.map(t=>t.url):this.relay&&(e=[this.relay.url]),e.length>n&&(e=e.slice(0,n)),this.isParamReplaceable()?nip19_exports.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:e}):e.length>0?nip19_exports.neventEncode({id:this.tagId(),relays:e,author:this.pubkey}):nip19_exports.noteEncode(this.tagId())}async function repost(n=!0,e){if(!e&&n){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),e=this.ndk.signer}const t=new NDKEvent(this.ndk,{kind:getKind(this)});return this.isProtected||(t.content=JSON.stringify(this.rawEvent())),t.tag(this),this.kind!==1&&t.tags.push(["k",`${this.kind}`]),e&&await t.sign(e),n&&await t.publish(),t}function getKind(n){return n.kind===1?6:16}function serialize(n=!1,e=!1){const t=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return n&&t.push(this.sig),e&&t.push(this.id),JSON.stringify(t)}function deserialize(n){const e=JSON.parse(n),t={pubkey:e[1],created_at:e[2],kind:e[3],tags:e[4],content:e[5]};return e.length>=7&&(t.sig=e[6]),e.length>=8&&(t.id=e[7]),t}var worker,processingQueue={};function signatureVerificationInit(n){worker=n,worker.onmessage=e=>{const[t,r]=e.data,s=processingQueue[t];if(!s){console.error("No record found for event",t);return}delete processingQueue[t];for(const o of s.resolves)o(r)}}async function verifySignatureAsync(n,e){return new Promise(r=>{const s=n.serialize();let o=!1;processingQueue[n.id]||(processingQueue[n.id]={event:n,resolves:[]},o=!0),processingQueue[n.id].resolves.push(r),o&&(worker==null||worker.postMessage({serialized:s,id:n.id,sig:n.sig,pubkey:n.pubkey}))})}var PUBKEY_REGEX=/^[a-f0-9]{64}$/;function validate(){if(typeof this.kind!="number"||typeof this.content!="string"||typeof this.created_at!="number"||typeof this.pubkey!="string"||!this.pubkey.match(PUBKEY_REGEX)||!Array.isArray(this.tags))return!1;for(let n=0;n<this.tags.length;n++){const e=this.tags[n];if(!Array.isArray(e))return!1;for(let t=0;t<e.length;t++)if(typeof e[t]=="object")return!1}return!0}var verifiedSignatures=new dist.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function verifySignature(n){var t;if(typeof this.signatureVerified=="boolean")return this.signatureVerified;const e=verifiedSignatures.get(this.id);if(e!==null)return this.signatureVerified=!!e,this.signatureVerified;try{if((t=this.ndk)!=null&&t.asyncSigVerification)verifySignatureAsync(this,n).then(r=>{var s;n&&(this.signatureVerified=r,r&&verifiedSignatures.set(this.id,this.sig)),r||((s=this.ndk)==null||s.emit("event:invalid-sig",this),verifiedSignatures.set(this.id,!1))});else{const r=sha256(new TextEncoder().encode(this.serialize())),s=schnorr.verify(this.sig,r,this.pubkey);return s?verifiedSignatures.set(this.id,this.sig):verifiedSignatures.set(this.id,!1),this.signatureVerified=s,s}}catch{return this.signatureVerified=!1,!1}}function getEventHash(){return getEventHashFromSerializedEvent(this.serialize())}function getEventHashFromSerializedEvent(n){const e=sha256(new TextEncoder().encode(n));return bytesToHex$1(e)}var skipClientTagOnKinds=new Set([0,4,1059,13,3,9734,5]),NDKEvent=class ve extends lib$1.EventEmitter{constructor(t,r){var s;super();p(this,"ndk");p(this,"created_at");p(this,"content","");p(this,"tags",[]);p(this,"kind");p(this,"id","");p(this,"sig");p(this,"pubkey","");p(this,"signatureVerified");p(this,"_author");p(this,"relay");p(this,"publishStatus","success");p(this,"publishError");p(this,"serialize",serialize.bind(this));p(this,"getEventHash",getEventHash.bind(this));p(this,"validate",validate.bind(this));p(this,"verifySignature",verifySignature.bind(this));p(this,"isReplaceable",isReplaceable.bind(this));p(this,"isEphemeral",isEphemeral.bind(this));p(this,"isDvm",()=>this.kind&&this.kind>=5e3&&this.kind<=7e3);p(this,"isParamReplaceable",isParamReplaceable.bind(this));p(this,"encode",encode.bind(this));p(this,"encrypt",encrypt.bind(this));p(this,"decrypt",decrypt.bind(this));p(this,"fetchTaggedEvent",fetchTaggedEvent.bind(this));p(this,"fetchRootEvent",fetchRootEvent.bind(this));p(this,"fetchReplyEvent",fetchReplyEvent.bind(this));p(this,"repost",repost.bind(this));this.ndk=t,this.created_at=r==null?void 0:r.created_at,this.content=(r==null?void 0:r.content)||"",this.tags=(r==null?void 0:r.tags)||[],this.id=(r==null?void 0:r.id)||"",this.sig=r==null?void 0:r.sig,this.pubkey=(r==null?void 0:r.pubkey)||"",this.kind=r==null?void 0:r.kind,r instanceof ve&&(this.relay&&(this.relay=r.relay,(s=this.ndk)==null||s.subManager.seenEvent(r.id,this.relay)),this.publishStatus=r.publishStatus,this.publishError=r.publishError)}get onRelays(){let t=[];return this.ndk?t=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&t.push(this.relay),t}static deserialize(t,r){return new ve(t,deserialize(r))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(t){var r;this.pubkey=t.pubkey,this._author=t,(r=this._author).ndk??(r.ndk=this.ndk)}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const t=this.ndk.getUser({pubkey:this.pubkey});return this._author=t,t}tagExternal(t,r,s){const o=["i"],a=["k"];switch(r){case"url":{const u=new URL(t);u.hash="",o.push(u.toString()),a.push(`${u.protocol}//${u.host}`);break}case"hashtag":o.push(`#${t.toLowerCase()}`),a.push("#");break;case"geohash":o.push(`geo:${t.toLowerCase()}`),a.push("geo");break;case"isbn":o.push(`isbn:${t.replace(/-/g,"")}`),a.push("isbn");break;case"podcast:guid":o.push(`podcast:guid:${t}`),a.push("podcast:guid");break;case"podcast:item:guid":o.push(`podcast:item:guid:${t}`),a.push("podcast:item:guid");break;case"podcast:publisher:guid":o.push(`podcast:publisher:guid:${t}`),a.push("podcast:publisher:guid");break;case"isan":o.push(`isan:${t.split("-").slice(0,4).join("-")}`),a.push("isan");break;case"doi":o.push(`doi:${t.toLowerCase()}`),a.push("doi");break;default:throw new Error(`Unsupported NIP-73 entity type: ${r}`)}s&&o.push(s),this.tags.push(o),this.tags.push(a)}tag(t,r,s,o){let a=[];if(t.fetchProfile!==void 0){o??(o="p");const c=[o,t.pubkey];r&&c.push("",r),a.push(c)}else if(t instanceof ve){const c=t;s??(s=(c==null?void 0:c.pubkey)===this.pubkey),a=c.referenceTags(r,s,o);for(const l of c.getMatchingTags("p"))l[1]!==this.pubkey&&(this.tags.find(f=>f[0]==="p"&&f[1]===l[1])||this.tags.push(["p",l[1]]))}else if(Array.isArray(t))a=[t];else throw new Error("Invalid argument",t);this.tags=mergeTags(this.tags,a)}async toNostrEvent(t){var o,a;if(!t&&this.pubkey===""){const u=await((a=(o=this.ndk)==null?void 0:o.signer)==null?void 0:a.user());this.pubkey=(u==null?void 0:u.pubkey)||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:r,tags:s}=await this.generateTags();this.content=r||"",this.tags=s;try{this.id=this.getEventHash()}catch{}return this.rawEvent()}getMatchingTags(t,r){const s=this.tags.filter(o=>o[0]===t);return r===void 0?s:s.filter(o=>o[3]===r)}hasTag(t,r){return this.tags.some(s=>s[0]===t&&(!r||s[3]===r))}tagValue(t){const r=this.getMatchingTags(t);if(r.length!==0)return r[0][1]}get alt(){return this.tagValue("alt")}set alt(t){this.removeTag("alt"),t&&this.tags.push(["alt",t])}get dTag(){return this.tagValue("d")}set dTag(t){this.removeTag("d"),t&&this.tags.push(["d",t])}removeTag(t){const r=Array.isArray(t)?t:[t];this.tags=this.tags.filter(s=>!r.includes(s[0]))}replaceTag(t){this.removeTag(t[0]),this.tags.push(t)}async sign(t){var s,o;t?this.author=await t.user():((s=this.ndk)==null||s.assertSigner(),t=(o=this.ndk)==null?void 0:o.signer);const r=await this.toNostrEvent();return this.sig=await t.sign(r),this.sig}async publishReplaceable(t,r,s){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(t,r,s)}async publish(t,r,s){var u,c,l;if(this.sig||await this.sign(),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");if((!t||t.size===0)&&(t=this.ndk.devWriteRelaySet||await calculateRelaySetFromEvent(this.ndk,this)),this.kind===5&&((u=this.ndk.cacheAdapter)!=null&&u.deleteEventIds)){const f=this.getMatchingTags("e").map(h=>h[1]);this.ndk.cacheAdapter.deleteEventIds(f)}const o=this.rawEvent();if((c=this.ndk.cacheAdapter)!=null&&c.addUnpublishedEvent&&shouldTrackUnpublishedEvent(this))try{this.ndk.cacheAdapter.addUnpublishedEvent(this,t.relayUrls)}catch(f){console.error("Error adding unpublished event to cache",f)}this.kind===5&&((l=this.ndk.cacheAdapter)!=null&&l.deleteEventIds)&&this.ndk.cacheAdapter.deleteEventIds(this.getMatchingTags("e").map(f=>f[1])),this.ndk.subManager.dispatchEvent(o,void 0,!0);const a=await t.publish(this,r,s);return a.forEach(f=>{var h;return(h=this.ndk)==null?void 0:h.subManager.seenEvent(this.id,f)}),a}async generateTags(){var o,a,u;let t=[];const r=await generateContentTags(this.content,this.tags),s=r.content;if(t=r.tags,this.kind&&this.isParamReplaceable()&&!this.getMatchingTags("d")[0]){const l=this.tagValue("title");let h=[...Array(l?6:16)].map(()=>Math.random().toString(36)[2]).join("");l&&l.length>0&&(h=`${l.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")}-${h}`),t.push(["d",h])}if(this.shouldAddClientTag){const c=["client",((o=this.ndk)==null?void 0:o.clientName)??""];(a=this.ndk)!=null&&a.clientNip89&&c.push((u=this.ndk)==null?void 0:u.clientNip89),t.push(c)}else this.shouldStripClientTag&&(t=t.filter(c=>c[0]!=="client"));return{content:s||"",tags:t}}get shouldAddClientTag(){var t,r;return!(!((t=this.ndk)!=null&&t.clientName)&&!((r=this.ndk)!=null&&r.clientNip89)||skipClientTagOnKinds.has(this.kind)||this.isEphemeral()||this.isReplaceable()&&!this.isParamReplaceable()||this.isDvm()||this.hasTag("client"))}get shouldStripClientTag(){return skipClientTagOnKinds.has(this.kind)}muted(){var o,a;const t=(o=this.ndk)==null?void 0:o.mutedIds.get(this.pubkey);if(t&&t==="p")return"author";const r=this.tagReference(),s=(a=this.ndk)==null?void 0:a.mutedIds.get(r[1]);return s&&s===r[0]?"event":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const t=this.getMatchingTags("d")[0];return t?t[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return this.kind===0||this.kind===3||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(this.isParamReplaceable()){const t=this.dTag??"";return`${this.kind}:${this.pubkey}:${t}`}if(this.isReplaceable())return`${this.kind}:${this.pubkey}:`;throw new Error("Event is not a replaceable event")}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(t){let r;return this.isParamReplaceable()?r=["a",this.tagAddress()]:r=["e",this.tagId()],this.relay?r.push(this.relay.url):r.push(""),r.push(t??""),this.isParamReplaceable()||r.push(this.pubkey),r}referenceTags(t,r,s){let o=[];return this.isParamReplaceable()?o=[[s??"a",this.tagAddress()],[s??"e",this.id]]:o=[[s??"e",this.id]],o=o.map(a=>{var u,c,l;return a[0]==="e"||t?a.push(((u=this.relay)==null?void 0:u.url)??""):(c=this.relay)!=null&&c.url&&a.push((l=this.relay)==null?void 0:l.url),a}),o.forEach(a=>{a[0]==="e"?(a.push(t??""),a.push(this.pubkey)):t&&a.push(t)}),o=[...o,...this.getMatchingTags("h")],r||o.push(...this.author.referenceTags()),o}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}nip22Filter(){return this.isParamReplaceable()?{"#A":[this.tagId()]}:{"#E":[this.tagId()]}}async delete(t,r=!0){var o;if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const s=new ve(this.ndk,{kind:5,content:t||""});return s.tag(this,void 0,!0),s.tags.push(["k",(o=this.kind)==null?void 0:o.toString()]),r&&(this.emit("deleted"),await s.publish()),s}set isProtected(t){this.removeTag("-"),t&&this.tags.push(["-"])}get isProtected(){return this.hasTag("-")}async react(t,r=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const s=new ve(this.ndk,{kind:7,content:t});return s.tag(this),r&&await s.publish(),s}get isValid(){return this.validate()}get inspect(){return JSON.stringify(this.rawEvent(),null,4)}dump(){console.debug(JSON.stringify(this.rawEvent(),null,4)),console.debug("Event on relays:",this.onRelays.map(t=>t.url).join(", "))}reply(){var r,s;const t=new ve(this.ndk);if(this.kind===1)t.kind=1,this.hasTag("e")?t.tags=[...t.tags,...this.getMatchingTags("e"),...this.getMatchingTags("p"),...this.getMatchingTags("a"),...this.referenceTags("reply")]:t.tag(this,"root");else{t.kind=1111;const o=["A","E","I","P"],a=this.tags.filter(u=>o.includes(u[0]));if(a.length>0){const u=this.tagValue("K");t.tags.push(...a),u&&t.tags.push(["K",u]);const[c,l,f,...h]=this.tagReference(),g=[c,l,...h];t.tags.push(g)}else{const[u,c,l,f]=this.tagReference(),h=[u,c,f??""];u==="e"&&h.push(this.pubkey),t.tags.push(h);const g=[...h];g[0]=g[0].toUpperCase(),t.tags.push(g),t.tags.push(["K",(r=this.kind)==null?void 0:r.toString()]),t.tags.push(["P",this.pubkey])}t.tags.push(["k",(s=this.kind)==null?void 0:s.toString()]),t.tags.push(...this.getMatchingTags("p")),t.tags.push(["p",this.pubkey])}return t}},untrackedUnpublishedEvents=new Set([24133,13194,23194,23195]);function shouldTrackUnpublishedEvent(n){return!untrackedUnpublishedEvents.has(n.kind)}var NDKPool=class extends lib$1.EventEmitter{constructor(e,t,r,{debug:s,name:o}={}){super();p(this,"_relays",new Map);p(this,"status","idle");p(this,"autoConnectRelays",new Set);p(this,"poolBlacklistRelayUrls",new Set);p(this,"debug");p(this,"temporaryRelayTimers",new Map);p(this,"flappingRelays",new Set);p(this,"backoffTimes",new Map);p(this,"ndk");p(this,"_name","unnamed");this.debug=s??r.debug.extend("pool"),o&&(this._name=o),this.ndk=r,this.relayUrls=e,this.poolBlacklistRelayUrls=new Set(t),this.ndk.pools.push(this)}get blacklistRelayUrls(){const e=new Set(this.ndk.blacklistRelayUrls);return this.poolBlacklistRelayUrls.forEach(t=>e.add(t)),e}get relays(){return this._relays}set relayUrls(e){this._relays.clear();for(const t of e){const r=new NDKRelay(t,void 0,this.ndk);r.connectivity.netDebug=this.ndk.netDebug,this.addRelay(r)}}get name(){return this._name}set name(e){this._name=e,this.debug=this.debug.extend(e)}useTemporaryRelay(e,t=3e4,r){const s=this.relays.has(e.url);s||(this.addRelay(e),this.debug("Adding temporary relay %s for filters %o",e.url,r));const o=this.temporaryRelayTimers.get(e.url);if(o&&clearTimeout(o),!s||o){const a=setTimeout(()=>{var u;(u=this.ndk.explicitRelayUrls)!=null&&u.includes(e.url)||this.removeRelay(e.url)},t);this.temporaryRelayTimers.set(e.url,a)}}addRelay(e,t=!0){var b,y;const r=this.relays.has(e.url),s=(b=this.blacklistRelayUrls)==null?void 0:b.has(e.url),o=e.url.includes("/npub1");let a=!0;const u=e.url;if(r)return;if(s){this.debug(`Refusing to add relay ${u}: blacklisted`);return}if(o){this.debug(`Refusing to add relay ${u}: is a filter relay`);return}if((y=this.ndk.cacheAdapter)!=null&&y.getRelayStatus){const w=this.ndk.cacheAdapter.getRelayStatus(u);if(w!=null&&w.dontConnectBefore){if(w.dontConnectBefore>Date.now()){const S=w.dontConnectBefore-Date.now();this.debug(`Refusing to add relay ${u}: delayed connect for ${S}ms`),setTimeout(()=>{this.addRelay(e,t)},S);return}a=!1}}const c=w=>this.emit("notice",e,w),l=()=>this.handleRelayConnect(u),f=()=>this.handleRelayReady(e),h=()=>this.emit("relay:disconnect",e),g=()=>this.handleFlapping(e),m=w=>this.emit("relay:auth",e,w),v=()=>this.emit("relay:authed",e);e.off("notice",c),e.off("connect",l),e.off("ready",f),e.off("disconnect",h),e.off("flapping",g),e.off("auth",m),e.off("authed",v),e.on("notice",c),e.on("connect",l),e.on("ready",f),e.on("disconnect",h),e.on("flapping",g),e.on("auth",m),e.on("authed",v),e.on("delayed-connect",w=>{var S;(S=this.ndk.cacheAdapter)!=null&&S.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(e.url,{dontConnectBefore:Date.now()+w})}),this._relays.set(u,e),t&&this.autoConnectRelays.add(u),t&&this.status==="active"&&(this.emit("relay:connecting",e),e.connect(void 0,a).catch(w=>{this.debug(`Failed to connect to relay ${u}`,w)}))}removeRelay(e){const t=this.relays.get(e);if(t)return t.disconnect(),this.relays.delete(e),this.autoConnectRelays.delete(e),this.emit("relay:disconnect",t),!0;const r=this.temporaryRelayTimers.get(e);return r&&(clearTimeout(r),this.temporaryRelayTimers.delete(e)),!1}isRelayConnected(e){const t=normalizeRelayUrl(e),r=this.relays.get(t);return r?r.status===5:!1}getRelay(e,t=!0,r=!1,s){let o=this.relays.get(normalizeRelayUrl(e));return o||(o=new NDKRelay(e,void 0,this.ndk),o.connectivity.netDebug=this.ndk.netDebug,r?this.useTemporaryRelay(o,3e4,s):this.addRelay(o,t)),o}handleRelayConnect(e){const t=this.relays.get(e);if(!t){console.error("NDK BUG: relay not found in pool",{relayUrl:e});return}this.emit("relay:connect",t),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(e){this.emit("relay:ready",e)}async connect(e){const t=[];this.status="active",this.debug(`Connecting to ${this.relays.size} relays${e?`, timeout ${e}...`:""}`);const r=new Set(this.autoConnectRelays.keys());for(const o of r){const a=this.relays.get(o);if(!a)continue;const u=new Promise((c,l)=>(this.emit("relay:connecting",a),a.connect(e).then(c).catch(l)));if(e){const c=new Promise((l,f)=>{setTimeout(()=>f(`Timed out after ${e}ms`),e)});t.push(Promise.race([u,c]).catch(l=>{this.debug(`Failed to connect to relay ${a.url}: ${l??"No reason specified"}`)}))}else t.push(u)}const s=()=>{const o=this.stats().connected===this.relays.size,a=this.stats().connected>0;!o&&a&&this.emit("connect")};e&&setTimeout(s,e),await Promise.all(t),s()}checkOnFlappingRelays(){const e=this.flappingRelays.size,t=this.relays.size;if(e/t>=.8)for(const r of this.flappingRelays)this.backoffTimes.set(r,0)}handleFlapping(e){this.debug(`Relay ${e.url} is flapping`);let t=this.backoffTimes.get(e.url)||5e3;t=t*2,this.backoffTimes.set(e.url,t),this.debug(`Backoff time for ${e.url} is ${t}ms`),setTimeout(()=>{this.debug(`Attempting to reconnect to ${e.url}`),this.emit("relay:connecting",e),e.connect(),this.checkOnFlappingRelays()},t),e.disconnect(),this.emit("flapping",e)}size(){return this.relays.size}stats(){const e={total:0,connected:0,disconnected:0,connecting:0};for(const t of this.relays.values())e.total++,t.status===5?e.connected++:t.status===1?e.disconnected++:t.status===4&&e.connecting++;return e}connectedRelays(){return Array.from(this.relays.values()).filter(e=>e.status>=5)}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter(e=>e.status>=5&&!this.temporaryRelayTimers.has(e.url))}urls(){return Array.from(this.relays.keys())}},NDKCashuMintList=(z=class extends NDKEvent{constructor(t,r){super(t,r);p(this,"_p2pk");this.kind??(this.kind=10019)}static from(t){return new z(t.ndk,t)}set relays(t){this.tags=this.tags.filter(r=>r[0]!=="relay");for(const r of t)this.tags.push(["relay",r])}get relays(){const t=[];for(const r of this.tags)r[0]==="relay"&&t.push(r[1]);return t}set mints(t){this.tags=this.tags.filter(r=>r[0]!=="mint");for(const r of t)this.tags.push(["mint",r])}get mints(){const t=[];for(const r of this.tags)r[0]==="mint"&&t.push(r[1]);return Array.from(new Set(t))}get p2pk(){return this._p2pk?this._p2pk:(this._p2pk=this.tagValue("pubkey")??this.pubkey,this._p2pk)}set p2pk(t){this._p2pk=t,this.removeTag("pubkey"),t&&this.tags.push(["pubkey",t])}get relaySet(){return NDKRelaySet.fromRelayUrls(this.relays,this.ndk)}},p(z,"kind",10019),p(z,"kinds",[10019]),z),NDKArticle=(W=class extends NDKEvent{constructor(e,t){super(e,t),this.kind??(this.kind=30023)}static from(e){return new W(e.ndk,e)}get title(){return this.tagValue("title")}set title(e){this.removeTag("title"),e&&this.tags.push(["title",e])}get image(){return this.tagValue("image")}set image(e){this.removeTag("image"),e&&this.tags.push(["image",e])}get summary(){return this.tagValue("summary")}set summary(e){this.removeTag("summary"),e&&this.tags.push(["summary",e])}get published_at(){const e=this.tagValue("published_at");if(e){let t=Number.parseInt(e);return t>1e12&&(t=Math.floor(t/1e3)),t}}set published_at(e){this.removeTag("published_at"),e!==void 0&&this.tags.push(["published_at",e.toString()])}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}get url(){return this.tagValue("url")}set url(e){e?this.tags.push(["url",e]):this.removeTag("url")}},p(W,"kind",30023),p(W,"kinds",[30023]),W);function proofsTotalBalance(n){return n.reduce((e,t)=>{if(t.amount<0)throw new Error("proof amount is negative");return e+t.amount},0)}var NDKCashuToken=(ae=class extends NDKEvent{constructor(t,r){super(t,r);p(this,"_proofs",[]);p(this,"_mint");p(this,"_deletes",[]);p(this,"original");this.kind??(this.kind=7375)}static async from(t){const r=new ae(t.ndk,t);r.original=t;try{await r.decrypt()}catch{r.content=r.original.content}try{const s=JSON.parse(r.content);if(r.proofs=s.proofs,r.mint=s.mint??r.tagValue("mint"),r.deletedTokens=s.del??[],!Array.isArray(r.proofs))return}catch{return}return r}get proofs(){return this._proofs}set proofs(t){const r=new Set;this._proofs=t.filter(s=>r.has(s.C)?(console.warn("Passed in proofs had duplicates, ignoring",s.C),!1):s.amount<0?(console.warn("Invalid proof with negative amount",s),!1):(r.add(s.C),!0)).map(this.cleanProof)}cleanProof(t){return{id:t.id,amount:t.amount,C:t.C,secret:t.secret}}async toNostrEvent(t){if(!this.ndk)throw new Error("no ndk");if(!this.ndk.signer)throw new Error("no signer");const r={proofs:this.proofs.map(this.cleanProof),mint:this.mint,del:this.deletedTokens??[]};this.content=JSON.stringify(r);const s=await this.ndk.signer.user();return await this.encrypt(s,void 0,"nip44"),super.toNostrEvent(t)}set mint(t){this._mint=t}get mint(){return this._mint}get deletedTokens(){return this._deletes}set deletedTokens(t){this._deletes=t}get amount(){return proofsTotalBalance(this.proofs)}async publish(t,r,s){return this.original?this.original.publish(t,r,s):super.publish(t,r,s)}},p(ae,"kind",7375),p(ae,"kinds",[7375]),ae),NDKHighlight=(ue=class extends NDKEvent{constructor(t,r){super(t,r);p(this,"_article");this.kind??(this.kind=9802)}static from(t){return new ue(t.ndk,t)}get url(){return this.tagValue("r")}set context(t){t===void 0?this.tags=this.tags.filter(([r,s])=>r!=="context"):(this.tags=this.tags.filter(([r,s])=>r!=="context"),this.tags.push(["context",t]))}get context(){var t;return((t=this.tags.find(([r,s])=>r==="context"))==null?void 0:t[1])??void 0}get article(){return this._article}set article(t){this._article=t,typeof t=="string"?this.tags.push(["r",t]):this.tag(t)}getArticleTag(){return this.getMatchingTags("a")[0]||this.getMatchingTags("e")[0]||this.getMatchingTags("r")[0]}async getArticle(){var s;if(this._article!==void 0)return this._article;let t;const r=this.getArticleTag();if(r){switch(r[0]){case"a":{const[o,a,u]=r[1].split(":");t=nip19_exports.naddrEncode({kind:Number.parseInt(o),pubkey:a,identifier:u});break}case"e":t=nip19_exports.noteEncode(r[1]);break;case"r":this._article=r[1];break}if(t){let o=await((s=this.ndk)==null?void 0:s.fetchEvent(t));o&&(o.kind===30023&&(o=NDKArticle.from(o)),this._article=o)}return this._article}}},p(ue,"kind",9802),p(ue,"kinds",[9802]),ue);function mapImetaTag(n){const e={};if(n.length===2){const r=n[1].split(" ");for(let s=0;s<r.length;s+=2){const o=r[s],a=r[s+1];o==="fallback"?(e.fallback||(e.fallback=[]),e.fallback.push(a)):e[o]=a}return e}const t=n.slice(1);for(const r of t){const s=r.split(" "),o=s[0],a=s.slice(1).join(" ");o==="fallback"?(e.fallback||(e.fallback=[]),e.fallback.push(a)):e[o]=a}return e}function imetaTagToTag(n){const e=["imeta"];for(const[t,r]of Object.entries(n))if(Array.isArray(r))for(const s of r)e.push(`${t} ${s}`);else r&&e.push(`${t} ${r}`);return e}var NDKImage=(ce=class extends NDKEvent{constructor(t,r){super(t,r);p(this,"_imetas");this.kind??(this.kind=20)}static from(t){return new ce(t.ndk,t.rawEvent())}get isValid(){return this.imetas.length>0}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(t=>t[0]==="imeta").map(mapImetaTag).filter(t=>!!t.url),this._imetas)}set imetas(t){this._imetas=t,this.tags=this.tags.filter(r=>r[0]!=="imeta"),this.tags.push(...t.map(imetaTagToTag))}},p(ce,"kind",20),p(ce,"kinds",[20]),ce),NDKList=(me=class extends NDKEvent{constructor(t,r){super(t,r);p(this,"_encryptedTags");p(this,"encryptedTagsLength");this.kind??(this.kind=30001)}static from(t){return new me(t.ndk,t)}get title(){const t=this.tagValue("title")||this.tagValue("name");return t||(this.kind===3?"Contacts":this.kind===1e4?"Mute":this.kind===10001?"Pinned Notes":this.kind===10002?"Relay Metadata":this.kind===10003?"Bookmarks":this.kind===10004?"Communities":this.kind===10005?"Public Chats":this.kind===10006?"Blocked Relays":this.kind===10007?"Search Relays":this.kind===10050?"Direct Message Receive Relays":this.kind===10015?"Interests":this.kind===10030?"Emojis":this.tagValue("d"))}set title(t){this.removeTag(["title","name"]),t&&this.tags.push(["title",t])}get name(){return this.title}set name(t){this.title=t}get description(){return this.tagValue("description")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}isEncryptedTagsCacheValid(){return!!(this._encryptedTags&&this.encryptedTagsLength===this.content.length)}async encryptedTags(t=!0){if(t&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const r=await this.ndk.signer.user();try{if(this.content.length>0)try{const s=await this.ndk.signer.decrypt(r,this.content),o=JSON.parse(s);return o!=null&&o[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=o):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch{}}catch{}return[]}validateTag(t){return!0}getItems(t){return this.tags.filter(r=>r[0]===t)}get items(){return this.tags.filter(t=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(t[0]))}async addItem(t,r=void 0,s=!1,o="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let a;if(t instanceof NDKEvent)a=[t.tagReference(r)];else if(t instanceof NDKUser)a=t.referenceTags();else if(t instanceof NDKRelay)a=t.referenceTags();else if(Array.isArray(t))a=[t];else throw new Error("Invalid object type");if(r&&a[0].push(r),s){const u=await this.ndk.signer.user(),c=await this.encryptedTags();o==="top"?c.unshift(...a):c.push(...a),this._encryptedTags=c,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(c),await this.encrypt(u)}else o==="top"?this.tags.unshift(...a):this.tags.push(...a);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(t,r=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const s=this.tags.findIndex(c=>c[1]===t);s>=0&&this.tags.splice(s,1);const o=await this.ndk.signer.user(),a=await this.encryptedTags(),u=a.findIndex(c=>c[1]===t);if(u>=0&&(a.splice(u,1),this._encryptedTags=a,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(a),await this.encrypt(o)),r)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(t,r){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(r){const s=await this.ndk.signer.user(),o=await this.encryptedTags();o.splice(t,1),this._encryptedTags=o,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(o),await this.encrypt(s)}else this.tags.splice(t,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(t){return this.items.some(r=>r[1]===t)}filterForItems(){const t=new Set,r=new Map,s=[];for(const o of this.items)if(o[0]==="e"&&o[1])t.add(o[1]);else if(o[0]==="a"&&o[1]){const[a,u,c]=o[1].split(":");if(!a||!u)continue;const l=`${a}:${u}`,f=r.get(l)||[];f.push(c||""),r.set(l,f)}if(t.size>0&&s.push({ids:Array.from(t)}),r.size>0)for(const[o,a]of r.entries()){const[u,c]=o.split(":");s.push({kinds:[Number.parseInt(u)],authors:[c],"#d":a})}return s}},p(me,"kinds",[10063,30001,10004,10050,10030,10015,10001,10002,10007,10006,10003]),me),lists_default=NDKList,NDKNutzap=(se=class extends NDKEvent{constructor(t,r){super(t,r);p(this,"debug");p(this,"_proofs",[]);p(this,"sender",this.author);this.kind??(this.kind=9321),this.debug=(t==null?void 0:t.debug.extend("nutzap"))??createDebug5("ndk:nutzap"),this.alt||(this.alt="This is a nutzap");try{const s=this.getMatchingTags("proof");s.length?this._proofs=s.map(o=>JSON.parse(o[1])):this._proofs=JSON.parse(this.content)}catch{return}}static from(t){const r=new se(t.ndk,t);if(!(!r._proofs||!r._proofs.length))return r}set comment(t){this.content=t??""}get comment(){const t=this.tagValue("comment");return t||this.content}set proofs(t){this._proofs=t,this.tags=this.tags.filter(r=>r[0]!=="proof");for(const r of t)this.tags.push(["proof",JSON.stringify(r)])}get proofs(){return this._proofs}get rawP2pk(){var r;const t=this.proofs[0];try{const s=JSON.parse(t.secret);let o;if(typeof s=="string"?(o=JSON.parse(s),this.debug("stringified payload",t.secret)):typeof s=="object"&&(o=s),Array.isArray(o)&&o[0]==="P2PK"&&o.length>1&&typeof o[1]=="object"&&o[1]!==null||typeof o=="object"&&o!==null&&typeof((r=o[1])==null?void 0:r.data)=="string")return o[1].data}catch(s){this.debug("error parsing p2pk pubkey",s,this.proofs[0])}}get p2pk(){const t=this.rawP2pk;if(t)return t.startsWith("02")?t.slice(2):t}get mint(){return this.tagValue("u")}set mint(t){this.replaceTag(["u",t])}get unit(){let t=this.tagValue("unit")??"sat";return t!=null&&t.startsWith("msat")&&(t="sat"),t}set unit(t){if(this.removeTag("unit"),t!=null&&t.startsWith("msat"))throw new Error("msat is not allowed, use sat denomination instead");t&&this.tag(["unit",t])}get amount(){return this.proofs.reduce((r,s)=>r+s.amount,0)}set target(t){this.tags=this.tags.filter(r=>r[0]!=="p"),t instanceof NDKEvent&&this.tags.push(t.tagReference())}set recipientPubkey(t){this.removeTag("p"),this.tag(["p",t])}get recipientPubkey(){return this.tagValue("p")}get recipient(){const t=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:t}):new NDKUser({pubkey:t})}async toNostrEvent(){this.unit==="msat"&&(this.unit="sat"),this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()]);const t=await super.toNostrEvent();return t.content=this.comment,t}get isValid(){let t=0,r=0,s=0;for(const o of this.tags)o[0]==="e"&&t++,o[0]==="p"&&r++,o[0]==="u"&&s++;return r===1&&s===1&&t<=1&&this.proofs.length>0}},p(se,"kind",9321),p(se,"kinds",[se.kind]),se),NDKSimpleGroupMemberList=(le=class extends NDKEvent{constructor(t,r){super(t,r);p(this,"relaySet");p(this,"memberSet",new Set);this.kind??(this.kind=39002),this.memberSet=new Set(this.members)}static from(t){return new le(t.ndk,t)}get members(){return this.getMatchingTags("p").map(t=>t[1])}hasMember(t){return this.memberSet.has(t)}async publish(t,r,s){return t??(t=this.relaySet),super.publishReplaceable(t,r,s)}},p(le,"kind",39002),p(le,"kinds",[39002]),le),NDKSimpleGroupMetadata=(de=class extends NDKEvent{constructor(e,t){super(e,t),this.kind??(this.kind=39e3)}static from(e){return new de(e.ndk,e)}get name(){return this.tagValue("name")}get picture(){return this.tagValue("picture")}get about(){return this.tagValue("about")}get scope(){if(this.getMatchingTags("public").length>0)return"public";if(this.getMatchingTags("public").length>0)return"private"}set scope(e){this.removeTag("public"),this.removeTag("private"),e==="public"?this.tags.push(["public",""]):e==="private"&&this.tags.push(["private",""])}get access(){if(this.getMatchingTags("open").length>0)return"open";if(this.getMatchingTags("closed").length>0)return"closed"}set access(e){this.removeTag("open"),this.removeTag("closed"),e==="open"?this.tags.push(["open",""]):e==="closed"&&this.tags.push(["closed",""])}},p(de,"kind",39e3),p(de,"kinds",[39e3]),de);function strToPosition(n){const[e,t]=n.split(",").map(Number);return{x:e,y:t}}function strToDimension(n){const[e,t]=n.split("x").map(Number);return{width:e,height:t}}var NDKStorySticker=(ne=class{constructor(e){p(this,"type");p(this,"value");p(this,"position");p(this,"dimension");p(this,"properties");p(this,"hasValidDimensions",()=>typeof this.dimension.width=="number"&&typeof this.dimension.height=="number"&&!Number.isNaN(this.dimension.width)&&!Number.isNaN(this.dimension.height));p(this,"hasValidPosition",()=>typeof this.position.x=="number"&&typeof this.position.y=="number"&&!Number.isNaN(this.position.x)&&!Number.isNaN(this.position.y));if(Array.isArray(e)){const t=e;if(t[0]!=="sticker"||t.length<5)throw new Error("Invalid sticker tag");this.type=t[1],this.value=t[2],this.position=strToPosition(t[3]),this.dimension=strToDimension(t[4]);const r={};for(let s=5;s<t.length;s++){const[o,...a]=t[s].split(" ");r[o]=a.join(" ")}Object.keys(r).length>0&&(this.properties=r)}else this.type=e,this.value=void 0,this.position={x:0,y:0},this.dimension={width:0,height:0}}static fromTag(e){try{return new ne(e)}catch{return null}}get style(){var e;return(e=this.properties)==null?void 0:e.style}set style(e){var t;e?this.properties={...this.properties,style:e}:(t=this.properties)==null||delete t.style}get rotation(){var e;return(e=this.properties)!=null&&e.rot?Number.parseFloat(this.properties.rot):void 0}set rotation(e){var t;e!==void 0?this.properties={...this.properties,rot:e.toString()}:(t=this.properties)==null||delete t.rot}get isValid(){return this.hasValidDimensions()&&this.hasValidPosition()}toTag(){if(!this.isValid){const r=[this.hasValidDimensions()?void 0:"dimensions is invalid",this.hasValidPosition()?void 0:"position is invalid"].filter(Boolean);throw new Error(`Invalid sticker: ${r.join(", ")}`)}let e;switch(this.type){case"event":e=this.value.tagId();break;case"pubkey":e=this.value.pubkey;break;default:e=this.value}const t=["sticker",this.type,e,coordinates(this.position),dimension(this.dimension)];if(this.properties)for(const[r,s]of Object.entries(this.properties))t.push(`${r} ${s}`);return t}},p(ne,"Text","text"),p(ne,"Pubkey","pubkey"),p(ne,"Event","event"),p(ne,"Prompt","prompt"),p(ne,"Countdown","countdown"),ne),NDKStory=(he=class extends NDKEvent{constructor(t,r){super(t,r);p(this,"_imeta");p(this,"_dimensions");if(this.kind??(this.kind=23),r)for(const s of r.tags)switch(s[0]){case"imeta":this._imeta=mapImetaTag(s);break;case"dim":this.dimensions=strToDimension(s[1]);break}}static from(t){return new he(t.ndk,t)}get isValid(){return!!this.imeta}get imeta(){return this._imeta}set imeta(t){this._imeta=t,this.tags=this.tags.filter(r=>r[0]!=="imeta"),t&&this.tags.push(imetaTagToTag(t))}get dimensions(){const t=this.tagValue("dim");if(t)return strToDimension(t)}set dimensions(t){this.removeTag("dim"),t&&this.tags.push(["dim",`${t.width}x${t.height}`])}get duration(){const t=this.tagValue("dur");if(t)return Number.parseInt(t)}set duration(t){this.removeTag("dur"),t!==void 0&&this.tags.push(["dur",t.toString()])}get stickers(){const t=[];for(const r of this.tags){if(r[0]!=="sticker"||r.length<5)continue;const s=NDKStorySticker.fromTag(r);s&&t.push(s)}return t}addSticker(t){let r;if(t instanceof NDKStorySticker)r=t;else{const s=["sticker",t.type,typeof t.value=="string"?t.value:"",coordinates(t.position),dimension(t.dimension)];if(t.properties)for(const[o,a]of Object.entries(t.properties))s.push(`${o} ${a}`);r=new NDKStorySticker(s),r.value=t.value}r.type==="pubkey"?this.tag(r.value):r.type==="event"&&this.tag(r.value),this.tags.push(r.toTag())}removeSticker(t){const r=this.stickers;if(t<0||t>=r.length)return;let s=0;for(let o=0;o<this.tags.length;o++)if(this.tags[o][0]==="sticker"){if(s===t){this.tags.splice(o,1);break}s++}}},p(he,"kind",23),p(he,"kinds",[23]),he),coordinates=n=>`${n.x},${n.y}`,dimension=n=>`${n.width}x${n.height}`,possibleIntervalFrequencies=["daily","weekly","monthly","quarterly","yearly"];function newAmount(n,e,t){return["amount",n.toString(),e,t]}function parseTagToSubscriptionAmount(n){const e=Number.parseInt(n[1]);if(Number.isNaN(e)||e===void 0||e===null||e<=0)return;const t=n[2];if(t===void 0||t==="")return;const r=n[3];if(r!==void 0&&possibleIntervalFrequencies.includes(r))return{amount:e,currency:t,term:r}}var NDKSubscriptionTier=(pe=class extends NDKArticle{constructor(e,t){const r=(t==null?void 0:t.kind)??37001;super(e,t),this.kind=r}static from(e){return new pe(e.ndk,e)}get perks(){return this.getMatchingTags("perk").map(e=>e[1]).filter(e=>e!==void 0)}addPerk(e){this.tags.push(["perk",e])}get amounts(){return this.getMatchingTags("amount").map(e=>parseTagToSubscriptionAmount(e)).filter(e=>e!==void 0)}addAmount(e,t,r){this.tags.push(newAmount(e,t,r))}set relayUrl(e){this.tags.push(["r",e])}get relayUrls(){return this.getMatchingTags("r").map(e=>e[1]).filter(e=>e!==void 0)}get verifierPubkey(){return this.tagValue("p")}set verifierPubkey(e){this.removeTag("p"),e&&this.tags.push(["p",e])}get isValid(){return this.title!==void 0&&this.amounts.length>0}},p(pe,"kind",37001),p(pe,"kinds",[37001]),pe),NDKVideo=(be=class extends NDKEvent{constructor(){super(...arguments);p(this,"_imetas")}static from(t){return new be(t.ndk,t.rawEvent())}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get thumbnail(){var r;let t;return this.imetas&&this.imetas.length>0&&(t=(r=this.imetas[0].image)==null?void 0:r[0]),t??this.tagValue("thumb")}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(t=>t[0]==="imeta").map(mapImetaTag),this._imetas)}set imetas(t){this._imetas=t,this.tags=this.tags.filter(r=>r[0]!=="imeta"),this.tags.push(...t.map(imetaTagToTag))}get url(){return this.imetas&&this.imetas.length>0?this.imetas[0].url:this.tagValue("url")}get published_at(){const t=this.tagValue("published_at");if(t)return Number.parseInt(t)}async generateTags(){var t,r;if(super.generateTags(),!this.kind&&(r=(t=this.imetas)==null?void 0:t[0])!=null&&r.dim){const[s,o]=this.imetas[0].dim.split("x"),a=s&&o&&Number.parseInt(s)<Number.parseInt(o);this.duration&&this.duration<120&&a?this.kind=22:this.kind=21}return super.generateTags()}get duration(){const t=this.tagValue("duration");if(t)return Number.parseInt(t)}set duration(t){this.removeTag("duration"),t!==void 0&&this.tags.push(["duration",Math.floor(t).toString()])}},p(be,"kind",21),p(be,"kinds",[34235,34236,22,21]),be),NDKWiki=(Ee=class extends NDKArticle{},p(Ee,"kind",30818),p(Ee,"kinds",[30818]),Ee);function wrapEvent(n){const e=new Map;for(const r of[NDKImage,NDKVideo,NDKCashuMintList,NDKArticle,NDKHighlight,NDKWiki,NDKNutzap,NDKSimpleGroupMemberList,NDKSimpleGroupMetadata,NDKSubscriptionTier,NDKCashuToken,NDKList,NDKStory])for(const s of r.kinds)e.set(s,r);const t=e.get(n.kind);return t?t.from(n):n}function queryFullyFilled(n){return!!(filterIncludesIds(n.filter)&&resultHasAllRequestedIds(n))}function filterIncludesIds(n){return!!n.ids}function resultHasAllRequestedIds(n){const e=n.filter.ids;return!!e&&e.length===n.eventFirstSeen.size}function filterFromId(n){let e;if(n.match(NIP33_A_REGEX)){const[t,r,s]=n.split(":"),o={authors:[r],kinds:[Number.parseInt(t)]};return s&&(o["#d"]=[s]),o}if(n.match(BECH32_REGEX))try{switch(e=nip19_exports.decode(n),e.type){case"nevent":{const t={ids:[e.data.id]};return e.data.author&&(t.authors=[e.data.author]),e.data.kind&&(t.kinds=[e.data.kind]),t}case"note":return{ids:[e.data]};case"naddr":{const t={authors:[e.data.pubkey],kinds:[e.data.kind]};return e.data.identifier&&(t["#d"]=[e.data.identifier]),t}}}catch(t){console.error("Error decoding",n,t)}return{ids:[n]}}function isNip33AValue(n){return n.match(NIP33_A_REGEX)!==null}var NIP33_A_REGEX=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,BECH32_REGEX=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;function relaysFromBech32(n,e){try{const t=nip19_exports.decode(n);if(["naddr","nevent"].includes(t==null?void 0:t.type)){const r=t.data;if(r!=null&&r.relays)return r.relays.map(s=>new NDKRelay(s,e.relayAuthDefaultPolicy,e))}}catch{}return[]}var defaultOpts$1={closeOnEose:!1,cacheUsage:"CACHE_FIRST",dontSaveToCache:!1,groupable:!0,groupableDelay:100,groupableDelayType:"at-most",cacheUnconstrainFilter:["limit","since","until"]},NDKSubscription=class extends lib$1.EventEmitter{constructor(e,t,r,s){super();p(this,"subId");p(this,"filters");p(this,"opts");p(this,"pool");p(this,"skipVerification",!1);p(this,"skipValidation",!1);p(this,"relayFilters");p(this,"relaySet");p(this,"ndk");p(this,"debug");p(this,"eventFirstSeen",new Map);p(this,"eosesSeen",new Set);p(this,"lastEventReceivedAt");p(this,"mostRecentCacheEventTimestamp");p(this,"internalId");p(this,"closeOnEose");p(this,"poolMonitor");p(this,"skipOptimisticPublishEvent",!1);p(this,"cacheUnconstrainFilter");p(this,"onStopped");p(this,"eoseTimeout");p(this,"eosed",!1);this.ndk=e,this.opts={...defaultOpts$1,...r||{}},this.pool=this.opts.pool||e.pool,this.filters=Array.isArray(t)?t:[t],this.subId=s||this.opts.subId,this.internalId=Math.random().toString(36).substring(7),this.debug=e.debug.extend(`subscription[${this.opts.subId??this.internalId}]`),this.opts.relaySet?this.relaySet=this.opts.relaySet:this.opts.relayUrls&&(this.relaySet=NDKRelaySet.fromRelayUrls(this.opts.relayUrls,this.ndk)),this.skipVerification=this.opts.skipVerification||!1,this.skipValidation=this.opts.skipValidation||!1,this.closeOnEose=this.opts.closeOnEose||!1,this.skipOptimisticPublishEvent=this.opts.skipOptimisticPublishEvent||!1,this.cacheUnconstrainFilter=this.opts.cacheUnconstrainFilter}relaysMissingEose(){var t;return this.relayFilters?Array.from((t=this.relayFilters)==null?void 0:t.keys()).filter(r=>!this.eosesSeen.has(this.pool.getRelay(r,!1,!1))):[]}get filter(){return this.filters[0]}get groupableDelay(){var e;if(this.isGroupable())return(e=this.opts)==null?void 0:e.groupableDelay}get groupableDelayType(){var e;return((e=this.opts)==null?void 0:e.groupableDelayType)||"at-most"}isGroupable(){var e;return((e=this.opts)==null?void 0:e.groupable)||!1}shouldQueryCache(){var t;return this.opts.addSinceFromCache?!0:((t=this.opts)==null?void 0:t.cacheUsage)==="ONLY_RELAY"?!1:(this.filters.some(r=>{var s;return(s=r.kinds)==null?void 0:s.some(o=>kindIsEphemeral(o))}),!0)}shouldQueryRelays(){var e;return((e=this.opts)==null?void 0:e.cacheUsage)!=="ONLY_CACHE"}shouldWaitForCache(){var e;return this.opts.addSinceFromCache?!0:this.opts.closeOnEose&&!!((e=this.ndk.cacheAdapter)!=null&&e.locking)&&this.opts.cacheUsage!=="PARALLEL"}start(e=!0){let t;const r=o=>{if(e)for(const a of o)(!this.mostRecentCacheEventTimestamp||a.created_at>this.mostRecentCacheEventTimestamp)&&(this.mostRecentCacheEventTimestamp=a.created_at),this.eventReceived(a,void 0,!0,!1);else{t=[];for(const a of o){(!this.mostRecentCacheEventTimestamp||a.created_at>this.mostRecentCacheEventTimestamp)&&(this.mostRecentCacheEventTimestamp=a.created_at),a.ndk=this.ndk;const u=this.opts.wrap?wrapEvent(a):a;if(!u)break;if(u instanceof Promise){u.then(c=>{this.emitEvent(!1,c,void 0,!0,!1)});break}this.eventFirstSeen.set(u.id,Date.now()),t.push(u)}}},s=()=>{this.shouldQueryRelays()?(this.startWithRelays(),this.startPoolMonitor()):this.emit("eose",this)};return this.shouldQueryCache()?(t=this.startWithCache(),t instanceof Promise?this.shouldWaitForCache()?(t.then(o=>{if(r(o),queryFullyFilled(this)){this.emit("eose",this);return}s()}),null):(t.then(o=>{r(o)}),s(),null):(r(t),queryFullyFilled(this)?this.emit("eose",this):s(),t)):(s(),null)}startPoolMonitor(){this.debug.extend("pool-monitor"),this.poolMonitor=e=>{var r,s;if((r=this.relayFilters)!=null&&r.has(e.url))return;calculateRelaySetsFromFilters(this.ndk,this.filters,this.pool).get(e.url)&&((s=this.relayFilters)==null||s.set(e.url,this.filters),e.subscribe(this,this.filters))},this.pool.on("relay:connect",this.poolMonitor)}stop(){var e;this.emit("close",this),this.poolMonitor&&this.pool.off("relay:connect",this.poolMonitor),(e=this.onStopped)==null||e.call(this)}hasAuthorsFilter(){return this.filters.some(e=>{var t;return(t=e.authors)==null?void 0:t.length})}startWithCache(){var e;return(e=this.ndk.cacheAdapter)!=null&&e.query?this.ndk.cacheAdapter.query(this):[]}startWithRelays(){let e=this.filters;if(this.opts.addSinceFromCache&&this.mostRecentCacheEventTimestamp){const t=this.mostRecentCacheEventTimestamp+1;e=e.map(r=>({...r,since:Math.max(r.since||0,t)}))}if(!this.relaySet||this.relaySet.relays.size===0)this.relayFilters=calculateRelaySetsFromFilters(this.ndk,e,this.pool);else{this.relayFilters=new Map;for(const t of this.relaySet.relays)this.relayFilters.set(t.url,e)}for(const[t,r]of this.relayFilters)this.pool.getRelay(t,!0,!0,r).subscribe(this,r)}eventReceived(e,t,r=!1,s=!1){var c;const o=e.id,a=this.eventFirstSeen.has(o);let u;if(e instanceof NDKEvent&&(u=e),a){const l=Date.now()-(this.eventFirstSeen.get(o)||0);if(this.emit("event:dup",e,t,l,this,r,s),t){const f=verifiedSignatures.get(o);f&&typeof f=="string"&&e.sig===f&&t.addValidatedEvent()}}else{if(u??(u=new NDKEvent(this.ndk,e)),u.ndk=this.ndk,u.relay=t,!r&&!s){if(!this.skipValidation&&!u.isValid){this.debug("Event failed validation %s from relay %s",o,t==null?void 0:t.url);return}if(t)if((t==null?void 0:t.shouldValidateEvent())!==!1){if(!this.skipVerification){if(!u.verifySignature(!0)&&!this.ndk.asyncSigVerification){this.debug("Event failed signature validation",e);return}t&&t.addValidatedEvent()}}else t.addNonValidatedEvent();this.ndk.cacheAdapter&&!this.opts.dontSaveToCache&&this.ndk.cacheAdapter.setEvent(u,this.filters,t)}(!s||this.skipOptimisticPublishEvent!==!0)&&(this.emitEvent(((c=this.opts)==null?void 0:c.wrap)??!1,u,t,r,s),this.eventFirstSeen.set(o,Date.now()))}this.lastEventReceivedAt=Date.now()}emitEvent(e,t,r,s,o){const a=e?wrapEvent(t):t;a instanceof Promise?a.then(u=>this.emitEvent(!1,u,r,s,o)):a&&this.emit("event",a,r,this,s,o)}closedReceived(e,t){this.emit("closed",e,t)}eoseReceived(e){var a;this.debug("EOSE received from %s",e.url),this.eosesSeen.add(e);let t=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0;const r=this.eosesSeen.size===((a=this.relayFilters)==null?void 0:a.size),s=queryFullyFilled(this),o=u=>{var c;this.debug("Performing EOSE: %s %d",u,this.eosed),!this.eosed&&(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.emit("eose",this),this.eosed=!0,(c=this.opts)!=null&&c.closeOnEose&&this.stop())};if(s||r)o("query filled or seen all");else if(this.relayFilters){let u=1e3;const c=new Set(this.pool.connectedRelays().map(h=>h.url)),l=Array.from(this.relayFilters.keys()).filter(h=>c.has(h));if(l.length===0){this.debug("No connected relays, waiting for all relays to connect",Array.from(this.relayFilters.keys()).join(", "));return}const f=this.eosesSeen.size/l.length;if(this.debug("Percentage of relays that have sent EOSE",{subId:this.subId,percentageOfRelaysThatHaveSentEose:f,seen:this.eosesSeen.size,total:l.length}),this.eosesSeen.size>=2&&f>=.5){if(u=u*(1-f),u===0){o("time to wait was 0");return}this.eoseTimeout&&clearTimeout(this.eoseTimeout);const h=()=>{t=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,t!==void 0&&t<20?this.eoseTimeout=setTimeout(h,u):o(`send eose timeout: ${u}`)};this.eoseTimeout=setTimeout(h,u)}}}},kindIsEphemeral=n=>n>=2e4&&n<3e4;async function follows(n,e,t=3){var s,o;if(!this.ndk)throw new Error("NDK not set");const r=await this.ndk.fetchEvent({kinds:[t],authors:[this.pubkey]},n||{groupable:!1});if(r){const a=new Set;return r.tags.forEach(u=>{u[0]==="p"&&a.add(u[1])}),e&&((o=(s=this.ndk)==null?void 0:s.outboxTracker)==null||o.trackUsers(Array.from(a))),[...a].reduce((u,c)=>{const l=new NDKUser({pubkey:c});return l.ndk=this.ndk,u.add(l),u},new Set)}return new Set}var NIP05_REGEX=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function getNip05For(n,e,t=fetch,r={}){return await n.queuesNip05.add({id:e,func:async()=>{var c,l,f;if((c=n.cacheAdapter)!=null&&c.loadNip05){const h=await n.cacheAdapter.loadNip05(e);if(h!=="missing"){if(h){const g=new NDKUser({pubkey:h.pubkey,relayUrls:h.relays,nip46Urls:h.nip46});return g.ndk=n,g}if(r.cache!=="no-cache")return null}}const s=e.match(NIP05_REGEX);if(!s)return null;const[o,a="_",u]=s;try{const h=await t(`https://${u}/.well-known/nostr.json?name=${a}`,r),{names:g,relays:m,nip46:v}=parseNIP05Result(await h.json()),b=g[a.toLowerCase()];let y=null;return b&&(y={pubkey:b,relays:m==null?void 0:m[b],nip46:v==null?void 0:v[b]}),(l=n==null?void 0:n.cacheAdapter)!=null&&l.saveNip05&&n.cacheAdapter.saveNip05(e,y),y}catch(h){return(f=n==null?void 0:n.cacheAdapter)!=null&&f.saveNip05&&(n==null||n.cacheAdapter.saveNip05(e,null)),console.error("Failed to fetch NIP05 for",e,h),null}}})}function parseNIP05Result(n){const e={names:{}};for(const[t,r]of Object.entries(n.names))typeof t=="string"&&typeof r=="string"&&(e.names[t.toLowerCase()]=r);if(n.relays){e.relays={};for(const[t,r]of Object.entries(n.relays))typeof t=="string"&&Array.isArray(r)&&(e.relays[t]=r.filter(s=>typeof s=="string"))}if(n.nip46){e.nip46={};for(const[t,r]of Object.entries(n.nip46))typeof t=="string"&&Array.isArray(r)&&(e.nip46[t]=r.filter(s=>typeof s=="string"))}return e}function profileFromEvent(n){const e={};let t;try{t=JSON.parse(n.content)}catch(r){throw new Error(`Failed to parse profile event: ${r}`)}e.created_at=n.created_at,e.profileEvent=JSON.stringify(n.rawEvent());for(const r of Object.keys(t))switch(r){case"name":e.name=t.name;break;case"display_name":e.displayName=t.display_name;break;case"image":case"picture":e.picture=t.picture||t.image,e.image=e.picture;break;case"banner":e.banner=t.banner;break;case"bio":e.bio=t.bio;break;case"nip05":e.nip05=t.nip05;break;case"lud06":e.lud06=t.lud06;break;case"lud16":e.lud16=t.lud16;break;case"about":e.about=t.about;break;case"website":e.website=t.website;break;default:e[r]=t[r];break}return e}function serializeProfile(n){const e={};for(const[t,r]of Object.entries(n))switch(t){case"username":case"name":e.name=r;break;case"displayName":e.display_name=r;break;case"image":case"picture":e.picture=r;break;case"bio":case"about":e.about=r;break;default:e[t]=r;break}return JSON.stringify(e)}var NDKUser=class Re{constructor(e){p(this,"ndk");p(this,"profile");p(this,"profileEvent");p(this,"_npub");p(this,"_pubkey");p(this,"relayUrls",[]);p(this,"nip46Urls",[]);p(this,"follows",follows.bind(this));if(e.npub&&(this._npub=e.npub),e.hexpubkey&&(this._pubkey=e.hexpubkey),e.pubkey&&(this._pubkey=e.pubkey),e.relayUrls&&(this.relayUrls=e.relayUrls),e.nip46Urls&&(this.nip46Urls=e.nip46Urls),e.nprofile)try{const t=nip19_exports.decode(e.nprofile);t.type==="nprofile"&&(this._pubkey=t.data.pubkey,t.data.relays&&t.data.relays.length>0&&this.relayUrls.push(...t.data.relays))}catch(t){console.error("Failed to decode nprofile",t)}}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=nip19_exports.npubEncode(this.pubkey)}return this._npub}get nprofile(){var t,r;const e=(r=(t=this.profileEvent)==null?void 0:t.onRelays)==null?void 0:r.map(s=>s.url);return nip19_exports.nprofileEncode({pubkey:this.pubkey,relays:e})}set npub(e){this._npub=e}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=nip19_exports.decode(this.npub).data}return this._pubkey}set pubkey(e){this._pubkey=e}filter(){return{"#p":[this.pubkey]}}async getZapInfo(e){if(!this.ndk)throw new Error("No NDK instance found");const t=async a=>{if(!e)return a;let u;const c=new Promise((l,f)=>{u=setTimeout(()=>f(new Error("Timeout")),e)});try{const l=await Promise.race([a,c]);return u&&clearTimeout(u),l}catch(l){if(l instanceof Error&&l.message==="Timeout")try{return await a}catch{return}return}},[r,s]=await Promise.all([t(this.fetchProfile()),t(this.ndk.fetchEvent({kinds:[10019],authors:[this.pubkey]}))]),o=new Map;if(s){const a=NDKCashuMintList.from(s);a.mints.length>0&&o.set("nip61",{mints:a.mints,relays:a.relays,p2pk:a.p2pk})}if(r){const{lud06:a,lud16:u}=r;o.set("nip57",{lud06:a,lud16:u})}return o}static async fromNip05(e,t,r=!1){if(!t)throw new Error("No NDK instance found");const s={};r&&(s.cache="no-cache");const o=await getNip05For(t,e,t==null?void 0:t.httpFetch,s);if(o){const a=new Re({pubkey:o.pubkey,relayUrls:o.relays,nip46Urls:o.nip46});return a.ndk=t,a}}async fetchProfile(e,t=!1){if(!this.ndk)throw new Error("NDK not set");let r=null;if(this.ndk.cacheAdapter&&(this.ndk.cacheAdapter.fetchProfile||this.ndk.cacheAdapter.fetchProfileSync)&&(e==null?void 0:e.cacheUsage)!=="ONLY_RELAY"){let s=null;if(this.ndk.cacheAdapter.fetchProfileSync?s=this.ndk.cacheAdapter.fetchProfileSync(this.pubkey):this.ndk.cacheAdapter.fetchProfile&&(s=await this.ndk.cacheAdapter.fetchProfile(this.pubkey)),s)return this.profile=s,s}return e??(e={}),e.cacheUsage??(e.cacheUsage="ONLY_RELAY"),e.closeOnEose??(e.closeOnEose=!0),e.groupable??(e.groupable=!0),e.groupableDelay??(e.groupableDelay=250),r||(r=await this.ndk.fetchEvent({kinds:[0],authors:[this.pubkey]},e)),r?(this.profile=profileFromEvent(r),t&&this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile):null}async followSet(e,t,r=3){const s=await this.follows(e,t,r);return new Set(Array.from(s).map(o=>o.pubkey))}tagReference(){return["p",this.pubkey]}referenceTags(e){const t=[["p",this.pubkey]];return e&&t[0].push("",e),t}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner(),await new NDKEvent(this.ndk,{kind:0,content:serializeProfile(this.profile)}).publish()}async follow(e,t,r=3){if(!this.ndk)throw new Error("No NDK instance found");if(this.ndk.assertSigner(),t||(t=await this.follows(void 0,void 0,r)),t.has(e))return!1;t.add(e);const s=new NDKEvent(this.ndk,{kind:r});for(const o of t)s.tag(o);return await s.publish(),!0}async unfollow(e,t,r=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),t||(t=await this.follows(void 0,void 0,r));const s=new Set;let o=!1;for(const u of t)u.pubkey!==e.pubkey?s.add(u):o=!0;if(!o)return!1;const a=new NDKEvent(this.ndk,{kind:r});for(const u of s)a.tag(u);return await a.publish()}async validateNip05(e){if(!this.ndk)throw new Error("No NDK instance found");const t=await getNip05For(this.ndk,e);return t===null?null:t.pubkey===this.pubkey}},READ_MARKER="read",WRITE_MARKER="write",NDKRelayList=class Be extends NDKEvent{constructor(e,t){super(e,t),this.kind??(this.kind=10002)}static from(e){return new Be(e.ndk,e.rawEvent())}get readRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]||e[2]&&e[2]===READ_MARKER).map(e=>tryNormalizeRelayUrl(e[1])).filter(e=>!!e)}set readRelayUrls(e){for(const t of e)this.tags.push(["r",t,READ_MARKER])}get writeRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]||e[2]&&e[2]===WRITE_MARKER).map(e=>tryNormalizeRelayUrl(e[1])).filter(e=>!!e)}set writeRelayUrls(e){for(const t of e)this.tags.push(["r",t,WRITE_MARKER])}get bothRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]).map(e=>e[1])}set bothRelayUrls(e){for(const t of e)this.tags.push(["r",t])}get relays(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").map(e=>e[1])}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new NDKRelaySet(new Set(this.relays.map(e=>{var t;return(t=this.ndk)==null?void 0:t.pool.getRelay(e)}).filter(e=>!!e)),this.ndk)}};function relayListFromKind3(n,e){try{const t=JSON.parse(e.content),r=new NDKRelayList(n),s=new Set,o=new Set;for(let[a,u]of Object.entries(t)){try{a=normalizeRelayUrl(a)}catch{continue}if(!u)s.add(a),o.add(a);else{const c=u;c.write&&o.add(a),c.read&&s.add(a)}}return r.readRelayUrls=Array.from(s),r.writeRelayUrls=Array.from(o),r}catch{}}var NDKPrivateKeySigner=class ke{constructor(e,t){p(this,"_user");p(this,"_privateKey");p(this,"_pubkey");if(typeof e=="string")if(e.startsWith("nsec1")){const{type:r,data:s}=nip19_exports.decode(e);if(r==="nsec")this._privateKey=s;else throw new Error("Invalid private key provided.")}else if(e.length===64)this._privateKey=hexToBytes$1(e);else throw new Error("Invalid private key provided.");else this._privateKey=e;this._pubkey=getPublicKey(this._privateKey),t&&(this._user=t.getUser({pubkey:this._pubkey})),this._user??(this._user=new NDKUser({pubkey:this._pubkey}))}get privateKey(){if(!this._privateKey)throw new Error("Not ready");return bytesToHex$1(this._privateKey)}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}get nsec(){if(!this._privateKey)throw new Error("Not ready");return nip19_exports.nsecEncode(this._privateKey)}get npub(){if(!this._pubkey)throw new Error("Not ready");return nip19_exports.npubEncode(this._pubkey)}static generate(){const e=generateSecretKey();return new ke(e)}async blockUntilReady(){return this._user}async user(){return this._user}get userSync(){return this._user}async sign(e){if(!this._privateKey)throw Error("Attempted to sign without a private key");return finalizeEvent(e,this._privateKey).sig}async encryptionEnabled(e){const t=[];return(!e||e==="nip04")&&t.push("nip04"),(!e||e==="nip44")&&t.push("nip44"),t}async encrypt(e,t,r){if(!this._privateKey||!this.privateKey)throw Error("Attempted to encrypt without a private key");const s=e.pubkey;if(r==="nip44"){const o=nip44_exports.v2.utils.getConversationKey(this._privateKey,s);return await nip44_exports.v2.encrypt(t,o)}return await nip04_exports.encrypt(this._privateKey,s,t)}async decrypt(e,t,r){if(!this._privateKey||!this.privateKey)throw Error("Attempted to decrypt without a private key");const s=e.pubkey;if(r==="nip44"){const o=nip44_exports.v2.utils.getConversationKey(this._privateKey,s);return await nip44_exports.v2.decrypt(t,o)}return await nip04_exports.decrypt(this._privateKey,s,t)}toPayload(){if(!this._privateKey)throw new Error("Private key not available");const e={type:"private-key",payload:this.privateKey};return JSON.stringify(e)}static async fromPayload(e,t){const r=JSON.parse(e);if(r.type!=="private-key")throw new Error(`Invalid payload type: expected 'private-key', got ${r.type}`);if(!r.payload||typeof r.payload!="string")throw new Error("Invalid payload content for private-key signer");return new ke(r.payload,t)}};function disconnect(n,e){return e??(e=createDebug5("ndk:relay:auth-policies:disconnect")),async t=>{e==null||e(`Relay ${t.url} requested authentication, disconnecting`),n.removeRelay(t.url)}}async function signAndAuth(n,e,t,r,s,o){try{await n.sign(t),s(n)}catch(a){r==null||r(`Failed to publish auth event to relay ${e.url}`,a),o(n)}}function signIn({ndk:n,signer:e,debug:t}={}){return t??(t=createDebug5("ndk:auth-policies:signIn")),async(r,s)=>{t==null||t(`Relay ${r.url} requested authentication, signing in`);const o=new NDKEvent(n);return o.kind=22242,o.tags=[["relay",r.url],["challenge",s]],e??(e=n==null?void 0:n.signer),new Promise(async(a,u)=>{e?await signAndAuth(o,r,e,t,a,u):n==null||n.once("signer:ready",async c=>{await signAndAuth(o,r,c,t,a,u)})})}}var NDKRelayAuthPolicies={disconnect,signIn},NDKNip07Signer=class Ie{constructor(e=1e3,t){p(this,"_userPromise");p(this,"encryptionQueue",[]);p(this,"encryptionProcessing",!1);p(this,"debug");p(this,"waitTimeout");p(this,"_pubkey");p(this,"ndk");p(this,"_user");this.debug=createDebug5("ndk:nip07"),this.waitTimeout=e,this.ndk=t}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}async blockUntilReady(){var r;await this.waitForExtension();const e=await((r=window.nostr)==null?void 0:r.getPublicKey());if(!e)throw new Error("User rejected access");this._pubkey=e;let t;return this.ndk?t=this.ndk.getUser({pubkey:e}):t=new NDKUser({pubkey:e}),this._user=t,t}async user(){return this._userPromise||(this._userPromise=this.blockUntilReady()),this._userPromise}get userSync(){if(!this._user)throw new Error("User not ready");return this._user}async sign(e){var r;await this.waitForExtension();const t=await((r=window.nostr)==null?void 0:r.signEvent(e));if(!t)throw new Error("Failed to sign event");return t.sig}async relays(e){var s,o;await this.waitForExtension();const t=await((o=(s=window.nostr)==null?void 0:s.getRelays)==null?void 0:o.call(s))||{},r=[];for(const a of Object.keys(t))t[a].read&&t[a].write&&r.push(a);return r.map(a=>new NDKRelay(a,e==null?void 0:e.relayAuthDefaultPolicy,e))}async encryptionEnabled(e){var r,s;const t=[];return(!e||e==="nip04")&&((r=window.nostr)!=null&&r.nip04)&&t.push("nip04"),(!e||e==="nip44")&&((s=window.nostr)!=null&&s.nip44)&&t.push("nip44"),t}async encrypt(e,t,r="nip04"){if(!await this.encryptionEnabled(r))throw new Error(`${r}encryption is not available from your browser extension`);await this.waitForExtension();const s=e.pubkey;return this.queueEncryption(r,"encrypt",s,t)}async decrypt(e,t,r="nip04"){if(!await this.encryptionEnabled(r))throw new Error(`${r}encryption is not available from your browser extension`);await this.waitForExtension();const s=e.pubkey;return this.queueEncryption(r,"decrypt",s,t)}async queueEncryption(e,t,r,s){return new Promise((o,a)=>{this.encryptionQueue.push({scheme:e,method:t,counterpartyHexpubkey:r,value:s,resolve:o,reject:a}),this.encryptionProcessing||this.processEncryptionQueue()})}async processEncryptionQueue(e,t=0){var f,h;if(!e&&this.encryptionQueue.length===0){this.encryptionProcessing=!1;return}this.encryptionProcessing=!0;const r=e||this.encryptionQueue.shift();if(!r){this.encryptionProcessing=!1;return}const{scheme:s,method:o,counterpartyHexpubkey:a,value:u,resolve:c,reject:l}=r;this.debug("Processing encryption queue item",{method:o,counterpartyHexpubkey:a,value:u});try{const g=await((h=(f=window.nostr)==null?void 0:f[s])==null?void 0:h[o](a,u));if(!g)throw new Error("Failed to encrypt/decrypt");c(g)}catch(g){const m=g instanceof Error?g.message:String(g);if(m.includes("call already executing")&&t<5){this.debug("Retrying encryption queue item",{method:o,counterpartyHexpubkey:a,value:u,retries:t}),setTimeout(()=>{this.processEncryptionQueue(r,t+1)},50*t);return}l(g instanceof Error?g:new Error(m))}this.processEncryptionQueue()}waitForExtension(){return new Promise((e,t)=>{if(window.nostr){e();return}let r;const s=setInterval(()=>{window.nostr&&(clearTimeout(r),clearInterval(s),e())},100);r=setTimeout(()=>{clearInterval(s),t(new Error("NIP-07 extension not available"))},this.waitTimeout)})}toPayload(){return JSON.stringify({type:"nip07",payload:""})}static async fromPayload(e,t){const r=JSON.parse(e);if(r.type!=="nip07")throw new Error(`Invalid payload type: expected 'nip07', got ${r.type}`);return new Ie(void 0,t)}},NDKNostrRpc=class extends lib$1.EventEmitter{constructor(e,t,r,s){super();p(this,"ndk");p(this,"signer");p(this,"relaySet");p(this,"debug");p(this,"encryptionType","nip04");p(this,"pool");if(this.ndk=e,this.signer=t,s){this.pool=new NDKPool(s,[],e,{debug:r.extend("rpc-pool"),name:"Nostr RPC"}),this.relaySet=new NDKRelaySet(new Set,e,this.pool);for(const o of s){const a=this.pool.getRelay(o,!1,!1);a.authPolicy=NDKRelayAuthPolicies.signIn({ndk:e,signer:t,debug:r}),this.relaySet.addRelay(a),a.connect()}}this.debug=r.extend("rpc")}subscribe(e){const t=this.ndk.subscribe(e,{closeOnEose:!1,groupable:!1,cacheUsage:"ONLY_RELAY",pool:this.pool,relaySet:this.relaySet},!1);return t.on("event",async r=>{try{const s=await this.parseEvent(r);s.method?this.emit("request",s):this.emit(`response-${s.id}`,s)}catch(s){this.debug("error parsing event",s,r.rawEvent())}}),new Promise(r=>{t.on("eose",()=>{this.debug("eosed"),r(t)}),t.start()})}async parseEvent(e){this.encryptionType==="nip44"&&e.content.includes("?iv=")?this.encryptionType="nip04":this.encryptionType==="nip04"&&!e.content.includes("?iv=")&&(this.encryptionType="nip44");const t=this.ndk.getUser({pubkey:e.pubkey});t.ndk=this.ndk;let r;try{r=await this.signer.decrypt(t,e.content,this.encryptionType)}catch{const h=this.encryptionType==="nip04"?"nip44":"nip04";r=await this.signer.decrypt(t,e.content,h),this.encryptionType=h}const s=JSON.parse(r),{id:o,method:a,params:u,result:c,error:l}=s;return a?{id:o,pubkey:e.pubkey,method:a,params:u,event:e}:{id:o,result:c,error:l,event:e}}async sendResponse(e,t,r,s=24133,o){const a={id:e,result:r};o&&(a.error=o);const u=await this.signer.user(),c=this.ndk.getUser({pubkey:t}),l=new NDKEvent(this.ndk,{kind:s,content:JSON.stringify(a),tags:[["p",t]],pubkey:u.pubkey});l.content=await this.signer.encrypt(c,l.content,this.encryptionType),await l.sign(this.signer),await l.publish(this.relaySet)}async sendRequest(e,t,r=[],s=24133,o){const a=Math.random().toString(36).substring(7),u=await this.signer.user(),c=this.ndk.getUser({pubkey:e}),l={id:a,method:t,params:r},f=new Promise(()=>{const g=m=>{m.result==="auth_url"?(this.once(`response-${a}`,g),this.emit("authUrl",m.error)):o&&o(m)};this.once(`response-${a}`,g)}),h=new NDKEvent(this.ndk,{kind:s,content:JSON.stringify(l),tags:[["p",e]],pubkey:u.pubkey});return h.content=await this.signer.encrypt(c,h.content,this.encryptionType),await h.sign(this.signer),await h.publish(this.relaySet),f}},signerRegistry=new Map;signerRegistry.set("private-key",NDKPrivateKeySigner),signerRegistry.set("nip07",NDKNip07Signer),signerRegistry.set("nip46",NDKNip46Signer);async function ndkSignerFromPayload(n,e){let t;try{t=JSON.parse(n)}catch(s){throw new Error(`Failed to parse signer payload: ${s instanceof Error?s.message:String(s)}`)}const r=signerRegistry.get(t.type);if(!r)throw new Error(`Unknown signer type: ${t.type}`);try{return await r.fromPayload(n,e)}catch(s){const o=s instanceof Error?s.message:String(s);throw new Error(`Failed to deserialize signer type ${t.type}: ${o}`)}}var NDKNip46Signer=class _e extends lib$1.EventEmitter{constructor(t,r,s){super();p(this,"ndk");p(this,"_user");p(this,"bunkerPubkey");p(this,"userPubkey");p(this,"secret");p(this,"localSigner");p(this,"nip05");p(this,"rpc");p(this,"debug");p(this,"relayUrls");p(this,"subscription");this.ndk=t,this.debug=t.debug.extend("nip46:signer"),r.startsWith("bunker://")?this.connectionTokenInit(r):this.nip05Init(r),s?this.localSigner=s:this.localSigner=NDKPrivateKeySigner.generate(),this.rpc=new NDKNostrRpc(this.ndk,this.localSigner,this.debug,this.relayUrls)}get pubkey(){if(!this.userPubkey)throw new Error("Not ready");return this.userPubkey}connectionTokenInit(t){const r=new URL(t),s=r.hostname||r.pathname.replace(/^\/\//,""),o=r.searchParams.get("pubkey"),a=r.searchParams.getAll("relay"),u=r.searchParams.get("secret");this.bunkerPubkey=s,this.userPubkey=o,this.relayUrls=a,this.secret=u}nip05Init(t){this.nip05=t}async startListening(){if(this.subscription)return;const t=await this.localSigner.user();if(!t)throw new Error("Local signer not ready");this.subscription=await this.rpc.subscribe({kinds:[24133],"#p":[t.pubkey]})}async user(){return this._user?this._user:this.blockUntilReady()}get userSync(){if(!this._user)throw new Error("Remote user not ready synchronously");return this._user}async blockUntilReady(){if(this.nip05&&!this.userPubkey){const t=await NDKUser.fromNip05(this.nip05,this.ndk);t&&(this._user=t,this.userPubkey=t.pubkey,this.relayUrls=t.nip46Urls,this.rpc=new NDKNostrRpc(this.ndk,this.localSigner,this.debug,this.relayUrls))}if(!this.bunkerPubkey&&this.userPubkey)this.bunkerPubkey=this.userPubkey;else if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");return await this.startListening(),this.rpc.on("authUrl",(...t)=>{this.emit("authUrl",...t)}),new Promise((t,r)=>{const s=[this.userPubkey??""];if(this.secret&&s.push(this.secret),!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"connect",s,24133,o=>{o.result==="ack"?this.getPublicKey().then(a=>{this.userPubkey=a,this._user=this.ndk.getUser({pubkey:a}),t(this._user)}):r(o.error)})})}async getPublicKey(){return this.userPubkey?this.userPubkey:new Promise((t,r)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"get_public_key",[],24133,s=>{t(s.result)})})}async encryptionEnabled(t){return t?[t]:Promise.resolve(["nip04","nip44"])}async encrypt(t,r,s="nip04"){return this.encryption(t,r,s,"encrypt")}async decrypt(t,r,s="nip04"){return this.encryption(t,r,s,"decrypt")}async encryption(t,r,s,o){return new Promise((u,c)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,`${s}_${o}`,[t.pubkey,r],24133,l=>{l.error?c(l.error):u(l.result)})})}async sign(t){return new Promise((s,o)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"sign_event",[JSON.stringify(t)],24133,a=>{if(a.error)o(a.error);else{const u=JSON.parse(a.result);s(u.sig)}})})}async createAccount(t,r,s){await this.startListening();const o=[];return t&&o.push(t),r&&o.push(r),s&&o.push(s),new Promise((a,u)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"create_account",o,24133,c=>{if(c.error)u(c.error);else{const l=c.result;a(l)}})})}toPayload(){if(!this.bunkerPubkey||!this.userPubkey)throw new Error("NIP-46 signer is not fully initialized for serialization");const t={type:"nip46",payload:{bunkerPubkey:this.bunkerPubkey,userPubkey:this.userPubkey,relayUrls:this.relayUrls,secret:this.secret,localSignerPayload:this.localSigner.toPayload(),nip05:this.nip05||null}};return JSON.stringify(t)}static async fromPayload(t,r){if(!r)throw new Error("NDK instance is required to deserialize NIP-46 signer");const s=JSON.parse(t);if(s.type!=="nip46")throw new Error(`Invalid payload type: expected 'nip46', got ${s.type}`);const o=s.payload;if(!o||typeof o!="object"||!o.localSignerPayload)throw new Error("Invalid payload content for nip46 signer");const a=await ndkSignerFromPayload(o.localSignerPayload,r);if(!a)throw new Error("Failed to deserialize local signer for NIP-46");let u;return o.nip05?(u=new _e(r,o.nip05,a),u.userPubkey=o.userPubkey,u.bunkerPubkey=o.bunkerPubkey,u.relayUrls=o.relayUrls,u.secret=o.secret):(u=new _e(r,o.userPubkey,a),u.bunkerPubkey=o.bunkerPubkey,u.relayUrls=o.relayUrls,u.secret=o.secret),u}};function dedup(n,e){return n.created_at>e.created_at?n:e}async function getRelayListForUser(n,e){return(await getRelayListForUsers([n],e)).get(n)}async function getRelayListForUsers(n,e,t=!1,r=1e3){var h;const s=e.outboxPool||e.pool,o=new Set;for(const g of s.relays.values())o.add(g);const a=new Map,u=new Map,c=new NDKRelaySet(o,e);if((h=e.cacheAdapter)!=null&&h.locking&&!t){const g=await e.fetchEvents({kinds:[3,10002],authors:Array.from(new Set(n))},{cacheUsage:"ONLY_CACHE",subId:"ndk-relay-list-fetch"});for(const m of g)m.kind===10002&&a.set(m.pubkey,NDKRelayList.from(m));for(const m of g)if(m.kind===3){if(a.has(m.pubkey))continue;const v=relayListFromKind3(e,m);v&&u.set(m.pubkey,v)}n=n.filter(m=>!a.has(m)&&!u.has(m))}if(n.length===0)return a;const l=new Map,f=new Map;return new Promise(g=>{(async()=>{const v={closeOnEose:!0,pool:s,groupable:!0,subId:"ndk-relay-list-fetch",addSinceFromCache:!0,relaySet:c};c&&(v.relaySet=c),e.subscribe({kinds:[3,10002],authors:n},v,{onEvent:b=>{if(b.kind===10002){const y=l.get(b.pubkey);if(y&&y.created_at>b.created_at)return;l.set(b.pubkey,b)}else if(b.kind===3){const y=f.get(b.pubkey);if(y&&y.created_at>b.created_at)return;f.set(b.pubkey,b)}},onEose:()=>{for(const b of l.values())a.set(b.pubkey,NDKRelayList.from(b));for(const b of n){if(a.has(b))continue;const y=f.get(b);if(!y)continue;const w=relayListFromKind3(e,y);w&&a.set(b,w)}g(a)}}),setTimeout(()=>{g(a)},r)})()})}var OutboxItem=class{constructor(n){p(this,"type");p(this,"relayUrlScores");p(this,"readRelays");p(this,"writeRelays");this.type=n,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},OutboxTracker=class extends lib$1.EventEmitter{constructor(e){super();p(this,"data");p(this,"ndk");p(this,"debug");this.ndk=e,this.debug=e.debug.extend("outbox-tracker"),this.data=new dist.LRUCache({maxSize:1e5,entryExpirationTimeInMS:2*60*1e3})}async trackUsers(e,t=!1){const r=[];for(let s=0;s<e.length;s+=400){const a=e.slice(s,s+400).map(u=>getKeyFromItem(u)).filter(u=>!this.data.has(u));if(a.length!==0){for(const u of a)this.data.set(u,new OutboxItem("user"));r.push(new Promise(u=>{getRelayListForUsers(a,this.ndk,t).then(c=>{for(const[l,f]of c){let h=this.data.get(l);if(h??(h=new OutboxItem("user")),f){h.readRelays=new Set(normalize(f.readRelayUrls)),h.writeRelays=new Set(normalize(f.writeRelayUrls));for(const g of h.readRelays)this.ndk.pool.blacklistRelayUrls.has(g)&&h.readRelays.delete(g);for(const g of h.writeRelays)this.ndk.pool.blacklistRelayUrls.has(g)&&h.writeRelays.delete(g);this.data.set(l,h)}}}).finally(u)}))}}return Promise.all(r)}track(e,t,r=!0){const s=getKeyFromItem(e);t??(t=getTypeFromItem(e));let o=this.data.get(s);return o||(o=new OutboxItem(t),e instanceof NDKUser&&this.trackUsers([e])),o}};function getKeyFromItem(n){return n instanceof NDKUser?n.pubkey:n}function getTypeFromItem(n){return n instanceof NDKUser?"user":"kind"}function correctRelaySet(n,e){const t=e.connectedRelays();if(!Array.from(n.relays).some(s=>t.map(o=>o.url).includes(s.url)))for(const s of t)n.addRelay(s);if(t.length===0)for(const s of e.relays.values())n.addRelay(s);return n}var NDKSubscriptionManager=class{constructor(){p(this,"subscriptions");p(this,"seenEvents",new Map);this.subscriptions=new Map}add(n){this.subscriptions.set(n.internalId,n),n.onStopped,n.onStopped=()=>{this.subscriptions.delete(n.internalId)},n.on("close",()=>{this.subscriptions.delete(n.internalId)})}seenEvent(n,e){const t=this.seenEvents.get(n)||[];t.push(e),this.seenEvents.set(n,t)}dispatchEvent(n,e,t=!1){e&&this.seenEvent(n.id,e);const r=this.subscriptions.values(),s=[];for(const o of r)matchFilters(o.filters,n)&&s.push(o);for(const o of s)o.eventReceived(n,e,!1,t)}},debug6=createDebug5("ndk:active-user");async function getUserRelayList(n){if(!this.autoConnectUserRelays)return;const e=await getRelayListForUser(n.pubkey,this);if(e){for(const t of e.relays){let r=this.pool.relays.get(t);r||(r=new NDKRelay(t,this.relayAuthDefaultPolicy,this),this.pool.addRelay(r))}return e}}async function setActiveUser(n){const e=this.outboxPool||this.pool;e.connectedRelays.length>0?setActiveUserConnected.call(this,n):e.once("connect",()=>{setActiveUserConnected.call(this,n)})}async function setActiveUserConnected(n){var o;const e=await getUserRelayList.call(this,n),t=[{kinds:[10006],authors:[n.pubkey]}];this.autoFetchUserMutelist&&((o=t[0].kinds)==null||o.push(1e4));const r=new Map,s=e?e.relaySet:void 0;this.subscribe(t,{subId:"active-user-settings",closeOnEose:!0,relaySet:s},{onEvent:a=>{const u=r.get(a.kind);u&&u.created_at>=a.created_at||r.set(a.kind,a)},onEose:()=>{for(const a of r.values())processEvent.call(this,a)}})}async function processEvent(n){n.kind===10006?processBlockRelayList.call(this,n):n.kind===1e4&&processMuteList.call(this,n)}function processBlockRelayList(n){const e=lists_default.from(n);for(const t of e.items)this.pool.blacklistRelayUrls.add(t[0]);debug6("Added %d relays to relay blacklist",e.items.length)}function processMuteList(n){const e=lists_default.from(n);for(const t of e.items)this.mutedIds.set(t[1],t[0]);debug6("Added %d users to mute list",e.items.length)}function getEntity(n){try{const e=nip19_exports.decode(n);return e.type==="npub"?npub(this,e.data):e.type==="nprofile"?nprofile(this,e.data):e}catch{return null}}function npub(n,e){return n.getUser({pubkey:e})}function nprofile(n,e){const t=n.getUser({pubkey:e.pubkey});return e.relays&&(t.relayUrls=e.relays),t}function isValidHint(n){if(!n||n==="")return!1;try{return new URL(n),!0}catch{return!1}}async function fetchEventFromTag(n,e,t,r={type:"timeout"}){const s=this.debug.extend("fetch-event-from-tag"),[o,a,u]=n;t={},s("fetching event from tag",n,t,r);const c=getRelaysForSync(this,e.pubkey);if(c&&c.size>0){s("fetching event from author relays %o",Array.from(c));const b=NDKRelaySet.fromRelayUrls(Array.from(c),this),y=await this.fetchEvent(a,t,b);if(y)return y}else s("no author relays found for %s",e.pubkey,e);const l=calculateRelaySetsFromFilters(this,[{ids:[a]}],this.pool);s("fetching event without relay hint",l);const f=await this.fetchEvent(a,t);if(f)return f;if(u&&u!==""){const b=await this.fetchEvent(a,t,this.pool.getRelay(u,!0,!0,[{ids:[a]}]));if(b)return b}let h;const g=isValidHint(u)?this.pool.getRelay(u,!1,!0,[{ids:[a]}]):void 0,m=new Promise(b=>{this.fetchEvent(a,t,g).then(b)});if(!isValidHint(u)||r.type==="none")return m;const v=new Promise(async b=>{const y=r.relaySet,w=r.timeout??1500,S=new Promise(B=>setTimeout(B,w));if(r.type==="timeout"&&await S,h)b(h);else{s("fallback fetch triggered");const B=await this.fetchEvent(a,t,y);b(B)}});switch(r.type){case"timeout":return Promise.race([m,v]);case"eose":return h=await m,h||v}}var Queue=class{constructor(n,e){p(this,"queue",[]);p(this,"maxConcurrency");p(this,"processing",new Set);p(this,"promises",new Map);this.maxConcurrency=e}add(n){if(this.promises.has(n.id))return this.promises.get(n.id);const e=new Promise((t,r)=>{this.queue.push({...n,func:()=>n.func().then(s=>(t(s),s),s=>{throw r(s),s})}),this.process()});return this.promises.set(n.id,e),e.finally(()=>{this.promises.delete(n.id),this.processing.delete(n.id),this.process()}),e}process(){if(this.processing.size>=this.maxConcurrency||this.queue.length===0)return;const n=this.queue.shift();!n||this.processing.has(n.id)||(this.processing.add(n.id),n.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},DEFAULT_OUTBOX_RELAYS=["wss://purplepag.es/","wss://nos.lol/"],DEFAULT_BLACKLISTED_RELAYS=["wss://brb.io/","wss://nostr.mutinywallet.com/"],NDK=class extends lib$1.EventEmitter{constructor(e={}){super();p(this,"_explicitRelayUrls");p(this,"blacklistRelayUrls");p(this,"pool");p(this,"outboxPool");p(this,"_signer");p(this,"_activeUser");p(this,"cacheAdapter");p(this,"debug");p(this,"devWriteRelaySet");p(this,"outboxTracker");p(this,"mutedIds");p(this,"clientName");p(this,"clientNip89");p(this,"queuesZapConfig");p(this,"queuesNip05");p(this,"asyncSigVerification",!1);p(this,"initialValidationRatio",1);p(this,"lowestValidationRatio",1);p(this,"validationRatioFn");p(this,"subManager");p(this,"publishingFailureHandled",!1);p(this,"pools",[]);p(this,"relayAuthDefaultPolicy");p(this,"httpFetch");p(this,"netDebug");p(this,"autoConnectUserRelays",!0);p(this,"autoFetchUserMutelist",!0);p(this,"walletConfig");p(this,"fetchEventFromTag",fetchEventFromTag.bind(this));p(this,"getEntity",getEntity.bind(this));this.debug=e.debug||createDebug5("ndk"),this.netDebug=e.netDebug,this._explicitRelayUrls=e.explicitRelayUrls||[],this.blacklistRelayUrls=e.blacklistRelayUrls||DEFAULT_BLACKLISTED_RELAYS,this.subManager=new NDKSubscriptionManager,this.pool=new NDKPool(e.explicitRelayUrls||[],[],this),this.pool.name="Main",this.pool.on("relay:auth",async(t,r)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(t,r)}),this.autoConnectUserRelays=e.autoConnectUserRelays??!0,this.autoFetchUserMutelist=e.autoFetchUserMutelist??!0,this.clientName=e.clientName,this.clientNip89=e.clientNip89,this.relayAuthDefaultPolicy=e.relayAuthDefaultPolicy,e.enableOutboxModel&&(this.outboxPool=new NDKPool(e.outboxRelayUrls||DEFAULT_OUTBOX_RELAYS,[],this,{debug:this.debug.extend("outbox-pool"),name:"Outbox Pool"}),this.outboxTracker=new OutboxTracker(this)),this.signer=e.signer,this.cacheAdapter=e.cacheAdapter,this.mutedIds=e.mutedIds||new Map,e.devWriteRelayUrls&&(this.devWriteRelaySet=NDKRelaySet.fromRelayUrls(e.devWriteRelayUrls,this)),this.queuesZapConfig=new Queue("zaps",3),this.queuesNip05=new Queue("nip05",10),this.signatureVerificationWorker=e.signatureVerificationWorker,this.initialValidationRatio=e.initialValidationRatio||1,this.lowestValidationRatio=e.lowestValidationRatio||1;try{this.httpFetch=fetch}catch{}}set explicitRelayUrls(e){this._explicitRelayUrls=e.map(normalizeRelayUrl),this.pool.relayUrls=e}get explicitRelayUrls(){return this._explicitRelayUrls||[]}set signatureVerificationWorker(e){this.asyncSigVerification=!!e,e&&signatureVerificationInit(e)}addExplicitRelay(e,t,r=!0){var o;let s;return typeof e=="string"?s=new NDKRelay(e,t,this):s=e,this.pool.addRelay(s,r),(o=this.explicitRelayUrls)==null||o.push(s.url),s}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(e){var r;const t=((r=this._activeUser)==null?void 0:r.pubkey)!==(e==null?void 0:e.pubkey);this._activeUser=e,e&&t?setActiveUser.call(this,e):e||(this.mutedIds=new Map)}get signer(){return this._signer}set signer(e){this._signer=e,e&&this.emit("signer:ready",e),e==null||e.user().then(t=>{t.ndk=this,this.activeUser=t})}async connect(e){var r,s;this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer %o",await((s=(r=this._signer).relays)==null?void 0:s.call(r,this))),this._signer.relays&&(await this._signer.relays(this)).forEach(a=>this.pool.addRelay(a)));const t=[this.pool.connect(e)];return this.outboxPool&&t.push(this.outboxPool.connect(e)),this.debug("Connecting to relays %o",{timeoutMs:e}),Promise.allSettled(t).then(()=>{})}getUser(e){const t=new NDKUser(e);return t.ndk=this,t}async getUserFromNip05(e,t=!1){return NDKUser.fromNip05(e,this,t)}subscribe(e,t,r=!0){var a;const s=new NDKSubscription(this,e,t);this.subManager.add(s);const o=s.pool;if(s.relaySet)for(const u of s.relaySet.relays)o.useTemporaryRelay(u,void 0,s.filters);if(this.outboxPool&&s.hasAuthorsFilter()){const u=s.filters.filter(c=>{var l;return c.authors&&((l=c.authors)==null?void 0:l.length)>0}).flatMap(c=>c.authors);(a=this.outboxTracker)==null||a.trackUsers(u)}if(r){let u;typeof r=="object"&&(r.onEvent&&s.on("event",r.onEvent),r.onEose&&s.on("eose",r.onEose),r.onEvents&&(u=r.onEvents)),setTimeout(()=>{const c=s.start(!u);c&&c.length>0&&u&&u(c)},0)}return s}async publish(e,t,r){return this.debug("Deprecated: Use `event.publish()` instead"),e.publish(t,r)}fetchEventSync(e){if(!this.cacheAdapter)throw new Error("Cache adapter not set");let t;typeof e=="string"?t=[filterFromId(e)]:t=e;const r=new NDKSubscription(this,t),s=this.cacheAdapter.query(r);if(s instanceof Promise)throw new Error("Cache adapter is async");return s.map(o=>(o.ndk=this,o))}async fetchEvent(e,t,r){let s,o;if(r instanceof NDKRelay?o=new NDKRelaySet(new Set([r]),this):r instanceof NDKRelaySet&&(o=r),!r&&typeof e=="string"&&!isNip33AValue(e)){const a=relaysFromBech32(e,this);a.length>0&&(o=new NDKRelaySet(new Set(a),this),o=correctRelaySet(o,this.pool))}if(typeof e=="string"?s=[filterFromId(e)]:Array.isArray(e)?s=e:s=[e],s.length===0)throw new Error(`Invalid filter: ${JSON.stringify(e)}`);return new Promise(a=>{let u=null;const c={...t||{},closeOnEose:!0};o&&(c.relaySet=o);const l=this.subscribe(s,c,!1),f=setTimeout(()=>{l.stop(),a(u)},1e4);l.on("event",h=>{h.ndk=this,h.isReplaceable()?(!u||u.created_at<h.created_at)&&(u=h):(clearTimeout(f),a(h))}),l.on("eose",()=>{clearTimeout(f),a(u)}),l.start()})}async fetchEvents(e,t,r){return new Promise(s=>{const o=new Map,a={...t||{},closeOnEose:!0};r&&(a.relaySet=r);const u=this.subscribe(e,a,!1),c=l=>{let f;l instanceof NDKEvent?f=l:f=new NDKEvent(void 0,l);const h=f.deduplicationKey(),g=o.get(h);g&&(f=dedup(g,f)),f.ndk=this,o.set(h,f)};u.on("event",c),u.on("eose",()=>{s(new Set(o.values()))}),u.start()})}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}set wallet(e){var t,r;if(!e){this.walletConfig=void 0;return}this.walletConfig??(this.walletConfig={}),this.walletConfig.lnPay=(t=e==null?void 0:e.lnPay)==null?void 0:t.bind(e),this.walletConfig.cashuPay=(r=e==null?void 0:e.cashuPay)==null?void 0:r.bind(e)}};createDebug5("ndk:zapper:ln"),createDebug5("ndk:zapper");function maskNPub(n="",e=3){const t=n.length;if(t!==63)return"Invalid nPub";let r="npub1";for(let o=5;o<e+5;o++)r+=n[o];r+="...";let s="";for(let o=t-1;o>=t-e;o--)s=n[o]+s;return r+=s,r}async function getPostStats(n,e){const t=await n.fetchEvents({kinds:[NDKKind.Repost],"#e":[e||""]}),r=Array.from(t).filter(c=>c.tags.filter(f=>f[0]==="p").length===1).length,s=await n.fetchEvents({kinds:[NDKKind.Reaction],"#e":[e||""]}),o=0,a=await n.fetchEvents({kinds:[NDKKind.Text],"#e":[e||""]}),u=Array.from(a).filter(c=>c.tags.filter(f=>f[0]==="e").length===1).length;return{likes:s.size,reposts:r,zaps:o/1e3,replies:u}}function escapeHtml(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function renderNpub(n,e,t){var s;if(t==="false"||t===null&&((s=n==null?void 0:n.profile)!=null&&s.nip05))return"";const r=e||(n==null?void 0:n.npub);return r?`
    <div class="npub-container">
      <span class="npub">${maskNPub(r)}</span>
      <span id="npub-copy" class="copy-button">&#x2398;</span>
    </div>
  `:(console.warn("Cannot use showNpub without providing a nPub"),"")}function renderProfileBadge(n,e,t,r,s,o,a){let u="";if(n)u=`
      <div class='nostr-profile-badge-container'>
        <div class='nostr-profile-badge-left-container'>
          <div class="skeleton img-skeleton"></div>
        </div>
        <div class='nostr-profile-badge-right-container'>
          <div class="skeleton text-skeleton-name"></div>
          <div class="skeleton text-skeleton-nip05"></div>
        </div>
      </div>
    `;else if(e)u=`
      <div class='nostr-profile-badge-container'>
        <div class='nostr-profile-badge-left-container'>
          <div class="error">&#9888;</div>
        </div>
        <div class='nostr-profile-badge-right-container'>
          <span class="error-text">Unable to load</span>
        </div>
      </div>
    `;else if(t){const c=t.displayName||t.name||maskNPub((r==null?void 0:r.npub)||""),l=t.image||"./assets/default_dp.png";u=`
      <div class='nostr-profile-badge-container'>
        <div class='nostr-profile-badge-left-container'>
          <img src='${escapeHtml(l)}' alt='Nostr profile image of ${escapeHtml(c)}'/>
        </div>
        <div class='nostr-profile-badge-right-container'>
          <div class='nostr-profile-badge-name' title="${escapeHtml(c)}">${escapeHtml(c)}</div>
          ${t.nip05?`<div class='nostr-profile-badge-nip05' title="${escapeHtml(t.nip05)}">${escapeHtml(t.nip05)}</div>`:""}
          ${o==="true"?renderNpub(r,s?escapeHtml(s):null,o):""}
          ${a==="true"&&(r!=null&&r.pubkey)?`<nostr-follow-button pubkey="${escapeHtml(r.pubkey)}"></nostr-follow-button>`:""}
        </div>
      </div>
    `}else u='<div class="error-text">Error: Profile data unavailable.</div>';return u}function getProfileBadgeStyles(n){return`
    <style>
      :host {
        /* Define CSS variables on the host element */
        --nstrc-profile-badge-background: var(--nstrc-profile-badge-background-${n});
        --nstrc-profile-badge-name-color: var(--nstrc-profile-badge-name-color-${n});
        --nstrc-profile-badge-nip05-color: var(--nstrc-profile-badge-nip05-color-${n});
        --nstrc-profile-badge-text-color: var(--nstrc-profile-badge-text-color-${n});
        --nstrc-profile-badge-skeleton-min-hsl: var(--nstrc-profile-badge-skeleton-min-hsl-${n});
        --nstrc-profile-badge-skeleton-max-hsl: var(--nstrc-profile-badge-skeleton-max-hsl-${n});
        --nstrc-profile-badge-border: var(--nstrc-profile-badge-border-${n});
        --nstrc-profile-badge-hover-background: var(--nstrc-profile-badge-hover-background-${n});
        display: block;
        contain: content;
      }

      :host(.dark) {
        --nstrc-profile-badge-background: var(--nstrc-profile-badge-background-dark);
        --nstrc-profile-badge-name-color: var(--nstrc-profile-badge-name-color-dark);
        --nstrc-profile-badge-nip05-color: var(--nstrc-profile-badge-nip05-color-dark);
        --nstrc-profile-badge-text-color: var(--nstrc-profile-badge-text-color-dark);
        --nstrc-profile-badge-skeleton-min-hsl: var(--nstrc-profile-badge-skeleton-min-hsl-dark);
        --nstrc-profile-badge-skeleton-max-hsl: var(--nstrc-profile-badge-skeleton-max-hsl-dark);
        --nstrc-profile-badge-border: var(--nstrc-profile-badge-border-dark);
        --nstrc-profile-badge-hover-background: var(--nstrc-profile-badge-hover-background-dark);
      }

      .nostr-profile-badge-wrapper {
        /* Wrapper to contain all the component's content */
        display: block;
        width: 100%;
        height: 100%;
      }

      .nostr-profile-badge-container {
        display: flex;
        gap: 12px;
        padding: 8px;
        border-radius: 8px;
        background-color: var(--nstrc-profile-badge-background);
        border: var(--nstrc-profile-badge-border, none);
        cursor: pointer;
        transition: background-color 0.2s ease;
        box-sizing: border-box;
      }

      .nostr-profile-badge-container:hover {
        background-color: var(--nstrc-profile-badge-hover-background, rgba(0, 0, 0, 0.05));
      }

      .nostr-profile-badge-left-container {
        width: 48px;
        height: 48px;
        flex-shrink: 0;
      }

      .nostr-profile-badge-left-container img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
      }

      .nostr-profile-badge-right-container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        flex-grow: 1;
        min-width: 0;
      }

      .nostr-profile-badge-name {
        font-weight: 600;
        font-size: 16px;
        color: var(--nstrc-profile-badge-name-color, #000);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .nostr-profile-badge-nip05 {
        font-size: 14px;
        color: var(--nstrc-profile-badge-nip05-color, #666);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .npub-container {
        display: flex;
        align-items: center;
        gap: 4px;
        font-family: monospace;
        font-size: 12px;
        color: var(--nstrc-profile-badge-text-color, #666);
      }

      .copy-button {
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.2s;
      }

      .copy-button:hover {
        opacity: 1;
      }

      /* Skeleton loading styles */
      .skeleton {
        background: linear-gradient(
          90deg,
          var(--nstrc-profile-badge-skeleton-min-hsl, #f0f0f0) 0%,
          var(--nstrc-profile-badge-skeleton-max-hsl, #e0e0e0) 50%,
          var(--nstrc-profile-badge-skeleton-min-hsl, #f0f0f0) 100%
        );
        background-size: 200% 100%;
        animation: skeleton-loading 1.5s infinite;
        border-radius: 4px;
      }

      .img-skeleton {
        width: 48px;
        height: 48px;
        border-radius: 50% !important;
      }

      .text-skeleton-name {
        width: 120px;
        height: 16px;
        margin-bottom: 6px;
      }

      .text-skeleton-nip05 {
        width: 80px;
        height: 14px;
      }

      @keyframes skeleton-loading {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      /* Error state */
      .error {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background-color: #ffebee;
        color: #d32f2f;
        font-size: 24px;
      }

      .error-text {
        color: #d32f2f;
        font-size: 14px;
      }
    </style>
  `}const we=class we{constructor(){p(this,"ndk");p(this,"isConnected",!1);this.ndk=new NDK}static getInstance(){return we.instance||(we.instance=new we),we.instance}async connectToNostr(e=DEFAULT_RELAYS){this.isConnected||(this.ndk.explicitRelayUrls=e,await this.ndk.connect(),this.isConnected=!0)}getRelays(){return this.ndk.explicitRelayUrls||DEFAULT_RELAYS}async getProfile(e){let t=null;if(e.npub)t=this.ndk.getUser({npub:e.npub});else if(e.nip05){const r=await this.ndk.getUserFromNip05(e.nip05);r&&(t=r)}else e.pubkey&&(t=this.ndk.getUser({pubkey:e.pubkey}));return t?(await t.fetchProfile(),t.profile):null}async getPost(e){const t=await this.ndk.fetchEvent(e);if(!t)return null;const r=t.getMatchingTags("e");if(r.length>0){const o=r.map(a=>a[1]);await this.ndk.fetchEvents({ids:o})}const s=t.getMatchingTags("a");for(const o of s){const a=o[1],u=o[2];a!=null&&a.startsWith("video/")&&u&&(t.content=t.content+`
${u}`)}return t}async getProfileStats(e,t){const r={follows:0,followers:0,notes:0,replies:0,zaps:0,relays:0},s=!t||t.length===0,o=a=>s||(t==null?void 0:t.includes(a));try{if(this.isConnected||await this.connectToNostr(),o("follows"))try{console.log("Fetching follows for user:",e.npub);const u=await e.follows(),c=Array.from(u.values());r.follows=c.length,console.log("Follows count:",r.follows)}catch(u){console.warn("Error fetching follows:",u)}if(o("followers"))try{console.log("Fetching followers for user:",e.npub);const u=await this.ndk.fetchEvents({kinds:[NDKKind.Contacts],"#p":[e.pubkey]}),c=Array.from(u).filter(Boolean);r.followers=c.length,console.log("Followers count:",r.followers)}catch(u){console.warn("Error fetching followers:",u)}if(o("notes")||o("replies"))try{console.log("Fetching notes and replies for user:",e.npub);const u=await this.ndk.fetchEvents({kinds:[NDKKind.Text],authors:[e.pubkey],limit:1e3});let c=0,l=0;u.forEach(f=>{f&&(f.tags.some(g=>g[0]==="e"&&g[3]!=="mention")&&c++,l++)}),r.replies=c,r.notes=Math.max(0,l-c),console.log("Notes:",r.notes,"Replies:",r.replies)}catch(u){console.warn("Error fetching notes and replies:",u)}if(o("zaps"))try{console.log("Fetching zaps for user:",e.npub);const u=await this.ndk.fetchEvents({kinds:[9735],"#p":[e.pubkey],limit:1e3});r.zaps=Array.from(u).filter(Boolean).length,console.log("Zaps count:",r.zaps)}catch(u){console.warn("Error fetching zaps:",u)}if(r.relays=0,console.log("Final stats:",r),s)return r;const a={};return t!=null&&t.includes("follows")&&(a.follows=r.follows),t!=null&&t.includes("followers")&&(a.followers=r.followers),t!=null&&t.includes("notes")&&(a.notes=r.notes),t!=null&&t.includes("replies")&&(a.replies=r.replies),t!=null&&t.includes("zaps")&&(a.zaps=r.zaps),t!=null&&t.includes("relays")&&(a.relays=r.relays),{follows:a.follows??0,followers:a.followers??0,notes:a.notes??0,replies:a.replies??0,zaps:a.zaps??0,relays:a.relays??0}}catch(a){return console.error("Error in getProfileStats:",a),{follows:0,followers:0,notes:0,replies:0,zaps:0,relays:0}}}getNDK(){return this.ndk}};p(we,"instance");let NostrService=we;class NostrProfileBadge extends HTMLElement{constructor(){super();p(this,"rendered",!1);p(this,"nostrService",NostrService.getInstance());p(this,"userProfile",{name:"",image:"",nip05:""});p(this,"theme","light");p(this,"isLoading",!0);p(this,"isError",!1);p(this,"onClick",null);p(this,"ndkUser",null);p(this,"shadow");p(this,"getRelays",()=>{const t=this.getAttribute("relays");return t?t.split(","):DEFAULT_RELAYS});p(this,"getNDKUser",async()=>{const t=this.getAttribute("npub"),r=this.getAttribute("nip05"),s=this.getAttribute("pubkey");return t?this.nostrService.getNDK().getUser({npub:t}):r?this.nostrService.getNDK().getUserFromNip05(r):s?this.nostrService.getNDK().getUser({pubkey:s}):null});p(this,"getUserProfile",async()=>{try{this.isLoading=!0,this.render();const t=await this.getNDKUser();if(t!=null&&t.npub){this.ndkUser=t;const r=await this.nostrService.getProfile({npub:t.npub,nip05:this.getAttribute("nip05")||void 0,pubkey:this.getAttribute("pubkey")||void 0});r?(this.userProfile=r,this.userProfile.image||(this.userProfile.image="./assets/default_dp.png"),this.isError=!1):(console.warn(`Could not fetch profile initially for user ${t.npub}`),this.userProfile.image||(this.userProfile.image="./assets/default_dp.png"),this.isError=!1)}else throw new Error("Either npub or nip05 should be provided")}catch(t){throw this.isError=!0,t}finally{this.isLoading=!1,this.render()}});p(this,"getTheme",async()=>{this.theme="light";const t=this.getAttribute("theme");if(t){if(!["light","dark"].includes(t))throw new Error(`Invalid theme '${t}'. Accepted values are 'light', 'dark'`);this.theme=t}});this.shadow=this.attachShadow({mode:"open"})}async connectedCallback(){const t=this.getAttribute("onClick");t!==null&&(this.onClick=window[t]),this.rendered||(this.getTheme(),await this.nostrService.connectToNostr(this.getRelays()),this.getUserProfile(),this.rendered=!0)}static get observedAttributes(){return["relays","npub","pubkey","nip05","theme","show-npub","show-follow","onClick"]}attributeChangedCallback(t,r,s){t==="relays"&&this.nostrService.connectToNostr(this.getRelays()),["relays","npub","nip05"].includes(t)&&this.getUserProfile(),t==="onClick"&&(this.onClick=window[s]),t==="theme"&&(this.getTheme(),this.render()),["show-npub","show-follow"].includes(t)&&this.render()}disconnectedCallback(){}copy(t){navigator.clipboard.writeText(t)}onProfileClick(){if(this.isError)return;if(this.onClick!==null&&typeof this.onClick=="function"){this.onClick(this.userProfile);return}let t="";const r=this.getAttribute("nip05"),s=this.getAttribute("npub");if(r)t=r;else if(s)t=s;else return;window.open(`https://njump.me/${t}`,"_blank")}attachEventListeners(){const t=this.shadow.querySelector(".nostr-profile-badge-container"),r=this.shadow.querySelector("#npub-copy"),s=this.shadow.querySelector("#nip05-copy");t==null||t.addEventListener("click",o=>{o.target.closest(".nostr-follow-button-container")||this.onProfileClick()}),r==null||r.addEventListener("click",o=>{var a;o.stopPropagation(),this.copy(this.getAttribute("npub")||((a=this.ndkUser)==null?void 0:a.npub)||"")}),s==null||s.addEventListener("click",o=>{o.stopPropagation(),this.copy(this.getAttribute("nip05")||this.userProfile.nip05||"")})}render(){this.isLoading===!1&&this.userProfile&&this.userProfile.image===void 0&&(this.userProfile.image="./assets/default_dp.png"),this.classList.toggle("dark",this.theme==="dark"),this.classList.toggle("loading",this.isLoading),this.classList.toggle("error-container",this.isError);const t=this.getAttribute("show-npub"),r=this.getAttribute("show-follow"),s=this.getAttribute("npub"),o=renderProfileBadge(this.isLoading,this.isError,this.userProfile,this.ndkUser,s,t,r);this.shadow.innerHTML=`
      ${getProfileBadgeStyles(this.theme)}
      <div class="nostr-profile-badge-wrapper">
        ${o}
      </div>
    `,this.attachEventListeners()}}customElements.define("nostr-profile-badge",NostrProfileBadge);const replyIcon=`
  <svg width="18" height="18" fill="#00b3ff">
    <path xmlns="http://www.w3.org/2000/svg" d="M12.2197 1.65717C7.73973 1.25408 5.14439 0.940234 3.12891 2.6623C0.948817 4.52502 0.63207 7.66213 2.35603 9.88052C3.01043 10.7226 4.28767 11.9877 5.51513 13.1462C6.75696 14.3184 7.99593 15.426 8.60692 15.9671C8.61074 15.9705 8.61463 15.9739 8.61859 15.9774C8.67603 16.0283 8.74753 16.0917 8.81608 16.1433C8.89816 16.2052 9.01599 16.2819 9.17334 16.3288C9.38253 16.3912 9.60738 16.3912 9.81656 16.3288C9.97391 16.2819 10.0917 16.2052 10.1738 16.1433C10.2424 16.0917 10.3139 16.0283 10.3713 15.9774C10.3753 15.9739 10.3792 15.9705 10.383 15.9671C10.994 15.426 12.2329 14.3184 13.4748 13.1462C14.7022 11.9877 15.9795 10.7226 16.6339 9.88052C18.3512 7.67065 18.0834 4.50935 15.8532 2.65572C13.8153 0.961905 11.2476 1.25349 9.49466 2.78774Z"/>
  </svg>
`,heartIcon=`
  <svg width="18" height="18">
    <g xmlns="http://www.w3.org/2000/svg">
      <path fill="#ff006d" d="M12.2197 1.65717C7.73973 1.25408 5.14439 0.940234 3.12891 2.6623C0.948817 4.52502 0.63207 7.66213 2.35603 9.88052C3.01043 10.7226 4.28767 11.9877 5.51513 13.1462C6.75696 14.3184 7.99593 15.426 8.60692 15.9671C8.61074 15.9705 8.61463 15.9739 8.61859 15.9774C8.67603 16.0283 8.74753 16.0917 8.81608 16.1433C8.89816 16.2052 9.01599 16.2819 9.17334 16.3288C9.38253 16.3912 9.60738 16.3912 9.81656 16.3288C9.97391 16.2819 10.0917 16.2052 10.1738 16.1433C10.2424 16.0917 10.3139 16.0283 10.3713 15.9774C10.3753 15.9739 10.3792 15.9705 10.383 15.9671C10.994 15.426 12.2329 14.3184 13.4748 13.1462C14.7022 11.9877 15.9795 10.7226 16.6339 9.88052C18.3512 7.67065 18.0834 4.50935 15.8532 2.65572C13.8153 0.961905 11.2476 1.25349 9.49466 2.78774Z"/>
    </g>
  </svg>
`,copyIcon=`
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM19 21H8V7H19V21Z" fill="currentColor"/>
  </svg>
`,checkmarkIcon=(n="dark",e=25,t=25)=>`
  <svg 
    class="checkmark" 
    xmlns="http://www.w3.org/2000/svg" 
    viewBox="0 0 52 52"
    width="${e}"
    height="${t}"
    role="img"
    aria-label="Success checkmark"
  >
    <style>
      .checkmark__circle {
        stroke-dasharray: 166;
        stroke-dashoffset: 166;
        stroke-width: 2;
        stroke-miterlimit: 10;
        stroke: #4bb71b;
        fill: none;
        animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
      }

      .checkmark {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        display: block;
        stroke-width: 3;
        stroke: #4bb71b;
        stroke-miterlimit: 10;
        margin: 0 auto;
        animation: fill 0.4s ease-in-out 0.4s forwards, scale 0.3s ease-in-out 0.9s both;
      }

      .checkmark__check {
        transform-origin: 50% 50%;
        stroke-dasharray: 48;
        stroke-dashoffset: 48;
        animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
      }

      @keyframes stroke {
        100% { stroke-dashoffset: 0; }
      }

      @keyframes scale {
        0%, 100% { transform: none; }
        50% { transform: scale3d(1.1, 1.1, 1); }
      }

      @keyframes fill {
        100% { box-shadow: inset 0 0 0 30px ${n==="dark"?"#FFF":"#000"}; }
      }
    </style>
    <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="${n==="dark"?"#FFF":"#000"}"/>
    <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
  </svg>
`,nostrLogo=(n=21,e=24)=>`
  <svg 
    width="${n}" 
    height="${e}" 
    viewBox="0 0 21 24" 
    fill="none" 
    xmlns="http://www.w3.org/2000/svg"
    role="img"
    aria-label="Nostr logo"
  >
    <path d="M17.7084 10.1607C18.1683 13.3466 14.8705 14.0207 12.9733 13.9618C12.8515 13.958 12.7366 14.0173 12.6647 14.1157C12.4684 14.384 12.1547 14.7309 11.9125 14.7309C11.6405 14.7309 11.3957 15.254 11.284 15.5795C11.2723 15.6137 11.3059 15.6452 11.3403 15.634C14.345 14.6584 15.5241 14.3238 16.032 14.4178C16.4421 14.4937 17.209 15.8665 17.5413 16.5434C16.7155 16.5909 16.4402 15.8507 16.2503 15.7178C16.0985 15.6116 16.0415 16.0974 16.032 16.3536C15.8517 16.2587 15.6239 16.1259 15.6049 15.7178C15.5859 15.3098 15.3771 15.4142 15.2157 15.4332C15.0544 15.4521 12.5769 16.2493 12.2067 16.3536C11.8366 16.458 11.4094 16.6004 11.0582 16.8471C10.4697 17.1318 10.09 16.9325 9.98561 16.4485C9.90208 16.0614 10.4444 14.8701 10.726 14.3229C10.3779 14.4526 9.65529 14.7158 9.54898 14.7309C9.44588 14.7457 8.13815 15.7552 7.43879 16.3038C7.398 16.3358 7.37174 16.3827 7.36236 16.4336C7.25047 17.0416 6.89335 17.2118 6.27423 17.5303C5.77602 17.7867 4.036 20.4606 3.14127 21.9041C3.0794 22.0039 2.9886 22.0806 2.8911 22.1461C2.32279 22.5276 1.74399 23.4985 1.50923 23.9737C1.17511 23.0095 1.61048 22.1802 1.86993 21.886C1.75602 21.7873 1.49341 21.8449 1.37634 21.886C1.69907 20.7757 2.82862 20.7757 2.790"/>
  </svg>
`,loadingNostrich=(n=25,e=25,t="dark")=>`
  <svg width="${n}" height="${e}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <style>
      @keyframes nostrich-run {
        0% { transform: translateX(0) rotate(0deg); }
        20% { transform: translateX(10px) rotate(5deg); }
        40% { transform: translateX(0) rotate(0deg); }
        60% { transform: translateX(-10px) rotate(-5deg); }
        80% { transform: translateX(0) rotate(0deg); }
        100% { transform: translateX(0) rotate(0deg); }
      }
      .nostrich {
        animation: nostrich-run 1.5s infinite ease-in-out;
        transform-origin: center;
        fill: ${t==="dark"?"#fff":"#000"};
      }
    </style>
    <g class="nostrich">
      <path d="M17.7084 10.1607C18.1683 13.3466 14.8705 14.0207 12.9733 13.9618C12.8515 13.958 12.7366 14.0173 12.6647 14.1157C12.4684 14.384 12.1547 14.7309 11.9125 14.7309C11.6405 14.7309 11.3957 15.254 11.284 15.5795C11.2723 15.6137 11.3059 15.6452 11.3403 15.634C14.345 14.6584 15.5241 14.3238 16.032 14.4178C16.4421 14.4937 17.209 15.8665 17.5413 16.5434C16.7155 16.5909 16.4402 15.8507 16.2503 15.7178C16.0985 15.6116 16.0415 16.0974 16.032 16.3536C15.8517 16.2587 15.6239 16.1259 15.6049 15.7178C15.5859 15.3098 15.3771 15.4142 15.2157 15.4332C15.0544 15.4521 12.5769 16.2493 12.2067 16.3536C11.8366 16.458 11.4094 16.6004 11.0582 16.8471C10.4697 17.1318 10.09 16.9325 9.98561 16.4485C9.90208 16.0614 10.4444 14.8701 10.726 14.3229C10.3779 14.4526 9.65529 14.7158 9.54898 14.7309C9.44588 14.7457 8.13815 15.7552 7.43879 16.3038C7.398 16.3358 7.37174 16.3827 7.36236 16.4336C7.25047 17.0416 6.89335 17.2118 6.27423 17.5303C5.77602 17.7867 4.036 20.4606 3.14127 21.9041C3.0794 22.0039 2.9886 22.0806 2.8911 22.1461C2.32279 22.5276 1.74399 23.4985 1.50923 23.9737C1.17511 23.0095 1.61048 22.1802 1.86993 21.886C1.75602 21.7873 1.49341 21.8449 1.37634 21.886C1.69907 20.7757 2.82862 20.7757 2.790" fill="currentColor"/>
    </g>
  </svg>
`;function getNostrLogo(n=21,e=24){return nostrLogo(n,e)}function getLoadingNostrich(n="dark",e=25,t=25){return loadingNostrich(e,t,n)}function getSuccessAnimation(n="dark",e=25,t=25){return checkmarkIcon(n,e,t)}function getPostStylesLegacy(n){let e="";return n==="dark"?e=`
        --nstrc-post-background: var(--nstrc-post-background-dark);
        --nstrc-post-name-color: var(--nstrc-post-name-color-dark);
        --nstrc-post-nip05-color: var(--nstrc-post-nip05-color-dark);
        --nstrc-post-skeleton-min-hsl: var(--nstrc-post-skeleton-min-hsl-dark);
        --nstrc-post-skeleton-max-hsl: var(--nstrc-post-skeleton-max-hsl-dark);
        --nstrc-post-text-color: var(--nstrc-post-text-color-dark);
        --nstrc-post-stats-color: var(--nstrc-post-stat-text-color-dark);
        `:e=`
        --nstrc-post-background: var(--nstrc-post-background-light);
        --nstrc-post-name-color: var(--nstrc-post-name-color-light);
        --nstrc-post-nip05-color: var(--nstrc-post-nip05-color-light);
        --nstrc-post-skeleton-min-hsl: var(--nstrc-post-skeleton-min-hsl-light);
        --nstrc-post-skeleton-max-hsl: var(--nstrc-post-skeleton-max-hsl-light);
        --nstrc-post-text-color: var(--nstrc-post-text-color-light);
        --nstrc-post-stats-color: var(--nstrc-post-stat-text-color-light);
      `,`
          <style>
            nostr-post { /* Use host tag selector for scoping */
              --nstrc-post-background-light: #f5f5f5;
              --nstrc-post-background-dark: #000000;
              --nstrc-post-name-color-light: #444;
              --nstrc-post-name-color-dark: #CCC;
              --nstrc-post-nip05-color-light: #808080;
              --nstrc-post-nip05-color-dark: #757575;
              --nstrc-post-skeleton-min-hsl-light: 200, 20%, 80%;
              --nstrc-post-skeleton-min-hsl-dark: 200, 20%, 20%;
              --nstrc-post-skeleton-max-hsl-light: 200, 20%, 95%;
              --nstrc-post-skeleton-max-hsl-dark: 200, 20%, 30%;
              --nstrc-post-text-color-light: #222;
              --nstrc-post-text-color-dark: #d4d4d4;
              --nstrc-post-stat-text-color-light: #222;
              --nstrc-post-stat-text-color-dark: #d0d0d0;

              --nstrc-post-name-font-weight: 700;
              --nstrc-post-nip05-font-weight: 400;

              --nstrc-post-accent: #ca077c;

              ${e}
            }
            
            nostr-post a { /* Scope link color */
              color: var(--nstrc-post-accent);
            }

            /* Keep other styles targeting elements within nostr-post */
            nostr-post .post-container {
                font-family: sans-serif;
                padding: 20px;

                display: flex;
                flex-direction: column;
                gap: 20px;

                border: 1px solid #d9d9d9;
                border-radius: 10px;

                background-color: var(--nstrc-post-background);

                color: var(--nstrc-post-text-color);

                cursor: pointer;
            }

            nostr-post .post-container .post-header {
                display: flex;
                gap: 10px;
            }
            
            nostr-post .post-body {
              display: block;
              width: 100%;
            }

            nostr-post .post-header-left {
                width: 35px;
            }

            nostr-post .post-header-left img {
                width: 35px;
                border-radius: 50%;
            }

            nostr-post .post-header-middle {
                display: flex;
                flex-direction: column;
                width: 100%;
                gap: 5px;
            }

            nostr-post .post-header-right {
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: end;
            }

            nostr-post .author-name {
              color: var(--nstrc-post-name-color);
              font-weight: var(--nstrc-post-name-font-weight);
                  word-break: break-word;
            }

            nostr-post .author-username {
                font-weight: var(--nstrc-post-nip05-font-weight);
                color: var(--nstrc-post-nip05-color);
                font-size: 14px;
                word-break: break-all;
            }

            nostr-post .text-content {
              word-break: break-word;
            }

            nostr-post .glide__slide {
                width: 100%;
            }

            nostr-post .glide__slide * {
                border-radius: 10px;
            }

            nostr-post .glide__bullets button {
                border: 1px solid #000; /* Example, adjust as needed */
            }

            nostr-post .post-container .skeleton {
              animation: post-skeleton-loading 0.5s linear infinite alternate;
            }

            @keyframes post-skeleton-loading {
              0% {
                background-color: hsl(var(--nstrc-post-skeleton-min-hsl));
              }
              100% {
                background-color: hsl(var(--nstrc-post-skeleton-max-hsl));
              }
            }

          nostr-post .error-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
          }

          nostr-post .error {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: red;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            color: #FFF;
          }

          nostr-post .error-text {
            color: red;
            font-weight: bold;
          }

          nostr-post .post-footer {
            margin-top: 20px; /* Adjusted margin based on isError logic removal */
            display: block; /* Ensure it takes full width */
            width: 100%;    /* Ensure it takes full width */
          }

          nostr-post .stats-container {
            display: flex;
            gap: 20px;
          }

          nostr-post .stat {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--nstrc-post-stats-color);
          }

          /* Media styling */
          nostr-post .post-media-item {
            width: 100%;
            margin: 10px 0;
            display: flex;
            justify-content: center;
          }

          nostr-post .post-media-item img,
          nostr-post .post-media-item video {
            max-width: 100%;
            max-height: 500px;
            width: auto;
            height: auto;
            object-fit: contain;
            border-radius: 10px;
            display: block;
          }

          /* Embedded media styling */
          nostr-post .embedded-media-item {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            margin: 5px 0;
          }

          nostr-post .embedded-media-item img,
          nostr-post .embedded-media-item video {
            width: 100%;
            max-height: 500px;
            object-fit: contain;
            display: block;
          }
        </style>
      `}function getProfileStyles(n){let e="";return n==="dark"?e=`
    --nstrc-profile-background: var(--nstrc-profile-background-dark, #000000);
    --nstrc-profile-skeleton-min-hsl: var(--nstrc-profile-skeleton-min-hsl-dark, 200, 20%, 20%);
    --nstrc-profile-skeleton-max-hsl: var(--nstrc-profile-skeleton-max-hsl-dark, 200, 20%, 30%);
    --nstrc-profile-text-primary: var(--nstrc-profile-text-primary-dark, #ffffff);
    --nstrc-profile-text-grey: var(--nstrc-profile-text-grey-dark, #666666);
    --nstrc-profile-banner-placeholder-color: var(--nstrc-profile-banner-placeholder-color-dark, #222222);
    --nstrc-profile-copy-foreground-color: var(--nstrc-profile-copy-foreground-color-dark, #CCC);
    `:e=`
    --nstrc-profile-background: var(--nstrc-profile-background-light, #f5f5f5);
    --nstrc-profile-skeleton-min-hsl: var(--nstrc-profile-skeleton-min-hsl-light, 200, 20%, 80%);
    --nstrc-profile-skeleton-max-hsl: var(--nstrc-profile-skeleton-max-hsl-light, 200, 20%, 95%);
    --nstrc-profile-text-primary: var(--nstrc-profile-text-primary-light, #111111);
    --nstrc-profile-text-grey: var(--nstrc-profile-text-grey-light, #808080);
    --nstrc-profile-banner-placeholder-color: var(--nstrc-profile-banner-placeholder-color-light, #e5e5e5);
    --nstrc-profile-copy-foreground-color: var(--nstrc-profile-copy-foreground-color-light, #222);
    `,`
  <style>
  :host {
      ${e}

      --nstrc-profile-accent: var(--nstrc-profile-accent, #ca077c);

      /* Override follow button styles for profile context */
      --nstrc-follow-btn-padding: 5px 8px !important;
      --nstrc-follow-btn-font-size: 14px !important;
      --nstrc-follow-btn-border-radius: 12px !important;
      --nstrc-follow-btn-border-dark: 1px solid #DDDDDD !important;
      --nstrc-follow-btn-border-light: 1px solid #DDDDDD !important;
      --nstrc-follow-btn-horizontal-alignment: end !important;
      --nstrc-follow-btn-min-height: auto !important;
    }

      .nostr-profile .skeleton {
          animation: profile-skeleton-loading 0.5s linear infinite alternate;
      }

      @keyframes profile-skeleton-loading {
          0% {
              background-color: hsl(var(--nstrc-profile-skeleton-min-hsl));
          }
          100% {
              background-color: hsl(var(--nstrc-profile-skeleton-max-hsl));
          }
      }

    .nostr-profile {
      -webkit-tap-highlight-color: transparent;
      text-size-adjust: 100%;
      font-weight: 400;
      font-size: 18px;
      line-height: 1.5;
      text-rendering: optimizeLegibility;
      overflow-wrap: break-word;
      font-family: Nacelle, sans-serif;
      -webkit-font-smoothing: antialiased;
      box-sizing: border-box;
      background-repeat: no-repeat;
      min-height: 500px;
      border: 1px solid #CCC;
      border-radius: 5px;
      background-color: var(--nstrc-profile-background);
      cursor: pointer;
    }

    #profile {
      position: relative;
      background-color: var(--nstrc-profile-background);
      padding-bottom: 4px;
    }

    #profile_banner {
      width: 100%;
      height: 214px;
      overflow: hidden;
    }

    #profile_banner a {
      outline: none;
      color: var(--nstrc-profile-accent);
    }

    #profile_banner a img {
      color: var(--nstrc-profile-accent);
      max-width: 100%;
      border-style: none;
      display: block;
      z-index: 22;
      width: 100%;
      height: 214px;
      object-fit: cover;
    }

    #profile_banner .banner-placeholder {
      width: 100%;
      height: 214px;
      background-color: var(--nstrc-profile-banner-placeholder-color);
    }

    .dp_container {
      position: absolute;
      top: 140px;
      left: 15px;
      overflow: hidden;
    }

    .avatar_container {
      border: solid 4px var(--nstrc-profile-background);
      border-radius: 50%;
      background-color: var(--nstrc-profile-background);
    }

    .avatar_wrapper {
      display: block;
      min-height: 142px;
    }

    .xxl_avatar {
      position: relative;
      background-color: var(--nstrc-profile-background);
      border-radius: 50%;
      width: 142px;
      height: 142px;
    }

    .backfill {
      background-color: var(--nstrc-profile-background);
      border-radius: 50%;
      width: 142px;
      height: 142px;
    }

    .backfill a {
      outline: none;
    }

    .backfill a img {
      max-width: 100%;
      border-style: none;
      display: block;
      z-index: 22;
      border-radius: 50%;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .profile_actions {
      height: 76px;
      display: flex;
      justify-content: end;
      align-items: center;
      padding: 0 18px;
    }

    .profile_data {
      display: block;
      margin-inline: 20px;
      min-height: 52px;
      margin-top: 14px;
    }

    .basic_info {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .name {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      max-width: 60%;
      height: 100%;
    }

    .name-text {
      color: var(--nstrc-profile-text-primary);
      font-size: 20px;
      line-height: 1;
      font-weight: 700;
      text-overflow: ellipsis;
      display: flex;
      align-items: center;
      vertical-align: baseline;
    }

    .verification-check {
      width: 20px;
      height: 20px;
    }

    .verification-icon {
      width: 20px;
      height: 20px;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-inline: 4px;
    }

    ._whiteCheckL_lfbpc_49 {
      width: 12px;
      height: 12px;
      top: 4px;
      left: 4px;
      border-radius: 50%;
      background-color: #fff;
      position: absolute;
    }

    ._verifiedIconPrimal_lfbpc_30 {
      width: 100%;
      height: 100%;
      background: var(--nstrc-profile-accent);
      mask: url(https://primal.net/assets/verified-84f47cd3.svg) no-repeat 0/100%;
    }

    .joined {
      font-weight: 400;
      font-size: 14px;
      line-height: 16px;
      text-align: right;
      color: var(--nstrc-profile-text-grey);
    }

    .nip05-wrapper {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      color: var(--nstrc-profile-text-grey);
      font-weight: 400;
      font-size: 14px;
      line-height: 16px;
      margin-top: 2px;
      margin-bottom: 16px;
    }

    .nip05-container {
      color: var(--nstrc-profile-text-grey);
      font-weight: 400;
      font-size: 14px;
      line-height: 16px;
      display: flex;
      align-items: center;
    }

    .nip05 {
      color: var(--nstrc-profile-text-grey);
      font-weight: 400;
      font-size: 14px;
      line-height: 16px;
      width: 100%;
      overflow: hidden;
      display: flex;
      gap: 5px;
    }

    .about {
      margin-inline: 20px;
      font-weight: 400;
      font-size: 14px;
      line-height: 20px;
      color: var(--nstrc-profile-text-primary);
    }

    .links {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-inline: 20px;
      margin-block: 12px;
    }

    .website {
      font-weight: 400;
      font-size: 14px;
      line-height: 20px;
      display: flex;
      align-items: center;
    }

    .website a {
      font-weight: 400;
      font-size: 14px;
      line-height: 20px;
      outline: none;
      color: var(--nstrc-profile-accent);
      max-width: 350px;
      overflow: hidden;
      text-overflow: ellipsis;
      word-wrap: normal;
    }

    .stats {
      position: relative;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      padding-inline: 8px;
      border-radius: 0;
      padding-top: 22px;
      border-top: none;
      background-color: var(--nstrc-profile-background);
    }

    .stat {
      position: relative;
      display: inline-block;
      padding-inline: 14px;
      padding-block: 2px;
      border: none;
      background: none;
      width: fit-content;
      height: 40px;
      margin: 0 0 12px;
    }

    .stat-inner {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .stat-inner .stat-value {
      font-weight: 400;
      font-size: 24px;
      line-height: 24px;
      color: var(--nstrc-profile-text-primary);
    }

    .stat-inner .stat-name {
      font-weight: 400;
      font-size: 14px;
      line-height: 16px;
      color: var(--nstrc-profile-text-grey);
      text-transform: lowercase;
    }

    .error-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      min-height: 500px;
    }

    .error {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background-color: red;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      color: #FFF;
    }

    .error-text {
      color: red;
      font-weight: bold;
    }

    .npub-container {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-top: 6px;
    }

    .npub-container .npub {
      color: #a2a2a2;
    }

    .npub.full {
      display: inline !important;
    }

    .npub.masked {
      display: none !important;
    }

    .copy-button {
      display: flex;
      font-size: 16px;
      min-width: 15px;
      min-height: 15px;
      align-items: center;
      justify-content: center;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      color: var(--nstrc-profile-copy-foreground-color);
    }

    @media only screen and (max-width: 600px) {
      button.stat .stat-value {
        font-size: 18px !important;
      }

      .npub.full {
        display: none !important;
      }

      .npub.masked {
        display: inline !important;
      }
    }

    @media only screen and (max-width: 600px) {
      :host {
        --nstrc-follow-btn-padding: 5px 8px !important;
        --nstrc-follow-btn-font-size: 12px !important;
        --nstrc-follow-btn-min-height: auto !important;
        --nstrc-follow-btn-border-radius: 8px !important;
        --nstrc-follow-btn-error-max-width: 150px !important;
      }
    }

  </style>
  `}const htmlDecodeTree=new Uint16Array('ᵁ<Õıʊҝջאٵ۞ޢߖࠏ੊ઑඡ๭༉༦჊ረዡᐕᒝᓃᓟᔥ\0\0\0\0\0\0ᕫᛍᦍᰒᷝ὾⁠↰⊍⏀⏻⑂⠤⤒ⴈ⹈⿎〖㊺㘹㞬㣾㨨㩱㫠㬮ࠀEMabcfglmnoprstu\\bfms¦³¹ÈÏlig耻Æ䃆P耻&䀦cute耻Á䃁reve;䄂Āiyx}rc耻Â䃂;䐐r;쀀𝔄rave耻À䃀pha;䎑acr;䄀d;橓Āgp¡on;䄄f;쀀𝔸plyFunction;恡ing耻Å䃅Ācs¾Ãr;쀀𝒜ign;扔ilde耻Ã䃃ml耻Ä䃄ЀaceforsuåûþėĜĢħĪĀcrêòkslash;或Ŷöø;櫧ed;挆y;䐑ƀcrtąċĔause;戵noullis;愬a;䎒r;쀀𝔅pf;쀀𝔹eve;䋘còēmpeq;扎܀HOacdefhilorsuōőŖƀƞƢƵƷƺǜȕɳɸɾcy;䐧PY耻©䂩ƀcpyŝŢźute;䄆Ā;iŧŨ拒talDifferentialD;慅leys;愭ȀaeioƉƎƔƘron;䄌dil耻Ç䃇rc;䄈nint;戰ot;䄊ĀdnƧƭilla;䂸terDot;䂷òſi;䎧rcleȀDMPTǇǋǑǖot;抙inus;抖lus;投imes;抗oĀcsǢǸkwiseContourIntegral;戲eCurlyĀDQȃȏoubleQuote;思uote;怙ȀlnpuȞȨɇɕonĀ;eȥȦ户;橴ƀgitȯȶȺruent;扡nt;戯ourIntegral;戮ĀfrɌɎ;愂oduct;成nterClockwiseContourIntegral;戳oss;樯cr;쀀𝒞pĀ;Cʄʅ拓ap;才րDJSZacefiosʠʬʰʴʸˋ˗ˡ˦̳ҍĀ;oŹʥtrahd;椑cy;䐂cy;䐅cy;䐏ƀgrsʿ˄ˇger;怡r;憡hv;櫤Āayː˕ron;䄎;䐔lĀ;t˝˞戇a;䎔r;쀀𝔇Āaf˫̧Ācm˰̢riticalȀADGT̖̜̀̆cute;䂴oŴ̋̍;䋙bleAcute;䋝rave;䁠ilde;䋜ond;拄ferentialD;慆Ѱ̽\0\0\0͔͂\0Ѕf;쀀𝔻ƀ;DE͈͉͍䂨ot;惜qual;扐blèCDLRUVͣͲ΂ϏϢϸontourIntegraìȹoɴ͹\0\0ͻ»͉nArrow;懓Āeo·ΤftƀARTΐΖΡrrow;懐ightArrow;懔eåˊngĀLRΫτeftĀARγιrrow;柸ightArrow;柺ightArrow;柹ightĀATϘϞrrow;懒ee;抨pɁϩ\0\0ϯrrow;懑ownArrow;懕erticalBar;戥ǹABLRTaВЪаўѿͼrrowƀ;BUНОТ憓ar;椓pArrow;懵reve;䌑eft˒к\0ц\0ѐightVector;楐eeVector;楞ectorĀ;Bљњ憽ar;楖ightǔѧ\0ѱeeVector;楟ectorĀ;BѺѻ懁ar;楗eeĀ;A҆҇护rrow;憧ĀctҒҗr;쀀𝒟rok;䄐ࠀNTacdfglmopqstuxҽӀӄӋӞӢӧӮӵԡԯԶՒ՝ՠեG;䅊H耻Ð䃐cute耻É䃉ƀaiyӒӗӜron;䄚rc耻Ê䃊;䐭ot;䄖r;쀀𝔈rave耻È䃈ement;戈ĀapӺӾcr;䄒tyɓԆ\0\0ԒmallSquare;旻erySmallSquare;斫ĀgpԦԪon;䄘f;쀀𝔼silon;䎕uĀaiԼՉlĀ;TՂՃ橵ilde;扂librium;懌Āci՗՚r;愰m;橳a;䎗ml耻Ë䃋Āipժկsts;戃onentialE;慇ʀcfiosօֈ֍ֲ׌y;䐤r;쀀𝔉lledɓ֗\0\0֣mallSquare;旼erySmallSquare;斪Ͱֺ\0ֿ\0\0ׄf;쀀𝔽All;戀riertrf;愱cò׋؀JTabcdfgorstר׬ׯ׺؀ؒؖ؛؝أ٬ٲcy;䐃耻>䀾mmaĀ;d׷׸䎓;䏜reve;䄞ƀeiy؇،ؐdil;䄢rc;䄜;䐓ot;䄠r;쀀𝔊;拙pf;쀀𝔾eater̀EFGLSTصلَٖٛ٦qualĀ;Lؾؿ扥ess;招ullEqual;执reater;檢ess;扷lantEqual;橾ilde;扳cr;쀀𝒢;扫ЀAacfiosuڅڋږڛڞڪھۊRDcy;䐪Āctڐڔek;䋇;䁞irc;䄤r;愌lbertSpace;愋ǰگ\0ڲf;愍izontalLine;攀Āctۃۅòکrok;䄦mpńېۘownHumðįqual;扏܀EJOacdfgmnostuۺ۾܃܇܎ܚܞܡܨ݄ݸދޏޕcy;䐕lig;䄲cy;䐁cute耻Í䃍Āiyܓܘrc耻Î䃎;䐘ot;䄰r;愑rave耻Ì䃌ƀ;apܠܯܿĀcgܴܷr;䄪inaryI;慈lieóϝǴ݉\0ݢĀ;eݍݎ戬Āgrݓݘral;戫section;拂isibleĀCTݬݲomma;恣imes;恢ƀgptݿރވon;䄮f;쀀𝕀a;䎙cr;愐ilde;䄨ǫޚ\0ޞcy;䐆l耻Ï䃏ʀcfosuެ޷޼߂ߐĀiyޱ޵rc;䄴;䐙r;쀀𝔍pf;쀀𝕁ǣ߇\0ߌr;쀀𝒥rcy;䐈kcy;䐄΀HJacfosߤߨ߽߬߱ࠂࠈcy;䐥cy;䐌ppa;䎚Āey߶߻dil;䄶;䐚r;쀀𝔎pf;쀀𝕂cr;쀀𝒦րJTaceflmostࠥࠩࠬࡐࡣ঳সে্਷ੇcy;䐉耻<䀼ʀcmnpr࠷࠼ࡁࡄࡍute;䄹bda;䎛g;柪lacetrf;愒r;憞ƀaeyࡗ࡜ࡡron;䄽dil;䄻;䐛Āfsࡨ॰tԀACDFRTUVarࡾࢩࢱࣦ࣠ࣼयज़ΐ४Ānrࢃ࢏gleBracket;柨rowƀ;BR࢙࢚࢞憐ar;懤ightArrow;懆eiling;挈oǵࢷ\0ࣃbleBracket;柦nǔࣈ\0࣒eeVector;楡ectorĀ;Bࣛࣜ懃ar;楙loor;挊ightĀAV࣯ࣵrrow;憔ector;楎Āerँगeƀ;AVउऊऐ抣rrow;憤ector;楚iangleƀ;BEतथऩ抲ar;槏qual;抴pƀDTVषूौownVector;楑eeVector;楠ectorĀ;Bॖॗ憿ar;楘ectorĀ;B॥०憼ar;楒ightáΜs̀EFGLSTॾঋকঝঢভqualGreater;拚ullEqual;扦reater;扶ess;檡lantEqual;橽ilde;扲r;쀀𝔏Ā;eঽা拘ftarrow;懚idot;䄿ƀnpw৔ਖਛgȀLRlr৞৷ਂਐeftĀAR০৬rrow;柵ightArrow;柷ightArrow;柶eftĀarγਊightáοightáϊf;쀀𝕃erĀLRਢਬeftArrow;憙ightArrow;憘ƀchtਾੀੂòࡌ;憰rok;䅁;扪Ѐacefiosuਗ਼੝੠੷੼અઋ઎p;椅y;䐜Ādl੥੯iumSpace;恟lintrf;愳r;쀀𝔐nusPlus;戓pf;쀀𝕄cò੶;䎜ҀJacefostuણધભીଔଙඑ඗ඞcy;䐊cute;䅃ƀaey઴હાron;䅇dil;䅅;䐝ƀgswે૰଎ativeƀMTV૓૟૨ediumSpace;怋hiĀcn૦૘ë૙eryThiî૙tedĀGL૸ଆreaterGreateòٳessLesóੈLine;䀊r;쀀𝔑ȀBnptଢନଷ଺reak;恠BreakingSpace;䂠f;愕ڀ;CDEGHLNPRSTV୕ୖ୪୼஡௫ఄ౞಄ದ೘ൡඅ櫬Āou୛୤ngruent;扢pCap;扭oubleVerticalBar;戦ƀlqxஃஊ஛ement;戉ualĀ;Tஒஓ扠ilde;쀀≂̸ists;戄reater΀;EFGLSTஶஷ஽௉௓௘௥扯qual;扱ullEqual;쀀≧̸reater;쀀≫̸ess;批lantEqual;쀀⩾̸ilde;扵umpń௲௽ownHump;쀀≎̸qual;쀀≏̸eĀfsఊధtTriangleƀ;BEచఛడ拪ar;쀀⧏̸qual;括s̀;EGLSTవశ఼ౄోౘ扮qual;扰reater;扸ess;쀀≪̸lantEqual;쀀⩽̸ilde;扴estedĀGL౨౹reaterGreater;쀀⪢̸essLess;쀀⪡̸recedesƀ;ESಒಓಛ技qual;쀀⪯̸lantEqual;拠ĀeiಫಹverseElement;戌ghtTriangleƀ;BEೋೌ೒拫ar;쀀⧐̸qual;拭ĀquೝഌuareSuĀbp೨೹setĀ;E೰ೳ쀀⊏̸qual;拢ersetĀ;Eഃആ쀀⊐̸qual;拣ƀbcpഓതൎsetĀ;Eഛഞ쀀⊂⃒qual;抈ceedsȀ;ESTലള഻െ抁qual;쀀⪰̸lantEqual;拡ilde;쀀≿̸ersetĀ;E൘൛쀀⊃⃒qual;抉ildeȀ;EFT൮൯൵ൿ扁qual;扄ullEqual;扇ilde;扉erticalBar;戤cr;쀀𝒩ilde耻Ñ䃑;䎝܀Eacdfgmoprstuvලෂ෉෕ෛ෠෧෼ขภยา฿ไlig;䅒cute耻Ó䃓Āiy෎ීrc耻Ô䃔;䐞blac;䅐r;쀀𝔒rave耻Ò䃒ƀaei෮ෲ෶cr;䅌ga;䎩cron;䎟pf;쀀𝕆enCurlyĀDQฎบoubleQuote;怜uote;怘;橔Āclวฬr;쀀𝒪ash耻Ø䃘iŬื฼de耻Õ䃕es;樷ml耻Ö䃖erĀBP๋๠Āar๐๓r;怾acĀek๚๜;揞et;掴arenthesis;揜Ҁacfhilors๿ງຊຏຒດຝະ໼rtialD;戂y;䐟r;쀀𝔓i;䎦;䎠usMinus;䂱Āipຢອncareplanåڝf;愙Ȁ;eio຺ູ໠໤檻cedesȀ;EST່້໏໚扺qual;檯lantEqual;扼ilde;找me;怳Ādp໩໮uct;戏ortionĀ;aȥ໹l;戝Āci༁༆r;쀀𝒫;䎨ȀUfos༑༖༛༟OT耻"䀢r;쀀𝔔pf;愚cr;쀀𝒬؀BEacefhiorsu༾གྷཇའཱིྦྷྪྭ႖ႩႴႾarr;椐G耻®䂮ƀcnrཎནབute;䅔g;柫rĀ;tཛྷཝ憠l;椖ƀaeyཧཬཱron;䅘dil;䅖;䐠Ā;vླྀཹ愜erseĀEUྂྙĀlq྇ྎement;戋uilibrium;懋pEquilibrium;楯r»ཹo;䎡ghtЀACDFTUVa࿁࿫࿳ဢဨၛႇϘĀnr࿆࿒gleBracket;柩rowƀ;BL࿜࿝࿡憒ar;懥eftArrow;懄eiling;按oǵ࿹\0စbleBracket;柧nǔည\0နeeVector;楝ectorĀ;Bဝသ懂ar;楕loor;挋Āerိ၃eƀ;AVဵံြ抢rrow;憦ector;楛iangleƀ;BEၐၑၕ抳ar;槐qual;抵pƀDTVၣၮၸownVector;楏eeVector;楜ectorĀ;Bႂႃ憾ar;楔ectorĀ;B႑႒懀ar;楓Āpuႛ႞f;愝ndImplies;楰ightarrow;懛ĀchႹႼr;愛;憱leDelayed;槴ڀHOacfhimoqstuფჱჷჽᄙᄞᅑᅖᅡᅧᆵᆻᆿĀCcჩხHcy;䐩y;䐨FTcy;䐬cute;䅚ʀ;aeiyᄈᄉᄎᄓᄗ檼ron;䅠dil;䅞rc;䅜;䐡r;쀀𝔖ortȀDLRUᄪᄴᄾᅉownArrow»ОeftArrow»࢚ightArrow»࿝pArrow;憑gma;䎣allCircle;战pf;쀀𝕊ɲᅭ\0\0ᅰt;戚areȀ;ISUᅻᅼᆉᆯ斡ntersection;抓uĀbpᆏᆞsetĀ;Eᆗᆘ抏qual;抑ersetĀ;Eᆨᆩ抐qual;抒nion;抔cr;쀀𝒮ar;拆ȀbcmpᇈᇛሉላĀ;sᇍᇎ拐etĀ;Eᇍᇕqual;抆ĀchᇠህeedsȀ;ESTᇭᇮᇴᇿ扻qual;檰lantEqual;扽ilde;承Tháྌ;我ƀ;esሒሓሣ拑rsetĀ;Eሜም抃qual;抇et»ሓրHRSacfhiorsሾቄ቉ቕ቞ቱቶኟዂወዑORN耻Þ䃞ADE;愢ĀHc቎ቒcy;䐋y;䐦Ābuቚቜ;䀉;䎤ƀaeyብቪቯron;䅤dil;䅢;䐢r;쀀𝔗Āeiቻ኉ǲኀ\0ኇefore;戴a;䎘Ācn኎ኘkSpace;쀀  Space;怉ldeȀ;EFTካኬኲኼ戼qual;扃ullEqual;扅ilde;扈pf;쀀𝕋ipleDot;惛Āctዖዛr;쀀𝒯rok;䅦ૡዷጎጚጦ\0ጬጱ\0\0\0\0\0ጸጽ፷ᎅ\0᏿ᐄᐊᐐĀcrዻጁute耻Ú䃚rĀ;oጇገ憟cir;楉rǣጓ\0጖y;䐎ve;䅬Āiyጞጣrc耻Û䃛;䐣blac;䅰r;쀀𝔘rave耻Ù䃙acr;䅪Ādiፁ፩erĀBPፈ፝Āarፍፐr;䁟acĀekፗፙ;揟et;掵arenthesis;揝onĀ;P፰፱拃lus;抎Āgp፻፿on;䅲f;쀀𝕌ЀADETadps᎕ᎮᎸᏄϨᏒᏗᏳrrowƀ;BDᅐᎠᎤar;椒ownArrow;懅ownArrow;憕quilibrium;楮eeĀ;AᏋᏌ报rrow;憥ownáϳerĀLRᏞᏨeftArrow;憖ightArrow;憗iĀ;lᏹᏺ䏒on;䎥ing;䅮cr;쀀𝒰ilde;䅨ml耻Ü䃜ҀDbcdefosvᐧᐬᐰᐳᐾᒅᒊᒐᒖash;披ar;櫫y;䐒ashĀ;lᐻᐼ抩;櫦Āerᑃᑅ;拁ƀbtyᑌᑐᑺar;怖Ā;iᑏᑕcalȀBLSTᑡᑥᑪᑴar;戣ine;䁼eparator;杘ilde;所ThinSpace;怊r;쀀𝔙pf;쀀𝕍cr;쀀𝒱dash;抪ʀcefosᒧᒬᒱᒶᒼirc;䅴dge;拀r;쀀𝔚pf;쀀𝕎cr;쀀𝒲Ȁfiosᓋᓐᓒᓘr;쀀𝔛;䎞pf;쀀𝕏cr;쀀𝒳ҀAIUacfosuᓱᓵᓹᓽᔄᔏᔔᔚᔠcy;䐯cy;䐇cy;䐮cute耻Ý䃝Āiyᔉᔍrc;䅶;䐫r;쀀𝔜pf;쀀𝕐cr;쀀𝒴ml;䅸ЀHacdefosᔵᔹᔿᕋᕏᕝᕠᕤcy;䐖cute;䅹Āayᕄᕉron;䅽;䐗ot;䅻ǲᕔ\0ᕛoWidtè૙a;䎖r;愨pf;愤cr;쀀𝒵௡ᖃᖊᖐ\0ᖰᖶᖿ\0\0\0\0ᗆᗛᗫᙟ᙭\0ᚕ᚛ᚲᚹ\0ᚾcute耻á䃡reve;䄃̀;Ediuyᖜᖝᖡᖣᖨᖭ戾;쀀∾̳;房rc耻â䃢te肻´̆;䐰lig耻æ䃦Ā;r²ᖺ;쀀𝔞rave耻à䃠ĀepᗊᗖĀfpᗏᗔsym;愵èᗓha;䎱ĀapᗟcĀclᗤᗧr;䄁g;樿ɤᗰ\0\0ᘊʀ;adsvᗺᗻᗿᘁᘇ戧nd;橕;橜lope;橘;橚΀;elmrszᘘᘙᘛᘞᘿᙏᙙ戠;榤e»ᘙsdĀ;aᘥᘦ戡ѡᘰᘲᘴᘶᘸᘺᘼᘾ;榨;榩;榪;榫;榬;榭;榮;榯tĀ;vᙅᙆ戟bĀ;dᙌᙍ抾;榝Āptᙔᙗh;戢»¹arr;捼Āgpᙣᙧon;䄅f;쀀𝕒΀;Eaeiop዁ᙻᙽᚂᚄᚇᚊ;橰cir;橯;扊d;手s;䀧roxĀ;e዁ᚒñᚃing耻å䃥ƀctyᚡᚦᚨr;쀀𝒶;䀪mpĀ;e዁ᚯñʈilde耻ã䃣ml耻ä䃤Āciᛂᛈoninôɲnt;樑ࠀNabcdefiklnoprsu᛭ᛱᜰ᜼ᝃᝈ᝸᝽០៦ᠹᡐᜍ᤽᥈ᥰot;櫭Ācrᛶ᜞kȀcepsᜀᜅᜍᜓong;扌psilon;䏶rime;怵imĀ;e᜚᜛戽q;拍Ŷᜢᜦee;抽edĀ;gᜬᜭ挅e»ᜭrkĀ;t፜᜷brk;掶Āoyᜁᝁ;䐱quo;怞ʀcmprtᝓ᝛ᝡᝤᝨausĀ;eĊĉptyv;榰séᜌnoõēƀahwᝯ᝱ᝳ;䎲;愶een;扬r;쀀𝔟g΀costuvwឍឝឳេ៕៛៞ƀaiuបពរðݠrc;旯p»፱ƀdptឤឨឭot;樀lus;樁imes;樂ɱឹ\0\0ើcup;樆ar;昅riangleĀdu៍្own;施p;斳plus;樄eåᑄåᒭarow;植ƀako៭ᠦᠵĀcn៲ᠣkƀlst៺֫᠂ozenge;槫riangleȀ;dlr᠒᠓᠘᠝斴own;斾eft;旂ight;斸k;搣Ʊᠫ\0ᠳƲᠯ\0ᠱ;斒;斑4;斓ck;斈ĀeoᠾᡍĀ;qᡃᡆ쀀=⃥uiv;쀀≡⃥t;挐Ȁptwxᡙᡞᡧᡬf;쀀𝕓Ā;tᏋᡣom»Ꮜtie;拈؀DHUVbdhmptuvᢅᢖᢪᢻᣗᣛᣬ᣿ᤅᤊᤐᤡȀLRlrᢎᢐᢒᢔ;敗;敔;敖;敓ʀ;DUduᢡᢢᢤᢦᢨ敐;敦;敩;敤;敧ȀLRlrᢳᢵᢷᢹ;敝;敚;敜;教΀;HLRhlrᣊᣋᣍᣏᣑᣓᣕ救;敬;散;敠;敫;敢;敟ox;槉ȀLRlrᣤᣦᣨᣪ;敕;敒;攐;攌ʀ;DUduڽ᣷᣹᣻᣽;敥;敨;攬;攴inus;抟lus;択imes;抠ȀLRlrᤙᤛᤝ᤟;敛;敘;攘;攔΀;HLRhlrᤰᤱᤳᤵᤷ᤻᤹攂;敪;敡;敞;攼;攤;攜Āevģ᥂bar耻¦䂦Ȁceioᥑᥖᥚᥠr;쀀𝒷mi;恏mĀ;e᜚᜜lƀ;bhᥨᥩᥫ䁜;槅sub;柈Ŭᥴ᥾lĀ;e᥹᥺怢t»᥺pƀ;Eeįᦅᦇ;檮Ā;qۜۛೡᦧ\0᧨ᨑᨕᨲ\0ᨷᩐ\0\0᪴\0\0᫁\0\0ᬡᬮ᭍᭒\0᯽\0ᰌƀcpr᦭ᦲ᧝ute;䄇̀;abcdsᦿᧀᧄ᧊᧕᧙戩nd;橄rcup;橉Āau᧏᧒p;橋p;橇ot;橀;쀀∩︀Āeo᧢᧥t;恁îړȀaeiu᧰᧻ᨁᨅǰ᧵\0᧸s;橍on;䄍dil耻ç䃧rc;䄉psĀ;sᨌᨍ橌m;橐ot;䄋ƀdmnᨛᨠᨦil肻¸ƭptyv;榲t脀¢;eᨭᨮ䂢räƲr;쀀𝔠ƀceiᨽᩀᩍy;䑇ckĀ;mᩇᩈ朓ark»ᩈ;䏇r΀;Ecefms᩟᩠ᩢᩫ᪤᪪᪮旋;槃ƀ;elᩩᩪᩭ䋆q;扗eɡᩴ\0\0᪈rrowĀlr᩼᪁eft;憺ight;憻ʀRSacd᪒᪔᪖᪚᪟»ཇ;擈st;抛irc;抚ash;抝nint;樐id;櫯cir;槂ubsĀ;u᪻᪼晣it»᪼ˬ᫇᫔᫺\0ᬊonĀ;eᫍᫎ䀺Ā;qÇÆɭ᫙\0\0᫢aĀ;t᫞᫟䀬;䁀ƀ;fl᫨᫩᫫戁îᅠeĀmx᫱᫶ent»᫩eóɍǧ᫾\0ᬇĀ;dኻᬂot;橭nôɆƀfryᬐᬔᬗ;쀀𝕔oäɔ脀©;sŕᬝr;愗Āaoᬥᬩrr;憵ss;朗Ācuᬲᬷr;쀀𝒸Ābpᬼ᭄Ā;eᭁᭂ櫏;櫑Ā;eᭉᭊ櫐;櫒dot;拯΀delprvw᭠᭬᭷ᮂᮬᯔ᯹arrĀlr᭨᭪;椸;椵ɰ᭲\0\0᭵r;拞c;拟arrĀ;p᭿ᮀ憶;椽̀;bcdosᮏᮐᮖᮡᮥᮨ截rcap;橈Āauᮛᮞp;橆p;橊ot;抍r;橅;쀀∪︀Ȁalrv᮵ᮿᯞᯣrrĀ;mᮼᮽ憷;椼yƀevwᯇᯔᯘqɰᯎ\0\0ᯒreã᭳uã᭵ee;拎edge;拏en耻¤䂤earrowĀlrᯮ᯳eft»ᮀight»ᮽeäᯝĀciᰁᰇoninôǷnt;戱lcty;挭ঀAHabcdefhijlorstuwz᰸᰻᰿ᱝᱩᱵᲊᲞᲬᲷ᳻᳿ᴍᵻᶑᶫᶻ᷆᷍rò΁ar;楥Ȁglrs᱈ᱍ᱒᱔ger;怠eth;愸òᄳhĀ;vᱚᱛ怐»ऊūᱡᱧarow;椏aã̕Āayᱮᱳron;䄏;䐴ƀ;ao̲ᱼᲄĀgrʿᲁr;懊tseq;橷ƀglmᲑᲔᲘ耻°䂰ta;䎴ptyv;榱ĀirᲣᲨsht;楿;쀀𝔡arĀlrᲳᲵ»ࣜ»သʀaegsv᳂͸᳖᳜᳠mƀ;oș᳊᳔ndĀ;ș᳑uit;晦amma;䏝in;拲ƀ;io᳧᳨᳸䃷de脀÷;o᳧ᳰntimes;拇nø᳷cy;䑒cɯᴆ\0\0ᴊrn;挞op;挍ʀlptuwᴘᴝᴢᵉᵕlar;䀤f;쀀𝕕ʀ;emps̋ᴭᴷᴽᵂqĀ;d͒ᴳot;扑inus;戸lus;戔quare;抡blebarwedgåúnƀadhᄮᵝᵧownarrowóᲃarpoonĀlrᵲᵶefôᲴighôᲶŢᵿᶅkaro÷གɯᶊ\0\0ᶎrn;挟op;挌ƀcotᶘᶣᶦĀryᶝᶡ;쀀𝒹;䑕l;槶rok;䄑Ādrᶰᶴot;拱iĀ;fᶺ᠖斿Āah᷀᷃ròЩaòྦangle;榦Āci᷒ᷕy;䑟grarr;柿ऀDacdefglmnopqrstuxḁḉḙḸոḼṉṡṾấắẽỡἪἷὄ὎὚ĀDoḆᴴoôᲉĀcsḎḔute耻é䃩ter;橮ȀaioyḢḧḱḶron;䄛rĀ;cḭḮ扖耻ê䃪lon;払;䑍ot;䄗ĀDrṁṅot;扒;쀀𝔢ƀ;rsṐṑṗ檚ave耻è䃨Ā;dṜṝ檖ot;檘Ȁ;ilsṪṫṲṴ檙nters;揧;愓Ā;dṹṺ檕ot;檗ƀapsẅẉẗcr;䄓tyƀ;svẒẓẕ戅et»ẓpĀ1;ẝẤĳạả;怄;怅怃ĀgsẪẬ;䅋p;怂ĀgpẴẸon;䄙f;쀀𝕖ƀalsỄỎỒrĀ;sỊị拕l;槣us;橱iƀ;lvỚớở䎵on»ớ;䏵ȀcsuvỪỳἋἣĀioữḱrc»Ḯɩỹ\0\0ỻíՈantĀglἂἆtr»ṝess»Ṻƀaeiἒ἖Ἒls;䀽st;扟vĀ;DȵἠD;橸parsl;槥ĀDaἯἳot;打rr;楱ƀcdiἾὁỸr;愯oô͒ĀahὉὋ;䎷耻ð䃰Āmrὓὗl耻ë䃫o;悬ƀcipὡὤὧl;䀡sôծĀeoὬὴctatioîՙnentialåչৡᾒ\0ᾞ\0ᾡᾧ\0\0ῆῌ\0ΐ\0ῦῪ \0 ⁚llingdotseñṄy;䑄male;晀ƀilrᾭᾳ῁lig;耀ﬃɩᾹ\0\0᾽g;耀ﬀig;耀ﬄ;쀀𝔣lig;耀ﬁlig;쀀fjƀaltῙ῜ῡt;晭ig;耀ﬂns;斱of;䆒ǰ΅\0ῳf;쀀𝕗ĀakֿῷĀ;vῼ´拔;櫙artint;樍Āao‌⁕Ācs‑⁒α‚‰‸⁅⁈\0⁐β•‥‧‪‬\0‮耻½䂽;慓耻¼䂼;慕;慙;慛Ƴ‴\0‶;慔;慖ʴ‾⁁\0\0⁃耻¾䂾;慗;慜5;慘ƶ⁌\0⁎;慚;慝8;慞l;恄wn;挢cr;쀀𝒻ࢀEabcdefgijlnorstv₂₉₟₥₰₴⃰⃵⃺⃿℃ℒℸ̗ℾ⅒↞Ā;lٍ₇;檌ƀcmpₐₕ₝ute;䇵maĀ;dₜ᳚䎳;檆reve;䄟Āiy₪₮rc;䄝;䐳ot;䄡Ȁ;lqsؾق₽⃉ƀ;qsؾٌ⃄lanô٥Ȁ;cdl٥⃒⃥⃕c;檩otĀ;o⃜⃝檀Ā;l⃢⃣檂;檄Ā;e⃪⃭쀀⋛︀s;檔r;쀀𝔤Ā;gٳ؛mel;愷cy;䑓Ȁ;Eajٚℌℎℐ;檒;檥;檤ȀEaesℛℝ℩ℴ;扩pĀ;p℣ℤ檊rox»ℤĀ;q℮ℯ檈Ā;q℮ℛim;拧pf;쀀𝕘Āci⅃ⅆr;愊mƀ;el٫ⅎ⅐;檎;檐茀>;cdlqr׮ⅠⅪⅮⅳⅹĀciⅥⅧ;檧r;橺ot;拗Par;榕uest;橼ʀadelsↄⅪ←ٖ↛ǰ↉\0↎proø₞r;楸qĀlqؿ↖lesó₈ií٫Āen↣↭rtneqq;쀀≩︀Å↪ԀAabcefkosy⇄⇇⇱⇵⇺∘∝∯≨≽ròΠȀilmr⇐⇔⇗⇛rsðᒄf»․ilôکĀdr⇠⇤cy;䑊ƀ;cwࣴ⇫⇯ir;楈;憭ar;意irc;䄥ƀalr∁∎∓rtsĀ;u∉∊晥it»∊lip;怦con;抹r;쀀𝔥sĀew∣∩arow;椥arow;椦ʀamopr∺∾≃≞≣rr;懿tht;戻kĀlr≉≓eftarrow;憩ightarrow;憪f;쀀𝕙bar;怕ƀclt≯≴≸r;쀀𝒽asè⇴rok;䄧Ābp⊂⊇ull;恃hen»ᱛૡ⊣\0⊪\0⊸⋅⋎\0⋕⋳\0\0⋸⌢⍧⍢⍿\0⎆⎪⎴cute耻í䃭ƀ;iyݱ⊰⊵rc耻î䃮;䐸Ācx⊼⊿y;䐵cl耻¡䂡ĀfrΟ⋉;쀀𝔦rave耻ì䃬Ȁ;inoܾ⋝⋩⋮Āin⋢⋦nt;樌t;戭fin;槜ta;愩lig;䄳ƀaop⋾⌚⌝ƀcgt⌅⌈⌗r;䄫ƀelpܟ⌏⌓inåގarôܠh;䄱f;抷ed;䆵ʀ;cfotӴ⌬⌱⌽⍁are;愅inĀ;t⌸⌹戞ie;槝doô⌙ʀ;celpݗ⍌⍐⍛⍡al;抺Āgr⍕⍙eróᕣã⍍arhk;樗rod;樼Ȁcgpt⍯⍲⍶⍻y;䑑on;䄯f;쀀𝕚a;䎹uest耻¿䂿Āci⎊⎏r;쀀𝒾nʀ;EdsvӴ⎛⎝⎡ӳ;拹ot;拵Ā;v⎦⎧拴;拳Ā;iݷ⎮lde;䄩ǫ⎸\0⎼cy;䑖l耻ï䃯̀cfmosu⏌⏗⏜⏡⏧⏵Āiy⏑⏕rc;䄵;䐹r;쀀𝔧ath;䈷pf;쀀𝕛ǣ⏬\0⏱r;쀀𝒿rcy;䑘kcy;䑔Ѐacfghjos␋␖␢␧␭␱␵␻ppaĀ;v␓␔䎺;䏰Āey␛␠dil;䄷;䐺r;쀀𝔨reen;䄸cy;䑅cy;䑜pf;쀀𝕜cr;쀀𝓀஀ABEHabcdefghjlmnoprstuv⑰⒁⒆⒍⒑┎┽╚▀♎♞♥♹♽⚚⚲⛘❝❨➋⟀⠁⠒ƀart⑷⑺⑼rò৆òΕail;椛arr;椎Ā;gঔ⒋;檋ar;楢ॣ⒥\0⒪\0⒱\0\0\0\0\0⒵Ⓔ\0ⓆⓈⓍ\0⓹ute;䄺mptyv;榴raîࡌbda;䎻gƀ;dlࢎⓁⓃ;榑åࢎ;檅uo耻«䂫rЀ;bfhlpst࢙ⓞⓦⓩ⓫⓮⓱⓵Ā;f࢝ⓣs;椟s;椝ë≒p;憫l;椹im;楳l;憢ƀ;ae⓿─┄檫il;椙Ā;s┉┊檭;쀀⪭︀ƀabr┕┙┝rr;椌rk;杲Āak┢┬cĀek┨┪;䁻;䁛Āes┱┳;榋lĀdu┹┻;榏;榍Ȁaeuy╆╋╖╘ron;䄾Ādi═╔il;䄼ìࢰâ┩;䐻Ȁcqrs╣╦╭╽a;椶uoĀ;rนᝆĀdu╲╷har;楧shar;楋h;憲ʀ;fgqs▋▌উ◳◿扤tʀahlrt▘▤▷◂◨rrowĀ;t࢙□aé⓶arpoonĀdu▯▴own»њp»०eftarrows;懇ightƀahs◍◖◞rrowĀ;sࣴࢧarpoonó྘quigarro÷⇰hreetimes;拋ƀ;qs▋ও◺lanôবʀ;cdgsব☊☍☝☨c;檨otĀ;o☔☕橿Ā;r☚☛檁;檃Ā;e☢☥쀀⋚︀s;檓ʀadegs☳☹☽♉♋pproøⓆot;拖qĀgq♃♅ôউgtò⒌ôছiíলƀilr♕࣡♚sht;楼;쀀𝔩Ā;Eজ♣;檑š♩♶rĀdu▲♮Ā;l॥♳;楪lk;斄cy;䑙ʀ;achtੈ⚈⚋⚑⚖rò◁orneòᴈard;楫ri;旺Āio⚟⚤dot;䅀ustĀ;a⚬⚭掰che»⚭ȀEaes⚻⚽⛉⛔;扨pĀ;p⛃⛄檉rox»⛄Ā;q⛎⛏檇Ā;q⛎⚻im;拦Ѐabnoptwz⛩⛴⛷✚✯❁❇❐Ānr⛮⛱g;柬r;懽rëࣁgƀlmr⛿✍✔eftĀar০✇ightá৲apsto;柼ightá৽parrowĀlr✥✩efô⓭ight;憬ƀafl✶✹✽r;榅;쀀𝕝us;樭imes;樴š❋❏st;戗áፎƀ;ef❗❘᠀旊nge»❘arĀ;l❤❥䀨t;榓ʀachmt❳❶❼➅➇ròࢨorneòᶌarĀ;d྘➃;業;怎ri;抿̀achiqt➘➝ੀ➢➮➻quo;怹r;쀀𝓁mƀ;egল➪➬;檍;檏Ābu┪➳oĀ;rฟ➹;怚rok;䅂萀<;cdhilqrࠫ⟒☹⟜⟠⟥⟪⟰Āci⟗⟙;檦r;橹reå◲mes;拉arr;楶uest;橻ĀPi⟵⟹ar;榖ƀ;ef⠀भ᠛旃rĀdu⠇⠍shar;楊har;楦Āen⠗⠡rtneqq;쀀≨︀Å⠞܀Dacdefhilnopsu⡀⡅⢂⢎⢓⢠⢥⢨⣚⣢⣤ઃ⣳⤂Dot;戺Ȁclpr⡎⡒⡣⡽r耻¯䂯Āet⡗⡙;時Ā;e⡞⡟朠se»⡟Ā;sျ⡨toȀ;dluျ⡳⡷⡻owîҌefôएðᏑker;斮Āoy⢇⢌mma;権;䐼ash;怔asuredangle»ᘦr;쀀𝔪o;愧ƀcdn⢯⢴⣉ro耻µ䂵Ȁ;acdᑤ⢽⣀⣄sôᚧir;櫰ot肻·Ƶusƀ;bd⣒ᤃ⣓戒Ā;uᴼ⣘;横ţ⣞⣡p;櫛ò−ðઁĀdp⣩⣮els;抧f;쀀𝕞Āct⣸⣽r;쀀𝓂pos»ᖝƀ;lm⤉⤊⤍䎼timap;抸ఀGLRVabcdefghijlmoprstuvw⥂⥓⥾⦉⦘⧚⧩⨕⨚⩘⩝⪃⪕⪤⪨⬄⬇⭄⭿⮮ⰴⱧⱼ⳩Āgt⥇⥋;쀀⋙̸Ā;v⥐௏쀀≫⃒ƀelt⥚⥲⥶ftĀar⥡⥧rrow;懍ightarrow;懎;쀀⋘̸Ā;v⥻ే쀀≪⃒ightarrow;懏ĀDd⦎⦓ash;抯ash;抮ʀbcnpt⦣⦧⦬⦱⧌la»˞ute;䅄g;쀀∠⃒ʀ;Eiop඄⦼⧀⧅⧈;쀀⩰̸d;쀀≋̸s;䅉roø඄urĀ;a⧓⧔普lĀ;s⧓ସǳ⧟\0⧣p肻 ଷmpĀ;e௹ఀʀaeouy⧴⧾⨃⨐⨓ǰ⧹\0⧻;橃on;䅈dil;䅆ngĀ;dൾ⨊ot;쀀⩭̸p;橂;䐽ash;怓΀;Aadqsxஒ⨩⨭⨻⩁⩅⩐rr;懗rĀhr⨳⨶k;椤Ā;oᏲᏰot;쀀≐̸uiöୣĀei⩊⩎ar;椨í஘istĀ;s஠டr;쀀𝔫ȀEest௅⩦⩹⩼ƀ;qs஼⩭௡ƀ;qs஼௅⩴lanô௢ií௪Ā;rஶ⪁»ஷƀAap⪊⪍⪑rò⥱rr;憮ar;櫲ƀ;svྍ⪜ྌĀ;d⪡⪢拼;拺cy;䑚΀AEadest⪷⪺⪾⫂⫅⫶⫹rò⥦;쀀≦̸rr;憚r;急Ȁ;fqs఻⫎⫣⫯tĀar⫔⫙rro÷⫁ightarro÷⪐ƀ;qs఻⪺⫪lanôౕĀ;sౕ⫴»శiíౝĀ;rవ⫾iĀ;eచథiäඐĀpt⬌⬑f;쀀𝕟膀¬;in⬙⬚⬶䂬nȀ;Edvஉ⬤⬨⬮;쀀⋹̸ot;쀀⋵̸ǡஉ⬳⬵;拷;拶iĀ;vಸ⬼ǡಸ⭁⭃;拾;拽ƀaor⭋⭣⭩rȀ;ast୻⭕⭚⭟lleì୻l;쀀⫽⃥;쀀∂̸lint;樔ƀ;ceಒ⭰⭳uåಥĀ;cಘ⭸Ā;eಒ⭽ñಘȀAait⮈⮋⮝⮧rò⦈rrƀ;cw⮔⮕⮙憛;쀀⤳̸;쀀↝̸ghtarrow»⮕riĀ;eೋೖ΀chimpqu⮽⯍⯙⬄୸⯤⯯Ȁ;cerല⯆ഷ⯉uå൅;쀀𝓃ortɭ⬅\0\0⯖ará⭖mĀ;e൮⯟Ā;q൴൳suĀbp⯫⯭å೸åഋƀbcp⯶ⰑⰙȀ;Ees⯿ⰀഢⰄ抄;쀀⫅̸etĀ;eഛⰋqĀ;qണⰀcĀ;eലⰗñസȀ;EesⰢⰣൟⰧ抅;쀀⫆̸etĀ;e൘ⰮqĀ;qൠⰣȀgilrⰽⰿⱅⱇìௗlde耻ñ䃱çృiangleĀlrⱒⱜeftĀ;eచⱚñదightĀ;eೋⱥñ೗Ā;mⱬⱭ䎽ƀ;esⱴⱵⱹ䀣ro;愖p;怇ҀDHadgilrsⲏⲔⲙⲞⲣⲰⲶⳓⳣash;抭arr;椄p;쀀≍⃒ash;抬ĀetⲨⲬ;쀀≥⃒;쀀>⃒nfin;槞ƀAetⲽⳁⳅrr;椂;쀀≤⃒Ā;rⳊⳍ쀀<⃒ie;쀀⊴⃒ĀAtⳘⳜrr;椃rie;쀀⊵⃒im;쀀∼⃒ƀAan⳰⳴ⴂrr;懖rĀhr⳺⳽k;椣Ā;oᏧᏥear;椧ቓ᪕\0\0\0\0\0\0\0\0\0\0\0\0\0ⴭ\0ⴸⵈⵠⵥ⵲ⶄᬇ\0\0ⶍⶫ\0ⷈⷎ\0ⷜ⸙⸫⸾⹃Ācsⴱ᪗ute耻ó䃳ĀiyⴼⵅrĀ;c᪞ⵂ耻ô䃴;䐾ʀabios᪠ⵒⵗǈⵚlac;䅑v;樸old;榼lig;䅓Ācr⵩⵭ir;榿;쀀𝔬ͯ⵹\0\0⵼\0ⶂn;䋛ave耻ò䃲;槁Ābmⶈ෴ar;榵Ȁacitⶕ⶘ⶥⶨrò᪀Āir⶝ⶠr;榾oss;榻nå๒;槀ƀaeiⶱⶵⶹcr;䅍ga;䏉ƀcdnⷀⷅǍron;䎿;榶pf;쀀𝕠ƀaelⷔ⷗ǒr;榷rp;榹΀;adiosvⷪⷫⷮ⸈⸍⸐⸖戨rò᪆Ȁ;efmⷷⷸ⸂⸅橝rĀ;oⷾⷿ愴f»ⷿ耻ª䂪耻º䂺gof;抶r;橖lope;橗;橛ƀclo⸟⸡⸧ò⸁ash耻ø䃸l;折iŬⸯ⸴de耻õ䃵esĀ;aǛ⸺s;樶ml耻ö䃶bar;挽ૡ⹞\0⹽\0⺀⺝\0⺢⺹\0\0⻋ຜ\0⼓\0\0⼫⾼\0⿈rȀ;astЃ⹧⹲຅脀¶;l⹭⹮䂶leìЃɩ⹸\0\0⹻m;櫳;櫽y;䐿rʀcimpt⺋⺏⺓ᡥ⺗nt;䀥od;䀮il;怰enk;怱r;쀀𝔭ƀimo⺨⺰⺴Ā;v⺭⺮䏆;䏕maô੶ne;明ƀ;tv⺿⻀⻈䏀chfork»´;䏖Āau⻏⻟nĀck⻕⻝kĀ;h⇴⻛;愎ö⇴sҀ;abcdemst⻳⻴ᤈ⻹⻽⼄⼆⼊⼎䀫cir;樣ir;樢Āouᵀ⼂;樥;橲n肻±ຝim;樦wo;樧ƀipu⼙⼠⼥ntint;樕f;쀀𝕡nd耻£䂣Ԁ;Eaceinosu່⼿⽁⽄⽇⾁⾉⾒⽾⾶;檳p;檷uå໙Ā;c໎⽌̀;acens່⽙⽟⽦⽨⽾pproø⽃urlyeñ໙ñ໎ƀaes⽯⽶⽺pprox;檹qq;檵im;拨iíໟmeĀ;s⾈ຮ怲ƀEas⽸⾐⽺ð⽵ƀdfp໬⾙⾯ƀals⾠⾥⾪lar;挮ine;挒urf;挓Ā;t໻⾴ï໻rel;抰Āci⿀⿅r;쀀𝓅;䏈ncsp;怈̀fiopsu⿚⋢⿟⿥⿫⿱r;쀀𝔮pf;쀀𝕢rime;恗cr;쀀𝓆ƀaeo⿸〉〓tĀei⿾々rnionóڰnt;樖stĀ;e【】䀿ñἙô༔઀ABHabcdefhilmnoprstux぀けさすムㄎㄫㅇㅢㅲㆎ㈆㈕㈤㈩㉘㉮㉲㊐㊰㊷ƀartぇおがròႳòϝail;検aròᱥar;楤΀cdenqrtとふへみわゔヌĀeuねぱ;쀀∽̱te;䅕iãᅮmptyv;榳gȀ;del࿑らるろ;榒;榥å࿑uo耻»䂻rր;abcfhlpstw࿜ガクシスゼゾダッデナp;極Ā;f࿠ゴs;椠;椳s;椞ë≝ð✮l;楅im;楴l;憣;憝Āaiパフil;椚oĀ;nホボ戶aló༞ƀabrョリヮrò៥rk;杳ĀakンヽcĀekヹ・;䁽;䁝Āes㄂㄄;榌lĀduㄊㄌ;榎;榐Ȁaeuyㄗㄜㄧㄩron;䅙Ādiㄡㄥil;䅗ì࿲âヺ;䑀Ȁclqsㄴㄷㄽㅄa;椷dhar;楩uoĀ;rȎȍh;憳ƀacgㅎㅟངlȀ;ipsླྀㅘㅛႜnåႻarôྩt;断ƀilrㅩဣㅮsht;楽;쀀𝔯ĀaoㅷㆆrĀduㅽㅿ»ѻĀ;l႑ㆄ;楬Ā;vㆋㆌ䏁;䏱ƀgns㆕ㇹㇼht̀ahlrstㆤㆰ㇂㇘㇤㇮rrowĀ;t࿜ㆭaéトarpoonĀduㆻㆿowîㅾp»႒eftĀah㇊㇐rrowó࿪arpoonóՑightarrows;應quigarro÷ニhreetimes;拌g;䋚ingdotseñἲƀahm㈍㈐㈓rò࿪aòՑ;怏oustĀ;a㈞㈟掱che»㈟mid;櫮Ȁabpt㈲㈽㉀㉒Ānr㈷㈺g;柭r;懾rëဃƀafl㉇㉊㉎r;榆;쀀𝕣us;樮imes;樵Āap㉝㉧rĀ;g㉣㉤䀩t;榔olint;樒arò㇣Ȁachq㉻㊀Ⴜ㊅quo;怺r;쀀𝓇Ābu・㊊oĀ;rȔȓƀhir㊗㊛㊠reåㇸmes;拊iȀ;efl㊪ၙᠡ㊫方tri;槎luhar;楨;愞ൡ㋕㋛㋟㌬㌸㍱\0㍺㎤\0\0㏬㏰\0㐨㑈㑚㒭㒱㓊㓱\0㘖\0\0㘳cute;䅛quï➺Ԁ;Eaceinpsyᇭ㋳㋵㋿㌂㌋㌏㌟㌦㌩;檴ǰ㋺\0㋼;檸on;䅡uåᇾĀ;dᇳ㌇il;䅟rc;䅝ƀEas㌖㌘㌛;檶p;檺im;择olint;樓iíሄ;䑁otƀ;be㌴ᵇ㌵担;橦΀Aacmstx㍆㍊㍗㍛㍞㍣㍭rr;懘rĀhr㍐㍒ë∨Ā;oਸ਼਴t耻§䂧i;䀻war;椩mĀin㍩ðnuóñt;朶rĀ;o㍶⁕쀀𝔰Ȁacoy㎂㎆㎑㎠rp;景Āhy㎋㎏cy;䑉;䑈rtɭ㎙\0\0㎜iäᑤaraì⹯耻­䂭Āgm㎨㎴maƀ;fv㎱㎲㎲䏃;䏂Ѐ;deglnprካ㏅㏉㏎㏖㏞㏡㏦ot;橪Ā;q኱ኰĀ;E㏓㏔檞;檠Ā;E㏛㏜檝;檟e;扆lus;樤arr;楲aròᄽȀaeit㏸㐈㐏㐗Āls㏽㐄lsetmé㍪hp;樳parsl;槤Ādlᑣ㐔e;挣Ā;e㐜㐝檪Ā;s㐢㐣檬;쀀⪬︀ƀflp㐮㐳㑂tcy;䑌Ā;b㐸㐹䀯Ā;a㐾㐿槄r;挿f;쀀𝕤aĀdr㑍ЂesĀ;u㑔㑕晠it»㑕ƀcsu㑠㑹㒟Āau㑥㑯pĀ;sᆈ㑫;쀀⊓︀pĀ;sᆴ㑵;쀀⊔︀uĀbp㑿㒏ƀ;esᆗᆜ㒆etĀ;eᆗ㒍ñᆝƀ;esᆨᆭ㒖etĀ;eᆨ㒝ñᆮƀ;afᅻ㒦ְrť㒫ֱ»ᅼaròᅈȀcemt㒹㒾㓂㓅r;쀀𝓈tmîñiì㐕aræᆾĀar㓎㓕rĀ;f㓔ឿ昆Āan㓚㓭ightĀep㓣㓪psiloîỠhé⺯s»⡒ʀbcmnp㓻㕞ሉ㖋㖎Ҁ;Edemnprs㔎㔏㔑㔕㔞㔣㔬㔱㔶抂;櫅ot;檽Ā;dᇚ㔚ot;櫃ult;櫁ĀEe㔨㔪;櫋;把lus;檿arr;楹ƀeiu㔽㕒㕕tƀ;en㔎㕅㕋qĀ;qᇚ㔏eqĀ;q㔫㔨m;櫇Ābp㕚㕜;櫕;櫓c̀;acensᇭ㕬㕲㕹㕻㌦pproø㋺urlyeñᇾñᇳƀaes㖂㖈㌛pproø㌚qñ㌗g;晪ڀ123;Edehlmnps㖩㖬㖯ሜ㖲㖴㗀㗉㗕㗚㗟㗨㗭耻¹䂹耻²䂲耻³䂳;櫆Āos㖹㖼t;檾ub;櫘Ā;dሢ㗅ot;櫄sĀou㗏㗒l;柉b;櫗arr;楻ult;櫂ĀEe㗤㗦;櫌;抋lus;櫀ƀeiu㗴㘉㘌tƀ;enሜ㗼㘂qĀ;qሢ㖲eqĀ;q㗧㗤m;櫈Ābp㘑㘓;櫔;櫖ƀAan㘜㘠㘭rr;懙rĀhr㘦㘨ë∮Ā;oਫ਩war;椪lig耻ß䃟௡㙑㙝㙠ዎ㙳㙹\0㙾㛂\0\0\0\0\0㛛㜃\0㜉㝬\0\0\0㞇ɲ㙖\0\0㙛get;挖;䏄rë๟ƀaey㙦㙫㙰ron;䅥dil;䅣;䑂lrec;挕r;쀀𝔱Ȁeiko㚆㚝㚵㚼ǲ㚋\0㚑eĀ4fኄኁaƀ;sv㚘㚙㚛䎸ym;䏑Ācn㚢㚲kĀas㚨㚮pproø዁im»ኬsðኞĀas㚺㚮ð዁rn耻þ䃾Ǭ̟㛆⋧es膀×;bd㛏㛐㛘䃗Ā;aᤏ㛕r;樱;樰ƀeps㛡㛣㜀á⩍Ȁ;bcf҆㛬㛰㛴ot;挶ir;櫱Ā;o㛹㛼쀀𝕥rk;櫚á㍢rime;怴ƀaip㜏㜒㝤dåቈ΀adempst㜡㝍㝀㝑㝗㝜㝟ngleʀ;dlqr㜰㜱㜶㝀㝂斵own»ᶻeftĀ;e⠀㜾ñम;扜ightĀ;e㊪㝋ñၚot;旬inus;樺lus;樹b;槍ime;樻ezium;揢ƀcht㝲㝽㞁Āry㝷㝻;쀀𝓉;䑆cy;䑛rok;䅧Āio㞋㞎xô᝷headĀlr㞗㞠eftarro÷ࡏightarrow»ཝऀAHabcdfghlmoprstuw㟐㟓㟗㟤㟰㟼㠎㠜㠣㠴㡑㡝㡫㢩㣌㣒㣪㣶ròϭar;楣Ācr㟜㟢ute耻ú䃺òᅐrǣ㟪\0㟭y;䑞ve;䅭Āiy㟵㟺rc耻û䃻;䑃ƀabh㠃㠆㠋ròᎭlac;䅱aòᏃĀir㠓㠘sht;楾;쀀𝔲rave耻ù䃹š㠧㠱rĀlr㠬㠮»ॗ»ႃlk;斀Āct㠹㡍ɯ㠿\0\0㡊rnĀ;e㡅㡆挜r»㡆op;挏ri;旸Āal㡖㡚cr;䅫肻¨͉Āgp㡢㡦on;䅳f;쀀𝕦̀adhlsuᅋ㡸㡽፲㢑㢠ownáᎳarpoonĀlr㢈㢌efô㠭ighô㠯iƀ;hl㢙㢚㢜䏅»ᏺon»㢚parrows;懈ƀcit㢰㣄㣈ɯ㢶\0\0㣁rnĀ;e㢼㢽挝r»㢽op;挎ng;䅯ri;旹cr;쀀𝓊ƀdir㣙㣝㣢ot;拰lde;䅩iĀ;f㜰㣨»᠓Āam㣯㣲rò㢨l耻ü䃼angle;榧ހABDacdeflnoprsz㤜㤟㤩㤭㦵㦸㦽㧟㧤㧨㧳㧹㧽㨁㨠ròϷarĀ;v㤦㤧櫨;櫩asèϡĀnr㤲㤷grt;榜΀eknprst㓣㥆㥋㥒㥝㥤㦖appá␕othinçẖƀhir㓫⻈㥙opô⾵Ā;hᎷ㥢ïㆍĀiu㥩㥭gmá㎳Ābp㥲㦄setneqĀ;q㥽㦀쀀⊊︀;쀀⫋︀setneqĀ;q㦏㦒쀀⊋︀;쀀⫌︀Āhr㦛㦟etá㚜iangleĀlr㦪㦯eft»थight»ၑy;䐲ash»ံƀelr㧄㧒㧗ƀ;beⷪ㧋㧏ar;抻q;扚lip;拮Ābt㧜ᑨaòᑩr;쀀𝔳tré㦮suĀbp㧯㧱»ജ»൙pf;쀀𝕧roð໻tré㦴Ācu㨆㨋r;쀀𝓋Ābp㨐㨘nĀEe㦀㨖»㥾nĀEe㦒㨞»㦐igzag;榚΀cefoprs㨶㨻㩖㩛㩔㩡㩪irc;䅵Ādi㩀㩑Ābg㩅㩉ar;機eĀ;qᗺ㩏;扙erp;愘r;쀀𝔴pf;쀀𝕨Ā;eᑹ㩦atèᑹcr;쀀𝓌ૣណ㪇\0㪋\0㪐㪛\0\0㪝㪨㪫㪯\0\0㫃㫎\0㫘ៜ៟tré៑r;쀀𝔵ĀAa㪔㪗ròσrò৶;䎾ĀAa㪡㪤ròθrò৫að✓is;拻ƀdptឤ㪵㪾Āfl㪺ឩ;쀀𝕩imåឲĀAa㫇㫊ròώròਁĀcq㫒ីr;쀀𝓍Āpt៖㫜ré។Ѐacefiosu㫰㫽㬈㬌㬑㬕㬛㬡cĀuy㫶㫻te耻ý䃽;䑏Āiy㬂㬆rc;䅷;䑋n耻¥䂥r;쀀𝔶cy;䑗pf;쀀𝕪cr;쀀𝓎Ācm㬦㬩y;䑎l耻ÿ䃿Ԁacdefhiosw㭂㭈㭔㭘㭤㭩㭭㭴㭺㮀cute;䅺Āay㭍㭒ron;䅾;䐷ot;䅼Āet㭝㭡træᕟa;䎶r;쀀𝔷cy;䐶grarr;懝pf;쀀𝕫cr;쀀𝓏Ājn㮅㮇;怍j;怌'.split("").map(n=>n.charCodeAt(0))),xmlDecodeTree=new Uint16Array("Ȁaglq	\x1Bɭ\0\0p;䀦os;䀧t;䀾t;䀼uot;䀢".split("").map(n=>n.charCodeAt(0)));var _a;const decodeMap=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),fromCodePoint=(_a=String.fromCodePoint)!==null&&_a!==void 0?_a:function(n){let e="";return n>65535&&(n-=65536,e+=String.fromCharCode(n>>>10&1023|55296),n=56320|n&1023),e+=String.fromCharCode(n),e};function replaceCodePoint(n){var e;return n>=55296&&n<=57343||n>1114111?65533:(e=decodeMap.get(n))!==null&&e!==void 0?e:n}var CharCodes$1;(function(n){n[n.NUM=35]="NUM",n[n.SEMI=59]="SEMI",n[n.EQUALS=61]="EQUALS",n[n.ZERO=48]="ZERO",n[n.NINE=57]="NINE",n[n.LOWER_A=97]="LOWER_A",n[n.LOWER_F=102]="LOWER_F",n[n.LOWER_X=120]="LOWER_X",n[n.LOWER_Z=122]="LOWER_Z",n[n.UPPER_A=65]="UPPER_A",n[n.UPPER_F=70]="UPPER_F",n[n.UPPER_Z=90]="UPPER_Z"})(CharCodes$1||(CharCodes$1={}));const TO_LOWER_BIT=32;var BinTrieFlags;(function(n){n[n.VALUE_LENGTH=49152]="VALUE_LENGTH",n[n.BRANCH_LENGTH=16256]="BRANCH_LENGTH",n[n.JUMP_TABLE=127]="JUMP_TABLE"})(BinTrieFlags||(BinTrieFlags={}));function isNumber(n){return n>=CharCodes$1.ZERO&&n<=CharCodes$1.NINE}function isHexadecimalCharacter(n){return n>=CharCodes$1.UPPER_A&&n<=CharCodes$1.UPPER_F||n>=CharCodes$1.LOWER_A&&n<=CharCodes$1.LOWER_F}function isAsciiAlphaNumeric(n){return n>=CharCodes$1.UPPER_A&&n<=CharCodes$1.UPPER_Z||n>=CharCodes$1.LOWER_A&&n<=CharCodes$1.LOWER_Z||isNumber(n)}function isEntityInAttributeInvalidEnd(n){return n===CharCodes$1.EQUALS||isAsciiAlphaNumeric(n)}var EntityDecoderState;(function(n){n[n.EntityStart=0]="EntityStart",n[n.NumericStart=1]="NumericStart",n[n.NumericDecimal=2]="NumericDecimal",n[n.NumericHex=3]="NumericHex",n[n.NamedEntity=4]="NamedEntity"})(EntityDecoderState||(EntityDecoderState={}));var DecodingMode;(function(n){n[n.Legacy=0]="Legacy",n[n.Strict=1]="Strict",n[n.Attribute=2]="Attribute"})(DecodingMode||(DecodingMode={}));class EntityDecoder{constructor(e,t,r){this.decodeTree=e,this.emitCodePoint=t,this.errors=r,this.state=EntityDecoderState.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=DecodingMode.Strict}startEntity(e){this.decodeMode=e,this.state=EntityDecoderState.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,t){switch(this.state){case EntityDecoderState.EntityStart:return e.charCodeAt(t)===CharCodes$1.NUM?(this.state=EntityDecoderState.NumericStart,this.consumed+=1,this.stateNumericStart(e,t+1)):(this.state=EntityDecoderState.NamedEntity,this.stateNamedEntity(e,t));case EntityDecoderState.NumericStart:return this.stateNumericStart(e,t);case EntityDecoderState.NumericDecimal:return this.stateNumericDecimal(e,t);case EntityDecoderState.NumericHex:return this.stateNumericHex(e,t);case EntityDecoderState.NamedEntity:return this.stateNamedEntity(e,t)}}stateNumericStart(e,t){return t>=e.length?-1:(e.charCodeAt(t)|TO_LOWER_BIT)===CharCodes$1.LOWER_X?(this.state=EntityDecoderState.NumericHex,this.consumed+=1,this.stateNumericHex(e,t+1)):(this.state=EntityDecoderState.NumericDecimal,this.stateNumericDecimal(e,t))}addToNumericResult(e,t,r,s){if(t!==r){const o=r-t;this.result=this.result*Math.pow(s,o)+Number.parseInt(e.substr(t,o),s),this.consumed+=o}}stateNumericHex(e,t){const r=t;for(;t<e.length;){const s=e.charCodeAt(t);if(isNumber(s)||isHexadecimalCharacter(s))t+=1;else return this.addToNumericResult(e,r,t,16),this.emitNumericEntity(s,3)}return this.addToNumericResult(e,r,t,16),-1}stateNumericDecimal(e,t){const r=t;for(;t<e.length;){const s=e.charCodeAt(t);if(isNumber(s))t+=1;else return this.addToNumericResult(e,r,t,10),this.emitNumericEntity(s,2)}return this.addToNumericResult(e,r,t,10),-1}emitNumericEntity(e,t){var r;if(this.consumed<=t)return(r=this.errors)===null||r===void 0||r.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===CharCodes$1.SEMI)this.consumed+=1;else if(this.decodeMode===DecodingMode.Strict)return 0;return this.emitCodePoint(replaceCodePoint(this.result),this.consumed),this.errors&&(e!==CharCodes$1.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,t){const{decodeTree:r}=this;let s=r[this.treeIndex],o=(s&BinTrieFlags.VALUE_LENGTH)>>14;for(;t<e.length;t++,this.excess++){const a=e.charCodeAt(t);if(this.treeIndex=determineBranch(r,s,this.treeIndex+Math.max(1,o),a),this.treeIndex<0)return this.result===0||this.decodeMode===DecodingMode.Attribute&&(o===0||isEntityInAttributeInvalidEnd(a))?0:this.emitNotTerminatedNamedEntity();if(s=r[this.treeIndex],o=(s&BinTrieFlags.VALUE_LENGTH)>>14,o!==0){if(a===CharCodes$1.SEMI)return this.emitNamedEntityData(this.treeIndex,o,this.consumed+this.excess);this.decodeMode!==DecodingMode.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:t,decodeTree:r}=this,s=(r[t]&BinTrieFlags.VALUE_LENGTH)>>14;return this.emitNamedEntityData(t,s,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,t,r){const{decodeTree:s}=this;return this.emitCodePoint(t===1?s[e]&~BinTrieFlags.VALUE_LENGTH:s[e+1],r),t===3&&this.emitCodePoint(s[e+2],r),r}end(){var e;switch(this.state){case EntityDecoderState.NamedEntity:return this.result!==0&&(this.decodeMode!==DecodingMode.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case EntityDecoderState.NumericDecimal:return this.emitNumericEntity(0,2);case EntityDecoderState.NumericHex:return this.emitNumericEntity(0,3);case EntityDecoderState.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case EntityDecoderState.EntityStart:return 0}}}function determineBranch(n,e,t,r){const s=(e&BinTrieFlags.BRANCH_LENGTH)>>7,o=e&BinTrieFlags.JUMP_TABLE;if(s===0)return o!==0&&r===o?t:-1;if(o){const c=r-o;return c<0||c>=s?-1:n[t+c]-1}let a=t,u=a+s-1;for(;a<=u;){const c=a+u>>>1,l=n[c];if(l<r)a=c+1;else if(l>r)u=c-1;else return n[c+s]}return-1}var CharCodes;(function(n){n[n.Tab=9]="Tab",n[n.NewLine=10]="NewLine",n[n.FormFeed=12]="FormFeed",n[n.CarriageReturn=13]="CarriageReturn",n[n.Space=32]="Space",n[n.ExclamationMark=33]="ExclamationMark",n[n.Number=35]="Number",n[n.Amp=38]="Amp",n[n.SingleQuote=39]="SingleQuote",n[n.DoubleQuote=34]="DoubleQuote",n[n.Dash=45]="Dash",n[n.Slash=47]="Slash",n[n.Zero=48]="Zero",n[n.Nine=57]="Nine",n[n.Semi=59]="Semi",n[n.Lt=60]="Lt",n[n.Eq=61]="Eq",n[n.Gt=62]="Gt",n[n.Questionmark=63]="Questionmark",n[n.UpperA=65]="UpperA",n[n.LowerA=97]="LowerA",n[n.UpperF=70]="UpperF",n[n.LowerF=102]="LowerF",n[n.UpperZ=90]="UpperZ",n[n.LowerZ=122]="LowerZ",n[n.LowerX=120]="LowerX",n[n.OpeningSquareBracket=91]="OpeningSquareBracket"})(CharCodes||(CharCodes={}));var State;(function(n){n[n.Text=1]="Text",n[n.BeforeTagName=2]="BeforeTagName",n[n.InTagName=3]="InTagName",n[n.InSelfClosingTag=4]="InSelfClosingTag",n[n.BeforeClosingTagName=5]="BeforeClosingTagName",n[n.InClosingTagName=6]="InClosingTagName",n[n.AfterClosingTagName=7]="AfterClosingTagName",n[n.BeforeAttributeName=8]="BeforeAttributeName",n[n.InAttributeName=9]="InAttributeName",n[n.AfterAttributeName=10]="AfterAttributeName",n[n.BeforeAttributeValue=11]="BeforeAttributeValue",n[n.InAttributeValueDq=12]="InAttributeValueDq",n[n.InAttributeValueSq=13]="InAttributeValueSq",n[n.InAttributeValueNq=14]="InAttributeValueNq",n[n.BeforeDeclaration=15]="BeforeDeclaration",n[n.InDeclaration=16]="InDeclaration",n[n.InProcessingInstruction=17]="InProcessingInstruction",n[n.BeforeComment=18]="BeforeComment",n[n.CDATASequence=19]="CDATASequence",n[n.InSpecialComment=20]="InSpecialComment",n[n.InCommentLike=21]="InCommentLike",n[n.BeforeSpecialS=22]="BeforeSpecialS",n[n.BeforeSpecialT=23]="BeforeSpecialT",n[n.SpecialStartSequence=24]="SpecialStartSequence",n[n.InSpecialTag=25]="InSpecialTag",n[n.InEntity=26]="InEntity"})(State||(State={}));function isWhitespace(n){return n===CharCodes.Space||n===CharCodes.NewLine||n===CharCodes.Tab||n===CharCodes.FormFeed||n===CharCodes.CarriageReturn}function isEndOfTagSection(n){return n===CharCodes.Slash||n===CharCodes.Gt||isWhitespace(n)}function isASCIIAlpha(n){return n>=CharCodes.LowerA&&n<=CharCodes.LowerZ||n>=CharCodes.UpperA&&n<=CharCodes.UpperZ}var QuoteType;(function(n){n[n.NoValue=0]="NoValue",n[n.Unquoted=1]="Unquoted",n[n.Single=2]="Single",n[n.Double=3]="Double"})(QuoteType||(QuoteType={}));const Sequences={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97]),XmpEnd:new Uint8Array([60,47,120,109,112])};class Tokenizer{constructor({xmlMode:e=!1,decodeEntities:t=!0},r){this.cbs=r,this.state=State.Text,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=State.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.xmlMode=e,this.decodeEntities=t,this.entityDecoder=new EntityDecoder(e?xmlDecodeTree:htmlDecodeTree,(s,o)=>this.emitCodePoint(s,o))}reset(){this.state=State.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=State.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(e){this.offset+=this.buffer.length,this.buffer=e,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}stateText(e){e===CharCodes.Lt||!this.decodeEntities&&this.fastForwardTo(CharCodes.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=State.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&e===CharCodes.Amp&&this.startEntity()}stateSpecialStartSequence(e){const t=this.sequenceIndex===this.currentSequence.length;if(!(t?isEndOfTagSection(e):(e|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!t){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=State.InTagName,this.stateInTagName(e)}stateInSpecialTag(e){if(this.sequenceIndex===this.currentSequence.length){if(e===CharCodes.Gt||isWhitespace(e)){const t=this.index-this.currentSequence.length;if(this.sectionStart<t){const r=this.index;this.index=t,this.cbs.ontext(this.sectionStart,t),this.index=r}this.isSpecial=!1,this.sectionStart=t+2,this.stateInClosingTagName(e);return}this.sequenceIndex=0}(e|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Sequences.TitleEnd?this.decodeEntities&&e===CharCodes.Amp&&this.startEntity():this.fastForwardTo(CharCodes.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(e===CharCodes.Lt)}stateCDATASequence(e){e===Sequences.Cdata[this.sequenceIndex]?++this.sequenceIndex===Sequences.Cdata.length&&(this.state=State.InCommentLike,this.currentSequence=Sequences.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=State.InDeclaration,this.stateInDeclaration(e))}fastForwardTo(e){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===e)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(e){e===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Sequences.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=State.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):e!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(e){return this.xmlMode?!isEndOfTagSection(e):isASCIIAlpha(e)}startSpecial(e,t){this.isSpecial=!0,this.currentSequence=e,this.sequenceIndex=t,this.state=State.SpecialStartSequence}stateBeforeTagName(e){if(e===CharCodes.ExclamationMark)this.state=State.BeforeDeclaration,this.sectionStart=this.index+1;else if(e===CharCodes.Questionmark)this.state=State.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(e)){const t=e|32;this.sectionStart=this.index,this.xmlMode?this.state=State.InTagName:t===Sequences.ScriptEnd[2]?this.state=State.BeforeSpecialS:t===Sequences.TitleEnd[2]||t===Sequences.XmpEnd[2]?this.state=State.BeforeSpecialT:this.state=State.InTagName}else e===CharCodes.Slash?this.state=State.BeforeClosingTagName:(this.state=State.Text,this.stateText(e))}stateInTagName(e){isEndOfTagSection(e)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(e))}stateBeforeClosingTagName(e){isWhitespace(e)||(e===CharCodes.Gt?this.state=State.Text:(this.state=this.isTagStartChar(e)?State.InClosingTagName:State.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(e){(e===CharCodes.Gt||isWhitespace(e))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=State.AfterClosingTagName,this.stateAfterClosingTagName(e))}stateAfterClosingTagName(e){(e===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.state=State.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(e){e===CharCodes.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=State.InSpecialTag,this.sequenceIndex=0):this.state=State.Text,this.sectionStart=this.index+1):e===CharCodes.Slash?this.state=State.InSelfClosingTag:isWhitespace(e)||(this.state=State.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(e){e===CharCodes.Gt?(this.cbs.onselfclosingtag(this.index),this.state=State.Text,this.sectionStart=this.index+1,this.isSpecial=!1):isWhitespace(e)||(this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(e))}stateInAttributeName(e){(e===CharCodes.Eq||isEndOfTagSection(e))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=this.index,this.state=State.AfterAttributeName,this.stateAfterAttributeName(e))}stateAfterAttributeName(e){e===CharCodes.Eq?this.state=State.BeforeAttributeValue:e===CharCodes.Slash||e===CharCodes.Gt?(this.cbs.onattribend(QuoteType.NoValue,this.sectionStart),this.sectionStart=-1,this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(e)):isWhitespace(e)||(this.cbs.onattribend(QuoteType.NoValue,this.sectionStart),this.state=State.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(e){e===CharCodes.DoubleQuote?(this.state=State.InAttributeValueDq,this.sectionStart=this.index+1):e===CharCodes.SingleQuote?(this.state=State.InAttributeValueSq,this.sectionStart=this.index+1):isWhitespace(e)||(this.sectionStart=this.index,this.state=State.InAttributeValueNq,this.stateInAttributeValueNoQuotes(e))}handleInAttributeValue(e,t){e===t||!this.decodeEntities&&this.fastForwardTo(t)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(t===CharCodes.DoubleQuote?QuoteType.Double:QuoteType.Single,this.index+1),this.state=State.BeforeAttributeName):this.decodeEntities&&e===CharCodes.Amp&&this.startEntity()}stateInAttributeValueDoubleQuotes(e){this.handleInAttributeValue(e,CharCodes.DoubleQuote)}stateInAttributeValueSingleQuotes(e){this.handleInAttributeValue(e,CharCodes.SingleQuote)}stateInAttributeValueNoQuotes(e){isWhitespace(e)||e===CharCodes.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(QuoteType.Unquoted,this.index),this.state=State.BeforeAttributeName,this.stateBeforeAttributeName(e)):this.decodeEntities&&e===CharCodes.Amp&&this.startEntity()}stateBeforeDeclaration(e){e===CharCodes.OpeningSquareBracket?(this.state=State.CDATASequence,this.sequenceIndex=0):this.state=e===CharCodes.Dash?State.BeforeComment:State.InDeclaration}stateInDeclaration(e){(e===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=State.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(e){(e===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=State.Text,this.sectionStart=this.index+1)}stateBeforeComment(e){e===CharCodes.Dash?(this.state=State.InCommentLike,this.currentSequence=Sequences.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=State.InDeclaration}stateInSpecialComment(e){(e===CharCodes.Gt||this.fastForwardTo(CharCodes.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=State.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(e){const t=e|32;t===Sequences.ScriptEnd[3]?this.startSpecial(Sequences.ScriptEnd,4):t===Sequences.StyleEnd[3]?this.startSpecial(Sequences.StyleEnd,4):(this.state=State.InTagName,this.stateInTagName(e))}stateBeforeSpecialT(e){switch(e|32){case Sequences.TitleEnd[3]:{this.startSpecial(Sequences.TitleEnd,4);break}case Sequences.TextareaEnd[3]:{this.startSpecial(Sequences.TextareaEnd,4);break}case Sequences.XmpEnd[3]:{this.startSpecial(Sequences.XmpEnd,4);break}default:this.state=State.InTagName,this.stateInTagName(e)}}startEntity(){this.baseState=this.state,this.state=State.InEntity,this.entityStart=this.index,this.entityDecoder.startEntity(this.xmlMode?DecodingMode.Strict:this.baseState===State.Text||this.baseState===State.InSpecialTag?DecodingMode.Legacy:DecodingMode.Attribute)}stateInEntity(){const e=this.entityDecoder.write(this.buffer,this.index-this.offset);e>=0?(this.state=this.baseState,e===0&&(this.index=this.entityStart)):this.index=this.offset+this.buffer.length-1}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===State.Text||this.state===State.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===State.InAttributeValueDq||this.state===State.InAttributeValueSq||this.state===State.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const e=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case State.Text:{this.stateText(e);break}case State.SpecialStartSequence:{this.stateSpecialStartSequence(e);break}case State.InSpecialTag:{this.stateInSpecialTag(e);break}case State.CDATASequence:{this.stateCDATASequence(e);break}case State.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(e);break}case State.InAttributeName:{this.stateInAttributeName(e);break}case State.InCommentLike:{this.stateInCommentLike(e);break}case State.InSpecialComment:{this.stateInSpecialComment(e);break}case State.BeforeAttributeName:{this.stateBeforeAttributeName(e);break}case State.InTagName:{this.stateInTagName(e);break}case State.InClosingTagName:{this.stateInClosingTagName(e);break}case State.BeforeTagName:{this.stateBeforeTagName(e);break}case State.AfterAttributeName:{this.stateAfterAttributeName(e);break}case State.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(e);break}case State.BeforeAttributeValue:{this.stateBeforeAttributeValue(e);break}case State.BeforeClosingTagName:{this.stateBeforeClosingTagName(e);break}case State.AfterClosingTagName:{this.stateAfterClosingTagName(e);break}case State.BeforeSpecialS:{this.stateBeforeSpecialS(e);break}case State.BeforeSpecialT:{this.stateBeforeSpecialT(e);break}case State.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(e);break}case State.InSelfClosingTag:{this.stateInSelfClosingTag(e);break}case State.InDeclaration:{this.stateInDeclaration(e);break}case State.BeforeDeclaration:{this.stateBeforeDeclaration(e);break}case State.BeforeComment:{this.stateBeforeComment(e);break}case State.InProcessingInstruction:{this.stateInProcessingInstruction(e);break}case State.InEntity:{this.stateInEntity();break}}this.index++}this.cleanup()}finish(){this.state===State.InEntity&&(this.entityDecoder.end(),this.state=this.baseState),this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const e=this.buffer.length+this.offset;this.sectionStart>=e||(this.state===State.InCommentLike?this.currentSequence===Sequences.CdataEnd?this.cbs.oncdata(this.sectionStart,e,0):this.cbs.oncomment(this.sectionStart,e,0):this.state===State.InTagName||this.state===State.BeforeAttributeName||this.state===State.BeforeAttributeValue||this.state===State.AfterAttributeName||this.state===State.InAttributeName||this.state===State.InAttributeValueSq||this.state===State.InAttributeValueDq||this.state===State.InAttributeValueNq||this.state===State.InClosingTagName||this.cbs.ontext(this.sectionStart,e))}emitCodePoint(e,t){this.baseState!==State.Text&&this.baseState!==State.InSpecialTag?(this.sectionStart<this.entityStart&&this.cbs.onattribdata(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+t,this.index=this.sectionStart-1,this.cbs.onattribentity(e)):(this.sectionStart<this.entityStart&&this.cbs.ontext(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+t,this.index=this.sectionStart-1,this.cbs.ontextentity(e,this.sectionStart))}}const formTags=new Set(["input","option","optgroup","select","button","datalist","textarea"]),pTag=new Set(["p"]),tableSectionTags=new Set(["thead","tbody"]),ddtTags=new Set(["dd","dt"]),rtpTags=new Set(["rt","rp"]),openImpliesClose=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",pTag],["h1",pTag],["h2",pTag],["h3",pTag],["h4",pTag],["h5",pTag],["h6",pTag],["select",formTags],["input",formTags],["output",formTags],["button",formTags],["datalist",formTags],["textarea",formTags],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",ddtTags],["dt",ddtTags],["address",pTag],["article",pTag],["aside",pTag],["blockquote",pTag],["details",pTag],["div",pTag],["dl",pTag],["fieldset",pTag],["figcaption",pTag],["figure",pTag],["footer",pTag],["form",pTag],["header",pTag],["hr",pTag],["main",pTag],["nav",pTag],["ol",pTag],["pre",pTag],["section",pTag],["table",pTag],["ul",pTag],["rt",rtpTags],["rp",rtpTags],["tbody",tableSectionTags],["tfoot",tableSectionTags]]),voidElements=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),foreignContextElements=new Set(["math","svg"]),htmlIntegrationElements=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),reNameEnd=/\s|\//;class Parser{constructor(e,t={}){var r,s,o,a,u,c;this.options=t,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=e??{},this.htmlMode=!this.options.xmlMode,this.lowerCaseTagNames=(r=t.lowerCaseTags)!==null&&r!==void 0?r:this.htmlMode,this.lowerCaseAttributeNames=(s=t.lowerCaseAttributeNames)!==null&&s!==void 0?s:this.htmlMode,this.recognizeSelfClosing=(o=t.recognizeSelfClosing)!==null&&o!==void 0?o:!this.htmlMode,this.tokenizer=new((a=t.Tokenizer)!==null&&a!==void 0?a:Tokenizer)(this.options,this),this.foreignContext=[!this.htmlMode],(c=(u=this.cbs).onparserinit)===null||c===void 0||c.call(u,this)}ontext(e,t){var r,s;const o=this.getSlice(e,t);this.endIndex=t-1,(s=(r=this.cbs).ontext)===null||s===void 0||s.call(r,o),this.startIndex=t}ontextentity(e,t){var r,s;this.endIndex=t-1,(s=(r=this.cbs).ontext)===null||s===void 0||s.call(r,fromCodePoint(e)),this.startIndex=t}isVoidElement(e){return this.htmlMode&&voidElements.has(e)}onopentagname(e,t){this.endIndex=t;let r=this.getSlice(e,t);this.lowerCaseTagNames&&(r=r.toLowerCase()),this.emitOpenTag(r)}emitOpenTag(e){var t,r,s,o;this.openTagStart=this.startIndex,this.tagname=e;const a=this.htmlMode&&openImpliesClose.get(e);if(a)for(;this.stack.length>0&&a.has(this.stack[0]);){const u=this.stack.shift();(r=(t=this.cbs).onclosetag)===null||r===void 0||r.call(t,u,!0)}this.isVoidElement(e)||(this.stack.unshift(e),this.htmlMode&&(foreignContextElements.has(e)?this.foreignContext.unshift(!0):htmlIntegrationElements.has(e)&&this.foreignContext.unshift(!1))),(o=(s=this.cbs).onopentagname)===null||o===void 0||o.call(s,e),this.cbs.onopentag&&(this.attribs={})}endOpenTag(e){var t,r;this.startIndex=this.openTagStart,this.attribs&&((r=(t=this.cbs).onopentag)===null||r===void 0||r.call(t,this.tagname,this.attribs,e),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(e){this.endIndex=e,this.endOpenTag(!1),this.startIndex=e+1}onclosetag(e,t){var r,s,o,a,u,c,l,f;this.endIndex=t;let h=this.getSlice(e,t);if(this.lowerCaseTagNames&&(h=h.toLowerCase()),this.htmlMode&&(foreignContextElements.has(h)||htmlIntegrationElements.has(h))&&this.foreignContext.shift(),this.isVoidElement(h))this.htmlMode&&h==="br"&&((a=(o=this.cbs).onopentagname)===null||a===void 0||a.call(o,"br"),(c=(u=this.cbs).onopentag)===null||c===void 0||c.call(u,"br",{},!0),(f=(l=this.cbs).onclosetag)===null||f===void 0||f.call(l,"br",!1));else{const g=this.stack.indexOf(h);if(g!==-1)for(let m=0;m<=g;m++){const v=this.stack.shift();(s=(r=this.cbs).onclosetag)===null||s===void 0||s.call(r,v,m!==g)}else this.htmlMode&&h==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=t+1}onselfclosingtag(e){this.endIndex=e,this.recognizeSelfClosing||this.foreignContext[0]?(this.closeCurrentTag(!1),this.startIndex=e+1):this.onopentagend(e)}closeCurrentTag(e){var t,r;const s=this.tagname;this.endOpenTag(e),this.stack[0]===s&&((r=(t=this.cbs).onclosetag)===null||r===void 0||r.call(t,s,!e),this.stack.shift())}onattribname(e,t){this.startIndex=e;const r=this.getSlice(e,t);this.attribname=this.lowerCaseAttributeNames?r.toLowerCase():r}onattribdata(e,t){this.attribvalue+=this.getSlice(e,t)}onattribentity(e){this.attribvalue+=fromCodePoint(e)}onattribend(e,t){var r,s;this.endIndex=t,(s=(r=this.cbs).onattribute)===null||s===void 0||s.call(r,this.attribname,this.attribvalue,e===QuoteType.Double?'"':e===QuoteType.Single?"'":e===QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(e){const t=e.search(reNameEnd);let r=t<0?e:e.substr(0,t);return this.lowerCaseTagNames&&(r=r.toLowerCase()),r}ondeclaration(e,t){this.endIndex=t;const r=this.getSlice(e,t);if(this.cbs.onprocessinginstruction){const s=this.getInstructionName(r);this.cbs.onprocessinginstruction(`!${s}`,`!${r}`)}this.startIndex=t+1}onprocessinginstruction(e,t){this.endIndex=t;const r=this.getSlice(e,t);if(this.cbs.onprocessinginstruction){const s=this.getInstructionName(r);this.cbs.onprocessinginstruction(`?${s}`,`?${r}`)}this.startIndex=t+1}oncomment(e,t,r){var s,o,a,u;this.endIndex=t,(o=(s=this.cbs).oncomment)===null||o===void 0||o.call(s,this.getSlice(e,t-r)),(u=(a=this.cbs).oncommentend)===null||u===void 0||u.call(a),this.startIndex=t+1}oncdata(e,t,r){var s,o,a,u,c,l,f,h,g,m;this.endIndex=t;const v=this.getSlice(e,t-r);!this.htmlMode||this.options.recognizeCDATA?((o=(s=this.cbs).oncdatastart)===null||o===void 0||o.call(s),(u=(a=this.cbs).ontext)===null||u===void 0||u.call(a,v),(l=(c=this.cbs).oncdataend)===null||l===void 0||l.call(c)):((h=(f=this.cbs).oncomment)===null||h===void 0||h.call(f,`[CDATA[${v}]]`),(m=(g=this.cbs).oncommentend)===null||m===void 0||m.call(g)),this.startIndex=t+1}onend(){var e,t;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let r=0;r<this.stack.length;r++)this.cbs.onclosetag(this.stack[r],!0)}(t=(e=this.cbs).onend)===null||t===void 0||t.call(e)}reset(){var e,t,r,s;(t=(e=this.cbs).onreset)===null||t===void 0||t.call(e),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(s=(r=this.cbs).onparserinit)===null||s===void 0||s.call(r,this),this.buffers.length=0,this.foreignContext.length=0,this.foreignContext.unshift(!this.htmlMode),this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(e){this.reset(),this.end(e)}getSlice(e,t){for(;e-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let r=this.buffers[0].slice(e-this.bufferOffset,t-this.bufferOffset);for(;t-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),r+=this.buffers[0].slice(0,t-this.bufferOffset);return r}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(e){var t,r;if(this.ended){(r=(t=this.cbs).onerror)===null||r===void 0||r.call(t,new Error(".write() after done!"));return}this.buffers.push(e),this.tokenizer.running&&(this.tokenizer.write(e),this.writeIndex++)}end(e){var t,r;if(this.ended){(r=(t=this.cbs).onerror)===null||r===void 0||r.call(t,new Error(".end() after done!"));return}e&&this.write(e),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(e){this.write(e)}done(e){this.end(e)}}var ElementType$2;(function(n){n.Root="root",n.Text="text",n.Directive="directive",n.Comment="comment",n.Script="script",n.Style="style",n.Tag="tag",n.CDATA="cdata",n.Doctype="doctype"})(ElementType$2||(ElementType$2={}));function isTag$1(n){return n.type===ElementType$2.Tag||n.type===ElementType$2.Script||n.type===ElementType$2.Style}ElementType$2.Root,ElementType$2.Text,ElementType$2.Directive,ElementType$2.Comment,ElementType$2.Script,ElementType$2.Style,ElementType$2.Tag,ElementType$2.CDATA,ElementType$2.Doctype;function isTag(n){return isTag$1(n)}function hasChildren(n){return Object.prototype.hasOwnProperty.call(n,"children")}var ElementType$1;(function(n){n.Root="root",n.Text="text",n.Directive="directive",n.Comment="comment",n.Script="script",n.Style="style",n.Tag="tag",n.CDATA="cdata",n.Doctype="doctype"})(ElementType$1||(ElementType$1={}));const Root=ElementType$1.Root,Text=ElementType$1.Text,Directive=ElementType$1.Directive,Comment=ElementType$1.Comment,Script=ElementType$1.Script,Style=ElementType$1.Style,Tag=ElementType$1.Tag,CDATA=ElementType$1.CDATA,Doctype=ElementType$1.Doctype,xmlReplacer=/["&'<>$\x80-\uFFFF]/g,xmlCodeMap=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]),getCodePoint=String.prototype.codePointAt!=null?(n,e)=>n.codePointAt(e):(n,e)=>(n.charCodeAt(e)&64512)===55296?(n.charCodeAt(e)-55296)*1024+n.charCodeAt(e+1)-56320+65536:n.charCodeAt(e);function encodeXML(n){let e="",t=0,r;for(;(r=xmlReplacer.exec(n))!==null;){const s=r.index,o=n.charCodeAt(s),a=xmlCodeMap.get(o);a!==void 0?(e+=n.substring(t,s)+a,t=s+1):(e+=`${n.substring(t,s)}&#x${getCodePoint(n,s).toString(16)};`,t=xmlReplacer.lastIndex+=+((o&64512)===55296))}return e+n.substr(t)}function getEscaper(n,e){return function(r){let s,o=0,a="";for(;s=n.exec(r);)o!==s.index&&(a+=r.substring(o,s.index)),a+=e.get(s[0].charCodeAt(0)),o=s.index+1;return a+r.substring(o)}}const escapeAttribute=getEscaper(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),escapeText=getEscaper(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]])),elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(n=>[n.toLowerCase(),n])),attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(n=>[n.toLowerCase(),n])),unencodedElements=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function replaceQuotes(n){return n.replace(/"/g,"&quot;")}function formatAttributes(n,e){var t;if(!n)return;const r=((t=e.encodeEntities)!==null&&t!==void 0?t:e.decodeEntities)===!1?replaceQuotes:e.xmlMode||e.encodeEntities!=="utf8"?encodeXML:escapeAttribute;return Object.keys(n).map(s=>{var o,a;const u=(o=n[s])!==null&&o!==void 0?o:"";return e.xmlMode==="foreign"&&(s=(a=attributeNames.get(s))!==null&&a!==void 0?a:s),!e.emptyAttrs&&!e.xmlMode&&u===""?s:`${s}="${r(u)}"`}).join(" ")}const singleTag=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function render(n,e={}){const t="length"in n?n:[n];let r="";for(let s=0;s<t.length;s++)r+=renderNode(t[s],e);return r}function renderNode(n,e){switch(n.type){case Root:return render(n.children,e);case Doctype:case Directive:return renderDirective(n);case Comment:return renderComment(n);case CDATA:return renderCdata(n);case Script:case Style:case Tag:return renderTag(n,e);case Text:return renderText(n,e)}}const foreignModeIntegrationPoints=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),foreignElements=new Set(["svg","math"]);function renderTag(n,e){var t;e.xmlMode==="foreign"&&(n.name=(t=elementNames.get(n.name))!==null&&t!==void 0?t:n.name,n.parent&&foreignModeIntegrationPoints.has(n.parent.name)&&(e={...e,xmlMode:!1})),!e.xmlMode&&foreignElements.has(n.name)&&(e={...e,xmlMode:"foreign"});let r=`<${n.name}`;const s=formatAttributes(n.attribs,e);return s&&(r+=` ${s}`),n.children.length===0&&(e.xmlMode?e.selfClosingTags!==!1:e.selfClosingTags&&singleTag.has(n.name))?(e.xmlMode||(r+=" "),r+="/>"):(r+=">",n.children.length>0&&(r+=render(n.children,e)),(e.xmlMode||!singleTag.has(n.name))&&(r+=`</${n.name}>`)),r}function renderDirective(n){return`<${n.data}>`}function renderText(n,e){var t;let r=n.data||"";return((t=e.encodeEntities)!==null&&t!==void 0?t:e.decodeEntities)!==!1&&!(!e.xmlMode&&n.parent&&unencodedElements.has(n.parent.name))&&(r=e.xmlMode||e.encodeEntities!=="utf8"?encodeXML(r):escapeText(r)),r}function renderCdata(n){return`<![CDATA[${n.children[0].data}]]>`}function renderComment(n){return`<!--${n.data}-->`}function getOuterHTML(n,e){return render(n,e)}function findAll(n,e){const t=[],r=[Array.isArray(e)?e:[e]],s=[0];for(;;){if(s[0]>=r[0].length){if(r.length===1)return t;r.shift(),s.shift();continue}const o=r[0][s[0]++];isTag(o)&&n(o)&&t.push(o),hasChildren(o)&&o.children.length>0&&(s.unshift(0),r.unshift(o.children))}}var domelementtype={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata"},node={exports:{}};node.exports={get firstChild(){var n=this.children;return n&&n[0]||null},get lastChild(){var n=this.children;return n&&n[n.length-1]||null},get nodeType(){return nodeTypes[this.type]||nodeTypes.element}};var domLvl1$1={tagName:"name",childNodes:"children",parentNode:"parent",previousSibling:"prev",nextSibling:"next",nodeValue:"data"},nodeTypes={element:1,text:3,cdata:4,comment:8};Object.keys(domLvl1$1).forEach(function(n){});var nodeExports=node.exports,element={exports:{}},NodePrototype$1=nodeExports,ElementPrototype$1=element.exports=Object.create(NodePrototype$1),domLvl1={tagName:"name"};Object.keys(domLvl1).forEach(function(n){var e=domLvl1[n];Object.defineProperty(ElementPrototype$1,n,{get:function(){return this[e]||null},set:function(t){return this[e]=t,t}})});var elementExports=element.exports,ElementType=domelementtype,re_whitespace=/\s+/g,NodePrototype=nodeExports,ElementPrototype=elementExports;function DomHandler(n,e,t){typeof n=="object"?(t=e,e=n,n=null):typeof e=="function"&&(t=e,e=defaultOpts),this._callback=n,this._options=e||defaultOpts,this._elementCB=t,this.dom=[],this._done=!1,this._tagStack=[],this._parser=this._parser||null}var defaultOpts={normalizeWhitespace:!1,withStartIndices:!1,withEndIndices:!1};DomHandler.prototype.onparserinit=function(n){this._parser=n},DomHandler.prototype.onreset=function(){DomHandler.call(this,this._callback,this._options,this._elementCB)},DomHandler.prototype.onend=function(){this._done||(this._done=!0,this._parser=null,this._handleCallback(null))},DomHandler.prototype._handleCallback=DomHandler.prototype.onerror=function(n){if(typeof this._callback=="function")this._callback(n,this.dom);else if(n)throw n},DomHandler.prototype.onclosetag=function(){var n=this._tagStack.pop();this._options.withEndIndices&&n&&(n.endIndex=this._parser.endIndex),this._elementCB&&this._elementCB(n)},DomHandler.prototype._createDomElement=function(n){if(!this._options.withDomLvl1)return n;var e;n.type==="tag"?e=Object.create(ElementPrototype):e=Object.create(NodePrototype);for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e},DomHandler.prototype._addDomElement=function(n){var e=this._tagStack[this._tagStack.length-1],t=e?e.children:this.dom,r=t[t.length-1];n.next=null,this._options.withStartIndices&&(n.startIndex=this._parser.startIndex),this._options.withEndIndices&&(n.endIndex=this._parser.endIndex),r?(n.prev=r,r.next=n):n.prev=null,t.push(n),n.parent=e||null},DomHandler.prototype.onopentag=function(n,e){var t={type:n==="script"?ElementType.Script:n==="style"?ElementType.Style:ElementType.Tag,name:n,attribs:e,children:[]},r=this._createDomElement(t);this._addDomElement(r),this._tagStack.push(r)},DomHandler.prototype.ontext=function(n){var e=this._options.normalizeWhitespace||this._options.ignoreWhitespace,t;if(!this._tagStack.length&&this.dom.length&&(t=this.dom[this.dom.length-1]).type===ElementType.Text)e?t.data=(t.data+n).replace(re_whitespace," "):t.data+=n;else if(this._tagStack.length&&(t=this._tagStack[this._tagStack.length-1])&&(t=t.children[t.children.length-1])&&t.type===ElementType.Text)e?t.data=(t.data+n).replace(re_whitespace," "):t.data+=n;else{e&&(n=n.replace(re_whitespace," "));var r=this._createDomElement({data:n,type:ElementType.Text});this._addDomElement(r)}},DomHandler.prototype.oncomment=function(n){var e=this._tagStack[this._tagStack.length-1];if(e&&e.type===ElementType.Comment){e.data+=n;return}var t={data:n,type:ElementType.Comment},r=this._createDomElement(t);this._addDomElement(r),this._tagStack.push(r)},DomHandler.prototype.oncdatastart=function(){var n={children:[{data:"",type:ElementType.Text}],type:ElementType.CDATA},e=this._createDomElement(n);this._addDomElement(e),this._tagStack.push(e)},DomHandler.prototype.oncommentend=DomHandler.prototype.oncdataend=function(){this._tagStack.pop()},DomHandler.prototype.onprocessinginstruction=function(n,e){var t=this._createDomElement({name:n,data:e,type:ElementType.Directive});this._addDomElement(t)};var domhandler=DomHandler;function renderPost(n){const{theme:e,isLoading:t,isError:r,author:s,date:o,shouldShowStats:a,stats:u,htmlToRender:c}=n;return`
    ${getPostStylesLegacy(e)}
    ${getPostStyles(e)}
    <div class="post-container">
      ${renderPostHeader(t,r,s,o)}
      ${renderPostBody(t,r,c)}
      ${a?renderPostFooter(t,r,u):""}
    </div>
  `}function renderPostHeader(n,e,t,r){return n?`
      <div class="post-header">
        <div class="post-header-left">
          <div class="author-picture">
            <div style="width: 35px; height: 35px; border-radius: 50%;" class="skeleton"></div>
          </div>
        </div>
        <div class="post-header-middle">
          <div style="width: 70%; height: 10px; border-radius: 10px;" class="skeleton"></div>
          <div style="width: 80%; height: 8px; border-radius: 10px; margin-top: 5px;" class="skeleton"></div>
        </div>
        <div class="post-header-right">
          <div style="width: 100px; height: 10px; border-radius: 10px;" class="skeleton"></div>
        </div>
      </div>
    `:e?"":`
    <div class="post-header">
      <div class="post-header-left">
        <div class="author-picture">
          ${t!=null&&t.image?`<img src="${t.image}" alt="Author" />`:""}
        </div>
      </div>
      <div class="post-header-middle">
        ${t!=null&&t.displayName?`<span class="author-name">${t.displayName}</span>`:""}
        ${t!=null&&t.nip05?`<span class="author-username">${t.nip05}</span>`:""}
      </div>
      <div class="post-header-right">
        <span class="post-date">${r}</span>
      </div>
    </div>
  `}function renderPostBody(n,e,t){return n?`
      <div class="post-body">
        <div style="width: 100%; height: 10px; border-radius: 10px; margin-bottom: 15px;" class="skeleton"></div>
        <div style="width: 100%; height: 10px; border-radius: 10px; margin-bottom: 15px;" class="skeleton"></div>
        <div style="width: 30%; height: 10px; border-radius: 10px;" class="skeleton"></div>
      </div>
    `:e?`
      <div class="post-body">
        <div class='error-container'>
          <div class="error">&#9888;</div>
          <span class="error-text">Unable to load post</span>
        </div>
        <div style="text-align: center; margin-top: 8px">
          <small class="error-text" style="font-weight: normal">Please check console for more information</small>
        </div>
      </div>
    `:`
    <div class="post-body">
      ${t}
    </div>
  `}function renderPostFooter(n,e,t){return n?`
      <div class="post-footer">
        <div class='stats-container'>
          <div class="stat">
            <div style="width: 42px; height: 20px; border-radius: 4px;" class="skeleton"></div>
          </div>
          <div class="stat">
            <div style="width: 42px; height: 20px; border-radius: 4px;" class="skeleton"></div>
          </div>
          <div class="stat">
            <div style="width: 42px; height: 20px; border-radius: 4px;" class="skeleton"></div>
          </div>
        </div>
      </div>
    `:e||!t?"":`
    <div class="post-footer">
      <div class='stats-container'>
        <div class="stat">
          ${replyIcon}
          <span>${t.replies}</span>
        </div>
        <div class="stat">
          ${heartIcon}
          <span>${t.likes}</span>
        </div>
      </div>
    </div>
  `}function getPostStyles(n){return`
    <style>
      .nostr-mention {
        color: #1DA1F2;
        font-weight: 500;
        cursor: pointer;
      }
      
      /* Embedded post styles */
      .embedded-post {
        margin: 10px 0;
        padding: 12px;
        border: 1px solid ${n==="light"?"#e1e8ed":"#38444d"};
        border-radius: 12px;
        background: ${n==="light"?"#f8f9fa":"#192734"};
      }
      
      .embedded-post-header {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
      }
      
      .embedded-author-avatar {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        overflow: hidden;
        margin-right: 8px;
      }
      
      .embedded-author-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      
      .embedded-author-info {
        display: flex;
        flex-direction: column;
        flex: 1;
      }
      
      .embedded-author-name {
        font-weight: bold;
        font-size: 14px;
        color: ${n==="light"?"#14171a":"#ffffff"};
      }
      
      .embedded-author-username {
        font-size: 12px;
        color: ${n==="light"?"#657786":"#8899a6"};
      }
      
      .embedded-post-date {
        font-size: 12px;
        color: ${n==="light"?"#657786":"#8899a6"};
      }
      
      .embedded-post-content {
        font-size: 14px;
        color: ${n==="light"?"#14171a":"#ffffff"};
        line-height: 1.4;
        white-space: pre-line;
      }
      
      .embedded-post-media {
        margin-top: 10px;
      }
      
      .embedded-media-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      
      .embedded-media-item {
        width: 100%;
        border-radius: 8px;
        overflow: hidden;
      }
      
      .embedded-media-item img,
      .embedded-media-item video {
        width: 100%;
        max-height: 300px;
        object-fit: contain;
        display: block;
      }
      
      .embedded-post-error {
        padding: 10px;
        color: #721c24;
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 4px;
        font-size: 14px;
      }
    </style>
  `}function renderEmbeddedPost(n,e,t,r){const s=(e==null?void 0:e.displayName)||"",o=[];let a=r;try{const c=[],l=new domhandler.DomHandler((g,m)=>{if(g)throw g;c.push(...m)},{normalizeWhitespace:!1,withEndIndices:!1,withStartIndices:!1}),f=new Parser(l);f.write(r),f.end(),findAll(g=>{var m;return g.type==="tag"&&(g.name==="img"||g.name==="video")&&((m=g.attribs)==null?void 0:m.src)},c).forEach(g=>{var m;if((m=g.attribs)!=null&&m.src){const v=g.name==="img"?"image":"video";o.push({type:v,url:g.attribs.src});const b=g.parent;b!=null&&b.children&&(b.children=b.children.filter(y=>y!==g))}}),a=c.map(g=>getOuterHTML(g)).join("")}catch(c){console.error("Error processing HTML content:",c),a=r}let u="";if(o.length>0){u='<div class="embedded-media-list">';for(const c of o)c.type==="image"?u+=`<div class="embedded-media-item"><img src="${c.url}" alt="Embedded image" loading="lazy" /></div>`:c.type==="video"&&(u+=`<div class="embedded-media-item"><video src="${c.url}" controls preload="none"></video></div>`);u+="</div>"}return`
    <div class="embedded-post" data-note-id="${n}">
      <div class="embedded-post-header">
        <div class="embedded-author-avatar" style="cursor: pointer;">
          ${e!=null&&e.image?`<img src="${e.image}" alt="Profile">`:""}
        </div>
        <div class="embedded-author-info" style="cursor: pointer;">
          <span class="embedded-author-name">${s}</span>
          ${e!=null&&e.nip05?`<span class="embedded-author-username">${e.nip05}</span>`:""}
        </div>
        <div class="embedded-post-date">${t}</div>
      </div>
      <div class="embedded-post-content">
        ${a}
        ${u?`<div class="embedded-post-media">${u}</div>`:""}
      </div>
    </div>
  `}class NostrPost extends HTMLElement{constructor(){super(...arguments);$e(this,ie);p(this,"rendered",!1);p(this,"nostrService",NostrService.getInstance());p(this,"isLoading",!0);p(this,"isError",!1);p(this,"theme","light");p(this,"post",null);p(this,"stats",null);p(this,"embeddedPosts",new Map);p(this,"receivedData",!1);p(this,"author",{name:"",image:"",nip05:""});p(this,"onClick",null);p(this,"onAuthorClick",null);p(this,"getRelays",()=>{const t=this.getAttribute("relays");return t?t.split(","):DEFAULT_RELAYS});p(this,"getTheme",async()=>{this.theme="light";const t=this.getAttribute("theme");if(t){if(!["light","dark"].includes(t))throw new Error(`Invalid theme '${t}'. Accepted values are 'light', 'dark'`);this.theme=t}});p(this,"renderContent",t=>{const r=[];let s="";for(const o of t)if(o.type==="text")s+=o.value;else if(o.type==="embedded-note")s&&(r.push(`<span class="text-content">${s.replace(/\n/g,"<br />")}</span>`),s=""),r.push(`<div class="embedded-post-placeholder" data-note-id="${o.noteId}"></div>`);else switch(s&&(r.push(`<span class="text-content">${s.replace(/\n/g,"<br />")}</span>`),s=""),o.type){case"image":r.push(`<div class="post-media-item"><img src="${o.value}" alt="Image"></div>`);break;case"gif":r.push(`<div class="post-media-item"><img src="${o.value}" alt="GIF"></div>`);break;case"video":r.push(`<div class="post-media-item"><video src="${o.value}" controls></video></div>`);break;case"link":r.push(`<a href="${o.value}">${o.value}</a>`);break}return s&&r.push(`<span class="text-content">${s.replace(/\n/g,"<br />")}</span>`),r.join("")})}async connectedCallback(){const t=this.getAttribute("onClick");t!==null&&window[t]&&(this.onClick=window[t]);const r=this.getAttribute("onAuthorClick");r!==null&&window[r]&&(this.onAuthorClick=window[r]),this.render(),this.rendered||(await this.nostrService.connectToNostr(this.getRelays()),this.getPost(),this.rendered=!0)}static get observedAttributes(){return["relays","id","theme","show-stats","onClick","onAuthorClick","onMentionClick"]}attributeChangedCallback(t,r,s){if(t==="relays"&&this.nostrService.connectToNostr(this.getRelays()),["relays","id"].includes(t)&&this.getPost(),t==="onClick"&&s){const o=window[s];typeof o=="function"&&(this.onClick=o)}if(t==="onAuthorClick"&&s){const o=window[s];typeof o=="function"&&(this.onAuthorClick=o)}t==="theme"&&(this.getTheme(),this.render()),t==="show-stats"&&this.render()}async getPost(){var t;try{this.isLoading=!0,this.render();const r=this.getAttribute("id")||"",s=await this.nostrService.getPost(r);if(!this.receivedData)if(!s)this.isError=!0;else{this.receivedData=!0,this.post=s;const o=await((t=this.post)==null?void 0:t.author.fetchProfile());o&&(this.author=o);const a=this.getAttribute("show-stats");if(this.post&&a){const u=await getPostStats(this.nostrService.getNDK(),this.post.id);u&&(this.stats=u)}this.isError=!1}}catch(r){throw console.log(r),this.isError=!0,r}finally{this.isLoading=!1,this.render()}}async parseText(t){let r=t,s=[];const o=/(nostr:)?(note[a-zA-Z0-9]{59,60})/g,a=[...r.matchAll(o)];for(const m of a){const v=m[0],b=m[2],y=m.index||0;s.push({id:b,position:y});try{if(!this.embeddedPosts.has(b)){const w=await this.nostrService.getPost(b);w&&this.embeddedPosts.set(b,w)}}catch(w){console.error(`Failed to fetch embedded post ${b}:`,w)}r=r.replace(v,"")}const u=r.matchAll(new RegExp(nip21_exports.NOSTR_URI_REGEX,"g"));for(let m of u){const v=nip21_exports.parse(m[0]),b=v.decoded.data;let y="";typeof b=="string"?y=b:y=b.pubkey;const S=await this.nostrService.getNDK().getUser({pubkey:y}).fetchProfile(),B=(S==null?void 0:S.displayName)||"";r=r.replace(m[0],`<a href="https://njump.me/${v.value}" target="_blank">@${B}</a>`)}const c=/(\s|^)@(\w+)/g,l=[...r.matchAll(c)];for(const m of l){const v=m[0],b=m[2];r=r.replace(v,`${m[1]}<span class="nostr-mention" data-username="${b}">@${b}</span>`)}const f=[];if(this.post){const m=this.post.getMatchingTags("a");for(const v of m){const b=v[1],y=v[2];b!=null&&b.startsWith("video/")&&y&&f.push({type:"video",value:y})}}const h=/(https:\/\/(?!njump\.me)[\w.-]+(?:\.[\w.-]+)+(?:\/[^\s]*)?)/g,g=r.match(h);if(g){let m=0;for(const v of g){const b=r.indexOf(v,m),y=b+v.length;b>m&&f.push({type:"text",value:r.substring(m,b)});const w=new URL(v);let S;w.pathname.endsWith(".jpg")||w.pathname.endsWith(".jpeg")||w.pathname.endsWith(".png")?S="image":w.pathname.endsWith(".gif")?S="gif":w.pathname.endsWith(".mp4")||w.pathname.endsWith(".webm")||w.pathname.endsWith(".mov")?S="video":S="link",f.push({type:S,value:v}),m=y}m<r.length&&f.push({type:"text",value:r.substring(m)})}else f.push({type:"text",value:r});if(s.length>0){s.sort((m,v)=>v.position-m.position);for(const m of s)f.push({type:"embedded-note",noteId:m.id})}return f}async renderEmbeddedPost(t){const r=this.embeddedPosts.get(t);if(!r)return'<div class="embedded-post-error">Post not found</div>';let s=null;try{s=await r.author.fetchProfile()}catch(c){console.error(`Failed to fetch profile for embedded post ${t}:`,c)}const o=r.created_at?new Date(r.created_at*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",a=await this.parseText(r.content),u=this.renderContent(a);return renderEmbeddedPost(t,s?{displayName:s.displayName||"",image:s.image||"",nip05:s.nip05||""}:void 0,o,u)}async replaceEmbeddedPostPlaceholders(){var r;const t=this.querySelectorAll(".embedded-post-placeholder");for(const s of t){const o=s.getAttribute("data-note-id");if(o){const a=await this.renderEmbeddedPost(o),u=document.createElement("div");u.innerHTML=a,(r=s.parentNode)==null||r.replaceChild(u.firstElementChild,s);const c=u.firstElementChild,l=c==null?void 0:c.querySelector(".embedded-author-avatar"),f=c==null?void 0:c.querySelector(".embedded-author-info");if(c&&l&&f){const h=c.getAttribute("data-note-id");if(h&&this.embeddedPosts.has(h)){const m=this.embeddedPosts.get(h).author.npub,v=b=>{b.preventDefault(),b.stopPropagation(),window.open(`https://njump.me/${m}`,"_blank")};l.addEventListener("click",v),f.addEventListener("click",v)}}}}}setupMentionClickHandlers(){this.querySelectorAll(".nostr-mention").forEach(u=>{u.addEventListener("click",c=>{var f;const l=u.getAttribute("data-username")||((f=u.textContent)==null?void 0:f.slice(1));l&&xe(this,ie,Le).call(this,l,c)})});const r=this.querySelector(".post-header-left"),s=this.querySelector(".post-header-middle");r&&r.addEventListener("click",u=>{u.preventDefault(),u.stopPropagation(),xe(this,ie,Se).call(this)}),s&&s.addEventListener("click",u=>{u.preventDefault(),u.stopPropagation(),xe(this,ie,Se).call(this)});const o=this.querySelector(".post-container");o&&o.addEventListener("click",u=>{(u.target===o||u.target.closest(".post-body")&&!u.target.closest("a, .nostr-mention, video, img"))&&xe(this,ie,Ne).call(this)}),this.querySelectorAll("a, video, img").forEach(u=>{u.addEventListener("click",c=>{c.stopPropagation()})})}async render(){var l,f;const t=((l=this.post)==null?void 0:l.content)||"",r=await this.parseText(t),s=this.renderContent(r);let o="";(f=this.post)!=null&&f.created_at&&(o=new Date(this.post.created_at*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}));const a=this.getAttribute("show-stats")==="true",u={theme:this.theme,isLoading:this.isLoading,isError:this.isError,author:this.author,date:o,shouldShowStats:a,stats:this.stats,htmlToRender:s};this.innerHTML=renderPost(u),await this.replaceEmbeddedPostPlaceholders(),this.setupMentionClickHandlers();const c=this.querySelector(".post-body");c&&c.setAttribute("style","cursor: pointer;")}}ie=new WeakSet,Ne=function(){if(this.isError||!this.post)return;if(this.onClick){this.onClick(this.post);return}let t=this.getAttribute("id");window.open(`https://njump.me/${t}`,"_blank")},Se=function(){var t,r;if(!(this.isError||!((t=this.post)!=null&&t.author.npub))){if(this.onAuthorClick){this.onAuthorClick(this.post.author.npub,this.author);return}window.open(`https://njump.me/${(r=this.post)==null?void 0:r.author.npub}`,"_blank")}},Le=function(t,r){r.preventDefault(),r.stopPropagation(),window.open(`https://njump.me/p/${t}`,"_blank")},customElements.define("nostr-post",NostrPost);function renderProfile(n){const{npub:e,userProfile:t,theme:r,isLoading:s,isStatsLoading:o,isStatsFollowersLoading:a,isStatsFollowsLoading:u,stats:c,error:l,showFollow:f,showNpub:h,onNpubClick:g,onProfileClick:m}=n,v=(t==null?void 0:t.displayName)||(t==null?void 0:t.name)||"",b=(t==null?void 0:t.nip05)||"",y=(t==null?void 0:t.image)||"",w=(t==null?void 0:t.about)||"",S=(t==null?void 0:t.website)||"",B=g?'data-nostr-action="npub-click"':"",N=m?`data-nostr-action="profile-click" data-npub="${e}"`:"";if(l)return`
      <div class="error-container">
        <div class="error">!</div>
        <div class="error-text">${l}</div>
      </div>
    `;const U=getProfileStyles(r),R=maskNPub(e),C=()=>h?`
      <div class="npub" ${B}>
        <span class="npub-text">${R}</span>
        <span class="copy-button" data-npub="${e}">
          ${copyIcon}
        </span>
      </div>
    `:"",I=()=>f?`
      <nostr-follow-button
        npub="${f}"
        theme="${r}">
      </nostr-follow-button>
    `:"";return`
    ${U}
    <div class="nostr-profile">
      <div id="profile">
        <div id="profile_banner">
          ${s?'<div style="width: 100%; height: 100%;" class="skeleton"></div>':t.banner?`<a target="_blank" data-cropped="true" class="profile_image" href="#">
                  <img src="${t.banner}" width="524px"/>
                </a>`:'<div class="banner-placeholder"></div>'}
        </div>
        <div class="dp_container">
          <div class="avatar_container">
            <div class="avatar_wrapper">
              <div class="xxl_avatar">
                <div class="backfill">
                  ${s?'<div style="width: 100%; height: 100%; border-radius: 50%" class="skeleton"></div>':`<a target="_blank" data-cropped="true" class="profile_image roundedImage" href="#" ${N}>
                        <img src="${y}" width="524px" alt="${v}" />
                      </a>`}
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="profile_actions">
          ${I()}
        </div>
        
        <div class="profile_data">
          <div class="basic_info">
            <div class="name">
              ${s?'<div style="width: 100px; height: 16px; border-radius: 20px" class="skeleton"></div>':`<div class="name-text">${v}</div>`}
            </div>
          </div>
          
          <div class="nip05-wrapper">
            <div class="nip05-container">
              ${s?'<div style="width: 75px; height: 8px; border-radius: 20px" class="skeleton"></div>':b?`<div class="nip05">
                      <span>${b}</span>
                      <span id="nip05-copy" class="copy-button">&#x2398;</span>
                    </div>`:""}
              ${C()}
            </div>
          </div>
        </div>
        
        <div class="about">
          ${s?`<div style="width: 100%; height: 12px; border-radius: 20px; margin-bottom: 12px" class="skeleton"></div>
               <div style="width: 40%; height: 12px; border-radius: 20px" class="skeleton"></div>`:w||""}
        </div>
        
        <div class="links">
          ${s?'<div style="width: 150px; height: 12px; border-radius: 20px" class="skeleton"></div>':S?`<div class="website">
                  <a target="_blank" href="${S}">${S}</a>
                </div>`:""}
        </div>
      </div>
      
      <div class="stats" data-orientation="horizontal">
        <button class="stat" data-orientation="horizontal">
          <div class="stat-inner">
            <div class="stat-value">
              ${o||u?'<div style="width: 50px; height: 28px; border-radius: 5px" class="skeleton"></div>':c.follows.toLocaleString()}
            </div>
            <div class="stat-name">Following</div>
          </div>
        </button>
        
        <button class="stat" data-orientation="horizontal">
          <div class="stat-inner">
            <div class="stat-value">
              ${o||a?'<div style="width: 50px; height: 28px; border-radius: 5px" class="skeleton"></div>':c.followers.toLocaleString()}
            </div>
            <div class="stat-name">Followers</div>
          </div>
        </button>
        
        <button class="stat" data-orientation="horizontal">
          <div class="stat-inner">
            <div class="stat-value">
              ${o?'<div style="width: 50px; height: 28px; border-radius: 5px" class="skeleton"></div>':c.notes.toLocaleString()}
            </div>
            <div class="stat-name">Notes</div>
          </div>
        </button>
        
        <button class="stat" data-orientation="horizontal">
          <div class="stat-inner">
            <div class="stat-value">
              ${o?'<div style="width: 50px; height: 28px; border-radius: 5px" class="skeleton"></div>':c.replies.toLocaleString()}
            </div>
            <div class="stat-name">Replies</div>
          </div>
        </button>
        
        <button class="stat" data-orientation="horizontal">
          <div class="stat-inner">
            <div class="stat-value">
              ${o?'<div style="width: 50px; height: 28px; border-radius: 5px" class="skeleton"></div>':c.zaps.toLocaleString()}
            </div>
            <div class="stat-name">Zaps</div>
          </div>
        </button>
      </div>
    </div>
  `}function renderLoadingState(n){return`
    ${getProfileStyles(n)}
    <div class="nostr-profile">
      <div id="profile">
        <div id="profile_banner">
          <div style="width: 100%; height: 100%;" class="skeleton"></div>
        </div>
        <div class="dp_container">
          <div class="avatar_container">
            <div class="avatar_wrapper">
              <div class="xxl_avatar">
                <div class="backfill">
                  <div style="width: 100%; height: 100%; border-radius: 50%" class="skeleton"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="profile_actions">
          <div style="width: 100px; height: 36px; border-radius: 18px;" class="skeleton"></div>
        </div>
        <div class="profile_data">
          <div class="basic_info">
            <div class="name">
              <div style="width: 100px; height: 16px; border-radius: 20px" class="skeleton"></div>
            </div>
          </div>
          <div class="nip05-wrapper">
            <div class="nip05-container">
              <div style="width: 75px; height: 8px; border-radius: 20px" class="skeleton"></div>
              <div style="width: 120px; height: 12px; border-radius: 20px; margin-top: 4px;" class="skeleton"></div>
            </div>
          </div>
        </div>
        <div class="about">
          <div style="width: 100%; height: 12px; border-radius: 20px; margin-bottom: 12px" class="skeleton"></div>
          <div style="width: 40%; height: 12px; border-radius: 20px" class="skeleton"></div>
        </div>
        <div class="links">
          <div style="width: 150px; height: 12px; border-radius: 20px" class="skeleton"></div>
        </div>
      </div>
      <div class="stats" data-orientation="horizontal">
        ${Array(4).fill(0).map(()=>`
          <button class="stat" data-orientation="horizontal">
            <div class="stat-inner">
              <div class="stat-value">
                <div style="width: 50px; height: 28px; border-radius: 5px" class="skeleton"></div>
              </div>
              <div class="stat-name">
                <div style="width: 50px; height: 12px; border-radius: 10px; margin: 4px auto 0;" class="skeleton"></div>
              </div>
            </div>
          </button>
        `).join("")}
      </div>
    </div>
  `}function renderErrorState(n,e){return`
    <style>${getProfileStyles(e)}</style>
    <div class="error-container">
      <div class="error">!</div>
      <span class="error-text">${n}</span>
    </div>
  `}class NostrProfile extends HTMLElement{constructor(){super();p(this,"rendered",!1);p(this,"nostrService",NostrService.getInstance());p(this,"userProfile",{name:"",image:"",nip05:""});p(this,"theme","light");p(this,"isLoading",!0);p(this,"isStatsLoading",!0);p(this,"isStatsFollowsLoading",!0);p(this,"isStatsFollowersLoading",!0);p(this,"isError",!1);p(this,"stats",{follows:0,followers:0,notes:0,replies:0,zaps:0,relays:0});p(this,"onClick",null);p(this,"ndkUser",null);p(this,"getRelays",()=>{const t=this.getAttribute("relays");return t?t.split(","):DEFAULT_RELAYS});p(this,"getNDKUser",async()=>{const t=this.getAttribute("npub"),r=this.getAttribute("nip05"),s=this.getAttribute("pubkey");return t?this.nostrService.getNDK().getUser({npub:t}):r?this.nostrService.getNDK().getUserFromNip05(r):s?this.nostrService.getNDK().getUser({pubkey:s}):null});p(this,"getUserProfile",async()=>{try{this.isLoading=!0,this.render();const t=await this.getNDKUser();if(t!=null&&t.npub){this.ndkUser=t;const r=await this.nostrService.getProfile({npub:t.npub,nip05:this.getAttribute("nip05")||void 0,pubkey:this.getAttribute("pubkey")||void 0});if(r){this.userProfile=r,this.isStatsLoading=!0,this.isStatsFollowsLoading=!0,this.isStatsFollowersLoading=!0;const s={...this.stats};this.nostrService.getProfileStats(t,["follows"]).then(({follows:o})=>{s.follows=o,this.stats={...this.stats,follows:o},this.isStatsFollowsLoading=!1,this.render()}).catch(o=>{console.error("Error loading follows:",o),this.isStatsFollowsLoading=!1,this.render()}),this.nostrService.getProfileStats(t,["followers"]).then(({followers:o})=>{s.followers=o,this.stats={...this.stats,followers:o},this.isStatsFollowersLoading=!1,this.render()}).catch(o=>{console.error("Error loading followers:",o),this.isStatsFollowersLoading=!1,this.render()}),this.nostrService.getProfileStats(t,["notes","replies","zaps"]).then(({notes:o,replies:a,zaps:u})=>{s.notes=o,s.replies=a,s.zaps=u,this.stats={...this.stats,notes:o,replies:a,zaps:u},this.isStatsLoading=!1,this.render()}).catch(o=>{console.error("Error loading other stats:",o),this.isStatsLoading=!1,this.render()}),this.userProfile.image||(this.userProfile.image="./assets/default_dp.png"),this.isError=!1}else console.warn(`Could not fetch profile for user ${t.npub}`),this.userProfile.image="./assets/default_dp.png",this.userProfile.name="",this.userProfile.nip05="",this.stats={follows:0,followers:0,notes:0,replies:0,zaps:0,relays:0},this.isStatsLoading=!1,this.isError=!0}else throw new Error("Either npub or nip05 should be provided")}catch(t){throw this.isError=!0,t}finally{this.isLoading=!1,this.render()}});p(this,"getTheme",async()=>{this.theme="light";const t=this.getAttribute("theme");if(t){if(!["light","dark"].includes(t))throw new Error(`Invalid theme '${t}'. Accepted values are 'light', 'dark'`);this.theme=t}});p(this,"handleClick",t=>{var a;const s=t.target.closest("[data-nostr-action]");if(!s)return;switch(t.stopPropagation(),s.getAttribute("data-nostr-action")){case"npub-click":case"profile-click":this.onProfileClick();break;case"copy-npub":this.copy(this.getAttribute("npub")||((a=this.ndkUser)==null?void 0:a.npub)||"");break;case"copy-nip05":this.copy(this.userProfile.nip05||"");break}});this.attachShadow({mode:"open"})}async connectedCallback(){this.rendered||(this.getTheme(),await this.nostrService.connectToNostr(this.getRelays()),this.getUserProfile(),this.rendered=!0)}static get observedAttributes(){return["relays","pubkey","nip05","theme","show-npub","show-follow","onClick"]}attributeChangedCallback(t,r,s){if(t==="relays"&&this.nostrService.connectToNostr(this.getRelays()),["relays","npub","nip05"].includes(t)&&this.getUserProfile(),t==="onClick"&&s){const o=window[s];typeof o=="function"?this.onClick=o:s.trim()!==""?(console.warn(`Handler '${s}' is not a valid function`),this.onClick=null):this.onClick=null}t==="theme"&&(this.getTheme(),this.render()),["show-npub","show-follow"].includes(t)&&this.render()}disconnectedCallback(){}getStyles(){return""}renderNpub(){const t=this.getAttribute("npub"),r=this.getAttribute("show-npub");if(r==="false"||r===null&&this.userProfile.nip05||this.ndkUser==null)return"";if(!t&&!this.ndkUser.npub)return console.warn("Cannot use showNpub without providing a nPub"),"";let s=t;return!s&&this.ndkUser&&this.ndkUser.npub&&(s=this.ndkUser.npub),s?`
      <div class="npub-container">
        ${this.isLoading?'<div style="width: 100px; height: 8px; border-radius: 5px" class="skeleton"></div>':`
                <span class="npub full">${s}</span>
                <span class="npub masked">${maskNPub(s)}</span>
                <span id="npub-copy" class="copy-button">&#x2398;</span>
            `}
      </div>
    `:(console.warn("Cannot use showNPub without providing a nPub"),"")}copy(t){navigator.clipboard.writeText(t)}onProfileClick(){if(this.isError)return;if(this.onClick!==null&&typeof this.onClick=="function"){this.onClick(this.userProfile);return}let t="";const r=this.getAttribute("nip05"),s=this.getAttribute("npub");if(r)t=r;else if(s)t=s;else return;window.open(`https://njump.me/${t}`,"_blank")}attachEventListeners(){var t,r;(t=this.shadowRoot)==null||t.removeEventListener("click",this.handleClick),(r=this.shadowRoot)==null||r.addEventListener("click",this.handleClick)}render(){var o,a;if(!this.shadowRoot)return;const t=this.getAttribute("show-npub")!=="false",r=this.getAttribute("show-follow")!=="false";if(this.isLoading){this.shadowRoot.innerHTML=renderLoadingState(this.theme);return}if(this.isError){this.shadowRoot.innerHTML=renderErrorState("Error fetching profile. Is the npub/nip05 correct?",this.theme);return}const s={npub:((o=this.ndkUser)==null?void 0:o.npub)||"",userProfile:this.userProfile,theme:this.theme,isLoading:this.isLoading,isStatsLoading:this.isStatsLoading,isStatsFollowersLoading:this.isStatsFollowersLoading,isStatsFollowsLoading:this.isStatsFollowsLoading,stats:{notes:this.stats.notes,replies:this.stats.replies,follows:this.stats.follows,followers:this.stats.followers,zaps:this.stats.zaps,relays:this.stats.relays},error:this.isError?"Error loading profile":null,onNpubClick:this.onProfileClick.bind(this),onProfileClick:this.onProfileClick.bind(this),showFollow:r&&((a=this.ndkUser)!=null&&a.npub)?this.ndkUser.npub:"",showNpub:t};this.shadowRoot.innerHTML=renderProfile(s),this.attachEventListeners()}}customElements.define("nostr-profile",NostrProfile);function renderFollowButton({theme:n,isLoading:e,isError:t,isFollowed:r,errorMessage:s,iconWidth:o,iconHeight:a}){const u=r?"Followed":"Follow";return`
    ${getFollowButtonStyles(n,e)}
    <div class="nostr-follow-button-container ${t?"nostr-follow-button-error":""}">
      <div class="nostr-follow-button-wrapper">
        <button class="nostr-follow-button">
          ${e?`${getLoadingNostrich(n,o,a)} <span>Following...</span>`:r?`${getSuccessAnimation(n,o,a)} ${u}`:`${getNostrLogo(o,a)} <span>Follow me on Nostr</span>`}
        </button>
      </div>
      ${t?`<small>${s}</small>`:""}
    </div>
  `}function getFollowButtonStyles(n,e){return`
    <style>
      :host {
        --nstrc-follow-btn-padding: 10px 16px;
        --nstrc-follow-btn-font-size: 16px;
        --nstrc-follow-btn-background-dark: #000000;
        --nstrc-follow-btn-background-light: #FFFFFF;
        --nstrc-follow-btn-hover-background-dark: #222222;
        --nstrc-follow-btn-hover-background-light: #F9F9F9;
        --nstrc-follow-btn-border-dark: none;
        --nstrc-follow-btn-border-light: 1px solid #DDDDDD;
        --nstrc-follow-btn-text-color-dark: #FFFFFF;
        --nstrc-follow-btn-text-color-light: #000000;
        --nstrc-follow-btn-border-radius: 8px;
        --nstrc-follow-btn-error-font-size: 12px;
        --nstrc-follow-btn-error-line-height: 1em;
        --nstrc-follow-btn-error-max-width: 250px;
        --nstrc-follow-btn-horizontal-alignment: start;
        --nstrc-follow-btn-min-height: 47px;
        --nstrc-follow-btn-background: var(--nstrc-follow-btn-background-${n});
        --nstrc-follow-btn-hover-background: var(--nstrc-follow-btn-hover-background-${n});
        --nstrc-follow-btn-text-color: var(--nstrc-follow-btn-text-color-${n});
        --nstrc-follow-btn-border: var(--nstrc-follow-btn-border-${n});
      }

      .nostr-follow-button-container {
        display: flex;
        flex-direction: column;
        font-family: Inter, sans-serif;
        gap: 8px;
        width: fit-content;
      }

      .nostr-follow-button-wrapper {
        display: flex;
        justify-content: var(--nstrc-follow-btn-horizontal-alignment);
      }
      
      .nostr-follow-button {
        display: flex;
        align-items: center;
        gap: 12px;
        border-radius: var(--nstrc-follow-btn-border-radius);
        background-color: var(--nstrc-follow-btn-background);
        cursor: pointer;
        min-height: var(--nstrc-follow-btn-min-height);
        border: var(--nstrc-follow-btn-border);
        padding: var(--nstrc-follow-btn-padding);
        font-size: var(--nstrc-follow-btn-font-size);
        color: var(--nstrc-follow-btn-text-color);
        ${e?"pointer-events: none; user-select: none; background-color: var(--nstrc-follow-btn-hover-background);":""}
      }

      .nostr-follow-button:hover {
        background-color: var(--nstrc-follow-btn-hover-background);
      }

      .nostr-follow-button-error small {
        justify-content: flex-end;
        color: red;
        font-size: var(--nstrc-follow-btn-error-font-size);
        line-height: var(--nstrc-follow-btn-error-line-height);
        max-width: var(--nstrc-follow-btn-error-max-width);
        white-space: pre-line;
      }

      .nostr-follow-button-container a {
        color: #3b82f6;
        text-decoration: underline;
      }
    </style>
  `}class NostrFollowButton extends HTMLElement{constructor(){super();p(this,"rendered",!1);p(this,"nostrService",NostrService.getInstance());p(this,"theme","light");p(this,"isLoading",!1);p(this,"isError",!1);p(this,"errorMessage","");p(this,"isFollowed",!1);p(this,"getRelays",()=>{const t=this.getAttribute("relays");return t?t.split(","):DEFAULT_RELAYS});p(this,"getTheme",async()=>{this.theme="light";const t=this.getAttribute("theme");if(t){if(!["light","dark"].includes(t))throw new Error(`Invalid theme '${t}'. Accepted values are 'light', 'dark'`);this.theme=t}});this.attachShadow({mode:"open"})}connectedCallback(){this.rendered||(this.getTheme(),this.nostrService.connectToNostr(this.getRelays()),this.render(),this.rendered=!0)}static get observedAttributes(){return["relays","npub","theme"]}attributeChangedCallback(t,r,s){t==="relays"&&this.nostrService.connectToNostr(this.getRelays()),t==="theme"&&this.getTheme(),this.render()}attachEventListeners(){var t;(t=this.shadowRoot.querySelector(".nostr-follow-button"))==null||t.addEventListener("click",async()=>{this.isError=!1;const r=new NDKNip07Signer;this.isLoading=!0,this.render();try{const s=this.nostrService.getNDK();s.signer=r,await this.nostrService.connectToNostr(this.getRelays());const o=this.getAttribute("npub"),a=this.getAttribute("nip05"),u=this.getAttribute("pubkey");if(!o&&!a&&!u)this.errorMessage="Provide npub, nip05 or pubkey",this.isError=!0;else{let c=null;if(u)c=s.getUser({pubkey:u});else if(o)c=s.getUser({npub:o});else if(a){const l=await s.getUserFromNip05(a);l&&(c=s.getUser({npub:l.npub}))}if(c!=null){const l=s.signer;if(!l)throw new Error("No signer available");const f=await l.user();f&&await f.follow(c),this.isFollowed=!0}}}catch(s){this.isError=!0;const o=s;o.message&&o.message.includes("NIP-07")?this.errorMessage=`Looks like you don't have any nostr signing browser extension.
                                Please checkout the following video to setup a signer extension - <a href="https://youtu.be/8thRYn14nB0?t=310" target="_blank">Video</a>`:this.errorMessage="Please authorize, click the button to try again!"}finally{this.isLoading=!1}this.render()})}render(){const t=this.getAttribute("icon-width"),r=this.getAttribute("icon-height"),s=t!==null?Number(t):25,o=r!==null?Number(r):25,a={theme:this.theme,isLoading:this.isLoading,isError:this.isError,isFollowed:this.isFollowed,errorMessage:this.errorMessage,iconWidth:s,iconHeight:o};this.shadowRoot.innerHTML=renderFollowButton(a),this.attachEventListeners()}}customElements.define("nostr-follow-button",NostrFollowButton),exports.NostrFollowButton=NostrFollowButton,exports.NostrPost=NostrPost,exports.NostrProfile=NostrProfile,exports.NostrProfileBadge=NostrProfileBadge,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=nostr-components.umd.js.map
